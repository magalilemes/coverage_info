<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - drivers/gpu/drm/amd/display/dc/dml/calcs/dce_calcs.c</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../../index.html">top level</a> - <a href="index.html">drivers/gpu/drm/amd/display/dc/dml/calcs</a> - dce_calcs.c<span style="font-size: 80%;"> (source / <a href="dce_calcs.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">2155</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2022-08-10 13:56:23</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">6</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<a name="2"><span class="lineNum">       2 </span>            :  * Copyright 2015 Advanced Micro Devices, Inc.</a>
<a name="3"><span class="lineNum">       3 </span>            :  *</a>
<a name="4"><span class="lineNum">       4 </span>            :  * Permission is hereby granted, free of charge, to any person obtaining a</a>
<a name="5"><span class="lineNum">       5 </span>            :  * copy of this software and associated documentation files (the &quot;Software&quot;),</a>
<a name="6"><span class="lineNum">       6 </span>            :  * to deal in the Software without restriction, including without limitation</a>
<a name="7"><span class="lineNum">       7 </span>            :  * the rights to use, copy, modify, merge, publish, distribute, sublicense,</a>
<a name="8"><span class="lineNum">       8 </span>            :  * and/or sell copies of the Software, and to permit persons to whom the</a>
<a name="9"><span class="lineNum">       9 </span>            :  * Software is furnished to do so, subject to the following conditions:</a>
<a name="10"><span class="lineNum">      10 </span>            :  *</a>
<a name="11"><span class="lineNum">      11 </span>            :  * The above copyright notice and this permission notice shall be included in</a>
<a name="12"><span class="lineNum">      12 </span>            :  * all copies or substantial portions of the Software.</a>
<a name="13"><span class="lineNum">      13 </span>            :  *</a>
<a name="14"><span class="lineNum">      14 </span>            :  * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</a>
<a name="15"><span class="lineNum">      15 </span>            :  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</a>
<a name="16"><span class="lineNum">      16 </span>            :  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</a>
<a name="17"><span class="lineNum">      17 </span>            :  * THE COPYRIGHT HOLDER(S) OR AUTHOR(S) BE LIABLE FOR ANY CLAIM, DAMAGES OR</a>
<a name="18"><span class="lineNum">      18 </span>            :  * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</a>
<a name="19"><span class="lineNum">      19 </span>            :  * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</a>
<a name="20"><span class="lineNum">      20 </span>            :  * OTHER DEALINGS IN THE SOFTWARE.</a>
<a name="21"><span class="lineNum">      21 </span>            :  *</a>
<a name="22"><span class="lineNum">      22 </span>            :  * Authors: AMD</a>
<a name="23"><span class="lineNum">      23 </span>            :  *</a>
<a name="24"><span class="lineNum">      24 </span>            :  */</a>
<a name="25"><span class="lineNum">      25 </span>            : </a>
<a name="26"><span class="lineNum">      26 </span>            : #include &lt;linux/slab.h&gt;</a>
<a name="27"><span class="lineNum">      27 </span>            : </a>
<a name="28"><span class="lineNum">      28 </span>            : #include &quot;resource.h&quot;</a>
<a name="29"><span class="lineNum">      29 </span>            : #include &quot;dm_services.h&quot;</a>
<a name="30"><span class="lineNum">      30 </span>            : #include &quot;dce_calcs.h&quot;</a>
<a name="31"><span class="lineNum">      31 </span>            : #include &quot;dc.h&quot;</a>
<a name="32"><span class="lineNum">      32 </span>            : #include &quot;core_types.h&quot;</a>
<a name="33"><span class="lineNum">      33 </span>            : #include &quot;dal_asic_id.h&quot;</a>
<a name="34"><span class="lineNum">      34 </span>            : #include &quot;calcs_logger.h&quot;</a>
<a name="35"><span class="lineNum">      35 </span>            : </a>
<a name="36"><span class="lineNum">      36 </span>            : /*</a>
<a name="37"><span class="lineNum">      37 </span>            :  * NOTE:</a>
<a name="38"><span class="lineNum">      38 </span>            :  *   This file is gcc-parseable HW gospel, coming straight from HW engineers.</a>
<a name="39"><span class="lineNum">      39 </span>            :  *</a>
<a name="40"><span class="lineNum">      40 </span>            :  * It doesn't adhere to Linux kernel style and sometimes will do things in odd</a>
<a name="41"><span class="lineNum">      41 </span>            :  * ways. Unless there is something clearly wrong with it the code should</a>
<a name="42"><span class="lineNum">      42 </span>            :  * remain as-is as it provides us with a guarantee from HW that it is correct.</a>
<a name="43"><span class="lineNum">      43 </span>            :  */</a>
<a name="44"><span class="lineNum">      44 </span>            : </a>
<a name="45"><span class="lineNum">      45 </span>            : /*******************************************************************************</a>
<a name="46"><span class="lineNum">      46 </span>            :  * Private Functions</a>
<a name="47"><span class="lineNum">      47 </span>            :  ******************************************************************************/</a>
<a name="48"><span class="lineNum">      48 </span>            : </a>
<a name="49"><span class="lineNum">      49 </span><span class="lineNoCov">          0 : static enum bw_calcs_version bw_calcs_version_from_asic_id(struct hw_asic_id asic_id)</span></a>
<a name="50"><span class="lineNum">      50 </span>            : {</a>
<a name="51"><span class="lineNum">      51 </span><span class="lineNoCov">          0 :         switch (asic_id.chip_family) {</span></a>
<a name="52"><span class="lineNum">      52 </span>            : </a>
<a name="53"><span class="lineNum">      53 </span>            :         case FAMILY_CZ:</a>
<a name="54"><span class="lineNum">      54 </span><span class="lineNoCov">          0 :                 if (ASIC_REV_IS_STONEY(asic_id.hw_internal_rev))</span></a>
<a name="55"><span class="lineNum">      55 </span>            :                         return BW_CALCS_VERSION_STONEY;</a>
<a name="56"><span class="lineNum">      56 </span>            :                 return BW_CALCS_VERSION_CARRIZO;</a>
<a name="57"><span class="lineNum">      57 </span>            : </a>
<a name="58"><span class="lineNum">      58 </span>            :         case FAMILY_VI:</a>
<a name="59"><span class="lineNum">      59 </span><span class="lineNoCov">          0 :                 if (ASIC_REV_IS_POLARIS12_V(asic_id.hw_internal_rev))</span></a>
<a name="60"><span class="lineNum">      60 </span>            :                         return BW_CALCS_VERSION_POLARIS12;</a>
<a name="61"><span class="lineNum">      61 </span><span class="lineNoCov">          0 :                 if (ASIC_REV_IS_POLARIS10_P(asic_id.hw_internal_rev))</span></a>
<a name="62"><span class="lineNum">      62 </span>            :                         return BW_CALCS_VERSION_POLARIS10;</a>
<a name="63"><span class="lineNum">      63 </span><span class="lineNoCov">          0 :                 if (ASIC_REV_IS_POLARIS11_M(asic_id.hw_internal_rev))</span></a>
<a name="64"><span class="lineNum">      64 </span>            :                         return BW_CALCS_VERSION_POLARIS11;</a>
<a name="65"><span class="lineNum">      65 </span><span class="lineNoCov">          0 :                 if (ASIC_REV_IS_VEGAM(asic_id.hw_internal_rev))</span></a>
<a name="66"><span class="lineNum">      66 </span>            :                         return BW_CALCS_VERSION_VEGAM;</a>
<a name="67"><span class="lineNum">      67 </span>            :                 return BW_CALCS_VERSION_INVALID;</a>
<a name="68"><span class="lineNum">      68 </span>            : </a>
<a name="69"><span class="lineNum">      69 </span>            :         case FAMILY_AI:</a>
<a name="70"><span class="lineNum">      70 </span>            :                 return BW_CALCS_VERSION_VEGA10;</a>
<a name="71"><span class="lineNum">      71 </span>            : </a>
<a name="72"><span class="lineNum">      72 </span>            :         default:</a>
<a name="73"><span class="lineNum">      73 </span>            :                 return BW_CALCS_VERSION_INVALID;</a>
<a name="74"><span class="lineNum">      74 </span>            :         }</a>
<a name="75"><span class="lineNum">      75 </span>            : }</a>
<a name="76"><span class="lineNum">      76 </span>            : </a>
<a name="77"><span class="lineNum">      77 </span><span class="lineNoCov">          0 : static void calculate_bandwidth(</span></a>
<a name="78"><span class="lineNum">      78 </span>            :         const struct bw_calcs_dceip *dceip,</a>
<a name="79"><span class="lineNum">      79 </span>            :         const struct bw_calcs_vbios *vbios,</a>
<a name="80"><span class="lineNum">      80 </span>            :         struct bw_calcs_data *data)</a>
<a name="81"><span class="lineNum">      81 </span>            : </a>
<a name="82"><span class="lineNum">      82 </span>            : {</a>
<a name="83"><span class="lineNum">      83 </span><span class="lineNoCov">          0 :         const int32_t pixels_per_chunk = 512;</span></a>
<a name="84"><span class="lineNum">      84 </span><span class="lineNoCov">          0 :         const int32_t high = 2;</span></a>
<a name="85"><span class="lineNum">      85 </span><span class="lineNoCov">          0 :         const int32_t mid = 1;</span></a>
<a name="86"><span class="lineNum">      86 </span><span class="lineNoCov">          0 :         const int32_t low = 0;</span></a>
<a name="87"><span class="lineNum">      87 </span><span class="lineNoCov">          0 :         const uint32_t s_low = 0;</span></a>
<a name="88"><span class="lineNum">      88 </span><span class="lineNoCov">          0 :         const uint32_t s_mid1 = 1;</span></a>
<a name="89"><span class="lineNum">      89 </span><span class="lineNoCov">          0 :         const uint32_t s_mid2 = 2;</span></a>
<a name="90"><span class="lineNum">      90 </span><span class="lineNoCov">          0 :         const uint32_t s_mid3 = 3;</span></a>
<a name="91"><span class="lineNum">      91 </span><span class="lineNoCov">          0 :         const uint32_t s_mid4 = 4;</span></a>
<a name="92"><span class="lineNum">      92 </span><span class="lineNoCov">          0 :         const uint32_t s_mid5 = 5;</span></a>
<a name="93"><span class="lineNum">      93 </span><span class="lineNoCov">          0 :         const uint32_t s_mid6 = 6;</span></a>
<a name="94"><span class="lineNum">      94 </span><span class="lineNoCov">          0 :         const uint32_t s_high = 7;</span></a>
<a name="95"><span class="lineNum">      95 </span><span class="lineNoCov">          0 :         const uint32_t dmif_chunk_buff_margin = 1;</span></a>
<a name="96"><span class="lineNum">      96 </span>            : </a>
<a name="97"><span class="lineNum">      97 </span>            :         uint32_t max_chunks_fbc_mode;</a>
<a name="98"><span class="lineNum">      98 </span>            :         int32_t num_cursor_lines;</a>
<a name="99"><span class="lineNum">      99 </span>            : </a>
<a name="100"><span class="lineNum">     100 </span>            :         int32_t i, j, k;</a>
<a name="101"><span class="lineNum">     101 </span>            :         struct bw_fixed *yclk;</a>
<a name="102"><span class="lineNum">     102 </span>            :         struct bw_fixed *sclk;</a>
<a name="103"><span class="lineNum">     103 </span>            :         bool d0_underlay_enable;</a>
<a name="104"><span class="lineNum">     104 </span>            :         bool d1_underlay_enable;</a>
<a name="105"><span class="lineNum">     105 </span>            :         bool fbc_enabled;</a>
<a name="106"><span class="lineNum">     106 </span>            :         bool lpt_enabled;</a>
<a name="107"><span class="lineNum">     107 </span>            :         enum bw_defines sclk_message;</a>
<a name="108"><span class="lineNum">     108 </span>            :         enum bw_defines yclk_message;</a>
<a name="109"><span class="lineNum">     109 </span>            :         enum bw_defines *tiling_mode;</a>
<a name="110"><span class="lineNum">     110 </span>            :         enum bw_defines *surface_type;</a>
<a name="111"><span class="lineNum">     111 </span>            :         enum bw_defines voltage;</a>
<a name="112"><span class="lineNum">     112 </span>            :         enum bw_defines pipe_check;</a>
<a name="113"><span class="lineNum">     113 </span>            :         enum bw_defines hsr_check;</a>
<a name="114"><span class="lineNum">     114 </span>            :         enum bw_defines vsr_check;</a>
<a name="115"><span class="lineNum">     115 </span>            :         enum bw_defines lb_size_check;</a>
<a name="116"><span class="lineNum">     116 </span>            :         enum bw_defines fbc_check;</a>
<a name="117"><span class="lineNum">     117 </span>            :         enum bw_defines rotation_check;</a>
<a name="118"><span class="lineNum">     118 </span>            :         enum bw_defines mode_check;</a>
<a name="119"><span class="lineNum">     119 </span>            :         enum bw_defines nbp_state_change_enable_blank;</a>
<a name="120"><span class="lineNum">     120 </span>            :         /*initialize variables*/</a>
<a name="121"><span class="lineNum">     121 </span><span class="lineNoCov">          0 :         int32_t number_of_displays_enabled = 0;</span></a>
<a name="122"><span class="lineNum">     122 </span><span class="lineNoCov">          0 :         int32_t number_of_displays_enabled_with_margin = 0;</span></a>
<a name="123"><span class="lineNum">     123 </span><span class="lineNoCov">          0 :         int32_t number_of_aligned_displays_with_no_margin = 0;</span></a>
<a name="124"><span class="lineNum">     124 </span>            : </a>
<a name="125"><span class="lineNum">     125 </span><span class="lineNoCov">          0 :         yclk = kcalloc(3, sizeof(*yclk), GFP_KERNEL);</span></a>
<a name="126"><span class="lineNum">     126 </span><span class="lineNoCov">          0 :         if (!yclk)</span></a>
<a name="127"><span class="lineNum">     127 </span>            :                 return;</a>
<a name="128"><span class="lineNum">     128 </span>            : </a>
<a name="129"><span class="lineNum">     129 </span><span class="lineNoCov">          0 :         sclk = kcalloc(8, sizeof(*sclk), GFP_KERNEL);</span></a>
<a name="130"><span class="lineNum">     130 </span><span class="lineNoCov">          0 :         if (!sclk)</span></a>
<a name="131"><span class="lineNum">     131 </span>            :                 goto free_yclk;</a>
<a name="132"><span class="lineNum">     132 </span>            : </a>
<a name="133"><span class="lineNum">     133 </span><span class="lineNoCov">          0 :         tiling_mode = kcalloc(maximum_number_of_surfaces, sizeof(*tiling_mode), GFP_KERNEL);</span></a>
<a name="134"><span class="lineNum">     134 </span><span class="lineNoCov">          0 :         if (!tiling_mode)</span></a>
<a name="135"><span class="lineNum">     135 </span>            :                 goto free_sclk;</a>
<a name="136"><span class="lineNum">     136 </span>            : </a>
<a name="137"><span class="lineNum">     137 </span><span class="lineNoCov">          0 :         surface_type = kcalloc(maximum_number_of_surfaces, sizeof(*surface_type), GFP_KERNEL);</span></a>
<a name="138"><span class="lineNum">     138 </span><span class="lineNoCov">          0 :         if (!surface_type)</span></a>
<a name="139"><span class="lineNum">     139 </span>            :                 goto free_tiling_mode;</a>
<a name="140"><span class="lineNum">     140 </span>            : </a>
<a name="141"><span class="lineNum">     141 </span><span class="lineNoCov">          0 :         yclk[low] = vbios-&gt;low_yclk;</span></a>
<a name="142"><span class="lineNum">     142 </span><span class="lineNoCov">          0 :         yclk[mid] = vbios-&gt;mid_yclk;</span></a>
<a name="143"><span class="lineNum">     143 </span><span class="lineNoCov">          0 :         yclk[high] = vbios-&gt;high_yclk;</span></a>
<a name="144"><span class="lineNum">     144 </span><span class="lineNoCov">          0 :         sclk[s_low] = vbios-&gt;low_sclk;</span></a>
<a name="145"><span class="lineNum">     145 </span><span class="lineNoCov">          0 :         sclk[s_mid1] = vbios-&gt;mid1_sclk;</span></a>
<a name="146"><span class="lineNum">     146 </span><span class="lineNoCov">          0 :         sclk[s_mid2] = vbios-&gt;mid2_sclk;</span></a>
<a name="147"><span class="lineNum">     147 </span><span class="lineNoCov">          0 :         sclk[s_mid3] = vbios-&gt;mid3_sclk;</span></a>
<a name="148"><span class="lineNum">     148 </span><span class="lineNoCov">          0 :         sclk[s_mid4] = vbios-&gt;mid4_sclk;</span></a>
<a name="149"><span class="lineNum">     149 </span><span class="lineNoCov">          0 :         sclk[s_mid5] = vbios-&gt;mid5_sclk;</span></a>
<a name="150"><span class="lineNum">     150 </span><span class="lineNoCov">          0 :         sclk[s_mid6] = vbios-&gt;mid6_sclk;</span></a>
<a name="151"><span class="lineNum">     151 </span><span class="lineNoCov">          0 :         sclk[s_high] = vbios-&gt;high_sclk;</span></a>
<a name="152"><span class="lineNum">     152 </span>            :         /*''''''''''''''''''*/</a>
<a name="153"><span class="lineNum">     153 </span>            :         /* surface assignment:*/</a>
<a name="154"><span class="lineNum">     154 </span>            :         /* 0: d0 underlay or underlay luma*/</a>
<a name="155"><span class="lineNum">     155 </span>            :         /* 1: d0 underlay chroma*/</a>
<a name="156"><span class="lineNum">     156 </span>            :         /* 2: d1 underlay or underlay luma*/</a>
<a name="157"><span class="lineNum">     157 </span>            :         /* 3: d1 underlay chroma*/</a>
<a name="158"><span class="lineNum">     158 </span>            :         /* 4: d0 graphics*/</a>
<a name="159"><span class="lineNum">     159 </span>            :         /* 5: d1 graphics*/</a>
<a name="160"><span class="lineNum">     160 </span>            :         /* 6: d2 graphics*/</a>
<a name="161"><span class="lineNum">     161 </span>            :         /* 7: d3 graphics, same mode as d2*/</a>
<a name="162"><span class="lineNum">     162 </span>            :         /* 8: d4 graphics, same mode as d2*/</a>
<a name="163"><span class="lineNum">     163 </span>            :         /* 9: d5 graphics, same mode as d2*/</a>
<a name="164"><span class="lineNum">     164 </span>            :         /* ...*/</a>
<a name="165"><span class="lineNum">     165 </span>            :         /* maximum_number_of_surfaces-2: d1 display_write_back420 luma*/</a>
<a name="166"><span class="lineNum">     166 </span>            :         /* maximum_number_of_surfaces-1: d1 display_write_back420 chroma*/</a>
<a name="167"><span class="lineNum">     167 </span>            :         /* underlay luma and chroma surface parameters from spreadsheet*/</a>
<a name="168"><span class="lineNum">     168 </span>            : </a>
<a name="169"><span class="lineNum">     169 </span>            : </a>
<a name="170"><span class="lineNum">     170 </span>            : </a>
<a name="171"><span class="lineNum">     171 </span>            : </a>
<a name="172"><span class="lineNum">     172 </span><span class="lineNoCov">          0 :         if (data-&gt;d0_underlay_mode == bw_def_none)</span></a>
<a name="173"><span class="lineNum">     173 </span>            :                 d0_underlay_enable = false;</a>
<a name="174"><span class="lineNum">     174 </span>            :         else</a>
<a name="175"><span class="lineNum">     175 </span><span class="lineNoCov">          0 :                 d0_underlay_enable = true;</span></a>
<a name="176"><span class="lineNum">     176 </span><span class="lineNoCov">          0 :         if (data-&gt;d1_underlay_mode == bw_def_none)</span></a>
<a name="177"><span class="lineNum">     177 </span>            :                 d1_underlay_enable = false;</a>
<a name="178"><span class="lineNum">     178 </span>            :         else</a>
<a name="179"><span class="lineNum">     179 </span><span class="lineNoCov">          0 :                 d1_underlay_enable = true;</span></a>
<a name="180"><span class="lineNum">     180 </span><span class="lineNoCov">          0 :         data-&gt;number_of_underlay_surfaces = d0_underlay_enable + d1_underlay_enable;</span></a>
<a name="181"><span class="lineNum">     181 </span><span class="lineNoCov">          0 :         switch (data-&gt;underlay_surface_type) {</span></a>
<a name="182"><span class="lineNum">     182 </span>            :         case bw_def_420:</a>
<a name="183"><span class="lineNum">     183 </span><span class="lineNoCov">          0 :                 surface_type[0] = bw_def_underlay420_luma;</span></a>
<a name="184"><span class="lineNum">     184 </span><span class="lineNoCov">          0 :                 surface_type[2] = bw_def_underlay420_luma;</span></a>
<a name="185"><span class="lineNum">     185 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[0] = 1;</span></a>
<a name="186"><span class="lineNum">     186 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[2] = 1;</span></a>
<a name="187"><span class="lineNum">     187 </span><span class="lineNoCov">          0 :                 surface_type[1] = bw_def_underlay420_chroma;</span></a>
<a name="188"><span class="lineNum">     188 </span><span class="lineNoCov">          0 :                 surface_type[3] = bw_def_underlay420_chroma;</span></a>
<a name="189"><span class="lineNum">     189 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[1] = 2;</span></a>
<a name="190"><span class="lineNum">     190 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[3] = 2;</span></a>
<a name="191"><span class="lineNum">     191 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[0] = dceip-&gt;underlay420_luma_lb_size_per_component;</span></a>
<a name="192"><span class="lineNum">     192 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[1] = dceip-&gt;underlay420_chroma_lb_size_per_component;</span></a>
<a name="193"><span class="lineNum">     193 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[2] = dceip-&gt;underlay420_luma_lb_size_per_component;</span></a>
<a name="194"><span class="lineNum">     194 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[3] = dceip-&gt;underlay420_chroma_lb_size_per_component;</span></a>
<a name="195"><span class="lineNum">     195 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="196"><span class="lineNum">     196 </span>            :         case bw_def_422:</a>
<a name="197"><span class="lineNum">     197 </span><span class="lineNoCov">          0 :                 surface_type[0] = bw_def_underlay422;</span></a>
<a name="198"><span class="lineNum">     198 </span><span class="lineNoCov">          0 :                 surface_type[2] = bw_def_underlay422;</span></a>
<a name="199"><span class="lineNum">     199 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[0] = 2;</span></a>
<a name="200"><span class="lineNum">     200 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[2] = 2;</span></a>
<a name="201"><span class="lineNum">     201 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[0] = dceip-&gt;underlay422_lb_size_per_component;</span></a>
<a name="202"><span class="lineNum">     202 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[2] = dceip-&gt;underlay422_lb_size_per_component;</span></a>
<a name="203"><span class="lineNum">     203 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="204"><span class="lineNum">     204 </span>            :         default:</a>
<a name="205"><span class="lineNum">     205 </span><span class="lineNoCov">          0 :                 surface_type[0] = bw_def_underlay444;</span></a>
<a name="206"><span class="lineNum">     206 </span><span class="lineNoCov">          0 :                 surface_type[2] = bw_def_underlay444;</span></a>
<a name="207"><span class="lineNum">     207 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[0] = 4;</span></a>
<a name="208"><span class="lineNum">     208 </span><span class="lineNoCov">          0 :                 data-&gt;bytes_per_pixel[2] = 4;</span></a>
<a name="209"><span class="lineNum">     209 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[0] = dceip-&gt;lb_size_per_component444;</span></a>
<a name="210"><span class="lineNum">     210 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[2] = dceip-&gt;lb_size_per_component444;</span></a>
<a name="211"><span class="lineNum">     211 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="212"><span class="lineNum">     212 </span>            :         }</a>
<a name="213"><span class="lineNum">     213 </span><span class="lineNoCov">          0 :         if (d0_underlay_enable) {</span></a>
<a name="214"><span class="lineNum">     214 </span><span class="lineNoCov">          0 :                 switch (data-&gt;underlay_surface_type) {</span></a>
<a name="215"><span class="lineNum">     215 </span>            :                 case bw_def_420:</a>
<a name="216"><span class="lineNum">     216 </span><span class="lineNoCov">          0 :                         data-&gt;enable[0] = 1;</span></a>
<a name="217"><span class="lineNum">     217 </span><span class="lineNoCov">          0 :                         data-&gt;enable[1] = 1;</span></a>
<a name="218"><span class="lineNum">     218 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="219"><span class="lineNum">     219 </span>            :                 default:</a>
<a name="220"><span class="lineNum">     220 </span><span class="lineNoCov">          0 :                         data-&gt;enable[0] = 1;</span></a>
<a name="221"><span class="lineNum">     221 </span><span class="lineNoCov">          0 :                         data-&gt;enable[1] = 0;</span></a>
<a name="222"><span class="lineNum">     222 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="223"><span class="lineNum">     223 </span>            :                 }</a>
<a name="224"><span class="lineNum">     224 </span>            :         }</a>
<a name="225"><span class="lineNum">     225 </span>            :         else {</a>
<a name="226"><span class="lineNum">     226 </span><span class="lineNoCov">          0 :                 data-&gt;enable[0] = 0;</span></a>
<a name="227"><span class="lineNum">     227 </span><span class="lineNoCov">          0 :                 data-&gt;enable[1] = 0;</span></a>
<a name="228"><span class="lineNum">     228 </span>            :         }</a>
<a name="229"><span class="lineNum">     229 </span><span class="lineNoCov">          0 :         if (d1_underlay_enable) {</span></a>
<a name="230"><span class="lineNum">     230 </span><span class="lineNoCov">          0 :                 switch (data-&gt;underlay_surface_type) {</span></a>
<a name="231"><span class="lineNum">     231 </span>            :                 case bw_def_420:</a>
<a name="232"><span class="lineNum">     232 </span><span class="lineNoCov">          0 :                         data-&gt;enable[2] = 1;</span></a>
<a name="233"><span class="lineNum">     233 </span><span class="lineNoCov">          0 :                         data-&gt;enable[3] = 1;</span></a>
<a name="234"><span class="lineNum">     234 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="235"><span class="lineNum">     235 </span>            :                 default:</a>
<a name="236"><span class="lineNum">     236 </span><span class="lineNoCov">          0 :                         data-&gt;enable[2] = 1;</span></a>
<a name="237"><span class="lineNum">     237 </span><span class="lineNoCov">          0 :                         data-&gt;enable[3] = 0;</span></a>
<a name="238"><span class="lineNum">     238 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="239"><span class="lineNum">     239 </span>            :                 }</a>
<a name="240"><span class="lineNum">     240 </span>            :         }</a>
<a name="241"><span class="lineNum">     241 </span>            :         else {</a>
<a name="242"><span class="lineNum">     242 </span><span class="lineNoCov">          0 :                 data-&gt;enable[2] = 0;</span></a>
<a name="243"><span class="lineNum">     243 </span><span class="lineNoCov">          0 :                 data-&gt;enable[3] = 0;</span></a>
<a name="244"><span class="lineNum">     244 </span>            :         }</a>
<a name="245"><span class="lineNum">     245 </span><span class="lineNoCov">          0 :         data-&gt;use_alpha[0] = 0;</span></a>
<a name="246"><span class="lineNum">     246 </span><span class="lineNoCov">          0 :         data-&gt;use_alpha[1] = 0;</span></a>
<a name="247"><span class="lineNum">     247 </span><span class="lineNoCov">          0 :         data-&gt;use_alpha[2] = 0;</span></a>
<a name="248"><span class="lineNum">     248 </span><span class="lineNoCov">          0 :         data-&gt;use_alpha[3] = 0;</span></a>
<a name="249"><span class="lineNum">     249 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_enable_for_pipe[0] = vbios-&gt;scatter_gather_enable;</span></a>
<a name="250"><span class="lineNum">     250 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_enable_for_pipe[1] = vbios-&gt;scatter_gather_enable;</span></a>
<a name="251"><span class="lineNum">     251 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_enable_for_pipe[2] = vbios-&gt;scatter_gather_enable;</span></a>
<a name="252"><span class="lineNum">     252 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_enable_for_pipe[3] = vbios-&gt;scatter_gather_enable;</span></a>
<a name="253"><span class="lineNum">     253 </span>            :         /*underlay0 same and graphics display pipe0*/</a>
<a name="254"><span class="lineNum">     254 </span><span class="lineNoCov">          0 :         data-&gt;interlace_mode[0] = data-&gt;interlace_mode[4];</span></a>
<a name="255"><span class="lineNum">     255 </span><span class="lineNoCov">          0 :         data-&gt;interlace_mode[1] = data-&gt;interlace_mode[4];</span></a>
<a name="256"><span class="lineNum">     256 </span>            :         /*underlay1 same and graphics display pipe1*/</a>
<a name="257"><span class="lineNum">     257 </span><span class="lineNoCov">          0 :         data-&gt;interlace_mode[2] = data-&gt;interlace_mode[5];</span></a>
<a name="258"><span class="lineNum">     258 </span><span class="lineNoCov">          0 :         data-&gt;interlace_mode[3] = data-&gt;interlace_mode[5];</span></a>
<a name="259"><span class="lineNum">     259 </span>            :         /*underlay0 same and graphics display pipe0*/</a>
<a name="260"><span class="lineNum">     260 </span><span class="lineNoCov">          0 :         data-&gt;h_total[0] = data-&gt;h_total[4];</span></a>
<a name="261"><span class="lineNum">     261 </span><span class="lineNoCov">          0 :         data-&gt;v_total[0] = data-&gt;v_total[4];</span></a>
<a name="262"><span class="lineNum">     262 </span><span class="lineNoCov">          0 :         data-&gt;h_total[1] = data-&gt;h_total[4];</span></a>
<a name="263"><span class="lineNum">     263 </span><span class="lineNoCov">          0 :         data-&gt;v_total[1] = data-&gt;v_total[4];</span></a>
<a name="264"><span class="lineNum">     264 </span>            :         /*underlay1 same and graphics display pipe1*/</a>
<a name="265"><span class="lineNum">     265 </span><span class="lineNoCov">          0 :         data-&gt;h_total[2] = data-&gt;h_total[5];</span></a>
<a name="266"><span class="lineNum">     266 </span><span class="lineNoCov">          0 :         data-&gt;v_total[2] = data-&gt;v_total[5];</span></a>
<a name="267"><span class="lineNum">     267 </span><span class="lineNoCov">          0 :         data-&gt;h_total[3] = data-&gt;h_total[5];</span></a>
<a name="268"><span class="lineNum">     268 </span><span class="lineNoCov">          0 :         data-&gt;v_total[3] = data-&gt;v_total[5];</span></a>
<a name="269"><span class="lineNum">     269 </span>            :         /*underlay0 same and graphics display pipe0*/</a>
<a name="270"><span class="lineNum">     270 </span><span class="lineNoCov">          0 :         data-&gt;pixel_rate[0] = data-&gt;pixel_rate[4];</span></a>
<a name="271"><span class="lineNum">     271 </span><span class="lineNoCov">          0 :         data-&gt;pixel_rate[1] = data-&gt;pixel_rate[4];</span></a>
<a name="272"><span class="lineNum">     272 </span>            :         /*underlay1 same and graphics display pipe1*/</a>
<a name="273"><span class="lineNum">     273 </span><span class="lineNoCov">          0 :         data-&gt;pixel_rate[2] = data-&gt;pixel_rate[5];</span></a>
<a name="274"><span class="lineNum">     274 </span><span class="lineNoCov">          0 :         data-&gt;pixel_rate[3] = data-&gt;pixel_rate[5];</span></a>
<a name="275"><span class="lineNum">     275 </span><span class="lineNoCov">          0 :         if ((data-&gt;underlay_tiling_mode == bw_def_array_linear_general || data-&gt;underlay_tiling_mode == bw_def_array_linear_aligned)) {</span></a>
<a name="276"><span class="lineNum">     276 </span><span class="lineNoCov">          0 :                 tiling_mode[0] = bw_def_linear;</span></a>
<a name="277"><span class="lineNum">     277 </span><span class="lineNoCov">          0 :                 tiling_mode[1] = bw_def_linear;</span></a>
<a name="278"><span class="lineNum">     278 </span><span class="lineNoCov">          0 :                 tiling_mode[2] = bw_def_linear;</span></a>
<a name="279"><span class="lineNum">     279 </span><span class="lineNoCov">          0 :                 tiling_mode[3] = bw_def_linear;</span></a>
<a name="280"><span class="lineNum">     280 </span>            :         }</a>
<a name="281"><span class="lineNum">     281 </span>            :         else {</a>
<a name="282"><span class="lineNum">     282 </span><span class="lineNoCov">          0 :                 tiling_mode[0] = bw_def_landscape;</span></a>
<a name="283"><span class="lineNum">     283 </span><span class="lineNoCov">          0 :                 tiling_mode[1] = bw_def_landscape;</span></a>
<a name="284"><span class="lineNum">     284 </span><span class="lineNoCov">          0 :                 tiling_mode[2] = bw_def_landscape;</span></a>
<a name="285"><span class="lineNum">     285 </span><span class="lineNoCov">          0 :                 tiling_mode[3] = bw_def_landscape;</span></a>
<a name="286"><span class="lineNum">     286 </span>            :         }</a>
<a name="287"><span class="lineNum">     287 </span><span class="lineNoCov">          0 :         data-&gt;lb_bpc[0] = data-&gt;underlay_lb_bpc;</span></a>
<a name="288"><span class="lineNum">     288 </span><span class="lineNoCov">          0 :         data-&gt;lb_bpc[1] = data-&gt;underlay_lb_bpc;</span></a>
<a name="289"><span class="lineNum">     289 </span><span class="lineNoCov">          0 :         data-&gt;lb_bpc[2] = data-&gt;underlay_lb_bpc;</span></a>
<a name="290"><span class="lineNum">     290 </span><span class="lineNoCov">          0 :         data-&gt;lb_bpc[3] = data-&gt;underlay_lb_bpc;</span></a>
<a name="291"><span class="lineNum">     291 </span><span class="lineNoCov">          0 :         data-&gt;compression_rate[0] = bw_int_to_fixed(1);</span></a>
<a name="292"><span class="lineNum">     292 </span><span class="lineNoCov">          0 :         data-&gt;compression_rate[1] = bw_int_to_fixed(1);</span></a>
<a name="293"><span class="lineNum">     293 </span><span class="lineNoCov">          0 :         data-&gt;compression_rate[2] = bw_int_to_fixed(1);</span></a>
<a name="294"><span class="lineNum">     294 </span><span class="lineNoCov">          0 :         data-&gt;compression_rate[3] = bw_int_to_fixed(1);</span></a>
<a name="295"><span class="lineNum">     295 </span><span class="lineNoCov">          0 :         data-&gt;access_one_channel_only[0] = 0;</span></a>
<a name="296"><span class="lineNum">     296 </span><span class="lineNoCov">          0 :         data-&gt;access_one_channel_only[1] = 0;</span></a>
<a name="297"><span class="lineNum">     297 </span><span class="lineNoCov">          0 :         data-&gt;access_one_channel_only[2] = 0;</span></a>
<a name="298"><span class="lineNum">     298 </span><span class="lineNoCov">          0 :         data-&gt;access_one_channel_only[3] = 0;</span></a>
<a name="299"><span class="lineNum">     299 </span><span class="lineNoCov">          0 :         data-&gt;cursor_width_pixels[0] = bw_int_to_fixed(0);</span></a>
<a name="300"><span class="lineNum">     300 </span><span class="lineNoCov">          0 :         data-&gt;cursor_width_pixels[1] = bw_int_to_fixed(0);</span></a>
<a name="301"><span class="lineNum">     301 </span><span class="lineNoCov">          0 :         data-&gt;cursor_width_pixels[2] = bw_int_to_fixed(0);</span></a>
<a name="302"><span class="lineNum">     302 </span><span class="lineNoCov">          0 :         data-&gt;cursor_width_pixels[3] = bw_int_to_fixed(0);</span></a>
<a name="303"><span class="lineNum">     303 </span>            :         /* graphics surface parameters from spreadsheet*/</a>
<a name="304"><span class="lineNum">     304 </span><span class="lineNoCov">          0 :         fbc_enabled = false;</span></a>
<a name="305"><span class="lineNum">     305 </span><span class="lineNoCov">          0 :         lpt_enabled = false;</span></a>
<a name="306"><span class="lineNum">     306 </span><span class="lineNoCov">          0 :         for (i = 4; i &lt;= maximum_number_of_surfaces - 3; i++) {</span></a>
<a name="307"><span class="lineNum">     307 </span><span class="lineNoCov">          0 :                 if (i &lt; data-&gt;number_of_displays + 4) {</span></a>
<a name="308"><span class="lineNum">     308 </span><span class="lineNoCov">          0 :                         if (i == 4 &amp;&amp; data-&gt;d0_underlay_mode == bw_def_underlay_only) {</span></a>
<a name="309"><span class="lineNum">     309 </span><span class="lineNoCov">          0 :                                 data-&gt;enable[i] = 0;</span></a>
<a name="310"><span class="lineNum">     310 </span><span class="lineNoCov">          0 :                                 data-&gt;use_alpha[i] = 0;</span></a>
<a name="311"><span class="lineNum">     311 </span>            :                         }</a>
<a name="312"><span class="lineNum">     312 </span><span class="lineNoCov">          0 :                         else if (i == 4 &amp;&amp; data-&gt;d0_underlay_mode == bw_def_blend) {</span></a>
<a name="313"><span class="lineNum">     313 </span><span class="lineNoCov">          0 :                                 data-&gt;enable[i] = 1;</span></a>
<a name="314"><span class="lineNum">     314 </span><span class="lineNoCov">          0 :                                 data-&gt;use_alpha[i] = 1;</span></a>
<a name="315"><span class="lineNum">     315 </span>            :                         }</a>
<a name="316"><span class="lineNum">     316 </span><span class="lineNoCov">          0 :                         else if (i == 4) {</span></a>
<a name="317"><span class="lineNum">     317 </span><span class="lineNoCov">          0 :                                 data-&gt;enable[i] = 1;</span></a>
<a name="318"><span class="lineNum">     318 </span><span class="lineNoCov">          0 :                                 data-&gt;use_alpha[i] = 0;</span></a>
<a name="319"><span class="lineNum">     319 </span>            :                         }</a>
<a name="320"><span class="lineNum">     320 </span><span class="lineNoCov">          0 :                         else if (i == 5 &amp;&amp; data-&gt;d1_underlay_mode == bw_def_underlay_only) {</span></a>
<a name="321"><span class="lineNum">     321 </span><span class="lineNoCov">          0 :                                 data-&gt;enable[i] = 0;</span></a>
<a name="322"><span class="lineNum">     322 </span><span class="lineNoCov">          0 :                                 data-&gt;use_alpha[i] = 0;</span></a>
<a name="323"><span class="lineNum">     323 </span>            :                         }</a>
<a name="324"><span class="lineNum">     324 </span><span class="lineNoCov">          0 :                         else if (i == 5 &amp;&amp; data-&gt;d1_underlay_mode == bw_def_blend) {</span></a>
<a name="325"><span class="lineNum">     325 </span><span class="lineNoCov">          0 :                                 data-&gt;enable[i] = 1;</span></a>
<a name="326"><span class="lineNum">     326 </span><span class="lineNoCov">          0 :                                 data-&gt;use_alpha[i] = 1;</span></a>
<a name="327"><span class="lineNum">     327 </span>            :                         }</a>
<a name="328"><span class="lineNum">     328 </span>            :                         else {</a>
<a name="329"><span class="lineNum">     329 </span><span class="lineNoCov">          0 :                                 data-&gt;enable[i] = 1;</span></a>
<a name="330"><span class="lineNum">     330 </span><span class="lineNoCov">          0 :                                 data-&gt;use_alpha[i] = 0;</span></a>
<a name="331"><span class="lineNum">     331 </span>            :                         }</a>
<a name="332"><span class="lineNum">     332 </span>            :                 }</a>
<a name="333"><span class="lineNum">     333 </span>            :                 else {</a>
<a name="334"><span class="lineNum">     334 </span><span class="lineNoCov">          0 :                         data-&gt;enable[i] = 0;</span></a>
<a name="335"><span class="lineNum">     335 </span><span class="lineNoCov">          0 :                         data-&gt;use_alpha[i] = 0;</span></a>
<a name="336"><span class="lineNum">     336 </span>            :                 }</a>
<a name="337"><span class="lineNum">     337 </span><span class="lineNoCov">          0 :                 data-&gt;scatter_gather_enable_for_pipe[i] = vbios-&gt;scatter_gather_enable;</span></a>
<a name="338"><span class="lineNum">     338 </span><span class="lineNoCov">          0 :                 surface_type[i] = bw_def_graphics;</span></a>
<a name="339"><span class="lineNum">     339 </span><span class="lineNoCov">          0 :                 data-&gt;lb_size_per_component[i] = dceip-&gt;lb_size_per_component444;</span></a>
<a name="340"><span class="lineNum">     340 </span><span class="lineNoCov">          0 :                 if (data-&gt;graphics_tiling_mode == bw_def_array_linear_general || data-&gt;graphics_tiling_mode == bw_def_array_linear_aligned) {</span></a>
<a name="341"><span class="lineNum">     341 </span><span class="lineNoCov">          0 :                         tiling_mode[i] = bw_def_linear;</span></a>
<a name="342"><span class="lineNum">     342 </span>            :                 }</a>
<a name="343"><span class="lineNum">     343 </span>            :                 else {</a>
<a name="344"><span class="lineNum">     344 </span><span class="lineNoCov">          0 :                         tiling_mode[i] = bw_def_tiled;</span></a>
<a name="345"><span class="lineNum">     345 </span>            :                 }</a>
<a name="346"><span class="lineNum">     346 </span><span class="lineNoCov">          0 :                 data-&gt;lb_bpc[i] = data-&gt;graphics_lb_bpc;</span></a>
<a name="347"><span class="lineNum">     347 </span><span class="lineNoCov">          0 :                 if ((data-&gt;fbc_en[i] == 1 &amp;&amp; (dceip-&gt;argb_compression_support || data-&gt;d0_underlay_mode != bw_def_blended))) {</span></a>
<a name="348"><span class="lineNum">     348 </span><span class="lineNoCov">          0 :                         data-&gt;compression_rate[i] = bw_int_to_fixed(vbios-&gt;average_compression_rate);</span></a>
<a name="349"><span class="lineNum">     349 </span><span class="lineNoCov">          0 :                         data-&gt;access_one_channel_only[i] = data-&gt;lpt_en[i];</span></a>
<a name="350"><span class="lineNum">     350 </span>            :                 }</a>
<a name="351"><span class="lineNum">     351 </span>            :                 else {</a>
<a name="352"><span class="lineNum">     352 </span><span class="lineNoCov">          0 :                         data-&gt;compression_rate[i] = bw_int_to_fixed(1);</span></a>
<a name="353"><span class="lineNum">     353 </span><span class="lineNoCov">          0 :                         data-&gt;access_one_channel_only[i] = 0;</span></a>
<a name="354"><span class="lineNum">     354 </span>            :                 }</a>
<a name="355"><span class="lineNum">     355 </span><span class="lineNoCov">          0 :                 if (data-&gt;fbc_en[i] == 1) {</span></a>
<a name="356"><span class="lineNum">     356 </span><span class="lineNoCov">          0 :                         fbc_enabled = true;</span></a>
<a name="357"><span class="lineNum">     357 </span><span class="lineNoCov">          0 :                         if (data-&gt;lpt_en[i] == 1) {</span></a>
<a name="358"><span class="lineNum">     358 </span><span class="lineNoCov">          0 :                                 lpt_enabled = true;</span></a>
<a name="359"><span class="lineNum">     359 </span>            :                         }</a>
<a name="360"><span class="lineNum">     360 </span>            :                 }</a>
<a name="361"><span class="lineNum">     361 </span><span class="lineNoCov">          0 :                 data-&gt;cursor_width_pixels[i] = bw_int_to_fixed(vbios-&gt;cursor_width);</span></a>
<a name="362"><span class="lineNum">     362 </span>            :         }</a>
<a name="363"><span class="lineNum">     363 </span>            :         /* display_write_back420*/</a>
<a name="364"><span class="lineNum">     364 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_enable_for_pipe[maximum_number_of_surfaces - 2] = 0;</span></a>
<a name="365"><span class="lineNum">     365 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_enable_for_pipe[maximum_number_of_surfaces - 1] = 0;</span></a>
<a name="366"><span class="lineNum">     366 </span><span class="lineNoCov">          0 :         if (data-&gt;d1_display_write_back_dwb_enable == 1) {</span></a>
<a name="367"><span class="lineNum">     367 </span><span class="lineNoCov">          0 :                 data-&gt;enable[maximum_number_of_surfaces - 2] = 1;</span></a>
<a name="368"><span class="lineNum">     368 </span><span class="lineNoCov">          0 :                 data-&gt;enable[maximum_number_of_surfaces - 1] = 1;</span></a>
<a name="369"><span class="lineNum">     369 </span>            :         }</a>
<a name="370"><span class="lineNum">     370 </span>            :         else {</a>
<a name="371"><span class="lineNum">     371 </span><span class="lineNoCov">          0 :                 data-&gt;enable[maximum_number_of_surfaces - 2] = 0;</span></a>
<a name="372"><span class="lineNum">     372 </span><span class="lineNoCov">          0 :                 data-&gt;enable[maximum_number_of_surfaces - 1] = 0;</span></a>
<a name="373"><span class="lineNum">     373 </span>            :         }</a>
<a name="374"><span class="lineNum">     374 </span><span class="lineNoCov">          0 :         surface_type[maximum_number_of_surfaces - 2] = bw_def_display_write_back420_luma;</span></a>
<a name="375"><span class="lineNum">     375 </span><span class="lineNoCov">          0 :         surface_type[maximum_number_of_surfaces - 1] = bw_def_display_write_back420_chroma;</span></a>
<a name="376"><span class="lineNum">     376 </span><span class="lineNoCov">          0 :         data-&gt;lb_size_per_component[maximum_number_of_surfaces - 2] = dceip-&gt;underlay420_luma_lb_size_per_component;</span></a>
<a name="377"><span class="lineNum">     377 </span><span class="lineNoCov">          0 :         data-&gt;lb_size_per_component[maximum_number_of_surfaces - 1] = dceip-&gt;underlay420_chroma_lb_size_per_component;</span></a>
<a name="378"><span class="lineNum">     378 </span><span class="lineNoCov">          0 :         data-&gt;bytes_per_pixel[maximum_number_of_surfaces - 2] = 1;</span></a>
<a name="379"><span class="lineNum">     379 </span><span class="lineNoCov">          0 :         data-&gt;bytes_per_pixel[maximum_number_of_surfaces - 1] = 2;</span></a>
<a name="380"><span class="lineNum">     380 </span><span class="lineNoCov">          0 :         data-&gt;interlace_mode[maximum_number_of_surfaces - 2] = data-&gt;interlace_mode[5];</span></a>
<a name="381"><span class="lineNum">     381 </span><span class="lineNoCov">          0 :         data-&gt;interlace_mode[maximum_number_of_surfaces - 1] = data-&gt;interlace_mode[5];</span></a>
<a name="382"><span class="lineNum">     382 </span><span class="lineNoCov">          0 :         data-&gt;h_taps[maximum_number_of_surfaces - 2] = bw_int_to_fixed(1);</span></a>
<a name="383"><span class="lineNum">     383 </span><span class="lineNoCov">          0 :         data-&gt;h_taps[maximum_number_of_surfaces - 1] = bw_int_to_fixed(1);</span></a>
<a name="384"><span class="lineNum">     384 </span><span class="lineNoCov">          0 :         data-&gt;v_taps[maximum_number_of_surfaces - 2] = bw_int_to_fixed(1);</span></a>
<a name="385"><span class="lineNum">     385 </span><span class="lineNoCov">          0 :         data-&gt;v_taps[maximum_number_of_surfaces - 1] = bw_int_to_fixed(1);</span></a>
<a name="386"><span class="lineNum">     386 </span><span class="lineNoCov">          0 :         data-&gt;rotation_angle[maximum_number_of_surfaces - 2] = bw_int_to_fixed(0);</span></a>
<a name="387"><span class="lineNum">     387 </span><span class="lineNoCov">          0 :         data-&gt;rotation_angle[maximum_number_of_surfaces - 1] = bw_int_to_fixed(0);</span></a>
<a name="388"><span class="lineNum">     388 </span><span class="lineNoCov">          0 :         tiling_mode[maximum_number_of_surfaces - 2] = bw_def_linear;</span></a>
<a name="389"><span class="lineNum">     389 </span><span class="lineNoCov">          0 :         tiling_mode[maximum_number_of_surfaces - 1] = bw_def_linear;</span></a>
<a name="390"><span class="lineNum">     390 </span><span class="lineNoCov">          0 :         data-&gt;lb_bpc[maximum_number_of_surfaces - 2] = 8;</span></a>
<a name="391"><span class="lineNum">     391 </span><span class="lineNoCov">          0 :         data-&gt;lb_bpc[maximum_number_of_surfaces - 1] = 8;</span></a>
<a name="392"><span class="lineNum">     392 </span><span class="lineNoCov">          0 :         data-&gt;compression_rate[maximum_number_of_surfaces - 2] = bw_int_to_fixed(1);</span></a>
<a name="393"><span class="lineNum">     393 </span><span class="lineNoCov">          0 :         data-&gt;compression_rate[maximum_number_of_surfaces - 1] = bw_int_to_fixed(1);</span></a>
<a name="394"><span class="lineNum">     394 </span><span class="lineNoCov">          0 :         data-&gt;access_one_channel_only[maximum_number_of_surfaces - 2] = 0;</span></a>
<a name="395"><span class="lineNum">     395 </span><span class="lineNoCov">          0 :         data-&gt;access_one_channel_only[maximum_number_of_surfaces - 1] = 0;</span></a>
<a name="396"><span class="lineNum">     396 </span>            :         /*assume display pipe1 has dwb enabled*/</a>
<a name="397"><span class="lineNum">     397 </span><span class="lineNoCov">          0 :         data-&gt;h_total[maximum_number_of_surfaces - 2] = data-&gt;h_total[5];</span></a>
<a name="398"><span class="lineNum">     398 </span><span class="lineNoCov">          0 :         data-&gt;h_total[maximum_number_of_surfaces - 1] = data-&gt;h_total[5];</span></a>
<a name="399"><span class="lineNum">     399 </span><span class="lineNoCov">          0 :         data-&gt;v_total[maximum_number_of_surfaces - 2] = data-&gt;v_total[5];</span></a>
<a name="400"><span class="lineNum">     400 </span><span class="lineNoCov">          0 :         data-&gt;v_total[maximum_number_of_surfaces - 1] = data-&gt;v_total[5];</span></a>
<a name="401"><span class="lineNum">     401 </span><span class="lineNoCov">          0 :         data-&gt;pixel_rate[maximum_number_of_surfaces - 2] = data-&gt;pixel_rate[5];</span></a>
<a name="402"><span class="lineNum">     402 </span><span class="lineNoCov">          0 :         data-&gt;pixel_rate[maximum_number_of_surfaces - 1] = data-&gt;pixel_rate[5];</span></a>
<a name="403"><span class="lineNum">     403 </span><span class="lineNoCov">          0 :         data-&gt;src_width[maximum_number_of_surfaces - 2] = data-&gt;src_width[5];</span></a>
<a name="404"><span class="lineNum">     404 </span><span class="lineNoCov">          0 :         data-&gt;src_width[maximum_number_of_surfaces - 1] = data-&gt;src_width[5];</span></a>
<a name="405"><span class="lineNum">     405 </span><span class="lineNoCov">          0 :         data-&gt;src_height[maximum_number_of_surfaces - 2] = data-&gt;src_height[5];</span></a>
<a name="406"><span class="lineNum">     406 </span><span class="lineNoCov">          0 :         data-&gt;src_height[maximum_number_of_surfaces - 1] = data-&gt;src_height[5];</span></a>
<a name="407"><span class="lineNum">     407 </span><span class="lineNoCov">          0 :         data-&gt;pitch_in_pixels[maximum_number_of_surfaces - 2] = data-&gt;src_width[5];</span></a>
<a name="408"><span class="lineNum">     408 </span><span class="lineNoCov">          0 :         data-&gt;pitch_in_pixels[maximum_number_of_surfaces - 1] = data-&gt;src_width[5];</span></a>
<a name="409"><span class="lineNum">     409 </span><span class="lineNoCov">          0 :         data-&gt;h_scale_ratio[maximum_number_of_surfaces - 2] = bw_int_to_fixed(1);</span></a>
<a name="410"><span class="lineNum">     410 </span><span class="lineNoCov">          0 :         data-&gt;h_scale_ratio[maximum_number_of_surfaces - 1] = bw_int_to_fixed(1);</span></a>
<a name="411"><span class="lineNum">     411 </span><span class="lineNoCov">          0 :         data-&gt;v_scale_ratio[maximum_number_of_surfaces - 2] = bw_int_to_fixed(1);</span></a>
<a name="412"><span class="lineNum">     412 </span><span class="lineNoCov">          0 :         data-&gt;v_scale_ratio[maximum_number_of_surfaces - 1] = bw_int_to_fixed(1);</span></a>
<a name="413"><span class="lineNum">     413 </span><span class="lineNoCov">          0 :         data-&gt;stereo_mode[maximum_number_of_surfaces - 2] = bw_def_mono;</span></a>
<a name="414"><span class="lineNum">     414 </span><span class="lineNoCov">          0 :         data-&gt;stereo_mode[maximum_number_of_surfaces - 1] = bw_def_mono;</span></a>
<a name="415"><span class="lineNum">     415 </span><span class="lineNoCov">          0 :         data-&gt;cursor_width_pixels[maximum_number_of_surfaces - 2] = bw_int_to_fixed(0);</span></a>
<a name="416"><span class="lineNum">     416 </span><span class="lineNoCov">          0 :         data-&gt;cursor_width_pixels[maximum_number_of_surfaces - 1] = bw_int_to_fixed(0);</span></a>
<a name="417"><span class="lineNum">     417 </span><span class="lineNoCov">          0 :         data-&gt;use_alpha[maximum_number_of_surfaces - 2] = 0;</span></a>
<a name="418"><span class="lineNum">     418 </span><span class="lineNoCov">          0 :         data-&gt;use_alpha[maximum_number_of_surfaces - 1] = 0;</span></a>
<a name="419"><span class="lineNum">     419 </span>            :         /*mode check calculations:*/</a>
<a name="420"><span class="lineNum">     420 </span>            :         /* mode within dce ip capabilities*/</a>
<a name="421"><span class="lineNum">     421 </span>            :         /* fbc*/</a>
<a name="422"><span class="lineNum">     422 </span>            :         /* hsr*/</a>
<a name="423"><span class="lineNum">     423 </span>            :         /* vsr*/</a>
<a name="424"><span class="lineNum">     424 </span>            :         /* lb size*/</a>
<a name="425"><span class="lineNum">     425 </span>            :         /*effective scaling source and ratios:*/</a>
<a name="426"><span class="lineNum">     426 </span>            :         /*for graphics, non-stereo, non-interlace surfaces when the size of the source and destination are the same, only one tap is used*/</a>
<a name="427"><span class="lineNum">     427 </span>            :         /*420 chroma has half the width, height, horizontal and vertical scaling ratios than luma*/</a>
<a name="428"><span class="lineNum">     428 </span>            :         /*rotating a graphic or underlay surface swaps the width, height, horizontal and vertical scaling ratios*/</a>
<a name="429"><span class="lineNum">     429 </span>            :         /*in top-bottom stereo mode there is 2:1 vertical downscaling for each eye*/</a>
<a name="430"><span class="lineNum">     430 </span>            :         /*in side-by-side stereo mode there is 2:1 horizontal downscaling for each eye*/</a>
<a name="431"><span class="lineNum">     431 </span>            :         /*in interlace mode there is 2:1 vertical downscaling for each field*/</a>
<a name="432"><span class="lineNum">     432 </span>            :         /*in panning or bezel adjustment mode the source width has an extra 128 pixels*/</a>
<a name="433"><span class="lineNum">     433 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="434"><span class="lineNum">     434 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="435"><span class="lineNum">     435 </span><span class="lineNoCov">          0 :                         if (bw_equ(data-&gt;h_scale_ratio[i], bw_int_to_fixed(1)) &amp;&amp; bw_equ(data-&gt;v_scale_ratio[i], bw_int_to_fixed(1)) &amp;&amp; surface_type[i] == bw_def_graphics &amp;&amp; data-&gt;stereo_mode[i] == bw_def_mono &amp;&amp; data-&gt;interlace_mode[i] == 0) {</span></a>
<a name="436"><span class="lineNum">     436 </span><span class="lineNoCov">          0 :                                 data-&gt;h_taps[i] = bw_int_to_fixed(1);</span></a>
<a name="437"><span class="lineNum">     437 </span><span class="lineNoCov">          0 :                                 data-&gt;v_taps[i] = bw_int_to_fixed(1);</span></a>
<a name="438"><span class="lineNum">     438 </span>            :                         }</a>
<a name="439"><span class="lineNum">     439 </span><span class="lineNoCov">          0 :                         if (surface_type[i] == bw_def_display_write_back420_chroma || surface_type[i] == bw_def_underlay420_chroma) {</span></a>
<a name="440"><span class="lineNum">     440 </span><span class="lineNoCov">          0 :                                 data-&gt;pitch_in_pixels_after_surface_type[i] = bw_div(data-&gt;pitch_in_pixels[i], bw_int_to_fixed(2));</span></a>
<a name="441"><span class="lineNum">     441 </span><span class="lineNoCov">          0 :                                 data-&gt;src_width_after_surface_type = bw_div(data-&gt;src_width[i], bw_int_to_fixed(2));</span></a>
<a name="442"><span class="lineNum">     442 </span><span class="lineNoCov">          0 :                                 data-&gt;src_height_after_surface_type = bw_div(data-&gt;src_height[i], bw_int_to_fixed(2));</span></a>
<a name="443"><span class="lineNum">     443 </span><span class="lineNoCov">          0 :                                 data-&gt;hsr_after_surface_type = bw_div(data-&gt;h_scale_ratio[i], bw_int_to_fixed(2));</span></a>
<a name="444"><span class="lineNum">     444 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr_after_surface_type = bw_div(data-&gt;v_scale_ratio[i], bw_int_to_fixed(2));</span></a>
<a name="445"><span class="lineNum">     445 </span>            :                         }</a>
<a name="446"><span class="lineNum">     446 </span>            :                         else {</a>
<a name="447"><span class="lineNum">     447 </span><span class="lineNoCov">          0 :                                 data-&gt;pitch_in_pixels_after_surface_type[i] = data-&gt;pitch_in_pixels[i];</span></a>
<a name="448"><span class="lineNum">     448 </span><span class="lineNoCov">          0 :                                 data-&gt;src_width_after_surface_type = data-&gt;src_width[i];</span></a>
<a name="449"><span class="lineNum">     449 </span><span class="lineNoCov">          0 :                                 data-&gt;src_height_after_surface_type = data-&gt;src_height[i];</span></a>
<a name="450"><span class="lineNum">     450 </span><span class="lineNoCov">          0 :                                 data-&gt;hsr_after_surface_type = data-&gt;h_scale_ratio[i];</span></a>
<a name="451"><span class="lineNum">     451 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr_after_surface_type = data-&gt;v_scale_ratio[i];</span></a>
<a name="452"><span class="lineNum">     452 </span>            :                         }</a>
<a name="453"><span class="lineNum">     453 </span><span class="lineNoCov">          0 :                         if ((bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(90)) || bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(270))) &amp;&amp; surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="454"><span class="lineNum">     454 </span><span class="lineNoCov">          0 :                                 data-&gt;src_width_after_rotation = data-&gt;src_height_after_surface_type;</span></a>
<a name="455"><span class="lineNum">     455 </span><span class="lineNoCov">          0 :                                 data-&gt;src_height_after_rotation = data-&gt;src_width_after_surface_type;</span></a>
<a name="456"><span class="lineNum">     456 </span><span class="lineNoCov">          0 :                                 data-&gt;hsr_after_rotation = data-&gt;vsr_after_surface_type;</span></a>
<a name="457"><span class="lineNum">     457 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr_after_rotation = data-&gt;hsr_after_surface_type;</span></a>
<a name="458"><span class="lineNum">     458 </span>            :                         }</a>
<a name="459"><span class="lineNum">     459 </span>            :                         else {</a>
<a name="460"><span class="lineNum">     460 </span><span class="lineNoCov">          0 :                                 data-&gt;src_width_after_rotation = data-&gt;src_width_after_surface_type;</span></a>
<a name="461"><span class="lineNum">     461 </span><span class="lineNoCov">          0 :                                 data-&gt;src_height_after_rotation = data-&gt;src_height_after_surface_type;</span></a>
<a name="462"><span class="lineNum">     462 </span><span class="lineNoCov">          0 :                                 data-&gt;hsr_after_rotation = data-&gt;hsr_after_surface_type;</span></a>
<a name="463"><span class="lineNum">     463 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr_after_rotation = data-&gt;vsr_after_surface_type;</span></a>
<a name="464"><span class="lineNum">     464 </span>            :                         }</a>
<a name="465"><span class="lineNum">     465 </span><span class="lineNoCov">          0 :                         switch (data-&gt;stereo_mode[i]) {</span></a>
<a name="466"><span class="lineNum">     466 </span>            :                         case bw_def_top_bottom:</a>
<a name="467"><span class="lineNum">     467 </span><span class="lineNoCov">          0 :                                 data-&gt;source_width_pixels[i] = data-&gt;src_width_after_rotation;</span></a>
<a name="468"><span class="lineNum">     468 </span><span class="lineNoCov">          0 :                                 data-&gt;source_height_pixels = bw_mul(bw_int_to_fixed(2), data-&gt;src_height_after_rotation);</span></a>
<a name="469"><span class="lineNum">     469 </span><span class="lineNoCov">          0 :                                 data-&gt;hsr_after_stereo = data-&gt;hsr_after_rotation;</span></a>
<a name="470"><span class="lineNum">     470 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr_after_stereo = bw_mul(bw_int_to_fixed(1), data-&gt;vsr_after_rotation);</span></a>
<a name="471"><span class="lineNum">     471 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="472"><span class="lineNum">     472 </span>            :                         case bw_def_side_by_side:</a>
<a name="473"><span class="lineNum">     473 </span><span class="lineNoCov">          0 :                                 data-&gt;source_width_pixels[i] = bw_mul(bw_int_to_fixed(2), data-&gt;src_width_after_rotation);</span></a>
<a name="474"><span class="lineNum">     474 </span><span class="lineNoCov">          0 :                                 data-&gt;source_height_pixels = data-&gt;src_height_after_rotation;</span></a>
<a name="475"><span class="lineNum">     475 </span><span class="lineNoCov">          0 :                                 data-&gt;hsr_after_stereo = bw_mul(bw_int_to_fixed(1), data-&gt;hsr_after_rotation);</span></a>
<a name="476"><span class="lineNum">     476 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr_after_stereo = data-&gt;vsr_after_rotation;</span></a>
<a name="477"><span class="lineNum">     477 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="478"><span class="lineNum">     478 </span>            :                         default:</a>
<a name="479"><span class="lineNum">     479 </span><span class="lineNoCov">          0 :                                 data-&gt;source_width_pixels[i] = data-&gt;src_width_after_rotation;</span></a>
<a name="480"><span class="lineNum">     480 </span><span class="lineNoCov">          0 :                                 data-&gt;source_height_pixels = data-&gt;src_height_after_rotation;</span></a>
<a name="481"><span class="lineNum">     481 </span><span class="lineNoCov">          0 :                                 data-&gt;hsr_after_stereo = data-&gt;hsr_after_rotation;</span></a>
<a name="482"><span class="lineNum">     482 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr_after_stereo = data-&gt;vsr_after_rotation;</span></a>
<a name="483"><span class="lineNum">     483 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="484"><span class="lineNum">     484 </span>            :                         }</a>
<a name="485"><span class="lineNum">     485 </span><span class="lineNoCov">          0 :                         data-&gt;hsr[i] = data-&gt;hsr_after_stereo;</span></a>
<a name="486"><span class="lineNum">     486 </span><span class="lineNoCov">          0 :                         if (data-&gt;interlace_mode[i]) {</span></a>
<a name="487"><span class="lineNum">     487 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr[i] = bw_mul(data-&gt;vsr_after_stereo, bw_int_to_fixed(2));</span></a>
<a name="488"><span class="lineNum">     488 </span>            :                         }</a>
<a name="489"><span class="lineNum">     489 </span>            :                         else {</a>
<a name="490"><span class="lineNum">     490 </span><span class="lineNoCov">          0 :                                 data-&gt;vsr[i] = data-&gt;vsr_after_stereo;</span></a>
<a name="491"><span class="lineNum">     491 </span>            :                         }</a>
<a name="492"><span class="lineNum">     492 </span><span class="lineNoCov">          0 :                         if (data-&gt;panning_and_bezel_adjustment != bw_def_none) {</span></a>
<a name="493"><span class="lineNum">     493 </span><span class="lineNoCov">          0 :                                 data-&gt;source_width_rounded_up_to_chunks[i] = bw_add(bw_floor2(bw_sub(data-&gt;source_width_pixels[i], bw_int_to_fixed(1)), bw_int_to_fixed(128)), bw_int_to_fixed(256));</span></a>
<a name="494"><span class="lineNum">     494 </span>            :                         }</a>
<a name="495"><span class="lineNum">     495 </span>            :                         else {</a>
<a name="496"><span class="lineNum">     496 </span><span class="lineNoCov">          0 :                                 data-&gt;source_width_rounded_up_to_chunks[i] = bw_ceil2(data-&gt;source_width_pixels[i], bw_int_to_fixed(128));</span></a>
<a name="497"><span class="lineNum">     497 </span>            :                         }</a>
<a name="498"><span class="lineNum">     498 </span><span class="lineNoCov">          0 :                         data-&gt;source_height_rounded_up_to_chunks[i] = data-&gt;source_height_pixels;</span></a>
<a name="499"><span class="lineNum">     499 </span>            :                 }</a>
<a name="500"><span class="lineNum">     500 </span>            :         }</a>
<a name="501"><span class="lineNum">     501 </span>            :         /*mode support checks:*/</a>
<a name="502"><span class="lineNum">     502 </span>            :         /*the number of graphics and underlay pipes is limited by the ip support*/</a>
<a name="503"><span class="lineNum">     503 </span>            :         /*maximum horizontal and vertical scale ratio is 4, and should not exceed the number of taps*/</a>
<a name="504"><span class="lineNum">     504 </span>            :         /*for downscaling with the pre-downscaler, the horizontal scale ratio must be more than the ceiling of one quarter of the number of taps*/</a>
<a name="505"><span class="lineNum">     505 </span>            :         /*the pre-downscaler reduces the line buffer source by the horizontal scale ratio*/</a>
<a name="506"><span class="lineNum">     506 </span>            :         /*the number of lines in the line buffer has to exceed the number of vertical taps*/</a>
<a name="507"><span class="lineNum">     507 </span>            :         /*the size of the line in the line buffer is the product of the source width and the bits per component, rounded up to a multiple of 48*/</a>
<a name="508"><span class="lineNum">     508 </span>            :         /*the size of the line in the line buffer in the case of 10 bit per component is the product of the source width rounded up to multiple of 8 and 30.023438 / 3, rounded up to a multiple of 48*/</a>
<a name="509"><span class="lineNum">     509 </span>            :         /*the size of the line in the line buffer in the case of 8 bit per component is the product of the source width rounded up to multiple of 8 and 30.023438 / 3, rounded up to a multiple of 48*/</a>
<a name="510"><span class="lineNum">     510 </span>            :         /*frame buffer compression is not supported with stereo mode, rotation, or non- 888 formats*/</a>
<a name="511"><span class="lineNum">     511 </span>            :         /*rotation is not supported with linear of stereo modes*/</a>
<a name="512"><span class="lineNum">     512 </span><span class="lineNoCov">          0 :         if (dceip-&gt;number_of_graphics_pipes &gt;= data-&gt;number_of_displays &amp;&amp; dceip-&gt;number_of_underlay_pipes &gt;= data-&gt;number_of_underlay_surfaces &amp;&amp; !(dceip-&gt;display_write_back_supported == 0 &amp;&amp; data-&gt;d1_display_write_back_dwb_enable == 1)) {</span></a>
<a name="513"><span class="lineNum">     513 </span>            :                 pipe_check = bw_def_ok;</a>
<a name="514"><span class="lineNum">     514 </span>            :         }</a>
<a name="515"><span class="lineNum">     515 </span>            :         else {</a>
<a name="516"><span class="lineNum">     516 </span><span class="lineNoCov">          0 :                 pipe_check = bw_def_notok;</span></a>
<a name="517"><span class="lineNum">     517 </span>            :         }</a>
<a name="518"><span class="lineNum">     518 </span><span class="lineNoCov">          0 :         hsr_check = bw_def_ok;</span></a>
<a name="519"><span class="lineNum">     519 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="520"><span class="lineNum">     520 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="521"><span class="lineNum">     521 </span><span class="lineNoCov">          0 :                         if (bw_neq(data-&gt;hsr[i], bw_int_to_fixed(1))) {</span></a>
<a name="522"><span class="lineNum">     522 </span><span class="lineNoCov">          0 :                                 if (bw_mtn(data-&gt;hsr[i], bw_int_to_fixed(4))) {</span></a>
<a name="523"><span class="lineNum">     523 </span>            :                                         hsr_check = bw_def_hsr_mtn_4;</a>
<a name="524"><span class="lineNum">     524 </span>            :                                 }</a>
<a name="525"><span class="lineNum">     525 </span>            :                                 else {</a>
<a name="526"><span class="lineNum">     526 </span><span class="lineNoCov">          0 :                                         if (bw_mtn(data-&gt;hsr[i], data-&gt;h_taps[i])) {</span></a>
<a name="527"><span class="lineNum">     527 </span>            :                                                 hsr_check = bw_def_hsr_mtn_h_taps;</a>
<a name="528"><span class="lineNum">     528 </span>            :                                         }</a>
<a name="529"><span class="lineNum">     529 </span>            :                                         else {</a>
<a name="530"><span class="lineNum">     530 </span><span class="lineNoCov">          0 :                                                 if (dceip-&gt;pre_downscaler_enabled == 1 &amp;&amp; bw_mtn(data-&gt;hsr[i], bw_int_to_fixed(1)) &amp;&amp; bw_leq(data-&gt;hsr[i], bw_ceil2(bw_div(data-&gt;h_taps[i], bw_int_to_fixed(4)), bw_int_to_fixed(1)))) {</span></a>
<a name="531"><span class="lineNum">     531 </span><span class="lineNoCov">          0 :                                                         hsr_check = bw_def_ceiling__h_taps_div_4___meq_hsr;</span></a>
<a name="532"><span class="lineNum">     532 </span>            :                                                 }</a>
<a name="533"><span class="lineNum">     533 </span>            :                                         }</a>
<a name="534"><span class="lineNum">     534 </span>            :                                 }</a>
<a name="535"><span class="lineNum">     535 </span>            :                         }</a>
<a name="536"><span class="lineNum">     536 </span>            :                 }</a>
<a name="537"><span class="lineNum">     537 </span>            :         }</a>
<a name="538"><span class="lineNum">     538 </span>            :         vsr_check = bw_def_ok;</a>
<a name="539"><span class="lineNum">     539 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="540"><span class="lineNum">     540 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="541"><span class="lineNum">     541 </span><span class="lineNoCov">          0 :                         if (bw_neq(data-&gt;vsr[i], bw_int_to_fixed(1))) {</span></a>
<a name="542"><span class="lineNum">     542 </span><span class="lineNoCov">          0 :                                 if (bw_mtn(data-&gt;vsr[i], bw_int_to_fixed(4))) {</span></a>
<a name="543"><span class="lineNum">     543 </span>            :                                         vsr_check = bw_def_vsr_mtn_4;</a>
<a name="544"><span class="lineNum">     544 </span>            :                                 }</a>
<a name="545"><span class="lineNum">     545 </span>            :                                 else {</a>
<a name="546"><span class="lineNum">     546 </span><span class="lineNoCov">          0 :                                         if (bw_mtn(data-&gt;vsr[i], data-&gt;v_taps[i])) {</span></a>
<a name="547"><span class="lineNum">     547 </span><span class="lineNoCov">          0 :                                                 vsr_check = bw_def_vsr_mtn_v_taps;</span></a>
<a name="548"><span class="lineNum">     548 </span>            :                                         }</a>
<a name="549"><span class="lineNum">     549 </span>            :                                 }</a>
<a name="550"><span class="lineNum">     550 </span>            :                         }</a>
<a name="551"><span class="lineNum">     551 </span>            :                 }</a>
<a name="552"><span class="lineNum">     552 </span>            :         }</a>
<a name="553"><span class="lineNum">     553 </span>            :         lb_size_check = bw_def_ok;</a>
<a name="554"><span class="lineNum">     554 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="555"><span class="lineNum">     555 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="556"><span class="lineNum">     556 </span><span class="lineNoCov">          0 :                         if ((dceip-&gt;pre_downscaler_enabled &amp;&amp; bw_mtn(data-&gt;hsr[i], bw_int_to_fixed(1)))) {</span></a>
<a name="557"><span class="lineNum">     557 </span><span class="lineNoCov">          0 :                                 data-&gt;source_width_in_lb = bw_div(data-&gt;source_width_pixels[i], data-&gt;hsr[i]);</span></a>
<a name="558"><span class="lineNum">     558 </span>            :                         }</a>
<a name="559"><span class="lineNum">     559 </span>            :                         else {</a>
<a name="560"><span class="lineNum">     560 </span><span class="lineNoCov">          0 :                                 data-&gt;source_width_in_lb = data-&gt;source_width_pixels[i];</span></a>
<a name="561"><span class="lineNum">     561 </span>            :                         }</a>
<a name="562"><span class="lineNum">     562 </span><span class="lineNoCov">          0 :                         switch (data-&gt;lb_bpc[i]) {</span></a>
<a name="563"><span class="lineNum">     563 </span>            :                         case 8:</a>
<a name="564"><span class="lineNum">     564 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_line_pitch = bw_ceil2(bw_mul(bw_div(bw_frc_to_fixed(2401171875ul, 100000000), bw_int_to_fixed(3)), bw_ceil2(data-&gt;source_width_in_lb, bw_int_to_fixed(8))), bw_int_to_fixed(48));</span></a>
<a name="565"><span class="lineNum">     565 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="566"><span class="lineNum">     566 </span>            :                         case 10:</a>
<a name="567"><span class="lineNum">     567 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_line_pitch = bw_ceil2(bw_mul(bw_div(bw_frc_to_fixed(300234375, 10000000), bw_int_to_fixed(3)), bw_ceil2(data-&gt;source_width_in_lb, bw_int_to_fixed(8))), bw_int_to_fixed(48));</span></a>
<a name="568"><span class="lineNum">     568 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="569"><span class="lineNum">     569 </span>            :                         default:</a>
<a name="570"><span class="lineNum">     570 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_line_pitch = bw_ceil2(bw_mul(bw_int_to_fixed(data-&gt;lb_bpc[i]), data-&gt;source_width_in_lb), bw_int_to_fixed(48));</span></a>
<a name="571"><span class="lineNum">     571 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="572"><span class="lineNum">     572 </span>            :                         }</a>
<a name="573"><span class="lineNum">     573 </span><span class="lineNoCov">          0 :                         data-&gt;lb_partitions[i] = bw_floor2(bw_div(data-&gt;lb_size_per_component[i], data-&gt;lb_line_pitch), bw_int_to_fixed(1));</span></a>
<a name="574"><span class="lineNum">     574 </span>            :                         /*clamp the partitions to the maxium number supported by the lb*/</a>
<a name="575"><span class="lineNum">     575 </span><span class="lineNoCov">          0 :                         if ((surface_type[i] != bw_def_graphics || dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching == 1)) {</span></a>
<a name="576"><span class="lineNum">     576 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_partitions_max[i] = bw_int_to_fixed(10);</span></a>
<a name="577"><span class="lineNum">     577 </span>            :                         }</a>
<a name="578"><span class="lineNum">     578 </span>            :                         else {</a>
<a name="579"><span class="lineNum">     579 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_partitions_max[i] = bw_int_to_fixed(7);</span></a>
<a name="580"><span class="lineNum">     580 </span>            :                         }</a>
<a name="581"><span class="lineNum">     581 </span><span class="lineNoCov">          0 :                         data-&gt;lb_partitions[i] = bw_min2(data-&gt;lb_partitions_max[i], data-&gt;lb_partitions[i]);</span></a>
<a name="582"><span class="lineNum">     582 </span><span class="lineNoCov">          0 :                         if (bw_mtn(bw_add(data-&gt;v_taps[i], bw_int_to_fixed(1)), data-&gt;lb_partitions[i])) {</span></a>
<a name="583"><span class="lineNum">     583 </span><span class="lineNoCov">          0 :                                 lb_size_check = bw_def_notok;</span></a>
<a name="584"><span class="lineNum">     584 </span>            :                         }</a>
<a name="585"><span class="lineNum">     585 </span>            :                 }</a>
<a name="586"><span class="lineNum">     586 </span>            :         }</a>
<a name="587"><span class="lineNum">     587 </span>            :         fbc_check = bw_def_ok;</a>
<a name="588"><span class="lineNum">     588 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="589"><span class="lineNum">     589 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i] &amp;&amp; data-&gt;fbc_en[i] == 1 &amp;&amp; (bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(90)) || bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(270)) || data-&gt;stereo_mode[i] != bw_def_mono || data-&gt;bytes_per_pixel[i] != 4)) {</span></a>
<a name="590"><span class="lineNum">     590 </span>            :                         fbc_check = bw_def_invalid_rotation_or_bpp_or_stereo;</a>
<a name="591"><span class="lineNum">     591 </span>            :                 }</a>
<a name="592"><span class="lineNum">     592 </span>            :         }</a>
<a name="593"><span class="lineNum">     593 </span>            :         rotation_check = bw_def_ok;</a>
<a name="594"><span class="lineNum">     594 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="595"><span class="lineNum">     595 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="596"><span class="lineNum">     596 </span><span class="lineNoCov">          0 :                         if ((bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(90)) || bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(270))) &amp;&amp; (tiling_mode[i] == bw_def_linear || data-&gt;stereo_mode[i] != bw_def_mono)) {</span></a>
<a name="597"><span class="lineNum">     597 </span><span class="lineNoCov">          0 :                                 rotation_check = bw_def_invalid_linear_or_stereo_mode;</span></a>
<a name="598"><span class="lineNum">     598 </span>            :                         }</a>
<a name="599"><span class="lineNum">     599 </span>            :                 }</a>
<a name="600"><span class="lineNum">     600 </span>            :         }</a>
<a name="601"><span class="lineNum">     601 </span><span class="lineNoCov">          0 :         if (pipe_check == bw_def_ok &amp;&amp; hsr_check == bw_def_ok &amp;&amp; vsr_check == bw_def_ok &amp;&amp; lb_size_check == bw_def_ok &amp;&amp; fbc_check == bw_def_ok &amp;&amp; rotation_check == bw_def_ok) {</span></a>
<a name="602"><span class="lineNum">     602 </span>            :                 mode_check = bw_def_ok;</a>
<a name="603"><span class="lineNum">     603 </span>            :         }</a>
<a name="604"><span class="lineNum">     604 </span>            :         else {</a>
<a name="605"><span class="lineNum">     605 </span><span class="lineNoCov">          0 :                 mode_check = bw_def_notok;</span></a>
<a name="606"><span class="lineNum">     606 </span>            :         }</a>
<a name="607"><span class="lineNum">     607 </span>            :         /*number of memory channels for write-back client*/</a>
<a name="608"><span class="lineNum">     608 </span><span class="lineNoCov">          0 :         data-&gt;number_of_dram_wrchannels = vbios-&gt;number_of_dram_channels;</span></a>
<a name="609"><span class="lineNum">     609 </span><span class="lineNoCov">          0 :         data-&gt;number_of_dram_channels = vbios-&gt;number_of_dram_channels;</span></a>
<a name="610"><span class="lineNum">     610 </span>            :         /*modify number of memory channels if lpt mode is enabled*/</a>
<a name="611"><span class="lineNum">     611 </span>            :         /* low power tiling mode register*/</a>
<a name="612"><span class="lineNum">     612 </span>            :         /* 0 = use channel 0*/</a>
<a name="613"><span class="lineNum">     613 </span>            :         /* 1 = use channel 0 and 1*/</a>
<a name="614"><span class="lineNum">     614 </span>            :         /* 2 = use channel 0,1,2,3*/</a>
<a name="615"><span class="lineNum">     615 </span><span class="lineNoCov">          0 :         if ((fbc_enabled == 1 &amp;&amp; lpt_enabled == 1)) {</span></a>
<a name="616"><span class="lineNum">     616 </span><span class="lineNoCov">          0 :                 if (vbios-&gt;memory_type == bw_def_hbm)</span></a>
<a name="617"><span class="lineNum">     617 </span><span class="lineNoCov">          0 :                         data-&gt;dram_efficiency = bw_frc_to_fixed(5, 10);</span></a>
<a name="618"><span class="lineNum">     618 </span>            :                 else</a>
<a name="619"><span class="lineNum">     619 </span><span class="lineNoCov">          0 :                         data-&gt;dram_efficiency = bw_int_to_fixed(1);</span></a>
<a name="620"><span class="lineNum">     620 </span>            : </a>
<a name="621"><span class="lineNum">     621 </span>            : </a>
<a name="622"><span class="lineNum">     622 </span><span class="lineNoCov">          0 :                 if (dceip-&gt;low_power_tiling_mode == 0) {</span></a>
<a name="623"><span class="lineNum">     623 </span><span class="lineNoCov">          0 :                         data-&gt;number_of_dram_channels = 1;</span></a>
<a name="624"><span class="lineNum">     624 </span>            :                 }</a>
<a name="625"><span class="lineNum">     625 </span><span class="lineNoCov">          0 :                 else if (dceip-&gt;low_power_tiling_mode == 1) {</span></a>
<a name="626"><span class="lineNum">     626 </span><span class="lineNoCov">          0 :                         data-&gt;number_of_dram_channels = 2;</span></a>
<a name="627"><span class="lineNum">     627 </span>            :                 }</a>
<a name="628"><span class="lineNum">     628 </span><span class="lineNoCov">          0 :                 else if (dceip-&gt;low_power_tiling_mode == 2) {</span></a>
<a name="629"><span class="lineNum">     629 </span><span class="lineNoCov">          0 :                         data-&gt;number_of_dram_channels = 4;</span></a>
<a name="630"><span class="lineNum">     630 </span>            :                 }</a>
<a name="631"><span class="lineNum">     631 </span>            :                 else {</a>
<a name="632"><span class="lineNum">     632 </span><span class="lineNoCov">          0 :                         data-&gt;number_of_dram_channels = 1;</span></a>
<a name="633"><span class="lineNum">     633 </span>            :                 }</a>
<a name="634"><span class="lineNum">     634 </span>            :         }</a>
<a name="635"><span class="lineNum">     635 </span>            :         else {</a>
<a name="636"><span class="lineNum">     636 </span><span class="lineNoCov">          0 :                 if (vbios-&gt;memory_type == bw_def_hbm)</span></a>
<a name="637"><span class="lineNum">     637 </span><span class="lineNoCov">          0 :                         data-&gt;dram_efficiency = bw_frc_to_fixed(5, 10);</span></a>
<a name="638"><span class="lineNum">     638 </span>            :                 else</a>
<a name="639"><span class="lineNum">     639 </span><span class="lineNoCov">          0 :                         data-&gt;dram_efficiency = bw_frc_to_fixed(8, 10);</span></a>
<a name="640"><span class="lineNum">     640 </span>            :         }</a>
<a name="641"><span class="lineNum">     641 </span>            :         /*memory request size and latency hiding:*/</a>
<a name="642"><span class="lineNum">     642 </span>            :         /*request size is normally 64 byte, 2-line interleaved, with full latency hiding*/</a>
<a name="643"><span class="lineNum">     643 </span>            :         /*the display write-back requests are single line*/</a>
<a name="644"><span class="lineNum">     644 </span>            :         /*for tiled graphics surfaces, or undelay surfaces with width higher than the maximum size for full efficiency, request size is 32 byte in 8 and 16 bpp or if the rotation is orthogonal to the tiling grain. only half is useful of the bytes in the request size in 8 bpp or in 32 bpp if the rotation is orthogonal to the tiling grain.*/</a>
<a name="645"><span class="lineNum">     645 </span>            :         /*for undelay surfaces with width lower than the maximum size for full efficiency, requests are 4-line interleaved in 16bpp if the rotation is parallel to the tiling grain, and 8-line interleaved with 4-line latency hiding in 8bpp or if the rotation is orthogonal to the tiling grain.*/</a>
<a name="646"><span class="lineNum">     646 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="647"><span class="lineNum">     647 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="648"><span class="lineNum">     648 </span><span class="lineNoCov">          0 :                         if ((bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(90)) || bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(270)))) {</span></a>
<a name="649"><span class="lineNum">     649 </span><span class="lineNoCov">          0 :                                 if ((i &lt; 4)) {</span></a>
<a name="650"><span class="lineNum">     650 </span>            :                                         /*underlay portrait tiling mode is not supported*/</a>
<a name="651"><span class="lineNum">     651 </span><span class="lineNoCov">          0 :                                         data-&gt;orthogonal_rotation[i] = 1;</span></a>
<a name="652"><span class="lineNum">     652 </span>            :                                 }</a>
<a name="653"><span class="lineNum">     653 </span>            :                                 else {</a>
<a name="654"><span class="lineNum">     654 </span>            :                                         /*graphics portrait tiling mode*/</a>
<a name="655"><span class="lineNum">     655 </span><span class="lineNoCov">          0 :                                         if (data-&gt;graphics_micro_tile_mode == bw_def_rotated_micro_tiling) {</span></a>
<a name="656"><span class="lineNum">     656 </span><span class="lineNoCov">          0 :                                                 data-&gt;orthogonal_rotation[i] = 0;</span></a>
<a name="657"><span class="lineNum">     657 </span>            :                                         }</a>
<a name="658"><span class="lineNum">     658 </span>            :                                         else {</a>
<a name="659"><span class="lineNum">     659 </span><span class="lineNoCov">          0 :                                                 data-&gt;orthogonal_rotation[i] = 1;</span></a>
<a name="660"><span class="lineNum">     660 </span>            :                                         }</a>
<a name="661"><span class="lineNum">     661 </span>            :                                 }</a>
<a name="662"><span class="lineNum">     662 </span>            :                         }</a>
<a name="663"><span class="lineNum">     663 </span>            :                         else {</a>
<a name="664"><span class="lineNum">     664 </span><span class="lineNoCov">          0 :                                 if ((i &lt; 4)) {</span></a>
<a name="665"><span class="lineNum">     665 </span>            :                                         /*underlay landscape tiling mode is only supported*/</a>
<a name="666"><span class="lineNum">     666 </span><span class="lineNoCov">          0 :                                         if (data-&gt;underlay_micro_tile_mode == bw_def_display_micro_tiling) {</span></a>
<a name="667"><span class="lineNum">     667 </span><span class="lineNoCov">          0 :                                                 data-&gt;orthogonal_rotation[i] = 0;</span></a>
<a name="668"><span class="lineNum">     668 </span>            :                                         }</a>
<a name="669"><span class="lineNum">     669 </span>            :                                         else {</a>
<a name="670"><span class="lineNum">     670 </span><span class="lineNoCov">          0 :                                                 data-&gt;orthogonal_rotation[i] = 1;</span></a>
<a name="671"><span class="lineNum">     671 </span>            :                                         }</a>
<a name="672"><span class="lineNum">     672 </span>            :                                 }</a>
<a name="673"><span class="lineNum">     673 </span>            :                                 else {</a>
<a name="674"><span class="lineNum">     674 </span>            :                                         /*graphics landscape tiling mode*/</a>
<a name="675"><span class="lineNum">     675 </span><span class="lineNoCov">          0 :                                         if (data-&gt;graphics_micro_tile_mode == bw_def_display_micro_tiling) {</span></a>
<a name="676"><span class="lineNum">     676 </span><span class="lineNoCov">          0 :                                                 data-&gt;orthogonal_rotation[i] = 0;</span></a>
<a name="677"><span class="lineNum">     677 </span>            :                                         }</a>
<a name="678"><span class="lineNum">     678 </span>            :                                         else {</a>
<a name="679"><span class="lineNum">     679 </span><span class="lineNoCov">          0 :                                                 data-&gt;orthogonal_rotation[i] = 1;</span></a>
<a name="680"><span class="lineNum">     680 </span>            :                                         }</a>
<a name="681"><span class="lineNum">     681 </span>            :                                 }</a>
<a name="682"><span class="lineNum">     682 </span>            :                         }</a>
<a name="683"><span class="lineNum">     683 </span><span class="lineNoCov">          0 :                         if (bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(90)) || bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(270))) {</span></a>
<a name="684"><span class="lineNum">     684 </span><span class="lineNoCov">          0 :                                 data-&gt;underlay_maximum_source_efficient_for_tiling = dceip-&gt;underlay_maximum_height_efficient_for_tiling;</span></a>
<a name="685"><span class="lineNum">     685 </span>            :                         }</a>
<a name="686"><span class="lineNum">     686 </span>            :                         else {</a>
<a name="687"><span class="lineNum">     687 </span><span class="lineNoCov">          0 :                                 data-&gt;underlay_maximum_source_efficient_for_tiling = dceip-&gt;underlay_maximum_width_efficient_for_tiling;</span></a>
<a name="688"><span class="lineNum">     688 </span>            :                         }</a>
<a name="689"><span class="lineNum">     689 </span><span class="lineNoCov">          0 :                         if (surface_type[i] == bw_def_display_write_back420_luma || surface_type[i] == bw_def_display_write_back420_chroma) {</span></a>
<a name="690"><span class="lineNum">     690 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="691"><span class="lineNum">     691 </span><span class="lineNoCov">          0 :                                 data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="692"><span class="lineNum">     692 </span><span class="lineNoCov">          0 :                                 data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(1);</span></a>
<a name="693"><span class="lineNum">     693 </span><span class="lineNoCov">          0 :                                 data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(1);</span></a>
<a name="694"><span class="lineNum">     694 </span>            :                         }</a>
<a name="695"><span class="lineNum">     695 </span><span class="lineNoCov">          0 :                         else if (tiling_mode[i] == bw_def_linear) {</span></a>
<a name="696"><span class="lineNum">     696 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="697"><span class="lineNum">     697 </span><span class="lineNoCov">          0 :                                 data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="698"><span class="lineNum">     698 </span><span class="lineNoCov">          0 :                                 data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(2);</span></a>
<a name="699"><span class="lineNum">     699 </span><span class="lineNoCov">          0 :                                 data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(2);</span></a>
<a name="700"><span class="lineNum">     700 </span>            :                         }</a>
<a name="701"><span class="lineNum">     701 </span>            :                         else {</a>
<a name="702"><span class="lineNum">     702 </span><span class="lineNoCov">          0 :                                 if (surface_type[i] == bw_def_graphics || (bw_mtn(data-&gt;source_width_rounded_up_to_chunks[i], bw_ceil2(data-&gt;underlay_maximum_source_efficient_for_tiling, bw_int_to_fixed(256))))) {</span></a>
<a name="703"><span class="lineNum">     703 </span><span class="lineNoCov">          0 :                                         switch (data-&gt;bytes_per_pixel[i]) {</span></a>
<a name="704"><span class="lineNum">     704 </span>            :                                         case 8:</a>
<a name="705"><span class="lineNum">     705 </span><span class="lineNoCov">          0 :                                                 data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(2);</span></a>
<a name="706"><span class="lineNum">     706 </span><span class="lineNoCov">          0 :                                                 data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(2);</span></a>
<a name="707"><span class="lineNum">     707 </span><span class="lineNoCov">          0 :                                                 if (data-&gt;orthogonal_rotation[i]) {</span></a>
<a name="708"><span class="lineNum">     708 </span><span class="lineNoCov">          0 :                                                         data-&gt;bytes_per_request[i] = bw_int_to_fixed(32);</span></a>
<a name="709"><span class="lineNum">     709 </span><span class="lineNoCov">          0 :                                                         data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(32);</span></a>
<a name="710"><span class="lineNum">     710 </span>            :                                                 }</a>
<a name="711"><span class="lineNum">     711 </span>            :                                                 else {</a>
<a name="712"><span class="lineNum">     712 </span><span class="lineNoCov">          0 :                                                         data-&gt;bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="713"><span class="lineNum">     713 </span><span class="lineNoCov">          0 :                                                         data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="714"><span class="lineNum">     714 </span>            :                                                 }</a>
<a name="715"><span class="lineNum">     715 </span>            :                                                 break;</a>
<a name="716"><span class="lineNum">     716 </span>            :                                         case 4:</a>
<a name="717"><span class="lineNum">     717 </span><span class="lineNoCov">          0 :                                                 if (data-&gt;orthogonal_rotation[i]) {</span></a>
<a name="718"><span class="lineNum">     718 </span><span class="lineNoCov">          0 :                                                         data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(2);</span></a>
<a name="719"><span class="lineNum">     719 </span><span class="lineNoCov">          0 :                                                         data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(2);</span></a>
<a name="720"><span class="lineNum">     720 </span><span class="lineNoCov">          0 :                                                         data-&gt;bytes_per_request[i] = bw_int_to_fixed(32);</span></a>
<a name="721"><span class="lineNum">     721 </span><span class="lineNoCov">          0 :                                                         data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(16);</span></a>
<a name="722"><span class="lineNum">     722 </span>            :                                                 }</a>
<a name="723"><span class="lineNum">     723 </span>            :                                                 else {</a>
<a name="724"><span class="lineNum">     724 </span><span class="lineNoCov">          0 :                                                         data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(2);</span></a>
<a name="725"><span class="lineNum">     725 </span><span class="lineNoCov">          0 :                                                         data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(2);</span></a>
<a name="726"><span class="lineNum">     726 </span><span class="lineNoCov">          0 :                                                         data-&gt;bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="727"><span class="lineNum">     727 </span><span class="lineNoCov">          0 :                                                         data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="728"><span class="lineNum">     728 </span>            :                                                 }</a>
<a name="729"><span class="lineNum">     729 </span>            :                                                 break;</a>
<a name="730"><span class="lineNum">     730 </span>            :                                         case 2:</a>
<a name="731"><span class="lineNum">     731 </span><span class="lineNoCov">          0 :                                                 data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(2);</span></a>
<a name="732"><span class="lineNum">     732 </span><span class="lineNoCov">          0 :                                                 data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(2);</span></a>
<a name="733"><span class="lineNum">     733 </span><span class="lineNoCov">          0 :                                                 data-&gt;bytes_per_request[i] = bw_int_to_fixed(32);</span></a>
<a name="734"><span class="lineNum">     734 </span><span class="lineNoCov">          0 :                                                 data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(32);</span></a>
<a name="735"><span class="lineNum">     735 </span><span class="lineNoCov">          0 :                                                 break;</span></a>
<a name="736"><span class="lineNum">     736 </span>            :                                         default:</a>
<a name="737"><span class="lineNum">     737 </span><span class="lineNoCov">          0 :                                                 data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(2);</span></a>
<a name="738"><span class="lineNum">     738 </span><span class="lineNoCov">          0 :                                                 data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(2);</span></a>
<a name="739"><span class="lineNum">     739 </span><span class="lineNoCov">          0 :                                                 data-&gt;bytes_per_request[i] = bw_int_to_fixed(32);</span></a>
<a name="740"><span class="lineNum">     740 </span><span class="lineNoCov">          0 :                                                 data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(16);</span></a>
<a name="741"><span class="lineNum">     741 </span><span class="lineNoCov">          0 :                                                 break;</span></a>
<a name="742"><span class="lineNum">     742 </span>            :                                         }</a>
<a name="743"><span class="lineNum">     743 </span>            :                                 }</a>
<a name="744"><span class="lineNum">     744 </span>            :                                 else {</a>
<a name="745"><span class="lineNum">     745 </span><span class="lineNoCov">          0 :                                         data-&gt;bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="746"><span class="lineNum">     746 </span><span class="lineNoCov">          0 :                                         data-&gt;useful_bytes_per_request[i] = bw_int_to_fixed(64);</span></a>
<a name="747"><span class="lineNum">     747 </span><span class="lineNoCov">          0 :                                         if (data-&gt;orthogonal_rotation[i]) {</span></a>
<a name="748"><span class="lineNum">     748 </span><span class="lineNoCov">          0 :                                                 data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(8);</span></a>
<a name="749"><span class="lineNum">     749 </span><span class="lineNoCov">          0 :                                                 data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(4);</span></a>
<a name="750"><span class="lineNum">     750 </span>            :                                         }</a>
<a name="751"><span class="lineNum">     751 </span>            :                                         else {</a>
<a name="752"><span class="lineNum">     752 </span><span class="lineNoCov">          0 :                                                 switch (data-&gt;bytes_per_pixel[i]) {</span></a>
<a name="753"><span class="lineNum">     753 </span>            :                                                 case 4:</a>
<a name="754"><span class="lineNum">     754 </span><span class="lineNoCov">          0 :                                                         data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(2);</span></a>
<a name="755"><span class="lineNum">     755 </span><span class="lineNoCov">          0 :                                                         data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(2);</span></a>
<a name="756"><span class="lineNum">     756 </span><span class="lineNoCov">          0 :                                                         break;</span></a>
<a name="757"><span class="lineNum">     757 </span>            :                                                 case 2:</a>
<a name="758"><span class="lineNum">     758 </span><span class="lineNoCov">          0 :                                                         data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(4);</span></a>
<a name="759"><span class="lineNum">     759 </span><span class="lineNoCov">          0 :                                                         data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(4);</span></a>
<a name="760"><span class="lineNum">     760 </span><span class="lineNoCov">          0 :                                                         break;</span></a>
<a name="761"><span class="lineNum">     761 </span>            :                                                 default:</a>
<a name="762"><span class="lineNum">     762 </span><span class="lineNoCov">          0 :                                                         data-&gt;lines_interleaved_in_mem_access[i] = bw_int_to_fixed(8);</span></a>
<a name="763"><span class="lineNum">     763 </span><span class="lineNoCov">          0 :                                                         data-&gt;latency_hiding_lines[i] = bw_int_to_fixed(4);</span></a>
<a name="764"><span class="lineNum">     764 </span><span class="lineNoCov">          0 :                                                         break;</span></a>
<a name="765"><span class="lineNum">     765 </span>            :                                                 }</a>
<a name="766"><span class="lineNum">     766 </span>            :                                         }</a>
<a name="767"><span class="lineNum">     767 </span>            :                                 }</a>
<a name="768"><span class="lineNum">     768 </span>            :                         }</a>
<a name="769"><span class="lineNum">     769 </span>            :                 }</a>
<a name="770"><span class="lineNum">     770 </span>            :         }</a>
<a name="771"><span class="lineNum">     771 </span>            :         /*requested peak bandwidth:*/</a>
<a name="772"><span class="lineNum">     772 </span>            :         /*the peak request-per-second bandwidth is the product of the maximum source lines in per line out in the beginning*/</a>
<a name="773"><span class="lineNum">     773 </span>            :         /*and in the middle of the frame, the ratio of the source width to the line time, the ratio of line interleaving*/</a>
<a name="774"><span class="lineNum">     774 </span>            :         /*in memory to lines of latency hiding, and the ratio of bytes per pixel to useful bytes per request.*/</a>
<a name="775"><span class="lineNum">     775 </span>            :         /**/</a>
<a name="776"><span class="lineNum">     776 </span>            :         /*if the dmif data buffer size holds more than vta_ps worth of source lines, then only vsr is used.*/</a>
<a name="777"><span class="lineNum">     777 </span>            :         /*the peak bandwidth is the peak request-per-second bandwidth times the request size.*/</a>
<a name="778"><span class="lineNum">     778 </span>            :         /**/</a>
<a name="779"><span class="lineNum">     779 </span>            :         /*the line buffer lines in per line out in the beginning of the frame is the vertical filter initialization value*/</a>
<a name="780"><span class="lineNum">     780 </span>            :         /*rounded up to even and divided by the line times for initialization, which is normally three.*/</a>
<a name="781"><span class="lineNum">     781 </span>            :         /*the line buffer lines in per line out in the middle of the frame is at least one, or the vertical scale ratio,*/</a>
<a name="782"><span class="lineNum">     782 </span>            :         /*rounded up to line pairs if not doing line buffer prefetching.*/</a>
<a name="783"><span class="lineNum">     783 </span>            :         /**/</a>
<a name="784"><span class="lineNum">     784 </span>            :         /*the non-prefetching rounding up of the vertical scale ratio can also be done up to 1 (for a 0,2 pattern), 4/3 (for a 0,2,2 pattern),*/</a>
<a name="785"><span class="lineNum">     785 </span>            :         /*6/4 (for a 0,2,2,2 pattern), or 3 (for a 2,4 pattern).*/</a>
<a name="786"><span class="lineNum">     786 </span>            :         /**/</a>
<a name="787"><span class="lineNum">     787 </span>            :         /*the scaler vertical filter initialization value is calculated by the hardware as the floor of the average of the*/</a>
<a name="788"><span class="lineNum">     788 </span>            :         /*vertical scale ratio and the number of vertical taps increased by one.  add one more for possible odd line*/</a>
<a name="789"><span class="lineNum">     789 </span>            :         /*panning/bezel adjustment mode.*/</a>
<a name="790"><span class="lineNum">     790 </span>            :         /**/</a>
<a name="791"><span class="lineNum">     791 </span>            :         /*for the bottom interlace field an extra 50% of the vertical scale ratio is considered for this calculation.*/</a>
<a name="792"><span class="lineNum">     792 </span>            :         /*in top-bottom stereo mode software has to set the filter initialization value manually and explicitly limit it to 4.*/</a>
<a name="793"><span class="lineNum">     793 </span>            :         /*furthermore, there is only one line time for initialization.*/</a>
<a name="794"><span class="lineNum">     794 </span>            :         /**/</a>
<a name="795"><span class="lineNum">     795 </span>            :         /*line buffer prefetching is done when the number of lines in the line buffer exceeds the number of taps plus*/</a>
<a name="796"><span class="lineNum">     796 </span>            :         /*the ceiling of the vertical scale ratio.*/</a>
<a name="797"><span class="lineNum">     797 </span>            :         /**/</a>
<a name="798"><span class="lineNum">     798 </span>            :         /*multi-line buffer prefetching is only done in the graphics pipe when the scaler is disabled or when upscaling and the vsr &lt;= 0.8.'*/</a>
<a name="799"><span class="lineNum">     799 </span>            :         /**/</a>
<a name="800"><span class="lineNum">     800 </span>            :         /*the horizontal blank and chunk granularity factor is indirectly used indicate the interval of time required to transfer the source pixels.*/</a>
<a name="801"><span class="lineNum">     801 </span>            :         /*the denominator of this term represents the total number of destination output pixels required for the input source pixels.*/</a>
<a name="802"><span class="lineNum">     802 </span>            :         /*it applies when the lines in per line out is not 2 or 4.  it does not apply when there is a line buffer between the scl and blnd.*/</a>
<a name="803"><span class="lineNum">     803 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="804"><span class="lineNum">     804 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="805"><span class="lineNum">     805 </span><span class="lineNoCov">          0 :                         data-&gt;v_filter_init[i] = bw_floor2(bw_div((bw_add(bw_add(bw_add(bw_int_to_fixed(1), data-&gt;v_taps[i]), data-&gt;vsr[i]), bw_mul(bw_mul(bw_int_to_fixed(data-&gt;interlace_mode[i]), bw_frc_to_fixed(5, 10)), data-&gt;vsr[i]))), bw_int_to_fixed(2)), bw_int_to_fixed(1));</span></a>
<a name="806"><span class="lineNum">     806 </span><span class="lineNoCov">          0 :                         if (data-&gt;panning_and_bezel_adjustment == bw_def_any_lines) {</span></a>
<a name="807"><span class="lineNum">     807 </span><span class="lineNoCov">          0 :                                 data-&gt;v_filter_init[i] = bw_add(data-&gt;v_filter_init[i], bw_int_to_fixed(1));</span></a>
<a name="808"><span class="lineNum">     808 </span>            :                         }</a>
<a name="809"><span class="lineNum">     809 </span><span class="lineNoCov">          0 :                         if (data-&gt;stereo_mode[i] == bw_def_top_bottom) {</span></a>
<a name="810"><span class="lineNum">     810 </span><span class="lineNoCov">          0 :                                 data-&gt;v_filter_init[i] = bw_min2(data-&gt;v_filter_init[i], bw_int_to_fixed(4));</span></a>
<a name="811"><span class="lineNum">     811 </span>            :                         }</a>
<a name="812"><span class="lineNum">     812 </span><span class="lineNoCov">          0 :                         if (data-&gt;stereo_mode[i] == bw_def_top_bottom) {</span></a>
<a name="813"><span class="lineNum">     813 </span><span class="lineNoCov">          0 :                                 data-&gt;num_lines_at_frame_start = bw_int_to_fixed(1);</span></a>
<a name="814"><span class="lineNum">     814 </span>            :                         }</a>
<a name="815"><span class="lineNum">     815 </span>            :                         else {</a>
<a name="816"><span class="lineNum">     816 </span><span class="lineNoCov">          0 :                                 data-&gt;num_lines_at_frame_start = bw_int_to_fixed(3);</span></a>
<a name="817"><span class="lineNum">     817 </span>            :                         }</a>
<a name="818"><span class="lineNum">     818 </span><span class="lineNoCov">          0 :                         if ((bw_mtn(data-&gt;vsr[i], bw_int_to_fixed(1)) &amp;&amp; surface_type[i] == bw_def_graphics) || data-&gt;panning_and_bezel_adjustment == bw_def_any_lines) {</span></a>
<a name="819"><span class="lineNum">     819 </span><span class="lineNoCov">          0 :                                 data-&gt;line_buffer_prefetch[i] = 0;</span></a>
<a name="820"><span class="lineNum">     820 </span>            :                         }</a>
<a name="821"><span class="lineNum">     821 </span><span class="lineNoCov">          0 :                         else if ((((dceip-&gt;underlay_downscale_prefetch_enabled == 1 &amp;&amp; surface_type[i] != bw_def_graphics) || surface_type[i] == bw_def_graphics) &amp;&amp; (bw_mtn(data-&gt;lb_partitions[i], bw_add(data-&gt;v_taps[i], bw_ceil2(data-&gt;vsr[i], bw_int_to_fixed(1))))))) {</span></a>
<a name="822"><span class="lineNum">     822 </span><span class="lineNoCov">          0 :                                 data-&gt;line_buffer_prefetch[i] = 1;</span></a>
<a name="823"><span class="lineNum">     823 </span>            :                         }</a>
<a name="824"><span class="lineNum">     824 </span>            :                         else {</a>
<a name="825"><span class="lineNum">     825 </span><span class="lineNoCov">          0 :                                 data-&gt;line_buffer_prefetch[i] = 0;</span></a>
<a name="826"><span class="lineNum">     826 </span>            :                         }</a>
<a name="827"><span class="lineNum">     827 </span><span class="lineNoCov">          0 :                         data-&gt;lb_lines_in_per_line_out_in_beginning_of_frame[i] = bw_div(bw_ceil2(data-&gt;v_filter_init[i], bw_int_to_fixed(dceip-&gt;lines_interleaved_into_lb)), data-&gt;num_lines_at_frame_start);</span></a>
<a name="828"><span class="lineNum">     828 </span><span class="lineNoCov">          0 :                         if (data-&gt;line_buffer_prefetch[i] == 1) {</span></a>
<a name="829"><span class="lineNum">     829 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i] = bw_max2(bw_int_to_fixed(1), data-&gt;vsr[i]);</span></a>
<a name="830"><span class="lineNum">     830 </span>            :                         }</a>
<a name="831"><span class="lineNum">     831 </span><span class="lineNoCov">          0 :                         else if (bw_leq(data-&gt;vsr[i], bw_int_to_fixed(1))) {</span></a>
<a name="832"><span class="lineNum">     832 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i] = bw_int_to_fixed(1);</span></a>
<a name="833"><span class="lineNum">     833 </span><span class="lineNoCov">          0 :                         } else if (bw_leq(data-&gt;vsr[i],</span></a>
<a name="834"><span class="lineNum">     834 </span>            :                                         bw_frc_to_fixed(4, 3))) {</a>
<a name="835"><span class="lineNum">     835 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i] = bw_div(bw_int_to_fixed(4), bw_int_to_fixed(3));</span></a>
<a name="836"><span class="lineNum">     836 </span><span class="lineNoCov">          0 :                         } else if (bw_leq(data-&gt;vsr[i],</span></a>
<a name="837"><span class="lineNum">     837 </span>            :                                         bw_frc_to_fixed(6, 4))) {</a>
<a name="838"><span class="lineNum">     838 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i] = bw_div(bw_int_to_fixed(6), bw_int_to_fixed(4));</span></a>
<a name="839"><span class="lineNum">     839 </span>            :                         }</a>
<a name="840"><span class="lineNum">     840 </span><span class="lineNoCov">          0 :                         else if (bw_leq(data-&gt;vsr[i], bw_int_to_fixed(2))) {</span></a>
<a name="841"><span class="lineNum">     841 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i] = bw_int_to_fixed(2);</span></a>
<a name="842"><span class="lineNum">     842 </span>            :                         }</a>
<a name="843"><span class="lineNum">     843 </span><span class="lineNoCov">          0 :                         else if (bw_leq(data-&gt;vsr[i], bw_int_to_fixed(3))) {</span></a>
<a name="844"><span class="lineNum">     844 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i] = bw_int_to_fixed(3);</span></a>
<a name="845"><span class="lineNum">     845 </span>            :                         }</a>
<a name="846"><span class="lineNum">     846 </span>            :                         else {</a>
<a name="847"><span class="lineNum">     847 </span><span class="lineNoCov">          0 :                                 data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i] = bw_int_to_fixed(4);</span></a>
<a name="848"><span class="lineNum">     848 </span>            :                         }</a>
<a name="849"><span class="lineNum">     849 </span><span class="lineNoCov">          0 :                         if (data-&gt;line_buffer_prefetch[i] == 1 || bw_equ(data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i], bw_int_to_fixed(2)) || bw_equ(data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i], bw_int_to_fixed(4))) {</span></a>
<a name="850"><span class="lineNum">     850 </span><span class="lineNoCov">          0 :                                 data-&gt;horizontal_blank_and_chunk_granularity_factor[i] = bw_int_to_fixed(1);</span></a>
<a name="851"><span class="lineNum">     851 </span>            :                         }</a>
<a name="852"><span class="lineNum">     852 </span>            :                         else {</a>
<a name="853"><span class="lineNum">     853 </span><span class="lineNoCov">          0 :                                 data-&gt;horizontal_blank_and_chunk_granularity_factor[i] = bw_div(data-&gt;h_total[i], (bw_div((bw_add(data-&gt;h_total[i], bw_div((bw_sub(data-&gt;source_width_pixels[i], bw_int_to_fixed(dceip-&gt;chunk_width))), data-&gt;hsr[i]))), bw_int_to_fixed(2))));</span></a>
<a name="854"><span class="lineNum">     854 </span>            :                         }</a>
<a name="855"><span class="lineNum">     855 </span><span class="lineNoCov">          0 :                         data-&gt;request_bandwidth[i] = bw_div(bw_mul(bw_div(bw_mul(bw_div(bw_mul(bw_max2(data-&gt;lb_lines_in_per_line_out_in_beginning_of_frame[i], data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i]), data-&gt;source_width_rounded_up_to_chunks[i]), (bw_div(data-&gt;h_total[i], data-&gt;pixel_rate[i]))), bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;useful_bytes_per_request[i]), data-&gt;lines_interleaved_in_mem_access[i]), data-&gt;latency_hiding_lines[i]);</span></a>
<a name="856"><span class="lineNum">     856 </span><span class="lineNoCov">          0 :                         data-&gt;display_bandwidth[i] = bw_mul(data-&gt;request_bandwidth[i], data-&gt;bytes_per_request[i]);</span></a>
<a name="857"><span class="lineNum">     857 </span>            :                 }</a>
<a name="858"><span class="lineNum">     858 </span>            :         }</a>
<a name="859"><span class="lineNum">     859 </span>            :         /*outstanding chunk request limit*/</a>
<a name="860"><span class="lineNum">     860 </span>            :         /*if underlay buffer sharing is enabled, the data buffer size for underlay in 422 or 444 is the sum of the luma and chroma data buffer sizes.*/</a>
<a name="861"><span class="lineNum">     861 </span>            :         /*underlay buffer sharing mode is only permitted in orthogonal rotation modes.*/</a>
<a name="862"><span class="lineNum">     862 </span>            :         /**/</a>
<a name="863"><span class="lineNum">     863 </span>            :         /*if there is only one display enabled, the dmif data buffer size for the graphics surface is increased by concatenating the adjacent buffers.*/</a>
<a name="864"><span class="lineNum">     864 </span>            :         /**/</a>
<a name="865"><span class="lineNum">     865 </span>            :         /*the memory chunk size in bytes is 1024 for the writeback, and 256 times the memory line interleaving and the bytes per pixel for graphics*/</a>
<a name="866"><span class="lineNum">     866 </span>            :         /*and underlay.*/</a>
<a name="867"><span class="lineNum">     867 </span>            :         /**/</a>
<a name="868"><span class="lineNum">     868 </span>            :         /*the pipe chunk size uses 2 for line interleaving, except for the write back, in which case it is 1.*/</a>
<a name="869"><span class="lineNum">     869 </span>            :         /*graphics and underlay data buffer size is adjusted (limited) using the outstanding chunk request limit if there is more than one*/</a>
<a name="870"><span class="lineNum">     870 </span>            :         /*display enabled or if the dmif request buffer is not large enough for the total data buffer size.*/</a>
<a name="871"><span class="lineNum">     871 </span>            :         /*the outstanding chunk request limit is the ceiling of the adjusted data buffer size divided by the chunk size in bytes*/</a>
<a name="872"><span class="lineNum">     872 </span>            :         /*the adjusted data buffer size is the product of the display bandwidth and the minimum effective data buffer size in terms of time,*/</a>
<a name="873"><span class="lineNum">     873 </span>            :         /*rounded up to the chunk size in bytes, but should not exceed the original data buffer size*/</a>
<a name="874"><span class="lineNum">     874 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="875"><span class="lineNum">     875 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="876"><span class="lineNum">     876 </span><span class="lineNoCov">          0 :                         if ((dceip-&gt;dmif_pipe_en_fbc_chunk_tracker + 3 == i &amp;&amp; fbc_enabled == 0 &amp;&amp; tiling_mode[i] != bw_def_linear)) {</span></a>
<a name="877"><span class="lineNum">     877 </span><span class="lineNoCov">          0 :                                 data-&gt;max_chunks_non_fbc_mode[i] = 128 - dmif_chunk_buff_margin;</span></a>
<a name="878"><span class="lineNum">     878 </span>            :                         }</a>
<a name="879"><span class="lineNum">     879 </span>            :                         else {</a>
<a name="880"><span class="lineNum">     880 </span><span class="lineNoCov">          0 :                                 data-&gt;max_chunks_non_fbc_mode[i] = 16 - dmif_chunk_buff_margin;</span></a>
<a name="881"><span class="lineNum">     881 </span>            :                         }</a>
<a name="882"><span class="lineNum">     882 </span>            :                 }</a>
<a name="883"><span class="lineNum">     883 </span>            :                 if (data-&gt;fbc_en[i] == 1) {</a>
<a name="884"><span class="lineNum">     884 </span>            :                         max_chunks_fbc_mode = 128 - dmif_chunk_buff_margin;</a>
<a name="885"><span class="lineNum">     885 </span>            :                 }</a>
<a name="886"><span class="lineNum">     886 </span>            :         }</a>
<a name="887"><span class="lineNum">     887 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="888"><span class="lineNum">     888 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="889"><span class="lineNum">     889 </span><span class="lineNoCov">          0 :                         switch (surface_type[i]) {</span></a>
<a name="890"><span class="lineNum">     890 </span>            :                         case bw_def_display_write_back420_luma:</a>
<a name="891"><span class="lineNum">     891 </span><span class="lineNoCov">          0 :                                 data-&gt;data_buffer_size[i] = bw_int_to_fixed(dceip-&gt;display_write_back420_luma_mcifwr_buffer_size);</span></a>
<a name="892"><span class="lineNum">     892 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="893"><span class="lineNum">     893 </span>            :                         case bw_def_display_write_back420_chroma:</a>
<a name="894"><span class="lineNum">     894 </span><span class="lineNoCov">          0 :                                 data-&gt;data_buffer_size[i] = bw_int_to_fixed(dceip-&gt;display_write_back420_chroma_mcifwr_buffer_size);</span></a>
<a name="895"><span class="lineNum">     895 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="896"><span class="lineNum">     896 </span>            :                         case bw_def_underlay420_luma:</a>
<a name="897"><span class="lineNum">     897 </span><span class="lineNoCov">          0 :                                 data-&gt;data_buffer_size[i] = bw_int_to_fixed(dceip-&gt;underlay_luma_dmif_size);</span></a>
<a name="898"><span class="lineNum">     898 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="899"><span class="lineNum">     899 </span>            :                         case bw_def_underlay420_chroma:</a>
<a name="900"><span class="lineNum">     900 </span><span class="lineNoCov">          0 :                                 data-&gt;data_buffer_size[i] = bw_div(bw_int_to_fixed(dceip-&gt;underlay_chroma_dmif_size), bw_int_to_fixed(2));</span></a>
<a name="901"><span class="lineNum">     901 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="902"><span class="lineNum">     902 </span>            :                         case bw_def_underlay422:case bw_def_underlay444:</a>
<a name="903"><span class="lineNum">     903 </span><span class="lineNoCov">          0 :                                 if (data-&gt;orthogonal_rotation[i] == 0) {</span></a>
<a name="904"><span class="lineNum">     904 </span><span class="lineNoCov">          0 :                                         data-&gt;data_buffer_size[i] = bw_int_to_fixed(dceip-&gt;underlay_luma_dmif_size);</span></a>
<a name="905"><span class="lineNum">     905 </span>            :                                 }</a>
<a name="906"><span class="lineNum">     906 </span>            :                                 else {</a>
<a name="907"><span class="lineNum">     907 </span><span class="lineNoCov">          0 :                                         data-&gt;data_buffer_size[i] = bw_add(bw_int_to_fixed(dceip-&gt;underlay_luma_dmif_size), bw_int_to_fixed(dceip-&gt;underlay_chroma_dmif_size));</span></a>
<a name="908"><span class="lineNum">     908 </span>            :                                 }</a>
<a name="909"><span class="lineNum">     909 </span>            :                                 break;</a>
<a name="910"><span class="lineNum">     910 </span>            :                         default:</a>
<a name="911"><span class="lineNum">     911 </span><span class="lineNoCov">          0 :                                 if (data-&gt;fbc_en[i] == 1) {</span></a>
<a name="912"><span class="lineNum">     912 </span>            :                                         /*data_buffer_size(i) = max_dmif_buffer_allocated * graphics_dmif_size*/</a>
<a name="913"><span class="lineNum">     913 </span><span class="lineNoCov">          0 :                                         if (data-&gt;number_of_displays == 1) {</span></a>
<a name="914"><span class="lineNum">     914 </span><span class="lineNoCov">          0 :                                                 data-&gt;data_buffer_size[i] = bw_min2(bw_mul(bw_mul(bw_int_to_fixed(max_chunks_fbc_mode), bw_int_to_fixed(pixels_per_chunk)), bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), bw_mul(bw_int_to_fixed(dceip-&gt;max_dmif_buffer_allocated), bw_int_to_fixed(dceip-&gt;graphics_dmif_size)));</span></a>
<a name="915"><span class="lineNum">     915 </span>            :                                         }</a>
<a name="916"><span class="lineNum">     916 </span>            :                                         else {</a>
<a name="917"><span class="lineNum">     917 </span><span class="lineNoCov">          0 :                                                 data-&gt;data_buffer_size[i] = bw_min2(bw_mul(bw_mul(bw_int_to_fixed(max_chunks_fbc_mode), bw_int_to_fixed(pixels_per_chunk)), bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), bw_int_to_fixed(dceip-&gt;graphics_dmif_size));</span></a>
<a name="918"><span class="lineNum">     918 </span>            :                                         }</a>
<a name="919"><span class="lineNum">     919 </span>            :                                 }</a>
<a name="920"><span class="lineNum">     920 </span>            :                                 else {</a>
<a name="921"><span class="lineNum">     921 </span>            :                                         /*the effective dmif buffer size in non-fbc mode is limited by the 16 entry chunk tracker*/</a>
<a name="922"><span class="lineNum">     922 </span><span class="lineNoCov">          0 :                                         if (data-&gt;number_of_displays == 1) {</span></a>
<a name="923"><span class="lineNum">     923 </span><span class="lineNoCov">          0 :                                                 data-&gt;data_buffer_size[i] = bw_min2(bw_mul(bw_mul(bw_int_to_fixed(data-&gt;max_chunks_non_fbc_mode[i]), bw_int_to_fixed(pixels_per_chunk)), bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), bw_mul(bw_int_to_fixed(dceip-&gt;max_dmif_buffer_allocated), bw_int_to_fixed(dceip-&gt;graphics_dmif_size)));</span></a>
<a name="924"><span class="lineNum">     924 </span>            :                                         }</a>
<a name="925"><span class="lineNum">     925 </span>            :                                         else {</a>
<a name="926"><span class="lineNum">     926 </span><span class="lineNoCov">          0 :                                                 data-&gt;data_buffer_size[i] = bw_min2(bw_mul(bw_mul(bw_int_to_fixed(data-&gt;max_chunks_non_fbc_mode[i]), bw_int_to_fixed(pixels_per_chunk)), bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), bw_int_to_fixed(dceip-&gt;graphics_dmif_size));</span></a>
<a name="927"><span class="lineNum">     927 </span>            :                                         }</a>
<a name="928"><span class="lineNum">     928 </span>            :                                 }</a>
<a name="929"><span class="lineNum">     929 </span>            :                                 break;</a>
<a name="930"><span class="lineNum">     930 </span>            :                         }</a>
<a name="931"><span class="lineNum">     931 </span><span class="lineNoCov">          0 :                         if (surface_type[i] == bw_def_display_write_back420_luma || surface_type[i] == bw_def_display_write_back420_chroma) {</span></a>
<a name="932"><span class="lineNum">     932 </span><span class="lineNoCov">          0 :                                 data-&gt;memory_chunk_size_in_bytes[i] = bw_int_to_fixed(1024);</span></a>
<a name="933"><span class="lineNum">     933 </span><span class="lineNoCov">          0 :                                 data-&gt;pipe_chunk_size_in_bytes[i] = bw_int_to_fixed(1024);</span></a>
<a name="934"><span class="lineNum">     934 </span>            :                         }</a>
<a name="935"><span class="lineNum">     935 </span>            :                         else {</a>
<a name="936"><span class="lineNum">     936 </span><span class="lineNoCov">          0 :                                 data-&gt;memory_chunk_size_in_bytes[i] = bw_mul(bw_mul(bw_int_to_fixed(dceip-&gt;chunk_width), data-&gt;lines_interleaved_in_mem_access[i]), bw_int_to_fixed(data-&gt;bytes_per_pixel[i]));</span></a>
<a name="937"><span class="lineNum">     937 </span><span class="lineNoCov">          0 :                                 data-&gt;pipe_chunk_size_in_bytes[i] = bw_mul(bw_mul(bw_int_to_fixed(dceip-&gt;chunk_width), bw_int_to_fixed(dceip-&gt;lines_interleaved_into_lb)), bw_int_to_fixed(data-&gt;bytes_per_pixel[i]));</span></a>
<a name="938"><span class="lineNum">     938 </span>            :                         }</a>
<a name="939"><span class="lineNum">     939 </span>            :                 }</a>
<a name="940"><span class="lineNum">     940 </span>            :         }</a>
<a name="941"><span class="lineNum">     941 </span><span class="lineNoCov">          0 :         data-&gt;min_dmif_size_in_time = bw_int_to_fixed(9999);</span></a>
<a name="942"><span class="lineNum">     942 </span><span class="lineNoCov">          0 :         data-&gt;min_mcifwr_size_in_time = bw_int_to_fixed(9999);</span></a>
<a name="943"><span class="lineNum">     943 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="944"><span class="lineNum">     944 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="945"><span class="lineNum">     945 </span><span class="lineNoCov">          0 :                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="946"><span class="lineNum">     946 </span><span class="lineNoCov">          0 :                                 if (bw_ltn(bw_div(bw_div(bw_mul(data-&gt;data_buffer_size[i], data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]), data-&gt;display_bandwidth[i]), data-&gt;min_dmif_size_in_time)) {</span></a>
<a name="947"><span class="lineNum">     947 </span><span class="lineNoCov">          0 :                                         data-&gt;min_dmif_size_in_time = bw_div(bw_div(bw_mul(data-&gt;data_buffer_size[i], data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]), data-&gt;display_bandwidth[i]);</span></a>
<a name="948"><span class="lineNum">     948 </span>            :                                 }</a>
<a name="949"><span class="lineNum">     949 </span>            :                         }</a>
<a name="950"><span class="lineNum">     950 </span>            :                         else {</a>
<a name="951"><span class="lineNum">     951 </span><span class="lineNoCov">          0 :                                 if (bw_ltn(bw_div(bw_div(bw_mul(data-&gt;data_buffer_size[i], data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]), data-&gt;display_bandwidth[i]), data-&gt;min_mcifwr_size_in_time)) {</span></a>
<a name="952"><span class="lineNum">     952 </span><span class="lineNoCov">          0 :                                         data-&gt;min_mcifwr_size_in_time = bw_div(bw_div(bw_mul(data-&gt;data_buffer_size[i], data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]), data-&gt;display_bandwidth[i]);</span></a>
<a name="953"><span class="lineNum">     953 </span>            :                                 }</a>
<a name="954"><span class="lineNum">     954 </span>            :                         }</a>
<a name="955"><span class="lineNum">     955 </span>            :                 }</a>
<a name="956"><span class="lineNum">     956 </span>            :         }</a>
<a name="957"><span class="lineNum">     957 </span><span class="lineNoCov">          0 :         data-&gt;total_requests_for_dmif_size = bw_int_to_fixed(0);</span></a>
<a name="958"><span class="lineNum">     958 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="959"><span class="lineNum">     959 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i] &amp;&amp; surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="960"><span class="lineNum">     960 </span><span class="lineNoCov">          0 :                         data-&gt;total_requests_for_dmif_size = bw_add(data-&gt;total_requests_for_dmif_size, bw_div(data-&gt;data_buffer_size[i], data-&gt;useful_bytes_per_request[i]));</span></a>
<a name="961"><span class="lineNum">     961 </span>            :                 }</a>
<a name="962"><span class="lineNum">     962 </span>            :         }</a>
<a name="963"><span class="lineNum">     963 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="964"><span class="lineNum">     964 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="965"><span class="lineNum">     965 </span><span class="lineNoCov">          0 :                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma &amp;&amp; dceip-&gt;limit_excessive_outstanding_dmif_requests &amp;&amp; (data-&gt;number_of_displays &gt; 1 || bw_mtn(data-&gt;total_requests_for_dmif_size, dceip-&gt;dmif_request_buffer_size))) {</span></a>
<a name="966"><span class="lineNum">     966 </span><span class="lineNoCov">          0 :                                 data-&gt;adjusted_data_buffer_size[i] = bw_min2(data-&gt;data_buffer_size[i], bw_ceil2(bw_mul(data-&gt;min_dmif_size_in_time, data-&gt;display_bandwidth[i]), data-&gt;memory_chunk_size_in_bytes[i]));</span></a>
<a name="967"><span class="lineNum">     967 </span>            :                         }</a>
<a name="968"><span class="lineNum">     968 </span>            :                         else {</a>
<a name="969"><span class="lineNum">     969 </span><span class="lineNoCov">          0 :                                 data-&gt;adjusted_data_buffer_size[i] = data-&gt;data_buffer_size[i];</span></a>
<a name="970"><span class="lineNum">     970 </span>            :                         }</a>
<a name="971"><span class="lineNum">     971 </span>            :                 }</a>
<a name="972"><span class="lineNum">     972 </span>            :         }</a>
<a name="973"><span class="lineNum">     973 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="974"><span class="lineNum">     974 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="975"><span class="lineNum">     975 </span><span class="lineNoCov">          0 :                         if (data-&gt;number_of_displays == 1 &amp;&amp; data-&gt;number_of_underlay_surfaces == 0) {</span></a>
<a name="976"><span class="lineNum">     976 </span>            :                                 /*set maximum chunk limit if only one graphic pipe is enabled*/</a>
<a name="977"><span class="lineNum">     977 </span><span class="lineNoCov">          0 :                                 data-&gt;outstanding_chunk_request_limit[i] = bw_int_to_fixed(127);</span></a>
<a name="978"><span class="lineNum">     978 </span>            :                         }</a>
<a name="979"><span class="lineNum">     979 </span>            :                         else {</a>
<a name="980"><span class="lineNum">     980 </span><span class="lineNoCov">          0 :                                 data-&gt;outstanding_chunk_request_limit[i] = bw_ceil2(bw_div(data-&gt;adjusted_data_buffer_size[i], data-&gt;pipe_chunk_size_in_bytes[i]), bw_int_to_fixed(1));</span></a>
<a name="981"><span class="lineNum">     981 </span>            :                                 /*clamp maximum chunk limit in the graphic display pipe*/</a>
<a name="982"><span class="lineNum">     982 </span><span class="lineNoCov">          0 :                                 if (i &gt;= 4) {</span></a>
<a name="983"><span class="lineNum">     983 </span><span class="lineNoCov">          0 :                                         data-&gt;outstanding_chunk_request_limit[i] = bw_max2(bw_int_to_fixed(127), data-&gt;outstanding_chunk_request_limit[i]);</span></a>
<a name="984"><span class="lineNum">     984 </span>            :                                 }</a>
<a name="985"><span class="lineNum">     985 </span>            :                         }</a>
<a name="986"><span class="lineNum">     986 </span>            :                 }</a>
<a name="987"><span class="lineNum">     987 </span>            :         }</a>
<a name="988"><span class="lineNum">     988 </span>            :         /*outstanding pte request limit*/</a>
<a name="989"><span class="lineNum">     989 </span>            :         /*in tiling mode with no rotation the sg pte requests are 8 useful pt_es, the sg row height is the page height and the sg page width x height is 64x64 for 8bpp, 64x32 for 16 bpp, 32x32 for 32 bpp*/</a>
<a name="990"><span class="lineNum">     990 </span>            :         /*in tiling mode with rotation the sg pte requests are only one useful pte, and the sg row height is also the page height, but the sg page width and height are swapped*/</a>
<a name="991"><span class="lineNum">     991 </span>            :         /*in linear mode the pte requests are 8 useful pt_es, the sg page width is 4096 divided by the bytes per pixel, the sg page height is 1, but there is just one row whose height is the lines of pte prefetching*/</a>
<a name="992"><span class="lineNum">     992 </span>            :         /*the outstanding pte request limit is obtained by multiplying the outstanding chunk request limit by the peak pte request to eviction limiting ratio, rounding up to integer, multiplying by the pte requests per chunk, and rounding up to integer again*/</a>
<a name="993"><span class="lineNum">     993 </span>            :         /*if not using peak pte request to eviction limiting, the outstanding pte request limit is the pte requests in the vblank*/</a>
<a name="994"><span class="lineNum">     994 </span>            :         /*the pte requests in the vblank is the product of the number of pte request rows times the number of pte requests in a row*/</a>
<a name="995"><span class="lineNum">     995 </span>            :         /*the number of pte requests in a row is the quotient of the source width divided by 256, multiplied by the pte requests per chunk, rounded up to even, multiplied by the scatter-gather row height and divided by the scatter-gather page height*/</a>
<a name="996"><span class="lineNum">     996 </span>            :         /*the pte requests per chunk is 256 divided by the scatter-gather page width and the useful pt_es per pte request*/</a>
<a name="997"><span class="lineNum">     997 </span><span class="lineNoCov">          0 :         if (data-&gt;number_of_displays &gt; 1 || (bw_neq(data-&gt;rotation_angle[4], bw_int_to_fixed(0)) &amp;&amp; bw_neq(data-&gt;rotation_angle[4], bw_int_to_fixed(180)))) {</span></a>
<a name="998"><span class="lineNum">     998 </span><span class="lineNoCov">          0 :                 data-&gt;peak_pte_request_to_eviction_ratio_limiting = dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_multiple_displays_or_single_rotated_display;</span></a>
<a name="999"><span class="lineNum">     999 </span>            :         }</a>
<a name="1000"><span class="lineNum">    1000 </span>            :         else {</a>
<a name="1001"><span class="lineNum">    1001 </span><span class="lineNoCov">          0 :                 data-&gt;peak_pte_request_to_eviction_ratio_limiting = dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_single_display_no_rotation;</span></a>
<a name="1002"><span class="lineNum">    1002 </span>            :         }</a>
<a name="1003"><span class="lineNum">    1003 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1004"><span class="lineNum">    1004 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i] &amp;&amp; data-&gt;scatter_gather_enable_for_pipe[i] == 1) {</span></a>
<a name="1005"><span class="lineNum">    1005 </span><span class="lineNoCov">          0 :                         if (tiling_mode[i] == bw_def_linear) {</span></a>
<a name="1006"><span class="lineNum">    1006 </span><span class="lineNoCov">          0 :                                 data-&gt;useful_pte_per_pte_request = bw_int_to_fixed(8);</span></a>
<a name="1007"><span class="lineNum">    1007 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_page_width[i] = bw_div(bw_int_to_fixed(4096), bw_int_to_fixed(data-&gt;bytes_per_pixel[i]));</span></a>
<a name="1008"><span class="lineNum">    1008 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_page_height[i] = bw_int_to_fixed(1);</span></a>
<a name="1009"><span class="lineNum">    1009 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_pte_request_rows = bw_int_to_fixed(1);</span></a>
<a name="1010"><span class="lineNum">    1010 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_row_height = bw_int_to_fixed(dceip-&gt;scatter_gather_lines_of_pte_prefetching_in_linear_mode);</span></a>
<a name="1011"><span class="lineNum">    1011 </span>            :                         }</a>
<a name="1012"><span class="lineNum">    1012 </span><span class="lineNoCov">          0 :                         else if (bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(0)) || bw_equ(data-&gt;rotation_angle[i], bw_int_to_fixed(180))) {</span></a>
<a name="1013"><span class="lineNum">    1013 </span><span class="lineNoCov">          0 :                                 data-&gt;useful_pte_per_pte_request = bw_int_to_fixed(8);</span></a>
<a name="1014"><span class="lineNum">    1014 </span><span class="lineNoCov">          0 :                                 switch (data-&gt;bytes_per_pixel[i]) {</span></a>
<a name="1015"><span class="lineNum">    1015 </span>            :                                 case 4:</a>
<a name="1016"><span class="lineNum">    1016 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_width[i] = bw_int_to_fixed(32);</span></a>
<a name="1017"><span class="lineNum">    1017 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_height[i] = bw_int_to_fixed(32);</span></a>
<a name="1018"><span class="lineNum">    1018 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1019"><span class="lineNum">    1019 </span>            :                                 case 2:</a>
<a name="1020"><span class="lineNum">    1020 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_width[i] = bw_int_to_fixed(64);</span></a>
<a name="1021"><span class="lineNum">    1021 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_height[i] = bw_int_to_fixed(32);</span></a>
<a name="1022"><span class="lineNum">    1022 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1023"><span class="lineNum">    1023 </span>            :                                 default:</a>
<a name="1024"><span class="lineNum">    1024 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_width[i] = bw_int_to_fixed(64);</span></a>
<a name="1025"><span class="lineNum">    1025 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_height[i] = bw_int_to_fixed(64);</span></a>
<a name="1026"><span class="lineNum">    1026 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1027"><span class="lineNum">    1027 </span>            :                                 }</a>
<a name="1028"><span class="lineNum">    1028 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_pte_request_rows = bw_int_to_fixed(dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode);</span></a>
<a name="1029"><span class="lineNum">    1029 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_row_height = data-&gt;scatter_gather_page_height[i];</span></a>
<a name="1030"><span class="lineNum">    1030 </span>            :                         }</a>
<a name="1031"><span class="lineNum">    1031 </span>            :                         else {</a>
<a name="1032"><span class="lineNum">    1032 </span><span class="lineNoCov">          0 :                                 data-&gt;useful_pte_per_pte_request = bw_int_to_fixed(1);</span></a>
<a name="1033"><span class="lineNum">    1033 </span><span class="lineNoCov">          0 :                                 switch (data-&gt;bytes_per_pixel[i]) {</span></a>
<a name="1034"><span class="lineNum">    1034 </span>            :                                 case 4:</a>
<a name="1035"><span class="lineNum">    1035 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_width[i] = bw_int_to_fixed(32);</span></a>
<a name="1036"><span class="lineNum">    1036 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_height[i] = bw_int_to_fixed(32);</span></a>
<a name="1037"><span class="lineNum">    1037 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1038"><span class="lineNum">    1038 </span>            :                                 case 2:</a>
<a name="1039"><span class="lineNum">    1039 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_width[i] = bw_int_to_fixed(32);</span></a>
<a name="1040"><span class="lineNum">    1040 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_height[i] = bw_int_to_fixed(64);</span></a>
<a name="1041"><span class="lineNum">    1041 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1042"><span class="lineNum">    1042 </span>            :                                 default:</a>
<a name="1043"><span class="lineNum">    1043 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_width[i] = bw_int_to_fixed(64);</span></a>
<a name="1044"><span class="lineNum">    1044 </span><span class="lineNoCov">          0 :                                         data-&gt;scatter_gather_page_height[i] = bw_int_to_fixed(64);</span></a>
<a name="1045"><span class="lineNum">    1045 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1046"><span class="lineNum">    1046 </span>            :                                 }</a>
<a name="1047"><span class="lineNum">    1047 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_pte_request_rows = bw_int_to_fixed(dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode);</span></a>
<a name="1048"><span class="lineNum">    1048 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_row_height = data-&gt;scatter_gather_page_height[i];</span></a>
<a name="1049"><span class="lineNum">    1049 </span>            :                         }</a>
<a name="1050"><span class="lineNum">    1050 </span><span class="lineNoCov">          0 :                         data-&gt;pte_request_per_chunk[i] = bw_div(bw_div(bw_int_to_fixed(dceip-&gt;chunk_width), data-&gt;scatter_gather_page_width[i]), data-&gt;useful_pte_per_pte_request);</span></a>
<a name="1051"><span class="lineNum">    1051 </span><span class="lineNoCov">          0 :                         data-&gt;scatter_gather_pte_requests_in_row[i] = bw_div(bw_mul(bw_ceil2(bw_mul(bw_div(data-&gt;source_width_rounded_up_to_chunks[i], bw_int_to_fixed(dceip-&gt;chunk_width)), data-&gt;pte_request_per_chunk[i]), bw_int_to_fixed(1)), data-&gt;scatter_gather_row_height), data-&gt;scatter_gather_page_height[i]);</span></a>
<a name="1052"><span class="lineNum">    1052 </span><span class="lineNoCov">          0 :                         data-&gt;scatter_gather_pte_requests_in_vblank = bw_mul(data-&gt;scatter_gather_pte_request_rows, data-&gt;scatter_gather_pte_requests_in_row[i]);</span></a>
<a name="1053"><span class="lineNum">    1053 </span><span class="lineNoCov">          0 :                         if (bw_equ(data-&gt;peak_pte_request_to_eviction_ratio_limiting, bw_int_to_fixed(0))) {</span></a>
<a name="1054"><span class="lineNum">    1054 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_pte_request_limit[i] = data-&gt;scatter_gather_pte_requests_in_vblank;</span></a>
<a name="1055"><span class="lineNum">    1055 </span>            :                         }</a>
<a name="1056"><span class="lineNum">    1056 </span>            :                         else {</a>
<a name="1057"><span class="lineNum">    1057 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_pte_request_limit[i] = bw_max2(dceip-&gt;minimum_outstanding_pte_request_limit, bw_min2(data-&gt;scatter_gather_pte_requests_in_vblank, bw_ceil2(bw_mul(bw_mul(bw_div(bw_ceil2(data-&gt;adjusted_data_buffer_size[i], data-&gt;memory_chunk_size_in_bytes[i]), data-&gt;memory_chunk_size_in_bytes[i]), data-&gt;pte_request_per_chunk[i]), data-&gt;peak_pte_request_to_eviction_ratio_limiting), bw_int_to_fixed(1))));</span></a>
<a name="1058"><span class="lineNum">    1058 </span>            :                         }</a>
<a name="1059"><span class="lineNum">    1059 </span>            :                 }</a>
<a name="1060"><span class="lineNum">    1060 </span>            :         }</a>
<a name="1061"><span class="lineNum">    1061 </span>            :         /*pitch padding recommended for efficiency in linear mode*/</a>
<a name="1062"><span class="lineNum">    1062 </span>            :         /*in linear mode graphics or underlay with scatter gather, a pitch that is a multiple of the channel interleave (256 bytes) times the channel-bank rotation is not efficient*/</a>
<a name="1063"><span class="lineNum">    1063 </span>            :         /*if that is the case it is recommended to pad the pitch by at least 256 pixels*/</a>
<a name="1064"><span class="lineNum">    1064 </span><span class="lineNoCov">          0 :         data-&gt;inefficient_linear_pitch_in_bytes = bw_mul(bw_mul(bw_int_to_fixed(256), bw_int_to_fixed(vbios-&gt;number_of_dram_banks)), bw_int_to_fixed(data-&gt;number_of_dram_channels));</span></a>
<a name="1065"><span class="lineNum">    1065 </span>            : </a>
<a name="1066"><span class="lineNum">    1066 </span>            :         /*pixel transfer time*/</a>
<a name="1067"><span class="lineNum">    1067 </span>            :         /*the dmif and mcifwr yclk(pclk) required is the one that allows the transfer of all pipe's data buffer size in memory in the time for data transfer*/</a>
<a name="1068"><span class="lineNum">    1068 </span>            :         /*for dmif, pte and cursor requests have to be included.*/</a>
<a name="1069"><span class="lineNum">    1069 </span>            :         /*the dram data requirement is doubled when the data request size in bytes is less than the dram channel width times the burst size (8)*/</a>
<a name="1070"><span class="lineNum">    1070 </span>            :         /*the dram data requirement is also multiplied by the number of channels in the case of low power tiling*/</a>
<a name="1071"><span class="lineNum">    1071 </span>            :         /*the page close-open time is determined by trc and the number of page close-opens*/</a>
<a name="1072"><span class="lineNum">    1072 </span>            :         /*in tiled mode graphics or underlay with scatter-gather enabled the bytes per page close-open is the product of the memory line interleave times the maximum of the scatter-gather page width and the product of the tile width (8 pixels) times the number of channels times the number of banks.*/</a>
<a name="1073"><span class="lineNum">    1073 </span>            :         /*in linear mode graphics or underlay with scatter-gather enabled and inefficient pitch, the bytes per page close-open is the line request alternation slice, because different lines are in completely different 4k address bases.*/</a>
<a name="1074"><span class="lineNum">    1074 </span>            :         /*otherwise, the bytes page close-open is the chunk size because that is the arbitration slice.*/</a>
<a name="1075"><span class="lineNum">    1075 </span>            :         /*pte requests are grouped by pte requests per chunk if that is more than 1. each group costs a page close-open time for dmif reads*/</a>
<a name="1076"><span class="lineNum">    1076 </span>            :         /*cursor requests outstanding are limited to a group of two source lines. each group costs a page close-open time for dmif reads*/</a>
<a name="1077"><span class="lineNum">    1077 </span>            :         /*the display reads and writes time for data transfer is the minimum data or cursor buffer size in time minus the mc urgent latency*/</a>
<a name="1078"><span class="lineNum">    1078 </span>            :         /*the mc urgent latency is experienced more than one time if the number of dmif requests in the data buffer exceeds the request buffer size plus the request slots reserved for dmif in the dram channel arbiter queues*/</a>
<a name="1079"><span class="lineNum">    1079 </span>            :         /*the dispclk required is the maximum for all surfaces of the maximum of the source pixels for first output pixel times the throughput factor, divided by the pixels per dispclk, and divided by the minimum latency hiding minus the dram speed/p-state change latency minus the burst time, and the source pixels for last output pixel, times the throughput factor, divided by the pixels per dispclk, and divided by the minimum latency hiding minus the dram speed/p-state change latency minus the burst time, plus the active time.*/</a>
<a name="1080"><span class="lineNum">    1080 </span>            :         /*the data burst time is the maximum of the total page close-open time, total dmif/mcifwr buffer size in memory divided by the dram bandwidth, and the total dmif/mcifwr buffer size in memory divided by the 32 byte sclk data bus bandwidth, each multiplied by its efficiency.*/</a>
<a name="1081"><span class="lineNum">    1081 </span>            :         /*the source line transfer time is the maximum for all surfaces of the maximum of the burst time plus the urgent latency times the floor of the data required divided by the buffer size for the fist pixel, and the burst time plus the urgent latency times the floor of the data required divided by the buffer size for the last pixel plus the active time.*/</a>
<a name="1082"><span class="lineNum">    1082 </span>            :         /*the source pixels for the first output pixel is 512 if the scaler vertical filter initialization value is greater than 2, and it is 4 times the source width if it is greater than 4.*/</a>
<a name="1083"><span class="lineNum">    1083 </span>            :         /*the source pixels for the last output pixel is the source width times the scaler vertical filter initialization value rounded up to even*/</a>
<a name="1084"><span class="lineNum">    1084 </span>            :         /*the source data for these pixels is the number of pixels times the bytes per pixel times the bytes per request divided by the useful bytes per request.*/</a>
<a name="1085"><span class="lineNum">    1085 </span><span class="lineNoCov">          0 :         data-&gt;cursor_total_data = bw_int_to_fixed(0);</span></a>
<a name="1086"><span class="lineNum">    1086 </span><span class="lineNoCov">          0 :         data-&gt;cursor_total_request_groups = bw_int_to_fixed(0);</span></a>
<a name="1087"><span class="lineNum">    1087 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_total_pte_requests = bw_int_to_fixed(0);</span></a>
<a name="1088"><span class="lineNum">    1088 </span><span class="lineNoCov">          0 :         data-&gt;scatter_gather_total_pte_request_groups = bw_int_to_fixed(0);</span></a>
<a name="1089"><span class="lineNum">    1089 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1090"><span class="lineNum">    1090 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1091"><span class="lineNum">    1091 </span><span class="lineNoCov">          0 :                         data-&gt;cursor_total_data = bw_add(data-&gt;cursor_total_data, bw_mul(bw_mul(bw_int_to_fixed(2), data-&gt;cursor_width_pixels[i]), bw_int_to_fixed(4)));</span></a>
<a name="1092"><span class="lineNum">    1092 </span><span class="lineNoCov">          0 :                         if (dceip-&gt;large_cursor == 1) {</span></a>
<a name="1093"><span class="lineNum">    1093 </span><span class="lineNoCov">          0 :                                 data-&gt;cursor_total_request_groups = bw_add(data-&gt;cursor_total_request_groups, bw_int_to_fixed((dceip-&gt;cursor_max_outstanding_group_num + 1)));</span></a>
<a name="1094"><span class="lineNum">    1094 </span>            :                         }</a>
<a name="1095"><span class="lineNum">    1095 </span>            :                         else {</a>
<a name="1096"><span class="lineNum">    1096 </span><span class="lineNoCov">          0 :                                 data-&gt;cursor_total_request_groups = bw_add(data-&gt;cursor_total_request_groups, bw_ceil2(bw_div(data-&gt;cursor_width_pixels[i], dceip-&gt;cursor_chunk_width), bw_int_to_fixed(1)));</span></a>
<a name="1097"><span class="lineNum">    1097 </span>            :                         }</a>
<a name="1098"><span class="lineNum">    1098 </span><span class="lineNoCov">          0 :                         if (data-&gt;scatter_gather_enable_for_pipe[i]) {</span></a>
<a name="1099"><span class="lineNum">    1099 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_total_pte_requests = bw_add(data-&gt;scatter_gather_total_pte_requests, data-&gt;scatter_gather_pte_request_limit[i]);</span></a>
<a name="1100"><span class="lineNum">    1100 </span><span class="lineNoCov">          0 :                                 data-&gt;scatter_gather_total_pte_request_groups = bw_add(data-&gt;scatter_gather_total_pte_request_groups, bw_ceil2(bw_div(data-&gt;scatter_gather_pte_request_limit[i], bw_ceil2(data-&gt;pte_request_per_chunk[i], bw_int_to_fixed(1))), bw_int_to_fixed(1)));</span></a>
<a name="1101"><span class="lineNum">    1101 </span>            :                         }</a>
<a name="1102"><span class="lineNum">    1102 </span>            :                 }</a>
<a name="1103"><span class="lineNum">    1103 </span>            :         }</a>
<a name="1104"><span class="lineNum">    1104 </span><span class="lineNoCov">          0 :         data-&gt;tile_width_in_pixels = bw_int_to_fixed(8);</span></a>
<a name="1105"><span class="lineNum">    1105 </span><span class="lineNoCov">          0 :         data-&gt;dmif_total_number_of_data_request_page_close_open = bw_int_to_fixed(0);</span></a>
<a name="1106"><span class="lineNum">    1106 </span><span class="lineNoCov">          0 :         data-&gt;mcifwr_total_number_of_data_request_page_close_open = bw_int_to_fixed(0);</span></a>
<a name="1107"><span class="lineNum">    1107 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1108"><span class="lineNum">    1108 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1109"><span class="lineNum">    1109 </span><span class="lineNoCov">          0 :                         if (data-&gt;scatter_gather_enable_for_pipe[i] == 1 &amp;&amp; tiling_mode[i] != bw_def_linear) {</span></a>
<a name="1110"><span class="lineNum">    1110 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_page_close_open = bw_mul(data-&gt;lines_interleaved_in_mem_access[i], bw_max2(bw_mul(bw_mul(bw_mul(bw_int_to_fixed(data-&gt;bytes_per_pixel[i]), data-&gt;tile_width_in_pixels), bw_int_to_fixed(vbios-&gt;number_of_dram_banks)), bw_int_to_fixed(data-&gt;number_of_dram_channels)), bw_mul(bw_int_to_fixed(data-&gt;bytes_per_pixel[i]), data-&gt;scatter_gather_page_width[i])));</span></a>
<a name="1111"><span class="lineNum">    1111 </span>            :                         }</a>
<a name="1112"><span class="lineNum">    1112 </span><span class="lineNoCov">          0 :                         else if (data-&gt;scatter_gather_enable_for_pipe[i] == 1 &amp;&amp; tiling_mode[i] == bw_def_linear &amp;&amp; bw_equ(bw_mod((bw_mul(data-&gt;pitch_in_pixels_after_surface_type[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i]))), data-&gt;inefficient_linear_pitch_in_bytes), bw_int_to_fixed(0))) {</span></a>
<a name="1113"><span class="lineNum">    1113 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_page_close_open = dceip-&gt;linear_mode_line_request_alternation_slice;</span></a>
<a name="1114"><span class="lineNum">    1114 </span>            :                         }</a>
<a name="1115"><span class="lineNum">    1115 </span>            :                         else {</a>
<a name="1116"><span class="lineNum">    1116 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_page_close_open = data-&gt;memory_chunk_size_in_bytes[i];</span></a>
<a name="1117"><span class="lineNum">    1117 </span>            :                         }</a>
<a name="1118"><span class="lineNum">    1118 </span><span class="lineNoCov">          0 :                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1119"><span class="lineNum">    1119 </span><span class="lineNoCov">          0 :                                 data-&gt;dmif_total_number_of_data_request_page_close_open = bw_add(data-&gt;dmif_total_number_of_data_request_page_close_open, bw_div(bw_ceil2(data-&gt;adjusted_data_buffer_size[i], data-&gt;memory_chunk_size_in_bytes[i]), data-&gt;bytes_per_page_close_open));</span></a>
<a name="1120"><span class="lineNum">    1120 </span>            :                         }</a>
<a name="1121"><span class="lineNum">    1121 </span>            :                         else {</a>
<a name="1122"><span class="lineNum">    1122 </span><span class="lineNoCov">          0 :                                 data-&gt;mcifwr_total_number_of_data_request_page_close_open = bw_add(data-&gt;mcifwr_total_number_of_data_request_page_close_open, bw_div(bw_ceil2(data-&gt;adjusted_data_buffer_size[i], data-&gt;memory_chunk_size_in_bytes[i]), data-&gt;bytes_per_page_close_open));</span></a>
<a name="1123"><span class="lineNum">    1123 </span>            :                         }</a>
<a name="1124"><span class="lineNum">    1124 </span>            :                 }</a>
<a name="1125"><span class="lineNum">    1125 </span>            :         }</a>
<a name="1126"><span class="lineNum">    1126 </span><span class="lineNoCov">          0 :         data-&gt;dmif_total_page_close_open_time = bw_div(bw_mul((bw_add(bw_add(data-&gt;dmif_total_number_of_data_request_page_close_open, data-&gt;scatter_gather_total_pte_request_groups), data-&gt;cursor_total_request_groups)), vbios-&gt;trc), bw_int_to_fixed(1000));</span></a>
<a name="1127"><span class="lineNum">    1127 </span><span class="lineNoCov">          0 :         data-&gt;mcifwr_total_page_close_open_time = bw_div(bw_mul(data-&gt;mcifwr_total_number_of_data_request_page_close_open, vbios-&gt;trc), bw_int_to_fixed(1000));</span></a>
<a name="1128"><span class="lineNum">    1128 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1129"><span class="lineNum">    1129 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1130"><span class="lineNum">    1130 </span><span class="lineNoCov">          0 :                         data-&gt;adjusted_data_buffer_size_in_memory[i] = bw_div(bw_mul(data-&gt;adjusted_data_buffer_size[i], data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]);</span></a>
<a name="1131"><span class="lineNum">    1131 </span>            :                 }</a>
<a name="1132"><span class="lineNum">    1132 </span>            :         }</a>
<a name="1133"><span class="lineNum">    1133 </span><span class="lineNoCov">          0 :         data-&gt;total_requests_for_adjusted_dmif_size = bw_int_to_fixed(0);</span></a>
<a name="1134"><span class="lineNum">    1134 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1135"><span class="lineNum">    1135 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1136"><span class="lineNum">    1136 </span><span class="lineNoCov">          0 :                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1137"><span class="lineNum">    1137 </span><span class="lineNoCov">          0 :                                 data-&gt;total_requests_for_adjusted_dmif_size = bw_add(data-&gt;total_requests_for_adjusted_dmif_size, bw_div(data-&gt;adjusted_data_buffer_size[i], data-&gt;useful_bytes_per_request[i]));</span></a>
<a name="1138"><span class="lineNum">    1138 </span>            :                         }</a>
<a name="1139"><span class="lineNum">    1139 </span>            :                 }</a>
<a name="1140"><span class="lineNum">    1140 </span>            :         }</a>
<a name="1141"><span class="lineNum">    1141 </span><span class="lineNoCov">          0 :         data-&gt;total_dmifmc_urgent_trips = bw_ceil2(bw_div(data-&gt;total_requests_for_adjusted_dmif_size, (bw_add(dceip-&gt;dmif_request_buffer_size, bw_int_to_fixed(vbios-&gt;number_of_request_slots_gmc_reserves_for_dmif_per_channel * data-&gt;number_of_dram_channels)))), bw_int_to_fixed(1));</span></a>
<a name="1142"><span class="lineNum">    1142 </span><span class="lineNoCov">          0 :         data-&gt;total_dmifmc_urgent_latency = bw_mul(vbios-&gt;dmifmc_urgent_latency, data-&gt;total_dmifmc_urgent_trips);</span></a>
<a name="1143"><span class="lineNum">    1143 </span><span class="lineNoCov">          0 :         data-&gt;total_display_reads_required_data = bw_int_to_fixed(0);</span></a>
<a name="1144"><span class="lineNum">    1144 </span><span class="lineNoCov">          0 :         data-&gt;total_display_reads_required_dram_access_data = bw_int_to_fixed(0);</span></a>
<a name="1145"><span class="lineNum">    1145 </span><span class="lineNoCov">          0 :         data-&gt;total_display_writes_required_data = bw_int_to_fixed(0);</span></a>
<a name="1146"><span class="lineNum">    1146 </span><span class="lineNoCov">          0 :         data-&gt;total_display_writes_required_dram_access_data = bw_int_to_fixed(0);</span></a>
<a name="1147"><span class="lineNum">    1147 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1148"><span class="lineNum">    1148 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1149"><span class="lineNum">    1149 </span><span class="lineNoCov">          0 :                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1150"><span class="lineNum">    1150 </span><span class="lineNoCov">          0 :                                 data-&gt;display_reads_required_data = data-&gt;adjusted_data_buffer_size_in_memory[i];</span></a>
<a name="1151"><span class="lineNum">    1151 </span>            :                                 /*for hbm memories, each channel is split into 2 pseudo-channels that are each 64 bits in width.  each*/</a>
<a name="1152"><span class="lineNum">    1152 </span>            :                                 /*pseudo-channel may be read independently of one another.*/</a>
<a name="1153"><span class="lineNum">    1153 </span>            :                                 /*the read burst length (bl) for hbm memories is 4, so each read command will access 32 bytes of data.*/</a>
<a name="1154"><span class="lineNum">    1154 </span>            :                                 /*the 64 or 32 byte sized data is stored in one pseudo-channel.*/</a>
<a name="1155"><span class="lineNum">    1155 </span>            :                                 /*it will take 4 memclk cycles or 8 yclk cycles to fetch 64 bytes of data from the hbm memory (2 read commands).*/</a>
<a name="1156"><span class="lineNum">    1156 </span>            :                                 /*it will take 2 memclk cycles or 4 yclk cycles to fetch 32 bytes of data from the hbm memory (1 read command).*/</a>
<a name="1157"><span class="lineNum">    1157 </span>            :                                 /*for gddr5/ddr4 memories, there is additional overhead if the size of the request is smaller than 64 bytes.*/</a>
<a name="1158"><span class="lineNum">    1158 </span>            :                                 /*the read burst length (bl) for gddr5/ddr4 memories is 8, regardless of the size of the data request.*/</a>
<a name="1159"><span class="lineNum">    1159 </span>            :                                 /*therefore it will require 8 cycles to fetch 64 or 32 bytes of data from the memory.*/</a>
<a name="1160"><span class="lineNum">    1160 </span>            :                                 /*the memory efficiency will be 50% for the 32 byte sized data.*/</a>
<a name="1161"><span class="lineNum">    1161 </span><span class="lineNoCov">          0 :                                 if (vbios-&gt;memory_type == bw_def_hbm) {</span></a>
<a name="1162"><span class="lineNum">    1162 </span><span class="lineNoCov">          0 :                                         data-&gt;display_reads_required_dram_access_data = data-&gt;adjusted_data_buffer_size_in_memory[i];</span></a>
<a name="1163"><span class="lineNum">    1163 </span>            :                                 }</a>
<a name="1164"><span class="lineNum">    1164 </span>            :                                 else {</a>
<a name="1165"><span class="lineNum">    1165 </span><span class="lineNoCov">          0 :                                         data-&gt;display_reads_required_dram_access_data = bw_mul(data-&gt;adjusted_data_buffer_size_in_memory[i], bw_ceil2(bw_div(bw_int_to_fixed((8 * vbios-&gt;dram_channel_width_in_bits / 8)), data-&gt;bytes_per_request[i]), bw_int_to_fixed(1)));</span></a>
<a name="1166"><span class="lineNum">    1166 </span>            :                                 }</a>
<a name="1167"><span class="lineNum">    1167 </span><span class="lineNoCov">          0 :                                 data-&gt;total_display_reads_required_data = bw_add(data-&gt;total_display_reads_required_data, data-&gt;display_reads_required_data);</span></a>
<a name="1168"><span class="lineNum">    1168 </span><span class="lineNoCov">          0 :                                 data-&gt;total_display_reads_required_dram_access_data = bw_add(data-&gt;total_display_reads_required_dram_access_data, data-&gt;display_reads_required_dram_access_data);</span></a>
<a name="1169"><span class="lineNum">    1169 </span>            :                         }</a>
<a name="1170"><span class="lineNum">    1170 </span>            :                         else {</a>
<a name="1171"><span class="lineNum">    1171 </span><span class="lineNoCov">          0 :                                 data-&gt;total_display_writes_required_data = bw_add(data-&gt;total_display_writes_required_data, data-&gt;adjusted_data_buffer_size_in_memory[i]);</span></a>
<a name="1172"><span class="lineNum">    1172 </span><span class="lineNoCov">          0 :                                 data-&gt;total_display_writes_required_dram_access_data = bw_add(data-&gt;total_display_writes_required_dram_access_data, bw_mul(data-&gt;adjusted_data_buffer_size_in_memory[i], bw_ceil2(bw_div(bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits), data-&gt;bytes_per_request[i]), bw_int_to_fixed(1))));</span></a>
<a name="1173"><span class="lineNum">    1173 </span>            :                         }</a>
<a name="1174"><span class="lineNum">    1174 </span>            :                 }</a>
<a name="1175"><span class="lineNum">    1175 </span>            :         }</a>
<a name="1176"><span class="lineNum">    1176 </span><span class="lineNoCov">          0 :         data-&gt;total_display_reads_required_data = bw_add(bw_add(data-&gt;total_display_reads_required_data, data-&gt;cursor_total_data), bw_mul(data-&gt;scatter_gather_total_pte_requests, bw_int_to_fixed(64)));</span></a>
<a name="1177"><span class="lineNum">    1177 </span><span class="lineNoCov">          0 :         data-&gt;total_display_reads_required_dram_access_data = bw_add(bw_add(data-&gt;total_display_reads_required_dram_access_data, data-&gt;cursor_total_data), bw_mul(data-&gt;scatter_gather_total_pte_requests, bw_int_to_fixed(64)));</span></a>
<a name="1178"><span class="lineNum">    1178 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1179"><span class="lineNum">    1179 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1180"><span class="lineNum">    1180 </span><span class="lineNoCov">          0 :                         if (bw_mtn(data-&gt;v_filter_init[i], bw_int_to_fixed(4))) {</span></a>
<a name="1181"><span class="lineNum">    1181 </span><span class="lineNoCov">          0 :                                 data-&gt;src_pixels_for_first_output_pixel[i] = bw_mul(bw_int_to_fixed(4), data-&gt;source_width_rounded_up_to_chunks[i]);</span></a>
<a name="1182"><span class="lineNum">    1182 </span>            :                         }</a>
<a name="1183"><span class="lineNum">    1183 </span>            :                         else {</a>
<a name="1184"><span class="lineNum">    1184 </span><span class="lineNoCov">          0 :                                 if (bw_mtn(data-&gt;v_filter_init[i], bw_int_to_fixed(2))) {</span></a>
<a name="1185"><span class="lineNum">    1185 </span><span class="lineNoCov">          0 :                                         data-&gt;src_pixels_for_first_output_pixel[i] = bw_int_to_fixed(512);</span></a>
<a name="1186"><span class="lineNum">    1186 </span>            :                                 }</a>
<a name="1187"><span class="lineNum">    1187 </span>            :                                 else {</a>
<a name="1188"><span class="lineNum">    1188 </span><span class="lineNoCov">          0 :                                         data-&gt;src_pixels_for_first_output_pixel[i] = bw_int_to_fixed(0);</span></a>
<a name="1189"><span class="lineNum">    1189 </span>            :                                 }</a>
<a name="1190"><span class="lineNum">    1190 </span>            :                         }</a>
<a name="1191"><span class="lineNum">    1191 </span><span class="lineNoCov">          0 :                         data-&gt;src_data_for_first_output_pixel[i] = bw_div(bw_mul(bw_mul(data-&gt;src_pixels_for_first_output_pixel[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]);</span></a>
<a name="1192"><span class="lineNum">    1192 </span><span class="lineNoCov">          0 :                         data-&gt;src_pixels_for_last_output_pixel[i] = bw_mul(data-&gt;source_width_rounded_up_to_chunks[i], bw_max2(bw_ceil2(data-&gt;v_filter_init[i], bw_int_to_fixed(dceip-&gt;lines_interleaved_into_lb)), bw_mul(bw_ceil2(data-&gt;vsr[i], bw_int_to_fixed(dceip-&gt;lines_interleaved_into_lb)), data-&gt;horizontal_blank_and_chunk_granularity_factor[i])));</span></a>
<a name="1193"><span class="lineNum">    1193 </span><span class="lineNoCov">          0 :                         data-&gt;src_data_for_last_output_pixel[i] = bw_div(bw_mul(bw_mul(bw_mul(data-&gt;source_width_rounded_up_to_chunks[i], bw_max2(bw_ceil2(data-&gt;v_filter_init[i], bw_int_to_fixed(dceip-&gt;lines_interleaved_into_lb)), data-&gt;lines_interleaved_in_mem_access[i])), bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]);</span></a>
<a name="1194"><span class="lineNum">    1194 </span><span class="lineNoCov">          0 :                         data-&gt;active_time[i] = bw_div(bw_div(data-&gt;source_width_rounded_up_to_chunks[i], data-&gt;hsr[i]), data-&gt;pixel_rate[i]);</span></a>
<a name="1195"><span class="lineNum">    1195 </span>            :                 }</a>
<a name="1196"><span class="lineNum">    1196 </span>            :         }</a>
<a name="1197"><span class="lineNum">    1197 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= 2; i++) {</span></a>
<a name="1198"><span class="lineNum">    1198 </span><span class="lineNoCov">          0 :                 for (j = 0; j &lt;= 7; j++) {</span></a>
<a name="1199"><span class="lineNum">    1199 </span><span class="lineNoCov">          0 :                         data-&gt;dmif_burst_time[i][j] = bw_max3(data-&gt;dmif_total_page_close_open_time, bw_div(data-&gt;total_display_reads_required_dram_access_data, (bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[i]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels)))), bw_div(data-&gt;total_display_reads_required_data, (bw_mul(bw_mul(sclk[j], vbios-&gt;data_return_bus_width), bw_frc_to_fixed(dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency, 100)))));</span></a>
<a name="1200"><span class="lineNum">    1200 </span><span class="lineNoCov">          0 :                         if (data-&gt;d1_display_write_back_dwb_enable == 1) {</span></a>
<a name="1201"><span class="lineNum">    1201 </span><span class="lineNoCov">          0 :                                 data-&gt;mcifwr_burst_time[i][j] = bw_max3(data-&gt;mcifwr_total_page_close_open_time, bw_div(data-&gt;total_display_writes_required_dram_access_data, (bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[i]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_wrchannels)))), bw_div(data-&gt;total_display_writes_required_data, (bw_mul(sclk[j], vbios-&gt;data_return_bus_width))));</span></a>
<a name="1202"><span class="lineNum">    1202 </span>            :                         }</a>
<a name="1203"><span class="lineNum">    1203 </span>            :                 }</a>
<a name="1204"><span class="lineNum">    1204 </span>            :         }</a>
<a name="1205"><span class="lineNum">    1205 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1206"><span class="lineNum">    1206 </span><span class="lineNoCov">          0 :                 for (j = 0; j &lt;= 2; j++) {</span></a>
<a name="1207"><span class="lineNum">    1207 </span><span class="lineNoCov">          0 :                         for (k = 0; k &lt;= 7; k++) {</span></a>
<a name="1208"><span class="lineNum">    1208 </span><span class="lineNoCov">          0 :                                 if (data-&gt;enable[i]) {</span></a>
<a name="1209"><span class="lineNum">    1209 </span><span class="lineNoCov">          0 :                                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1210"><span class="lineNum">    1210 </span>            :                                                 /*time to transfer data from the dmif buffer to the lb.  since the mc to dmif transfer time overlaps*/</a>
<a name="1211"><span class="lineNum">    1211 </span>            :                                                 /*with the dmif to lb transfer time, only time to transfer the last chunk  is considered.*/</a>
<a name="1212"><span class="lineNum">    1212 </span><span class="lineNoCov">          0 :                                                 data-&gt;dmif_buffer_transfer_time[i] = bw_mul(data-&gt;source_width_rounded_up_to_chunks[i], (bw_div(dceip-&gt;lb_write_pixels_per_dispclk, (bw_div(vbios-&gt;low_voltage_max_dispclk, dceip-&gt;display_pipe_throughput_factor)))));</span></a>
<a name="1213"><span class="lineNum">    1213 </span><span class="lineNoCov">          0 :                                                 data-&gt;line_source_transfer_time[i][j][k] = bw_max2(bw_mul((bw_add(data-&gt;total_dmifmc_urgent_latency, data-&gt;dmif_burst_time[j][k])), bw_floor2(bw_div(data-&gt;src_data_for_first_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1))), bw_sub(bw_add(bw_mul((bw_add(data-&gt;total_dmifmc_urgent_latency, data-&gt;dmif_burst_time[j][k])), bw_floor2(bw_div(data-&gt;src_data_for_last_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1))), data-&gt;dmif_buffer_transfer_time[i]), data-&gt;active_time[i]));</span></a>
<a name="1214"><span class="lineNum">    1214 </span>            :                                                 /*during an mclk switch the requests from the dce ip are stored in the gmc/arb.  these requests should be serviced immediately*/</a>
<a name="1215"><span class="lineNum">    1215 </span>            :                                                 /*after the mclk switch sequence and not incur an urgent latency penalty.  it is assumed that the gmc/arb can hold up to 256 requests*/</a>
<a name="1216"><span class="lineNum">    1216 </span>            :                                                 /*per memory channel.  if the dce ip is urgent after the mclk switch sequence, all pending requests and subsequent requests should be*/</a>
<a name="1217"><span class="lineNum">    1217 </span>            :                                                 /*immediately serviced without a gap in the urgent requests.*/</a>
<a name="1218"><span class="lineNum">    1218 </span>            :                                                 /*the latency incurred would be the time to issue the requests and return the data for the first or last output pixel.*/</a>
<a name="1219"><span class="lineNum">    1219 </span><span class="lineNoCov">          0 :                                                 if (surface_type[i] == bw_def_graphics) {</span></a>
<a name="1220"><span class="lineNum">    1220 </span><span class="lineNoCov">          0 :                                                         switch (data-&gt;lb_bpc[i]) {</span></a>
<a name="1221"><span class="lineNum">    1221 </span>            :                                                         case 6:</a>
<a name="1222"><span class="lineNum">    1222 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency6_bit_per_component;</span></a>
<a name="1223"><span class="lineNum">    1223 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1224"><span class="lineNum">    1224 </span>            :                                                         case 8:</a>
<a name="1225"><span class="lineNum">    1225 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency8_bit_per_component;</span></a>
<a name="1226"><span class="lineNum">    1226 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1227"><span class="lineNum">    1227 </span>            :                                                         case 10:</a>
<a name="1228"><span class="lineNum">    1228 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency10_bit_per_component;</span></a>
<a name="1229"><span class="lineNum">    1229 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1230"><span class="lineNum">    1230 </span>            :                                                         default:</a>
<a name="1231"><span class="lineNum">    1231 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency12_bit_per_component;</span></a>
<a name="1232"><span class="lineNum">    1232 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1233"><span class="lineNum">    1233 </span>            :                                                         }</a>
<a name="1234"><span class="lineNum">    1234 </span><span class="lineNoCov">          0 :                                                         if (data-&gt;use_alpha[i] == 1) {</span></a>
<a name="1235"><span class="lineNum">    1235 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = bw_min2(data-&gt;v_scaler_efficiency, dceip-&gt;alpha_vscaler_efficiency);</span></a>
<a name="1236"><span class="lineNum">    1236 </span>            :                                                         }</a>
<a name="1237"><span class="lineNum">    1237 </span>            :                                                 }</a>
<a name="1238"><span class="lineNum">    1238 </span>            :                                                 else {</a>
<a name="1239"><span class="lineNum">    1239 </span><span class="lineNoCov">          0 :                                                         switch (data-&gt;lb_bpc[i]) {</span></a>
<a name="1240"><span class="lineNum">    1240 </span>            :                                                         case 6:</a>
<a name="1241"><span class="lineNum">    1241 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = dceip-&gt;underlay_vscaler_efficiency6_bit_per_component;</span></a>
<a name="1242"><span class="lineNum">    1242 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1243"><span class="lineNum">    1243 </span>            :                                                         case 8:</a>
<a name="1244"><span class="lineNum">    1244 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = dceip-&gt;underlay_vscaler_efficiency8_bit_per_component;</span></a>
<a name="1245"><span class="lineNum">    1245 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1246"><span class="lineNum">    1246 </span>            :                                                         case 10:</a>
<a name="1247"><span class="lineNum">    1247 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = dceip-&gt;underlay_vscaler_efficiency10_bit_per_component;</span></a>
<a name="1248"><span class="lineNum">    1248 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1249"><span class="lineNum">    1249 </span>            :                                                         default:</a>
<a name="1250"><span class="lineNum">    1250 </span><span class="lineNoCov">          0 :                                                                 data-&gt;v_scaler_efficiency = bw_int_to_fixed(3);</span></a>
<a name="1251"><span class="lineNum">    1251 </span><span class="lineNoCov">          0 :                                                                 break;</span></a>
<a name="1252"><span class="lineNum">    1252 </span>            :                                                         }</a>
<a name="1253"><span class="lineNum">    1253 </span>            :                                                 }</a>
<a name="1254"><span class="lineNum">    1254 </span><span class="lineNoCov">          0 :                                                 if (dceip-&gt;pre_downscaler_enabled &amp;&amp; bw_mtn(data-&gt;hsr[i], bw_int_to_fixed(1))) {</span></a>
<a name="1255"><span class="lineNum">    1255 </span><span class="lineNoCov">          0 :                                                         data-&gt;scaler_limits_factor = bw_max2(bw_div(data-&gt;v_taps[i], data-&gt;v_scaler_efficiency), bw_div(data-&gt;source_width_rounded_up_to_chunks[i], data-&gt;h_total[i]));</span></a>
<a name="1256"><span class="lineNum">    1256 </span>            :                                                 }</a>
<a name="1257"><span class="lineNum">    1257 </span>            :                                                 else {</a>
<a name="1258"><span class="lineNum">    1258 </span><span class="lineNoCov">          0 :                                                         data-&gt;scaler_limits_factor = bw_max3(bw_int_to_fixed(1), bw_ceil2(bw_div(data-&gt;h_taps[i], bw_int_to_fixed(4)), bw_int_to_fixed(1)), bw_mul(data-&gt;hsr[i], bw_max2(bw_div(data-&gt;v_taps[i], data-&gt;v_scaler_efficiency), bw_int_to_fixed(1))));</span></a>
<a name="1259"><span class="lineNum">    1259 </span>            :                                                 }</a>
<a name="1260"><span class="lineNum">    1260 </span><span class="lineNoCov">          0 :                                                 data-&gt;dram_speed_change_line_source_transfer_time[i][j][k] = bw_mul(bw_int_to_fixed(2), bw_max2((bw_add((bw_div(data-&gt;src_data_for_first_output_pixel[i], bw_min2(bw_mul(data-&gt;bytes_per_request[i], sclk[k]), bw_div(bw_mul(bw_mul(data-&gt;bytes_per_request[i], data-&gt;pixel_rate[i]), data-&gt;scaler_limits_factor), bw_int_to_fixed(2))))), (bw_mul(data-&gt;dmif_burst_time[j][k], bw_floor2(bw_div(data-&gt;src_data_for_first_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1)))))), (bw_add((bw_div(data-&gt;src_data_for_last_output_pixel[i], bw_min2(bw_mul(data-&gt;bytes_per_request[i], sclk[k]), bw_div(bw_mul(bw_mul(data-&gt;bytes_per_request[i], data-&gt;pixel_rate[i]), data-&gt;scaler_limits_factor), bw_int_to_fixed(2))))), (bw_sub(bw_mul(data-&gt;dmif_burst_time[j][k], bw_floor2(bw_div(data-&gt;src_data_for_last_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1))), data-&gt;active_time[i]))))));</span></a>
<a name="1261"><span class="lineNum">    1261 </span>            :                                         }</a>
<a name="1262"><span class="lineNum">    1262 </span>            :                                         else {</a>
<a name="1263"><span class="lineNum">    1263 </span><span class="lineNoCov">          0 :                                                 data-&gt;line_source_transfer_time[i][j][k] = bw_max2(bw_mul((bw_add(vbios-&gt;mcifwrmc_urgent_latency, data-&gt;mcifwr_burst_time[j][k])), bw_floor2(bw_div(data-&gt;src_data_for_first_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1))), bw_sub(bw_mul((bw_add(vbios-&gt;mcifwrmc_urgent_latency, data-&gt;mcifwr_burst_time[j][k])), bw_floor2(bw_div(data-&gt;src_data_for_last_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1))), data-&gt;active_time[i]));</span></a>
<a name="1264"><span class="lineNum">    1264 </span><span class="lineNoCov">          0 :                                                 /*during an mclk switch the requests from the dce ip are stored in the gmc/arb.  these requests should be serviced immediately*/</span></a>
<a name="1265"><span class="lineNum">    1265 </span>            :                                                 /*after the mclk switch sequence and not incur an urgent latency penalty.  it is assumed that the gmc/arb can hold up to 256 requests*/</a>
<a name="1266"><span class="lineNum">    1266 </span>            :                                                 /*per memory channel.  if the dce ip is urgent after the mclk switch sequence, all pending requests and subsequent requests should be*/</a>
<a name="1267"><span class="lineNum">    1267 </span>            :                                                 /*immediately serviced without a gap in the urgent requests.*/</a>
<a name="1268"><span class="lineNum">    1268 </span>            :                                                 /*the latency incurred would be the time to issue the requests and return the data for the first or last output pixel.*/</a>
<a name="1269"><span class="lineNum">    1269 </span><span class="lineNoCov">          0 :                                                 data-&gt;dram_speed_change_line_source_transfer_time[i][j][k] = bw_max2((bw_add((bw_div(data-&gt;src_data_for_first_output_pixel[i], bw_min2(bw_mul(data-&gt;bytes_per_request[i], sclk[k]), bw_div(bw_mul(data-&gt;bytes_per_request[i], vbios-&gt;low_voltage_max_dispclk), bw_int_to_fixed(2))))), (bw_mul(data-&gt;mcifwr_burst_time[j][k], bw_floor2(bw_div(data-&gt;src_data_for_first_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1)))))), (bw_add((bw_div(data-&gt;src_data_for_last_output_pixel[i], bw_min2(bw_mul(data-&gt;bytes_per_request[i], sclk[k]), bw_div(bw_mul(data-&gt;bytes_per_request[i], vbios-&gt;low_voltage_max_dispclk), bw_int_to_fixed(2))))), (bw_sub(bw_mul(data-&gt;mcifwr_burst_time[j][k], bw_floor2(bw_div(data-&gt;src_data_for_last_output_pixel[i], data-&gt;adjusted_data_buffer_size_in_memory[i]), bw_int_to_fixed(1))), data-&gt;active_time[i])))));</span></a>
<a name="1270"><span class="lineNum">    1270 </span>            :                                         }</a>
<a name="1271"><span class="lineNum">    1271 </span>            :                                 }</a>
<a name="1272"><span class="lineNum">    1272 </span>            :                         }</a>
<a name="1273"><span class="lineNum">    1273 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1274"><span class="lineNum">    1274 </span>            :         }</a>
<a name="1275"><span class="lineNum">    1275 </span>            :         /*cpu c-state and p-state change enable*/</a>
<a name="1276"><span class="lineNum">    1276 </span>            :         /*for cpu p-state change to be possible for a yclk(pclk) and sclk level the dispclk required has to be enough for the blackout duration*/</a>
<a name="1277"><span class="lineNum">    1277 </span>            :         /*for cpu c-state change to be possible for a yclk(pclk) and sclk level the dispclk required has to be enough for the blackout duration and recovery*/</a>
<a name="1278"><span class="lineNum">    1278 </span>            :         /*condition for the blackout duration:*/</a>
<a name="1279"><span class="lineNum">    1279 </span>            :         /* minimum latency hiding &gt; blackout duration + dmif burst time + line source transfer time*/</a>
<a name="1280"><span class="lineNum">    1280 </span>            :         /*condition for the blackout recovery:*/</a>
<a name="1281"><span class="lineNum">    1281 </span>            :         /* recovery time &gt;  dmif burst time + 2 * urgent latency*/</a>
<a name="1282"><span class="lineNum">    1282 </span>            :         /* recovery time &gt; (display bw * blackout duration  + (2 * urgent latency + dmif burst time)*dispclk - dmif size )*/</a>
<a name="1283"><span class="lineNum">    1283 </span>            :         /*                  / (dispclk - display bw)*/</a>
<a name="1284"><span class="lineNum">    1284 </span>            :         /*the minimum latency hiding is the minimum for all pipes of one screen line time, plus one more line time if doing lb prefetch, plus the dmif data buffer size equivalent in time, minus the urgent latency.*/</a>
<a name="1285"><span class="lineNum">    1285 </span>            :         /*the minimum latency hiding is  further limited by the cursor.  the cursor latency hiding is the number of lines of the cursor buffer, minus one if the downscaling is less than two, or minus three if it is more*/</a>
<a name="1286"><span class="lineNum">    1286 </span>            : </a>
<a name="1287"><span class="lineNum">    1287 </span>            :         /*initialize variables*/</a>
<a name="1288"><span class="lineNum">    1288 </span>            :         number_of_displays_enabled = 0;</a>
<a name="1289"><span class="lineNum">    1289 </span>            :         number_of_displays_enabled_with_margin = 0;</a>
<a name="1290"><span class="lineNum">    1290 </span><span class="lineNoCov">          0 :         for (k = 0; k &lt;= maximum_number_of_surfaces - 1; k++) {</span></a>
<a name="1291"><span class="lineNum">    1291 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[k]) {</span></a>
<a name="1292"><span class="lineNum">    1292 </span><span class="lineNoCov">          0 :                         number_of_displays_enabled = number_of_displays_enabled + 1;</span></a>
<a name="1293"><span class="lineNum">    1293 </span>            :                 }</a>
<a name="1294"><span class="lineNum">    1294 </span><span class="lineNoCov">          0 :                 data-&gt;display_pstate_change_enable[k] = 0;</span></a>
<a name="1295"><span class="lineNum">    1295 </span>            :         }</a>
<a name="1296"><span class="lineNum">    1296 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1297"><span class="lineNum">    1297 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1298"><span class="lineNum">    1298 </span><span class="lineNoCov">          0 :                         if ((bw_equ(dceip-&gt;stutter_and_dram_clock_state_change_gated_before_cursor, bw_int_to_fixed(0)) &amp;&amp; bw_mtn(data-&gt;cursor_width_pixels[i], bw_int_to_fixed(0)))) {</span></a>
<a name="1299"><span class="lineNum">    1299 </span><span class="lineNoCov">          0 :                                 if (bw_ltn(data-&gt;vsr[i], bw_int_to_fixed(2))) {</span></a>
<a name="1300"><span class="lineNum">    1300 </span><span class="lineNoCov">          0 :                                         data-&gt;cursor_latency_hiding[i] = bw_div(bw_div(bw_mul((bw_sub(dceip-&gt;cursor_dcp_buffer_lines, bw_int_to_fixed(1))), data-&gt;h_total[i]), data-&gt;vsr[i]), data-&gt;pixel_rate[i]);</span></a>
<a name="1301"><span class="lineNum">    1301 </span>            :                                 }</a>
<a name="1302"><span class="lineNum">    1302 </span>            :                                 else {</a>
<a name="1303"><span class="lineNum">    1303 </span><span class="lineNoCov">          0 :                                         data-&gt;cursor_latency_hiding[i] = bw_div(bw_div(bw_mul((bw_sub(dceip-&gt;cursor_dcp_buffer_lines, bw_int_to_fixed(3))), data-&gt;h_total[i]), data-&gt;vsr[i]), data-&gt;pixel_rate[i]);</span></a>
<a name="1304"><span class="lineNum">    1304 </span>            :                                 }</a>
<a name="1305"><span class="lineNum">    1305 </span>            :                         }</a>
<a name="1306"><span class="lineNum">    1306 </span>            :                         else {</a>
<a name="1307"><span class="lineNum">    1307 </span><span class="lineNoCov">          0 :                                 data-&gt;cursor_latency_hiding[i] = bw_int_to_fixed(9999);</span></a>
<a name="1308"><span class="lineNum">    1308 </span>            :                         }</a>
<a name="1309"><span class="lineNum">    1309 </span>            :                 }</a>
<a name="1310"><span class="lineNum">    1310 </span>            :         }</a>
<a name="1311"><span class="lineNum">    1311 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1312"><span class="lineNum">    1312 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1313"><span class="lineNum">    1313 </span><span class="lineNoCov">          0 :                         if (dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching == 1 &amp;&amp; (bw_equ(data-&gt;vsr[i], bw_int_to_fixed(1)) || (bw_leq(data-&gt;vsr[i], bw_frc_to_fixed(8, 10)) &amp;&amp; bw_leq(data-&gt;v_taps[i], bw_int_to_fixed(2)) &amp;&amp; data-&gt;lb_bpc[i] == 8)) &amp;&amp; surface_type[i] == bw_def_graphics) {</span></a>
<a name="1314"><span class="lineNum">    1314 </span><span class="lineNoCov">          0 :                                 if (number_of_displays_enabled &gt; 2)</span></a>
<a name="1315"><span class="lineNum">    1315 </span><span class="lineNoCov">          0 :                                         data-&gt;minimum_latency_hiding[i] = bw_sub(bw_div(bw_mul((bw_div((bw_add(bw_sub(data-&gt;lb_partitions[i], bw_int_to_fixed(2)), bw_div(bw_div(data-&gt;data_buffer_size[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;source_width_pixels[i]))), data-&gt;vsr[i])), data-&gt;h_total[i]), data-&gt;pixel_rate[i]), data-&gt;total_dmifmc_urgent_latency);</span></a>
<a name="1316"><span class="lineNum">    1316 </span>            :                                 else</a>
<a name="1317"><span class="lineNum">    1317 </span><span class="lineNoCov">          0 :                                         data-&gt;minimum_latency_hiding[i] = bw_sub(bw_div(bw_mul((bw_div((bw_add(bw_sub(data-&gt;lb_partitions[i], bw_int_to_fixed(1)), bw_div(bw_div(data-&gt;data_buffer_size[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;source_width_pixels[i]))), data-&gt;vsr[i])), data-&gt;h_total[i]), data-&gt;pixel_rate[i]), data-&gt;total_dmifmc_urgent_latency);</span></a>
<a name="1318"><span class="lineNum">    1318 </span>            :                         }</a>
<a name="1319"><span class="lineNum">    1319 </span>            :                         else {</a>
<a name="1320"><span class="lineNum">    1320 </span><span class="lineNoCov">          0 :                                 data-&gt;minimum_latency_hiding[i] = bw_sub(bw_div(bw_mul((bw_div((bw_add(bw_int_to_fixed(1 + data-&gt;line_buffer_prefetch[i]), bw_div(bw_div(data-&gt;data_buffer_size[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;source_width_pixels[i]))), data-&gt;vsr[i])), data-&gt;h_total[i]), data-&gt;pixel_rate[i]), data-&gt;total_dmifmc_urgent_latency);</span></a>
<a name="1321"><span class="lineNum">    1321 </span>            :                         }</a>
<a name="1322"><span class="lineNum">    1322 </span><span class="lineNoCov">          0 :                         data-&gt;minimum_latency_hiding_with_cursor[i] = bw_min2(data-&gt;minimum_latency_hiding[i], data-&gt;cursor_latency_hiding[i]);</span></a>
<a name="1323"><span class="lineNum">    1323 </span>            :                 }</a>
<a name="1324"><span class="lineNum">    1324 </span>            :         }</a>
<a name="1325"><span class="lineNum">    1325 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= 2; i++) {</span></a>
<a name="1326"><span class="lineNum">    1326 </span><span class="lineNoCov">          0 :                 for (j = 0; j &lt;= 7; j++) {</span></a>
<a name="1327"><span class="lineNum">    1327 </span><span class="lineNoCov">          0 :                         data-&gt;blackout_duration_margin[i][j] = bw_int_to_fixed(9999);</span></a>
<a name="1328"><span class="lineNum">    1328 </span><span class="lineNoCov">          0 :                         data-&gt;dispclk_required_for_blackout_duration[i][j] = bw_int_to_fixed(0);</span></a>
<a name="1329"><span class="lineNum">    1329 </span><span class="lineNoCov">          0 :                         data-&gt;dispclk_required_for_blackout_recovery[i][j] = bw_int_to_fixed(0);</span></a>
<a name="1330"><span class="lineNum">    1330 </span><span class="lineNoCov">          0 :                         for (k = 0; k &lt;= maximum_number_of_surfaces - 1; k++) {</span></a>
<a name="1331"><span class="lineNum">    1331 </span><span class="lineNoCov">          0 :                                 if (data-&gt;enable[k] &amp;&amp; bw_mtn(vbios-&gt;blackout_duration, bw_int_to_fixed(0))) {</span></a>
<a name="1332"><span class="lineNum">    1332 </span><span class="lineNoCov">          0 :                                         if (surface_type[k] != bw_def_display_write_back420_luma &amp;&amp; surface_type[k] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1333"><span class="lineNum">    1333 </span><span class="lineNoCov">          0 :                                                 data-&gt;blackout_duration_margin[i][j] = bw_min2(data-&gt;blackout_duration_margin[i][j], bw_sub(bw_sub(bw_sub(data-&gt;minimum_latency_hiding_with_cursor[k], vbios-&gt;blackout_duration), data-&gt;dmif_burst_time[i][j]), data-&gt;line_source_transfer_time[k][i][j]));</span></a>
<a name="1334"><span class="lineNum">    1334 </span><span class="lineNoCov">          0 :                                                 data-&gt;dispclk_required_for_blackout_duration[i][j] = bw_max3(data-&gt;dispclk_required_for_blackout_duration[i][j], bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_first_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_sub(bw_sub(data-&gt;minimum_latency_hiding_with_cursor[k], vbios-&gt;blackout_duration), data-&gt;dmif_burst_time[i][j]))), bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_last_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_add(bw_sub(bw_sub(data-&gt;minimum_latency_hiding_with_cursor[k], vbios-&gt;blackout_duration), data-&gt;dmif_burst_time[i][j]), data-&gt;active_time[k]))));</span></a>
<a name="1335"><span class="lineNum">    1335 </span><span class="lineNoCov">          0 :                                                 if (bw_leq(vbios-&gt;maximum_blackout_recovery_time, bw_add(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[i][j]))) {</span></a>
<a name="1336"><span class="lineNum">    1336 </span><span class="lineNoCov">          0 :                                                         data-&gt;dispclk_required_for_blackout_recovery[i][j] = bw_int_to_fixed(9999);</span></a>
<a name="1337"><span class="lineNum">    1337 </span>            :                                                 }</a>
<a name="1338"><span class="lineNum">    1338 </span><span class="lineNoCov">          0 :                                                 else if (bw_ltn(data-&gt;adjusted_data_buffer_size[k], bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), (bw_add(vbios-&gt;blackout_duration, bw_add(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[i][j])))))) {</span></a>
<a name="1339"><span class="lineNum">    1339 </span><span class="lineNoCov">          0 :                                                         data-&gt;dispclk_required_for_blackout_recovery[i][j] = bw_max2(data-&gt;dispclk_required_for_blackout_recovery[i][j], bw_div(bw_mul(bw_div(bw_div((bw_sub(bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), (bw_add(vbios-&gt;blackout_duration, vbios-&gt;maximum_blackout_recovery_time))), data-&gt;adjusted_data_buffer_size[k])), bw_int_to_fixed(data-&gt;bytes_per_pixel[k])), (bw_sub(vbios-&gt;maximum_blackout_recovery_time, bw_sub(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[i][j])))), data-&gt;latency_hiding_lines[k]), data-&gt;lines_interleaved_in_mem_access[k]));</span></a>
<a name="1340"><span class="lineNum">    1340 </span>            :                                                 }</a>
<a name="1341"><span class="lineNum">    1341 </span>            :                                         }</a>
<a name="1342"><span class="lineNum">    1342 </span>            :                                         else {</a>
<a name="1343"><span class="lineNum">    1343 </span><span class="lineNoCov">          0 :                                                 data-&gt;blackout_duration_margin[i][j] = bw_min2(data-&gt;blackout_duration_margin[i][j], bw_sub(bw_sub(bw_sub(bw_sub(data-&gt;minimum_latency_hiding_with_cursor[k], vbios-&gt;blackout_duration), data-&gt;dmif_burst_time[i][j]), data-&gt;mcifwr_burst_time[i][j]), data-&gt;line_source_transfer_time[k][i][j]));</span></a>
<a name="1344"><span class="lineNum">    1344 </span><span class="lineNoCov">          0 :                                                 data-&gt;dispclk_required_for_blackout_duration[i][j] = bw_max3(data-&gt;dispclk_required_for_blackout_duration[i][j], bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_first_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_sub(bw_sub(bw_sub(data-&gt;minimum_latency_hiding_with_cursor[k], vbios-&gt;blackout_duration), data-&gt;dmif_burst_time[i][j]), data-&gt;mcifwr_burst_time[i][j]))), bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_last_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_add(bw_sub(bw_sub(bw_sub(data-&gt;minimum_latency_hiding_with_cursor[k], vbios-&gt;blackout_duration), data-&gt;dmif_burst_time[i][j]), data-&gt;mcifwr_burst_time[i][j]), data-&gt;active_time[k]))));</span></a>
<a name="1345"><span class="lineNum">    1345 </span><span class="lineNoCov">          0 :                                                 if (bw_ltn(vbios-&gt;maximum_blackout_recovery_time, bw_add(bw_add(bw_mul(bw_int_to_fixed(2), vbios-&gt;mcifwrmc_urgent_latency), data-&gt;dmif_burst_time[i][j]), data-&gt;mcifwr_burst_time[i][j]))) {</span></a>
<a name="1346"><span class="lineNum">    1346 </span><span class="lineNoCov">          0 :                                                         data-&gt;dispclk_required_for_blackout_recovery[i][j] = bw_int_to_fixed(9999);</span></a>
<a name="1347"><span class="lineNum">    1347 </span>            :                                                 }</a>
<a name="1348"><span class="lineNum">    1348 </span><span class="lineNoCov">          0 :                                                 else if (bw_ltn(data-&gt;adjusted_data_buffer_size[k], bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), (bw_add(vbios-&gt;blackout_duration, bw_add(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[i][j])))))) {</span></a>
<a name="1349"><span class="lineNum">    1349 </span><span class="lineNoCov">          0 :                                                         data-&gt;dispclk_required_for_blackout_recovery[i][j] = bw_max2(data-&gt;dispclk_required_for_blackout_recovery[i][j], bw_div(bw_mul(bw_div(bw_div((bw_sub(bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), (bw_add(vbios-&gt;blackout_duration, vbios-&gt;maximum_blackout_recovery_time))), data-&gt;adjusted_data_buffer_size[k])), bw_int_to_fixed(data-&gt;bytes_per_pixel[k])), (bw_sub(vbios-&gt;maximum_blackout_recovery_time, (bw_add(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[i][j]))))), data-&gt;latency_hiding_lines[k]), data-&gt;lines_interleaved_in_mem_access[k]));</span></a>
<a name="1350"><span class="lineNum">    1350 </span>            :                                                 }</a>
<a name="1351"><span class="lineNum">    1351 </span>            :                                         }</a>
<a name="1352"><span class="lineNum">    1352 </span>            :                                 }</a>
<a name="1353"><span class="lineNum">    1353 </span>            :                         }</a>
<a name="1354"><span class="lineNum">    1354 </span>            :                 }</a>
<a name="1355"><span class="lineNum">    1355 </span>            :         }</a>
<a name="1356"><span class="lineNum">    1356 </span><span class="lineNoCov">          0 :         if (bw_mtn(data-&gt;blackout_duration_margin[high][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[high][s_high], vbios-&gt;high_voltage_max_dispclk)) {</span></a>
<a name="1357"><span class="lineNum">    1357 </span><span class="lineNoCov">          0 :                 data-&gt;cpup_state_change_enable = bw_def_yes;</span></a>
<a name="1358"><span class="lineNum">    1358 </span><span class="lineNoCov">          0 :                 if (bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[high][s_high], vbios-&gt;high_voltage_max_dispclk)) {</span></a>
<a name="1359"><span class="lineNum">    1359 </span><span class="lineNoCov">          0 :                         data-&gt;cpuc_state_change_enable = bw_def_yes;</span></a>
<a name="1360"><span class="lineNum">    1360 </span>            :                 }</a>
<a name="1361"><span class="lineNum">    1361 </span>            :                 else {</a>
<a name="1362"><span class="lineNum">    1362 </span><span class="lineNoCov">          0 :                         data-&gt;cpuc_state_change_enable = bw_def_no;</span></a>
<a name="1363"><span class="lineNum">    1363 </span>            :                 }</a>
<a name="1364"><span class="lineNum">    1364 </span>            :         }</a>
<a name="1365"><span class="lineNum">    1365 </span>            :         else {</a>
<a name="1366"><span class="lineNum">    1366 </span><span class="lineNoCov">          0 :                 data-&gt;cpup_state_change_enable = bw_def_no;</span></a>
<a name="1367"><span class="lineNum">    1367 </span><span class="lineNoCov">          0 :                 data-&gt;cpuc_state_change_enable = bw_def_no;</span></a>
<a name="1368"><span class="lineNum">    1368 </span>            :         }</a>
<a name="1369"><span class="lineNum">    1369 </span>            :         /*nb p-state change enable*/</a>
<a name="1370"><span class="lineNum">    1370 </span>            :         /*for dram speed/p-state change to be possible for a yclk(pclk) and sclk level there has to be positive margin and the dispclk required has to be*/</a>
<a name="1371"><span class="lineNum">    1371 </span>            :         /*below the maximum.*/</a>
<a name="1372"><span class="lineNum">    1372 </span>            :         /*the dram speed/p-state change margin is the minimum for all surfaces of the maximum latency hiding minus the dram speed/p-state change latency,*/</a>
<a name="1373"><span class="lineNum">    1373 </span>            :         /*minus the dmif burst time, minus the source line transfer time*/</a>
<a name="1374"><span class="lineNum">    1374 </span>            :         /*the maximum latency hiding is the minimum latency hiding plus one source line used for de-tiling in the line buffer, plus half the urgent latency*/</a>
<a name="1375"><span class="lineNum">    1375 </span>            :         /*if stutter and dram clock state change are gated before cursor then the cursor latency hiding does not limit stutter or dram clock state change*/</a>
<a name="1376"><span class="lineNum">    1376 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1377"><span class="lineNum">    1377 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1378"><span class="lineNum">    1378 </span>            :                         /*maximum_latency_hiding(i) = minimum_latency_hiding(i) + 1 / vsr(i) **/</a>
<a name="1379"><span class="lineNum">    1379 </span>            :                         /*      h_total(i) / pixel_rate(i) + 0.5 * total_dmifmc_urgent_latency*/</a>
<a name="1380"><span class="lineNum">    1380 </span><span class="lineNoCov">          0 :                         data-&gt;maximum_latency_hiding[i] = bw_add(data-&gt;minimum_latency_hiding[i],</span></a>
<a name="1381"><span class="lineNum">    1381 </span>            :                                 bw_mul(bw_frc_to_fixed(5, 10), data-&gt;total_dmifmc_urgent_latency));</a>
<a name="1382"><span class="lineNum">    1382 </span><span class="lineNoCov">          0 :                         data-&gt;maximum_latency_hiding_with_cursor[i] = bw_min2(data-&gt;maximum_latency_hiding[i], data-&gt;cursor_latency_hiding[i]);</span></a>
<a name="1383"><span class="lineNum">    1383 </span>            :                 }</a>
<a name="1384"><span class="lineNum">    1384 </span>            :         }</a>
<a name="1385"><span class="lineNum">    1385 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= 2; i++) {</span></a>
<a name="1386"><span class="lineNum">    1386 </span><span class="lineNoCov">          0 :                 for (j = 0; j &lt;= 7; j++) {</span></a>
<a name="1387"><span class="lineNum">    1387 </span><span class="lineNoCov">          0 :                         data-&gt;min_dram_speed_change_margin[i][j] = bw_int_to_fixed(9999);</span></a>
<a name="1388"><span class="lineNum">    1388 </span><span class="lineNoCov">          0 :                         data-&gt;dram_speed_change_margin = bw_int_to_fixed(9999);</span></a>
<a name="1389"><span class="lineNum">    1389 </span><span class="lineNoCov">          0 :                         data-&gt;dispclk_required_for_dram_speed_change[i][j] = bw_int_to_fixed(0);</span></a>
<a name="1390"><span class="lineNum">    1390 </span><span class="lineNoCov">          0 :                         data-&gt;num_displays_with_margin[i][j] = 0;</span></a>
<a name="1391"><span class="lineNum">    1391 </span><span class="lineNoCov">          0 :                         for (k = 0; k &lt;= maximum_number_of_surfaces - 1; k++) {</span></a>
<a name="1392"><span class="lineNum">    1392 </span><span class="lineNoCov">          0 :                                 if (data-&gt;enable[k]) {</span></a>
<a name="1393"><span class="lineNum">    1393 </span><span class="lineNoCov">          0 :                                         if (surface_type[k] != bw_def_display_write_back420_luma &amp;&amp; surface_type[k] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1394"><span class="lineNum">    1394 </span><span class="lineNoCov">          0 :                                                 data-&gt;dram_speed_change_margin = bw_sub(bw_sub(bw_sub(data-&gt;maximum_latency_hiding_with_cursor[k], vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[i][j]), data-&gt;dram_speed_change_line_source_transfer_time[k][i][j]);</span></a>
<a name="1395"><span class="lineNum">    1395 </span><span class="lineNoCov">          0 :                                                 if ((bw_mtn(data-&gt;dram_speed_change_margin, bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dram_speed_change_margin, bw_int_to_fixed(9999)))) {</span></a>
<a name="1396"><span class="lineNum">    1396 </span>            :                                                         /*determine the minimum dram clock change margin for each set of clock frequencies*/</a>
<a name="1397"><span class="lineNum">    1397 </span><span class="lineNoCov">          0 :                                                         data-&gt;min_dram_speed_change_margin[i][j] = bw_min2(data-&gt;min_dram_speed_change_margin[i][j], data-&gt;dram_speed_change_margin);</span></a>
<a name="1398"><span class="lineNum">    1398 </span>            :                                                         /*compute the maximum clock frequuency required for the dram clock change at each set of clock frequencies*/</a>
<a name="1399"><span class="lineNum">    1399 </span><span class="lineNoCov">          0 :                                                         data-&gt;dispclk_required_for_dram_speed_change_pipe[i][j] = bw_max2(bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_first_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_sub(bw_sub(bw_sub(data-&gt;maximum_latency_hiding_with_cursor[k], vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[i][j]), data-&gt;dram_speed_change_line_source_transfer_time[k][i][j]))), bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_last_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_add(bw_sub(bw_sub(bw_sub(data-&gt;maximum_latency_hiding_with_cursor[k], vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[i][j]), data-&gt;dram_speed_change_line_source_transfer_time[k][i][j]), data-&gt;active_time[k]))));</span></a>
<a name="1400"><span class="lineNum">    1400 </span><span class="lineNoCov">          0 :                                                         if ((bw_ltn(data-&gt;dispclk_required_for_dram_speed_change_pipe[i][j], vbios-&gt;high_voltage_max_dispclk))) {</span></a>
<a name="1401"><span class="lineNum">    1401 </span><span class="lineNoCov">          0 :                                                                 data-&gt;display_pstate_change_enable[k] = 1;</span></a>
<a name="1402"><span class="lineNum">    1402 </span><span class="lineNoCov">          0 :                                                                 data-&gt;num_displays_with_margin[i][j] = data-&gt;num_displays_with_margin[i][j] + 1;</span></a>
<a name="1403"><span class="lineNum">    1403 </span><span class="lineNoCov">          0 :                                                                 data-&gt;dispclk_required_for_dram_speed_change[i][j] = bw_max2(data-&gt;dispclk_required_for_dram_speed_change[i][j], data-&gt;dispclk_required_for_dram_speed_change_pipe[i][j]);</span></a>
<a name="1404"><span class="lineNum">    1404 </span>            :                                                         }</a>
<a name="1405"><span class="lineNum">    1405 </span>            :                                                 }</a>
<a name="1406"><span class="lineNum">    1406 </span>            :                                         }</a>
<a name="1407"><span class="lineNum">    1407 </span>            :                                         else {</a>
<a name="1408"><span class="lineNum">    1408 </span><span class="lineNoCov">          0 :                                                 data-&gt;dram_speed_change_margin = bw_sub(bw_sub(bw_sub(bw_sub(data-&gt;maximum_latency_hiding_with_cursor[k], vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[i][j]), data-&gt;mcifwr_burst_time[i][j]), data-&gt;dram_speed_change_line_source_transfer_time[k][i][j]);</span></a>
<a name="1409"><span class="lineNum">    1409 </span><span class="lineNoCov">          0 :                                                 if ((bw_mtn(data-&gt;dram_speed_change_margin, bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dram_speed_change_margin, bw_int_to_fixed(9999)))) {</span></a>
<a name="1410"><span class="lineNum">    1410 </span>            :                                                         /*determine the minimum dram clock change margin for each display pipe*/</a>
<a name="1411"><span class="lineNum">    1411 </span><span class="lineNoCov">          0 :                                                         data-&gt;min_dram_speed_change_margin[i][j] = bw_min2(data-&gt;min_dram_speed_change_margin[i][j], data-&gt;dram_speed_change_margin);</span></a>
<a name="1412"><span class="lineNum">    1412 </span>            :                                                         /*compute the maximum clock frequuency required for the dram clock change at each set of clock frequencies*/</a>
<a name="1413"><span class="lineNum">    1413 </span><span class="lineNoCov">          0 :                                                         data-&gt;dispclk_required_for_dram_speed_change_pipe[i][j] = bw_max2(bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_first_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_sub(bw_sub(bw_sub(bw_sub(data-&gt;maximum_latency_hiding_with_cursor[k], vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[i][j]), data-&gt;dram_speed_change_line_source_transfer_time[k][i][j]), data-&gt;mcifwr_burst_time[i][j]))), bw_div(bw_div(bw_mul(data-&gt;src_pixels_for_last_output_pixel[k], dceip-&gt;display_pipe_throughput_factor), dceip-&gt;lb_write_pixels_per_dispclk), (bw_add(bw_sub(bw_sub(bw_sub(bw_sub(data-&gt;maximum_latency_hiding_with_cursor[k], vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[i][j]), data-&gt;dram_speed_change_line_source_transfer_time[k][i][j]), data-&gt;mcifwr_burst_time[i][j]), data-&gt;active_time[k]))));</span></a>
<a name="1414"><span class="lineNum">    1414 </span><span class="lineNoCov">          0 :                                                         if ((bw_ltn(data-&gt;dispclk_required_for_dram_speed_change_pipe[i][j], vbios-&gt;high_voltage_max_dispclk))) {</span></a>
<a name="1415"><span class="lineNum">    1415 </span><span class="lineNoCov">          0 :                                                                 data-&gt;display_pstate_change_enable[k] = 1;</span></a>
<a name="1416"><span class="lineNum">    1416 </span><span class="lineNoCov">          0 :                                                                 data-&gt;num_displays_with_margin[i][j] = data-&gt;num_displays_with_margin[i][j] + 1;</span></a>
<a name="1417"><span class="lineNum">    1417 </span><span class="lineNoCov">          0 :                                                                 data-&gt;dispclk_required_for_dram_speed_change[i][j] = bw_max2(data-&gt;dispclk_required_for_dram_speed_change[i][j], data-&gt;dispclk_required_for_dram_speed_change_pipe[i][j]);</span></a>
<a name="1418"><span class="lineNum">    1418 </span>            :                                                         }</a>
<a name="1419"><span class="lineNum">    1419 </span>            :                                                 }</a>
<a name="1420"><span class="lineNum">    1420 </span>            :                                         }</a>
<a name="1421"><span class="lineNum">    1421 </span>            :                                 }</a>
<a name="1422"><span class="lineNum">    1422 </span>            :                         }</a>
<a name="1423"><span class="lineNum">    1423 </span>            :                 }</a>
<a name="1424"><span class="lineNum">    1424 </span>            :         }</a>
<a name="1425"><span class="lineNum">    1425 </span>            :         /*determine the number of displays with margin to switch in the v_active region*/</a>
<a name="1426"><span class="lineNum">    1426 </span><span class="lineNoCov">          0 :         for (k = 0; k &lt;= maximum_number_of_surfaces - 1; k++) {</span></a>
<a name="1427"><span class="lineNum">    1427 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[k] == 1 &amp;&amp; data-&gt;display_pstate_change_enable[k] == 1) {</span></a>
<a name="1428"><span class="lineNum">    1428 </span><span class="lineNoCov">          0 :                         number_of_displays_enabled_with_margin = number_of_displays_enabled_with_margin + 1;</span></a>
<a name="1429"><span class="lineNum">    1429 </span>            :                 }</a>
<a name="1430"><span class="lineNum">    1430 </span>            :         }</a>
<a name="1431"><span class="lineNum">    1431 </span>            :         /*determine the number of displays that don't have any dram clock change margin, but*/</a>
<a name="1432"><span class="lineNum">    1432 </span>            :         /*have the same resolution.  these displays can switch in a common vblank region if*/</a>
<a name="1433"><span class="lineNum">    1433 </span>            :         /*their frames are aligned.*/</a>
<a name="1434"><span class="lineNum">    1434 </span><span class="lineNoCov">          0 :         data-&gt;min_vblank_dram_speed_change_margin = bw_int_to_fixed(9999);</span></a>
<a name="1435"><span class="lineNum">    1435 </span><span class="lineNoCov">          0 :         for (k = 0; k &lt;= maximum_number_of_surfaces - 1; k++) {</span></a>
<a name="1436"><span class="lineNum">    1436 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[k]) {</span></a>
<a name="1437"><span class="lineNum">    1437 </span><span class="lineNoCov">          0 :                         if (surface_type[k] != bw_def_display_write_back420_luma &amp;&amp; surface_type[k] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1438"><span class="lineNum">    1438 </span><span class="lineNoCov">          0 :                                 data-&gt;v_blank_dram_speed_change_margin[k] = bw_sub(bw_sub(bw_sub(bw_div(bw_mul((bw_sub(data-&gt;v_total[k], bw_sub(bw_div(data-&gt;src_height[k], data-&gt;v_scale_ratio[k]), bw_int_to_fixed(4)))), data-&gt;h_total[k]), data-&gt;pixel_rate[k]), vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[low][s_low]), data-&gt;dram_speed_change_line_source_transfer_time[k][low][s_low]);</span></a>
<a name="1439"><span class="lineNum">    1439 </span><span class="lineNoCov">          0 :                                 data-&gt;min_vblank_dram_speed_change_margin = bw_min2(data-&gt;min_vblank_dram_speed_change_margin, data-&gt;v_blank_dram_speed_change_margin[k]);</span></a>
<a name="1440"><span class="lineNum">    1440 </span>            :                         }</a>
<a name="1441"><span class="lineNum">    1441 </span>            :                         else {</a>
<a name="1442"><span class="lineNum">    1442 </span><span class="lineNoCov">          0 :                                 data-&gt;v_blank_dram_speed_change_margin[k] = bw_sub(bw_sub(bw_sub(bw_sub(bw_div(bw_mul((bw_sub(data-&gt;v_total[k], bw_sub(bw_div(data-&gt;src_height[k], data-&gt;v_scale_ratio[k]), bw_int_to_fixed(4)))), data-&gt;h_total[k]), data-&gt;pixel_rate[k]), vbios-&gt;nbp_state_change_latency), data-&gt;dmif_burst_time[low][s_low]), data-&gt;mcifwr_burst_time[low][s_low]), data-&gt;dram_speed_change_line_source_transfer_time[k][low][s_low]);</span></a>
<a name="1443"><span class="lineNum">    1443 </span><span class="lineNoCov">          0 :                                 data-&gt;min_vblank_dram_speed_change_margin = bw_min2(data-&gt;min_vblank_dram_speed_change_margin, data-&gt;v_blank_dram_speed_change_margin[k]);</span></a>
<a name="1444"><span class="lineNum">    1444 </span>            :                         }</a>
<a name="1445"><span class="lineNum">    1445 </span>            :                 }</a>
<a name="1446"><span class="lineNum">    1446 </span>            :         }</a>
<a name="1447"><span class="lineNum">    1447 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1448"><span class="lineNum">    1448 </span><span class="lineNoCov">          0 :                 data-&gt;displays_with_same_mode[i] = bw_int_to_fixed(0);</span></a>
<a name="1449"><span class="lineNum">    1449 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i] == 1 &amp;&amp; data-&gt;display_pstate_change_enable[i] == 0 &amp;&amp; bw_mtn(data-&gt;v_blank_dram_speed_change_margin[i], bw_int_to_fixed(0))) {</span></a>
<a name="1450"><span class="lineNum">    1450 </span><span class="lineNoCov">          0 :                         for (j = 0; j &lt;= maximum_number_of_surfaces - 1; j++) {</span></a>
<a name="1451"><span class="lineNum">    1451 </span><span class="lineNoCov">          0 :                                 if ((i == j || data-&gt;display_synchronization_enabled) &amp;&amp; (data-&gt;enable[j] == 1 &amp;&amp; bw_equ(data-&gt;source_width_rounded_up_to_chunks[i], data-&gt;source_width_rounded_up_to_chunks[j]) &amp;&amp; bw_equ(data-&gt;source_height_rounded_up_to_chunks[i], data-&gt;source_height_rounded_up_to_chunks[j]) &amp;&amp; bw_equ(data-&gt;vsr[i], data-&gt;vsr[j]) &amp;&amp; bw_equ(data-&gt;hsr[i], data-&gt;hsr[j]) &amp;&amp; bw_equ(data-&gt;pixel_rate[i], data-&gt;pixel_rate[j]))) {</span></a>
<a name="1452"><span class="lineNum">    1452 </span><span class="lineNoCov">          0 :                                         data-&gt;displays_with_same_mode[i] = bw_add(data-&gt;displays_with_same_mode[i], bw_int_to_fixed(1));</span></a>
<a name="1453"><span class="lineNum">    1453 </span>            :                                 }</a>
<a name="1454"><span class="lineNum">    1454 </span>            :                         }</a>
<a name="1455"><span class="lineNum">    1455 </span>            :                 }</a>
<a name="1456"><span class="lineNum">    1456 </span>            :         }</a>
<a name="1457"><span class="lineNum">    1457 </span>            :         /*compute the maximum number of aligned displays with no margin*/</a>
<a name="1458"><span class="lineNum">    1458 </span>            :         number_of_aligned_displays_with_no_margin = 0;</a>
<a name="1459"><span class="lineNum">    1459 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1460"><span class="lineNum">    1460 </span><span class="lineNoCov">          0 :                 number_of_aligned_displays_with_no_margin = bw_fixed_to_int(bw_max2(bw_int_to_fixed(number_of_aligned_displays_with_no_margin), data-&gt;displays_with_same_mode[i]));</span></a>
<a name="1461"><span class="lineNum">    1461 </span>            :         }</a>
<a name="1462"><span class="lineNum">    1462 </span>            :         /*dram clock change is possible, if all displays have positive margin except for one display or a group of*/</a>
<a name="1463"><span class="lineNum">    1463 </span>            :         /*aligned displays with the same timing.*/</a>
<a name="1464"><span class="lineNum">    1464 </span>            :         /*the display(s) with the negative margin can be switched in the v_blank region while the other*/</a>
<a name="1465"><span class="lineNum">    1465 </span>            :         /*displays are in v_blank or v_active.*/</a>
<a name="1466"><span class="lineNum">    1466 </span><span class="lineNoCov">          0 :         if (number_of_displays_enabled_with_margin &gt; 0 &amp;&amp; (number_of_displays_enabled_with_margin + number_of_aligned_displays_with_no_margin) == number_of_displays_enabled &amp;&amp; bw_mtn(data-&gt;min_dram_speed_change_margin[high][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[high][s_high], bw_int_to_fixed(9999)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_dram_speed_change[high][s_high], vbios-&gt;high_voltage_max_dispclk)) {</span></a>
<a name="1467"><span class="lineNum">    1467 </span><span class="lineNoCov">          0 :                 data-&gt;nbp_state_change_enable = bw_def_yes;</span></a>
<a name="1468"><span class="lineNum">    1468 </span>            :         }</a>
<a name="1469"><span class="lineNum">    1469 </span>            :         else {</a>
<a name="1470"><span class="lineNum">    1470 </span><span class="lineNoCov">          0 :                 data-&gt;nbp_state_change_enable = bw_def_no;</span></a>
<a name="1471"><span class="lineNum">    1471 </span>            :         }</a>
<a name="1472"><span class="lineNum">    1472 </span>            :         /*dram clock change is possible only in vblank if all displays are aligned and have no margin*/</a>
<a name="1473"><span class="lineNum">    1473 </span><span class="lineNoCov">          0 :         if (number_of_aligned_displays_with_no_margin == number_of_displays_enabled) {</span></a>
<a name="1474"><span class="lineNum">    1474 </span>            :                 nbp_state_change_enable_blank = bw_def_yes;</a>
<a name="1475"><span class="lineNum">    1475 </span>            :         }</a>
<a name="1476"><span class="lineNum">    1476 </span>            :         else {</a>
<a name="1477"><span class="lineNum">    1477 </span><span class="lineNoCov">          0 :                 nbp_state_change_enable_blank = bw_def_no;</span></a>
<a name="1478"><span class="lineNum">    1478 </span>            :         }</a>
<a name="1479"><span class="lineNum">    1479 </span>            : </a>
<a name="1480"><span class="lineNum">    1480 </span>            :         /*average bandwidth*/</a>
<a name="1481"><span class="lineNum">    1481 </span>            :         /*the average bandwidth with no compression is the vertical active time is the source width times the bytes per pixel divided by the line time, multiplied by the vertical scale ratio and the ratio of bytes per request divided by the useful bytes per request.*/</a>
<a name="1482"><span class="lineNum">    1482 </span>            :         /*the average bandwidth with compression is the same, divided by the compression ratio*/</a>
<a name="1483"><span class="lineNum">    1483 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1484"><span class="lineNum">    1484 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1485"><span class="lineNum">    1485 </span><span class="lineNoCov">          0 :                         data-&gt;average_bandwidth_no_compression[i] = bw_div(bw_mul(bw_mul(bw_div(bw_mul(data-&gt;source_width_rounded_up_to_chunks[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), (bw_div(data-&gt;h_total[i], data-&gt;pixel_rate[i]))), data-&gt;vsr[i]), data-&gt;bytes_per_request[i]), data-&gt;useful_bytes_per_request[i]);</span></a>
<a name="1486"><span class="lineNum">    1486 </span><span class="lineNoCov">          0 :                         data-&gt;average_bandwidth[i] = bw_div(data-&gt;average_bandwidth_no_compression[i], data-&gt;compression_rate[i]);</span></a>
<a name="1487"><span class="lineNum">    1487 </span>            :                 }</a>
<a name="1488"><span class="lineNum">    1488 </span>            :         }</a>
<a name="1489"><span class="lineNum">    1489 </span><span class="lineNoCov">          0 :         data-&gt;total_average_bandwidth_no_compression = bw_int_to_fixed(0);</span></a>
<a name="1490"><span class="lineNum">    1490 </span><span class="lineNoCov">          0 :         data-&gt;total_average_bandwidth = bw_int_to_fixed(0);</span></a>
<a name="1491"><span class="lineNum">    1491 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1492"><span class="lineNum">    1492 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1493"><span class="lineNum">    1493 </span><span class="lineNoCov">          0 :                         data-&gt;total_average_bandwidth_no_compression = bw_add(data-&gt;total_average_bandwidth_no_compression, data-&gt;average_bandwidth_no_compression[i]);</span></a>
<a name="1494"><span class="lineNum">    1494 </span><span class="lineNoCov">          0 :                         data-&gt;total_average_bandwidth = bw_add(data-&gt;total_average_bandwidth, data-&gt;average_bandwidth[i]);</span></a>
<a name="1495"><span class="lineNum">    1495 </span>            :                 }</a>
<a name="1496"><span class="lineNum">    1496 </span>            :         }</a>
<a name="1497"><span class="lineNum">    1497 </span>            : </a>
<a name="1498"><span class="lineNum">    1498 </span>            :         /*required yclk(pclk)*/</a>
<a name="1499"><span class="lineNum">    1499 </span>            :         /*yclk requirement only makes sense if the dmif and mcifwr data total page close-open time is less than the time for data transfer and the total pte requests fit in the scatter-gather saw queque size*/</a>
<a name="1500"><span class="lineNum">    1500 </span>            :         /*if that is the case, the yclk requirement is the maximum of the ones required by dmif and mcifwr, and the high/low yclk(pclk) is chosen accordingly*/</a>
<a name="1501"><span class="lineNum">    1501 </span>            :         /*high yclk(pclk) has to be selected when dram speed/p-state change is not possible.*/</a>
<a name="1502"><span class="lineNum">    1502 </span><span class="lineNoCov">          0 :         data-&gt;min_cursor_memory_interface_buffer_size_in_time = bw_int_to_fixed(9999);</span></a>
<a name="1503"><span class="lineNum">    1503 </span>            :         /* number of cursor lines stored in the cursor data return buffer*/</a>
<a name="1504"><span class="lineNum">    1504 </span><span class="lineNoCov">          0 :         num_cursor_lines = 0;</span></a>
<a name="1505"><span class="lineNum">    1505 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1506"><span class="lineNum">    1506 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1507"><span class="lineNum">    1507 </span><span class="lineNoCov">          0 :                         if (bw_mtn(data-&gt;cursor_width_pixels[i], bw_int_to_fixed(0))) {</span></a>
<a name="1508"><span class="lineNum">    1508 </span>            :                                 /*compute number of cursor lines stored in data return buffer*/</a>
<a name="1509"><span class="lineNum">    1509 </span><span class="lineNoCov">          0 :                                 if (bw_leq(data-&gt;cursor_width_pixels[i], bw_int_to_fixed(64)) &amp;&amp; dceip-&gt;large_cursor == 1) {</span></a>
<a name="1510"><span class="lineNum">    1510 </span>            :                                         num_cursor_lines = 4;</a>
<a name="1511"><span class="lineNum">    1511 </span>            :                                 }</a>
<a name="1512"><span class="lineNum">    1512 </span>            :                                 else {</a>
<a name="1513"><span class="lineNum">    1513 </span><span class="lineNoCov">          0 :                                         num_cursor_lines = 2;</span></a>
<a name="1514"><span class="lineNum">    1514 </span>            :                                 }</a>
<a name="1515"><span class="lineNum">    1515 </span><span class="lineNoCov">          0 :                                 data-&gt;min_cursor_memory_interface_buffer_size_in_time = bw_min2(data-&gt;min_cursor_memory_interface_buffer_size_in_time, bw_div(bw_mul(bw_div(bw_int_to_fixed(num_cursor_lines), data-&gt;vsr[i]), data-&gt;h_total[i]), data-&gt;pixel_rate[i]));</span></a>
<a name="1516"><span class="lineNum">    1516 </span>            :                         }</a>
<a name="1517"><span class="lineNum">    1517 </span>            :                 }</a>
<a name="1518"><span class="lineNum">    1518 </span>            :         }</a>
<a name="1519"><span class="lineNum">    1519 </span>            :         /*compute minimum time to read one chunk from the dmif buffer*/</a>
<a name="1520"><span class="lineNum">    1520 </span><span class="lineNoCov">          0 :         if (number_of_displays_enabled &gt; 2) {</span></a>
<a name="1521"><span class="lineNum">    1521 </span><span class="lineNoCov">          0 :                 data-&gt;chunk_request_delay = 0;</span></a>
<a name="1522"><span class="lineNum">    1522 </span>            :         }</a>
<a name="1523"><span class="lineNum">    1523 </span>            :         else {</a>
<a name="1524"><span class="lineNum">    1524 </span><span class="lineNoCov">          0 :                 data-&gt;chunk_request_delay = bw_fixed_to_int(bw_div(bw_int_to_fixed(512), vbios-&gt;high_voltage_max_dispclk));</span></a>
<a name="1525"><span class="lineNum">    1525 </span>            :         }</a>
<a name="1526"><span class="lineNum">    1526 </span><span class="lineNoCov">          0 :         data-&gt;min_read_buffer_size_in_time = bw_min2(data-&gt;min_cursor_memory_interface_buffer_size_in_time, data-&gt;min_dmif_size_in_time);</span></a>
<a name="1527"><span class="lineNum">    1527 </span><span class="lineNoCov">          0 :         data-&gt;display_reads_time_for_data_transfer = bw_sub(bw_sub(data-&gt;min_read_buffer_size_in_time, data-&gt;total_dmifmc_urgent_latency), bw_int_to_fixed(data-&gt;chunk_request_delay));</span></a>
<a name="1528"><span class="lineNum">    1528 </span><span class="lineNoCov">          0 :         data-&gt;display_writes_time_for_data_transfer = bw_sub(data-&gt;min_mcifwr_size_in_time, vbios-&gt;mcifwrmc_urgent_latency);</span></a>
<a name="1529"><span class="lineNum">    1529 </span><span class="lineNoCov">          0 :         data-&gt;dmif_required_dram_bandwidth = bw_div(data-&gt;total_display_reads_required_dram_access_data, data-&gt;display_reads_time_for_data_transfer);</span></a>
<a name="1530"><span class="lineNum">    1530 </span><span class="lineNoCov">          0 :         data-&gt;mcifwr_required_dram_bandwidth = bw_div(data-&gt;total_display_writes_required_dram_access_data, data-&gt;display_writes_time_for_data_transfer);</span></a>
<a name="1531"><span class="lineNum">    1531 </span><span class="lineNoCov">          0 :         data-&gt;required_dmifmc_urgent_latency_for_page_close_open = bw_div((bw_sub(data-&gt;min_read_buffer_size_in_time, data-&gt;dmif_total_page_close_open_time)), data-&gt;total_dmifmc_urgent_trips);</span></a>
<a name="1532"><span class="lineNum">    1532 </span><span class="lineNoCov">          0 :         data-&gt;required_mcifmcwr_urgent_latency = bw_sub(data-&gt;min_mcifwr_size_in_time, data-&gt;mcifwr_total_page_close_open_time);</span></a>
<a name="1533"><span class="lineNum">    1533 </span><span class="lineNoCov">          0 :         if (bw_mtn(data-&gt;scatter_gather_total_pte_requests, dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw)) {</span></a>
<a name="1534"><span class="lineNum">    1534 </span><span class="lineNoCov">          0 :                 data-&gt;required_dram_bandwidth_gbyte_per_second = bw_int_to_fixed(9999);</span></a>
<a name="1535"><span class="lineNum">    1535 </span><span class="lineNoCov">          0 :                 yclk_message = bw_def_exceeded_allowed_outstanding_pte_req_queue_size;</span></a>
<a name="1536"><span class="lineNum">    1536 </span><span class="lineNoCov">          0 :                 data-&gt;y_clk_level = high;</span></a>
<a name="1537"><span class="lineNum">    1537 </span><span class="lineNoCov">          0 :                 data-&gt;dram_bandwidth = bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[high]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels));</span></a>
<a name="1538"><span class="lineNum">    1538 </span>            :         }</a>
<a name="1539"><span class="lineNum">    1539 </span><span class="lineNoCov">          0 :         else if (bw_mtn(vbios-&gt;dmifmc_urgent_latency, data-&gt;required_dmifmc_urgent_latency_for_page_close_open) || bw_mtn(vbios-&gt;mcifwrmc_urgent_latency, data-&gt;required_mcifmcwr_urgent_latency)) {</span></a>
<a name="1540"><span class="lineNum">    1540 </span><span class="lineNoCov">          0 :                 data-&gt;required_dram_bandwidth_gbyte_per_second = bw_int_to_fixed(9999);</span></a>
<a name="1541"><span class="lineNum">    1541 </span><span class="lineNoCov">          0 :                 yclk_message = bw_def_exceeded_allowed_page_close_open;</span></a>
<a name="1542"><span class="lineNum">    1542 </span><span class="lineNoCov">          0 :                 data-&gt;y_clk_level = high;</span></a>
<a name="1543"><span class="lineNum">    1543 </span><span class="lineNoCov">          0 :                 data-&gt;dram_bandwidth = bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[high]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels));</span></a>
<a name="1544"><span class="lineNum">    1544 </span>            :         }</a>
<a name="1545"><span class="lineNum">    1545 </span>            :         else {</a>
<a name="1546"><span class="lineNum">    1546 </span><span class="lineNoCov">          0 :                 data-&gt;required_dram_bandwidth_gbyte_per_second = bw_div(bw_max2(data-&gt;dmif_required_dram_bandwidth, data-&gt;mcifwr_required_dram_bandwidth), bw_int_to_fixed(1000));</span></a>
<a name="1547"><span class="lineNum">    1547 </span><span class="lineNoCov">          0 :                 if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation, 100),yclk[low]),bw_div(bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits),bw_int_to_fixed(8))),bw_int_to_fixed(vbios-&gt;number_of_dram_channels)))</span></a>
<a name="1548"><span class="lineNum">    1548 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(bw_mul(data-&gt;required_dram_bandwidth_gbyte_per_second, bw_int_to_fixed(1000)), bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[low]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels))) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[low][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[low][s_high], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[low][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[low][s_high], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[low][s_high], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[low][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[low][s_high], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[low][s_high], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[low][s_high] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1549"><span class="lineNum">    1549 </span><span class="lineNoCov">          0 :                         yclk_message = bw_fixed_to_int(vbios-&gt;low_yclk);</span></a>
<a name="1550"><span class="lineNum">    1550 </span><span class="lineNoCov">          0 :                         data-&gt;y_clk_level = low;</span></a>
<a name="1551"><span class="lineNum">    1551 </span><span class="lineNoCov">          0 :                         data-&gt;dram_bandwidth = bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[low]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels));</span></a>
<a name="1552"><span class="lineNum">    1552 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1553"><span class="lineNum">    1553 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation, 100),yclk[mid]),bw_div(bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits),bw_int_to_fixed(8))),bw_int_to_fixed(vbios-&gt;number_of_dram_channels)))</span></a>
<a name="1554"><span class="lineNum">    1554 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(bw_mul(data-&gt;required_dram_bandwidth_gbyte_per_second, bw_int_to_fixed(1000)), bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[mid]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels))) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[mid][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[mid][s_high], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[mid][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[mid][s_high], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[mid][s_high], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[mid][s_high], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[mid][s_high], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[mid][s_high], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[mid][s_high] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1555"><span class="lineNum">    1555 </span><span class="lineNoCov">          0 :                         yclk_message = bw_fixed_to_int(vbios-&gt;mid_yclk);</span></a>
<a name="1556"><span class="lineNum">    1556 </span><span class="lineNoCov">          0 :                         data-&gt;y_clk_level = mid;</span></a>
<a name="1557"><span class="lineNum">    1557 </span><span class="lineNoCov">          0 :                         data-&gt;dram_bandwidth = bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[mid]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels));</span></a>
<a name="1558"><span class="lineNum">    1558 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1559"><span class="lineNum">    1559 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation, 100),yclk[high]),bw_div(bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits),bw_int_to_fixed(8))),bw_int_to_fixed(vbios-&gt;number_of_dram_channels)))</span></a>
<a name="1560"><span class="lineNum">    1560 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(bw_mul(data-&gt;required_dram_bandwidth_gbyte_per_second, bw_int_to_fixed(1000)), bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[high]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels)))) {</span></a>
<a name="1561"><span class="lineNum">    1561 </span><span class="lineNoCov">          0 :                         yclk_message = bw_fixed_to_int(vbios-&gt;high_yclk);</span></a>
<a name="1562"><span class="lineNum">    1562 </span><span class="lineNoCov">          0 :                         data-&gt;y_clk_level = high;</span></a>
<a name="1563"><span class="lineNum">    1563 </span><span class="lineNoCov">          0 :                         data-&gt;dram_bandwidth = bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[high]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels));</span></a>
<a name="1564"><span class="lineNum">    1564 </span>            :                 }</a>
<a name="1565"><span class="lineNum">    1565 </span>            :                 else {</a>
<a name="1566"><span class="lineNum">    1566 </span><span class="lineNoCov">          0 :                         yclk_message = bw_def_exceeded_allowed_maximum_bw;</span></a>
<a name="1567"><span class="lineNum">    1567 </span><span class="lineNoCov">          0 :                         data-&gt;y_clk_level = high;</span></a>
<a name="1568"><span class="lineNum">    1568 </span><span class="lineNoCov">          0 :                         data-&gt;dram_bandwidth = bw_mul(bw_div(bw_mul(bw_mul(data-&gt;dram_efficiency, yclk[high]), bw_int_to_fixed(vbios-&gt;dram_channel_width_in_bits)), bw_int_to_fixed(8)), bw_int_to_fixed(data-&gt;number_of_dram_channels));</span></a>
<a name="1569"><span class="lineNum">    1569 </span>            :                 }</a>
<a name="1570"><span class="lineNum">    1570 </span>            :         }</a>
<a name="1571"><span class="lineNum">    1571 </span>            :         /*required sclk*/</a>
<a name="1572"><span class="lineNum">    1572 </span>            :         /*sclk requirement only makes sense if the total pte requests fit in the scatter-gather saw queque size*/</a>
<a name="1573"><span class="lineNum">    1573 </span>            :         /*if that is the case, the sclk requirement is the maximum of the ones required by dmif and mcifwr, and the high/mid/low sclk is chosen accordingly, unless that choice results in foresaking dram speed/nb p-state change.*/</a>
<a name="1574"><span class="lineNum">    1574 </span>            :         /*the dmif and mcifwr sclk required is the one that allows the transfer of all pipe's data buffer size through the sclk bus in the time for data transfer*/</a>
<a name="1575"><span class="lineNum">    1575 </span>            :         /*for dmif, pte and cursor requests have to be included.*/</a>
<a name="1576"><span class="lineNum">    1576 </span><span class="lineNoCov">          0 :         data-&gt;dmif_required_sclk = bw_div(bw_div(data-&gt;total_display_reads_required_data, data-&gt;display_reads_time_for_data_transfer), (bw_mul(vbios-&gt;data_return_bus_width, bw_frc_to_fixed(dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency, 100))));</span></a>
<a name="1577"><span class="lineNum">    1577 </span><span class="lineNoCov">          0 :         data-&gt;mcifwr_required_sclk = bw_div(bw_div(data-&gt;total_display_writes_required_data, data-&gt;display_writes_time_for_data_transfer), vbios-&gt;data_return_bus_width);</span></a>
<a name="1578"><span class="lineNum">    1578 </span><span class="lineNoCov">          0 :         if (bw_mtn(data-&gt;scatter_gather_total_pte_requests, dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw)) {</span></a>
<a name="1579"><span class="lineNum">    1579 </span><span class="lineNoCov">          0 :                 data-&gt;required_sclk = bw_int_to_fixed(9999);</span></a>
<a name="1580"><span class="lineNum">    1580 </span><span class="lineNoCov">          0 :                 sclk_message = bw_def_exceeded_allowed_outstanding_pte_req_queue_size;</span></a>
<a name="1581"><span class="lineNum">    1581 </span><span class="lineNoCov">          0 :                 data-&gt;sclk_level = s_high;</span></a>
<a name="1582"><span class="lineNum">    1582 </span>            :         }</a>
<a name="1583"><span class="lineNum">    1583 </span><span class="lineNoCov">          0 :         else if (bw_mtn(vbios-&gt;dmifmc_urgent_latency, data-&gt;required_dmifmc_urgent_latency_for_page_close_open) || bw_mtn(vbios-&gt;mcifwrmc_urgent_latency, data-&gt;required_mcifmcwr_urgent_latency)) {</span></a>
<a name="1584"><span class="lineNum">    1584 </span><span class="lineNoCov">          0 :                 data-&gt;required_sclk = bw_int_to_fixed(9999);</span></a>
<a name="1585"><span class="lineNum">    1585 </span><span class="lineNoCov">          0 :                 sclk_message = bw_def_exceeded_allowed_page_close_open;</span></a>
<a name="1586"><span class="lineNum">    1586 </span><span class="lineNoCov">          0 :                 data-&gt;sclk_level = s_high;</span></a>
<a name="1587"><span class="lineNum">    1587 </span>            :         }</a>
<a name="1588"><span class="lineNum">    1588 </span>            :         else {</a>
<a name="1589"><span class="lineNum">    1589 </span><span class="lineNoCov">          0 :                 data-&gt;required_sclk = bw_max2(data-&gt;dmif_required_sclk, data-&gt;mcifwr_required_sclk);</span></a>
<a name="1590"><span class="lineNum">    1590 </span><span class="lineNoCov">          0 :                 if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[low]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1591"><span class="lineNum">    1591 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_low]) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_low], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_low], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_low], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_low], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][s_low], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_low], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_low], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][s_low], vbios-&gt;low_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[data-&gt;y_clk_level][s_low] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1592"><span class="lineNum">    1592 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_low;</span></a>
<a name="1593"><span class="lineNum">    1593 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_low;</span></a>
<a name="1594"><span class="lineNum">    1594 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;low_sclk;</span></a>
<a name="1595"><span class="lineNum">    1595 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1596"><span class="lineNum">    1596 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[mid]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1597"><span class="lineNum">    1597 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_mid1]) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid1], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid1], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid1], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid1], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][s_mid1], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid1], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid1], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][s_mid1], vbios-&gt;mid_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[data-&gt;y_clk_level][s_mid1] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1598"><span class="lineNum">    1598 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_mid;</span></a>
<a name="1599"><span class="lineNum">    1599 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_mid1;</span></a>
<a name="1600"><span class="lineNum">    1600 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;mid1_sclk;</span></a>
<a name="1601"><span class="lineNum">    1601 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1602"><span class="lineNum">    1602 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[s_mid2]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1603"><span class="lineNum">    1603 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_mid2]) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid2], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid2], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid2], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid2], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][s_mid2], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid2], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid2], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][s_mid2], vbios-&gt;mid_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[data-&gt;y_clk_level][s_mid2] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1604"><span class="lineNum">    1604 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_mid;</span></a>
<a name="1605"><span class="lineNum">    1605 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_mid2;</span></a>
<a name="1606"><span class="lineNum">    1606 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;mid2_sclk;</span></a>
<a name="1607"><span class="lineNum">    1607 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1608"><span class="lineNum">    1608 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[s_mid3]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1609"><span class="lineNum">    1609 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_mid3]) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid3], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid3], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid3], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid3], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][s_mid3], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid3], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid3], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][s_mid3], vbios-&gt;mid_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[data-&gt;y_clk_level][s_mid3] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1610"><span class="lineNum">    1610 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_mid;</span></a>
<a name="1611"><span class="lineNum">    1611 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_mid3;</span></a>
<a name="1612"><span class="lineNum">    1612 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;mid3_sclk;</span></a>
<a name="1613"><span class="lineNum">    1613 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1614"><span class="lineNum">    1614 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[s_mid4]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1615"><span class="lineNum">    1615 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_mid4]) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid4], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid4], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid4], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid4], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][s_mid4], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid4], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid4], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][s_mid4], vbios-&gt;mid_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[data-&gt;y_clk_level][s_mid4] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1616"><span class="lineNum">    1616 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_mid;</span></a>
<a name="1617"><span class="lineNum">    1617 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_mid4;</span></a>
<a name="1618"><span class="lineNum">    1618 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;mid4_sclk;</span></a>
<a name="1619"><span class="lineNum">    1619 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1620"><span class="lineNum">    1620 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[s_mid5]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1621"><span class="lineNum">    1621 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_mid5]) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid5], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid5], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid5], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid5], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][s_mid5], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid5], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid5], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][s_mid5], vbios-&gt;mid_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[data-&gt;y_clk_level][s_mid5] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1622"><span class="lineNum">    1622 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_mid;</span></a>
<a name="1623"><span class="lineNum">    1623 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_mid5;</span></a>
<a name="1624"><span class="lineNum">    1624 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;mid5_sclk;</span></a>
<a name="1625"><span class="lineNum">    1625 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1626"><span class="lineNum">    1626 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[s_mid6]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1627"><span class="lineNum">    1627 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_mid6]) &amp;&amp; (data-&gt;cpup_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid6], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid6], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (data-&gt;cpuc_state_change_enable == bw_def_no || (bw_mtn(data-&gt;blackout_duration_margin[data-&gt;y_clk_level][s_mid6], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][s_mid6], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; bw_ltn(data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][s_mid6], vbios-&gt;high_voltage_max_dispclk))) &amp;&amp; (!data-&gt;increase_voltage_to_support_mclk_switch || data-&gt;nbp_state_change_enable == bw_def_no || (bw_mtn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid6], bw_int_to_fixed(0)) &amp;&amp; bw_ltn(data-&gt;min_dram_speed_change_margin[data-&gt;y_clk_level][s_mid6], bw_int_to_fixed(9999)) &amp;&amp; bw_leq(data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][s_mid6], vbios-&gt;high_voltage_max_dispclk) &amp;&amp; data-&gt;num_displays_with_margin[data-&gt;y_clk_level][s_mid6] == number_of_displays_enabled_with_margin))) {</span></a>
<a name="1628"><span class="lineNum">    1628 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_mid;</span></a>
<a name="1629"><span class="lineNum">    1629 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_mid6;</span></a>
<a name="1630"><span class="lineNum">    1630 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;mid6_sclk;</span></a>
<a name="1631"><span class="lineNum">    1631 </span><span class="lineNoCov">          0 :                 }</span></a>
<a name="1632"><span class="lineNum">    1632 </span><span class="lineNoCov">          0 :                 else if (bw_ltn(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[s_high]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1633"><span class="lineNum">    1633 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_high])) {</span></a>
<a name="1634"><span class="lineNum">    1634 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_high;</span></a>
<a name="1635"><span class="lineNum">    1635 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_high;</span></a>
<a name="1636"><span class="lineNum">    1636 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;high_sclk;</span></a>
<a name="1637"><span class="lineNum">    1637 </span>            :                 }</a>
<a name="1638"><span class="lineNum">    1638 </span><span class="lineNoCov">          0 :                 else if (bw_meq(data-&gt;total_average_bandwidth_no_compression, bw_mul(bw_mul(bw_frc_to_fixed(dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation, 100),sclk[s_high]),vbios-&gt;data_return_bus_width))</span></a>
<a name="1639"><span class="lineNum">    1639 </span><span class="lineNoCov">          0 :                                 &amp;&amp; bw_ltn(data-&gt;required_sclk, sclk[s_high])) {</span></a>
<a name="1640"><span class="lineNum">    1640 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_high;</span></a>
<a name="1641"><span class="lineNum">    1641 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_high;</span></a>
<a name="1642"><span class="lineNum">    1642 </span><span class="lineNoCov">          0 :                         data-&gt;required_sclk = vbios-&gt;high_sclk;</span></a>
<a name="1643"><span class="lineNum">    1643 </span>            :                 }</a>
<a name="1644"><span class="lineNum">    1644 </span>            :                 else {</a>
<a name="1645"><span class="lineNum">    1645 </span><span class="lineNoCov">          0 :                         sclk_message = bw_def_exceeded_allowed_maximum_sclk;</span></a>
<a name="1646"><span class="lineNum">    1646 </span><span class="lineNoCov">          0 :                         data-&gt;sclk_level = s_high;</span></a>
<a name="1647"><span class="lineNum">    1647 </span>            :                         /*required_sclk = high_sclk*/</a>
<a name="1648"><span class="lineNum">    1648 </span>            :                 }</a>
<a name="1649"><span class="lineNum">    1649 </span>            :         }</a>
<a name="1650"><span class="lineNum">    1650 </span>            :         /*dispclk*/</a>
<a name="1651"><span class="lineNum">    1651 </span>            :         /*if dispclk is set to the maximum, ramping is not required.  dispclk required without ramping is less than the dispclk required with ramping.*/</a>
<a name="1652"><span class="lineNum">    1652 </span>            :         /*if dispclk required without ramping is more than the maximum dispclk, that is the dispclk required, and the mode is not supported*/</a>
<a name="1653"><span class="lineNum">    1653 </span>            :         /*if that does not happen, but dispclk required with ramping is more than the maximum dispclk, dispclk required is just the maximum dispclk*/</a>
<a name="1654"><span class="lineNum">    1654 </span>            :         /*if that does not happen either, dispclk required is the dispclk required with ramping.*/</a>
<a name="1655"><span class="lineNum">    1655 </span>            :         /*dispclk required without ramping is the maximum of the one required for display pipe pixel throughput, for scaler throughput, for total read request thrrougput and for dram/np p-state change if enabled.*/</a>
<a name="1656"><span class="lineNum">    1656 </span>            :         /*the display pipe pixel throughput is the maximum of lines in per line out in the beginning of the frame and lines in per line out in the middle of the frame multiplied by the horizontal blank and chunk granularity factor, altogether multiplied by the ratio of the source width to the line time, divided by the line buffer pixels per dispclk throughput, and multiplied by the display pipe throughput factor.*/</a>
<a name="1657"><span class="lineNum">    1657 </span>            :         /*the horizontal blank and chunk granularity factor is the ratio of the line time divided by the line time minus half the horizontal blank and chunk time.  it applies when the lines in per line out is not 2 or 4.*/</a>
<a name="1658"><span class="lineNum">    1658 </span>            :         /*the dispclk required for scaler throughput is the product of the pixel rate and the scaling limits factor.*/</a>
<a name="1659"><span class="lineNum">    1659 </span>            :         /*the dispclk required for total read request throughput is the product of the peak request-per-second bandwidth and the dispclk cycles per request, divided by the request efficiency.*/</a>
<a name="1660"><span class="lineNum">    1660 </span>            :         /*for the dispclk required with ramping, instead of multiplying just the pipe throughput by the display pipe throughput factor, we multiply the scaler and pipe throughput by the ramping factor.*/</a>
<a name="1661"><span class="lineNum">    1661 </span>            :         /*the scaling limits factor is the product of the horizontal scale ratio, and the ratio of the vertical taps divided by the scaler efficiency clamped to at least 1.*/</a>
<a name="1662"><span class="lineNum">    1662 </span>            :         /*the scaling limits factor itself it also clamped to at least 1*/</a>
<a name="1663"><span class="lineNum">    1663 </span>            :         /*if doing downscaling with the pre-downscaler enabled, the horizontal scale ratio should not be considered above (use &quot;1&quot;)*/</a>
<a name="1664"><span class="lineNum">    1664 </span><span class="lineNoCov">          0 :         data-&gt;downspread_factor = bw_add(bw_int_to_fixed(1), bw_div(vbios-&gt;down_spread_percentage, bw_int_to_fixed(100)));</span></a>
<a name="1665"><span class="lineNum">    1665 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1666"><span class="lineNum">    1666 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1667"><span class="lineNum">    1667 </span><span class="lineNoCov">          0 :                         if (surface_type[i] == bw_def_graphics) {</span></a>
<a name="1668"><span class="lineNum">    1668 </span><span class="lineNoCov">          0 :                                 switch (data-&gt;lb_bpc[i]) {</span></a>
<a name="1669"><span class="lineNum">    1669 </span>            :                                 case 6:</a>
<a name="1670"><span class="lineNum">    1670 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency6_bit_per_component;</span></a>
<a name="1671"><span class="lineNum">    1671 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1672"><span class="lineNum">    1672 </span>            :                                 case 8:</a>
<a name="1673"><span class="lineNum">    1673 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency8_bit_per_component;</span></a>
<a name="1674"><span class="lineNum">    1674 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1675"><span class="lineNum">    1675 </span>            :                                 case 10:</a>
<a name="1676"><span class="lineNum">    1676 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency10_bit_per_component;</span></a>
<a name="1677"><span class="lineNum">    1677 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1678"><span class="lineNum">    1678 </span>            :                                 default:</a>
<a name="1679"><span class="lineNum">    1679 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;graphics_vscaler_efficiency12_bit_per_component;</span></a>
<a name="1680"><span class="lineNum">    1680 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1681"><span class="lineNum">    1681 </span>            :                                 }</a>
<a name="1682"><span class="lineNum">    1682 </span><span class="lineNoCov">          0 :                                 if (data-&gt;use_alpha[i] == 1) {</span></a>
<a name="1683"><span class="lineNum">    1683 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = bw_min2(data-&gt;v_scaler_efficiency, dceip-&gt;alpha_vscaler_efficiency);</span></a>
<a name="1684"><span class="lineNum">    1684 </span>            :                                 }</a>
<a name="1685"><span class="lineNum">    1685 </span>            :                         }</a>
<a name="1686"><span class="lineNum">    1686 </span>            :                         else {</a>
<a name="1687"><span class="lineNum">    1687 </span><span class="lineNoCov">          0 :                                 switch (data-&gt;lb_bpc[i]) {</span></a>
<a name="1688"><span class="lineNum">    1688 </span>            :                                 case 6:</a>
<a name="1689"><span class="lineNum">    1689 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;underlay_vscaler_efficiency6_bit_per_component;</span></a>
<a name="1690"><span class="lineNum">    1690 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1691"><span class="lineNum">    1691 </span>            :                                 case 8:</a>
<a name="1692"><span class="lineNum">    1692 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;underlay_vscaler_efficiency8_bit_per_component;</span></a>
<a name="1693"><span class="lineNum">    1693 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1694"><span class="lineNum">    1694 </span>            :                                 case 10:</a>
<a name="1695"><span class="lineNum">    1695 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;underlay_vscaler_efficiency10_bit_per_component;</span></a>
<a name="1696"><span class="lineNum">    1696 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1697"><span class="lineNum">    1697 </span>            :                                 default:</a>
<a name="1698"><span class="lineNum">    1698 </span><span class="lineNoCov">          0 :                                         data-&gt;v_scaler_efficiency = dceip-&gt;underlay_vscaler_efficiency12_bit_per_component;</span></a>
<a name="1699"><span class="lineNum">    1699 </span><span class="lineNoCov">          0 :                                         break;</span></a>
<a name="1700"><span class="lineNum">    1700 </span>            :                                 }</a>
<a name="1701"><span class="lineNum">    1701 </span>            :                         }</a>
<a name="1702"><span class="lineNum">    1702 </span><span class="lineNoCov">          0 :                         if (dceip-&gt;pre_downscaler_enabled &amp;&amp; bw_mtn(data-&gt;hsr[i], bw_int_to_fixed(1))) {</span></a>
<a name="1703"><span class="lineNum">    1703 </span><span class="lineNoCov">          0 :                                 data-&gt;scaler_limits_factor = bw_max2(bw_div(data-&gt;v_taps[i], data-&gt;v_scaler_efficiency), bw_div(data-&gt;source_width_rounded_up_to_chunks[i], data-&gt;h_total[i]));</span></a>
<a name="1704"><span class="lineNum">    1704 </span>            :                         }</a>
<a name="1705"><span class="lineNum">    1705 </span>            :                         else {</a>
<a name="1706"><span class="lineNum">    1706 </span><span class="lineNoCov">          0 :                                 data-&gt;scaler_limits_factor = bw_max3(bw_int_to_fixed(1), bw_ceil2(bw_div(data-&gt;h_taps[i], bw_int_to_fixed(4)), bw_int_to_fixed(1)), bw_mul(data-&gt;hsr[i], bw_max2(bw_div(data-&gt;v_taps[i], data-&gt;v_scaler_efficiency), bw_int_to_fixed(1))));</span></a>
<a name="1707"><span class="lineNum">    1707 </span>            :                         }</a>
<a name="1708"><span class="lineNum">    1708 </span><span class="lineNoCov">          0 :                         data-&gt;display_pipe_pixel_throughput = bw_div(bw_div(bw_mul(bw_max2(data-&gt;lb_lines_in_per_line_out_in_beginning_of_frame[i], bw_mul(data-&gt;lb_lines_in_per_line_out_in_middle_of_frame[i], data-&gt;horizontal_blank_and_chunk_granularity_factor[i])), data-&gt;source_width_rounded_up_to_chunks[i]), (bw_div(data-&gt;h_total[i], data-&gt;pixel_rate[i]))), dceip-&gt;lb_write_pixels_per_dispclk);</span></a>
<a name="1709"><span class="lineNum">    1709 </span><span class="lineNoCov">          0 :                         data-&gt;dispclk_required_without_ramping[i] = bw_mul(data-&gt;downspread_factor, bw_max2(bw_mul(data-&gt;pixel_rate[i], data-&gt;scaler_limits_factor), bw_mul(dceip-&gt;display_pipe_throughput_factor, data-&gt;display_pipe_pixel_throughput)));</span></a>
<a name="1710"><span class="lineNum">    1710 </span><span class="lineNoCov">          0 :                         data-&gt;dispclk_required_with_ramping[i] = bw_mul(dceip-&gt;dispclk_ramping_factor, bw_max2(bw_mul(data-&gt;pixel_rate[i], data-&gt;scaler_limits_factor), data-&gt;display_pipe_pixel_throughput));</span></a>
<a name="1711"><span class="lineNum">    1711 </span>            :                 }</a>
<a name="1712"><span class="lineNum">    1712 </span>            :         }</a>
<a name="1713"><span class="lineNum">    1713 </span><span class="lineNoCov">          0 :         data-&gt;total_dispclk_required_with_ramping = bw_int_to_fixed(0);</span></a>
<a name="1714"><span class="lineNum">    1714 </span><span class="lineNoCov">          0 :         data-&gt;total_dispclk_required_without_ramping = bw_int_to_fixed(0);</span></a>
<a name="1715"><span class="lineNum">    1715 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1716"><span class="lineNum">    1716 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1717"><span class="lineNum">    1717 </span><span class="lineNoCov">          0 :                         if (bw_ltn(data-&gt;total_dispclk_required_with_ramping, data-&gt;dispclk_required_with_ramping[i])) {</span></a>
<a name="1718"><span class="lineNum">    1718 </span><span class="lineNoCov">          0 :                                 data-&gt;total_dispclk_required_with_ramping = data-&gt;dispclk_required_with_ramping[i];</span></a>
<a name="1719"><span class="lineNum">    1719 </span>            :                         }</a>
<a name="1720"><span class="lineNum">    1720 </span><span class="lineNoCov">          0 :                         if (bw_ltn(data-&gt;total_dispclk_required_without_ramping, data-&gt;dispclk_required_without_ramping[i])) {</span></a>
<a name="1721"><span class="lineNum">    1721 </span><span class="lineNoCov">          0 :                                 data-&gt;total_dispclk_required_without_ramping = data-&gt;dispclk_required_without_ramping[i];</span></a>
<a name="1722"><span class="lineNum">    1722 </span>            :                         }</a>
<a name="1723"><span class="lineNum">    1723 </span>            :                 }</a>
<a name="1724"><span class="lineNum">    1724 </span>            :         }</a>
<a name="1725"><span class="lineNum">    1725 </span><span class="lineNoCov">          0 :         data-&gt;total_read_request_bandwidth = bw_int_to_fixed(0);</span></a>
<a name="1726"><span class="lineNum">    1726 </span><span class="lineNoCov">          0 :         data-&gt;total_write_request_bandwidth = bw_int_to_fixed(0);</span></a>
<a name="1727"><span class="lineNum">    1727 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1728"><span class="lineNum">    1728 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1729"><span class="lineNum">    1729 </span><span class="lineNoCov">          0 :                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1730"><span class="lineNum">    1730 </span><span class="lineNoCov">          0 :                                 data-&gt;total_read_request_bandwidth = bw_add(data-&gt;total_read_request_bandwidth, data-&gt;request_bandwidth[i]);</span></a>
<a name="1731"><span class="lineNum">    1731 </span>            :                         }</a>
<a name="1732"><span class="lineNum">    1732 </span>            :                         else {</a>
<a name="1733"><span class="lineNum">    1733 </span><span class="lineNoCov">          0 :                                 data-&gt;total_write_request_bandwidth = bw_add(data-&gt;total_write_request_bandwidth, data-&gt;request_bandwidth[i]);</span></a>
<a name="1734"><span class="lineNum">    1734 </span>            :                         }</a>
<a name="1735"><span class="lineNum">    1735 </span>            :                 }</a>
<a name="1736"><span class="lineNum">    1736 </span>            :         }</a>
<a name="1737"><span class="lineNum">    1737 </span><span class="lineNoCov">          0 :         data-&gt;dispclk_required_for_total_read_request_bandwidth = bw_div(bw_mul(data-&gt;total_read_request_bandwidth, dceip-&gt;dispclk_per_request), dceip-&gt;request_efficiency);</span></a>
<a name="1738"><span class="lineNum">    1738 </span><span class="lineNoCov">          0 :         data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth = bw_max2(data-&gt;total_dispclk_required_with_ramping, data-&gt;dispclk_required_for_total_read_request_bandwidth);</span></a>
<a name="1739"><span class="lineNum">    1739 </span><span class="lineNoCov">          0 :         data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth = bw_max2(data-&gt;total_dispclk_required_without_ramping, data-&gt;dispclk_required_for_total_read_request_bandwidth);</span></a>
<a name="1740"><span class="lineNum">    1740 </span><span class="lineNoCov">          0 :         if (data-&gt;cpuc_state_change_enable == bw_def_yes) {</span></a>
<a name="1741"><span class="lineNum">    1741 </span><span class="lineNoCov">          0 :                 data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth = bw_max3(data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth, data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][data-&gt;sclk_level], data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][data-&gt;sclk_level]);</span></a>
<a name="1742"><span class="lineNum">    1742 </span><span class="lineNoCov">          0 :                 data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth = bw_max3(data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth, data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][data-&gt;sclk_level], data-&gt;dispclk_required_for_blackout_recovery[data-&gt;y_clk_level][data-&gt;sclk_level]);</span></a>
<a name="1743"><span class="lineNum">    1743 </span>            :         }</a>
<a name="1744"><span class="lineNum">    1744 </span><span class="lineNoCov">          0 :         if (data-&gt;cpup_state_change_enable == bw_def_yes) {</span></a>
<a name="1745"><span class="lineNum">    1745 </span><span class="lineNoCov">          0 :                 data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth = bw_max2(data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth, data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][data-&gt;sclk_level]);</span></a>
<a name="1746"><span class="lineNum">    1746 </span><span class="lineNoCov">          0 :                 data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth = bw_max2(data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth, data-&gt;dispclk_required_for_blackout_duration[data-&gt;y_clk_level][data-&gt;sclk_level]);</span></a>
<a name="1747"><span class="lineNum">    1747 </span>            :         }</a>
<a name="1748"><span class="lineNum">    1748 </span><span class="lineNoCov">          0 :         if (data-&gt;nbp_state_change_enable == bw_def_yes &amp;&amp; data-&gt;increase_voltage_to_support_mclk_switch) {</span></a>
<a name="1749"><span class="lineNum">    1749 </span><span class="lineNoCov">          0 :                 data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth = bw_max2(data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth, data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][data-&gt;sclk_level]);</span></a>
<a name="1750"><span class="lineNum">    1750 </span><span class="lineNoCov">          0 :                 data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth = bw_max2(data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth, data-&gt;dispclk_required_for_dram_speed_change[data-&gt;y_clk_level][data-&gt;sclk_level]);</span></a>
<a name="1751"><span class="lineNum">    1751 </span>            :         }</a>
<a name="1752"><span class="lineNum">    1752 </span><span class="lineNoCov">          0 :         if (bw_ltn(data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth, vbios-&gt;high_voltage_max_dispclk)) {</span></a>
<a name="1753"><span class="lineNum">    1753 </span><span class="lineNoCov">          0 :                 data-&gt;dispclk = data-&gt;total_dispclk_required_with_ramping_with_request_bandwidth;</span></a>
<a name="1754"><span class="lineNum">    1754 </span>            :         }</a>
<a name="1755"><span class="lineNum">    1755 </span><span class="lineNoCov">          0 :         else if (bw_ltn(data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth, vbios-&gt;high_voltage_max_dispclk)) {</span></a>
<a name="1756"><span class="lineNum">    1756 </span><span class="lineNoCov">          0 :                 data-&gt;dispclk = vbios-&gt;high_voltage_max_dispclk;</span></a>
<a name="1757"><span class="lineNum">    1757 </span>            :         }</a>
<a name="1758"><span class="lineNum">    1758 </span>            :         else {</a>
<a name="1759"><span class="lineNum">    1759 </span><span class="lineNoCov">          0 :                 data-&gt;dispclk = data-&gt;total_dispclk_required_without_ramping_with_request_bandwidth;</span></a>
<a name="1760"><span class="lineNum">    1760 </span>            :         }</a>
<a name="1761"><span class="lineNum">    1761 </span>            :         /* required core voltage*/</a>
<a name="1762"><span class="lineNum">    1762 </span>            :         /* the core voltage required is low if sclk, yclk(pclk)and dispclk are within the low limits*/</a>
<a name="1763"><span class="lineNum">    1763 </span>            :         /* otherwise, the core voltage required is medium if yclk (pclk) is within the low limit and sclk and dispclk are within the medium limit*/</a>
<a name="1764"><span class="lineNum">    1764 </span>            :         /* otherwise, the core voltage required is high if the three clocks are within the high limits*/</a>
<a name="1765"><span class="lineNum">    1765 </span>            :         /* otherwise, or if the mode is not supported, core voltage requirement is not applicable*/</a>
<a name="1766"><span class="lineNum">    1766 </span><span class="lineNoCov">          0 :         if (pipe_check == bw_def_notok) {</span></a>
<a name="1767"><span class="lineNum">    1767 </span>            :                 voltage = bw_def_na;</a>
<a name="1768"><span class="lineNum">    1768 </span>            :         }</a>
<a name="1769"><span class="lineNum">    1769 </span><span class="lineNoCov">          0 :         else if (mode_check == bw_def_notok) {</span></a>
<a name="1770"><span class="lineNum">    1770 </span>            :                 voltage = bw_def_notok;</a>
<a name="1771"><span class="lineNum">    1771 </span>            :         }</a>
<a name="1772"><span class="lineNum">    1772 </span><span class="lineNoCov">          0 :         else if (bw_equ(bw_int_to_fixed(yclk_message), vbios-&gt;low_yclk) &amp;&amp; sclk_message == bw_def_low &amp;&amp; bw_ltn(data-&gt;dispclk, vbios-&gt;low_voltage_max_dispclk)) {</span></a>
<a name="1773"><span class="lineNum">    1773 </span>            :                 voltage = bw_def_0_72;</a>
<a name="1774"><span class="lineNum">    1774 </span>            :         }</a>
<a name="1775"><span class="lineNum">    1775 </span><span class="lineNoCov">          0 :         else if ((bw_equ(bw_int_to_fixed(yclk_message), vbios-&gt;low_yclk) || bw_equ(bw_int_to_fixed(yclk_message), vbios-&gt;mid_yclk)) &amp;&amp; (sclk_message == bw_def_low || sclk_message == bw_def_mid) &amp;&amp; bw_ltn(data-&gt;dispclk, vbios-&gt;mid_voltage_max_dispclk)) {</span></a>
<a name="1776"><span class="lineNum">    1776 </span>            :                 voltage = bw_def_0_8;</a>
<a name="1777"><span class="lineNum">    1777 </span>            :         }</a>
<a name="1778"><span class="lineNum">    1778 </span><span class="lineNoCov">          0 :         else if ((bw_equ(bw_int_to_fixed(yclk_message), vbios-&gt;low_yclk) || bw_equ(bw_int_to_fixed(yclk_message), vbios-&gt;mid_yclk) || bw_equ(bw_int_to_fixed(yclk_message), vbios-&gt;high_yclk)) &amp;&amp; (sclk_message == bw_def_low || sclk_message == bw_def_mid || sclk_message == bw_def_high) &amp;&amp; bw_leq(data-&gt;dispclk, vbios-&gt;high_voltage_max_dispclk)) {</span></a>
<a name="1779"><span class="lineNum">    1779 </span><span class="lineNoCov">          0 :                 if ((data-&gt;nbp_state_change_enable == bw_def_no &amp;&amp; nbp_state_change_enable_blank == bw_def_no)) {</span></a>
<a name="1780"><span class="lineNum">    1780 </span>            :                         voltage = bw_def_high_no_nbp_state_change;</a>
<a name="1781"><span class="lineNum">    1781 </span>            :                 }</a>
<a name="1782"><span class="lineNum">    1782 </span>            :                 else {</a>
<a name="1783"><span class="lineNum">    1783 </span><span class="lineNoCov">          0 :                         voltage = bw_def_0_9;</span></a>
<a name="1784"><span class="lineNum">    1784 </span>            :                 }</a>
<a name="1785"><span class="lineNum">    1785 </span>            :         }</a>
<a name="1786"><span class="lineNum">    1786 </span>            :         else {</a>
<a name="1787"><span class="lineNum">    1787 </span>            :                 voltage = bw_def_notok;</a>
<a name="1788"><span class="lineNum">    1788 </span>            :         }</a>
<a name="1789"><span class="lineNum">    1789 </span><span class="lineNoCov">          0 :         if (voltage == bw_def_0_72) {</span></a>
<a name="1790"><span class="lineNum">    1790 </span><span class="lineNoCov">          0 :                 data-&gt;max_phyclk = vbios-&gt;low_voltage_max_phyclk;</span></a>
<a name="1791"><span class="lineNum">    1791 </span>            :         }</a>
<a name="1792"><span class="lineNum">    1792 </span><span class="lineNoCov">          0 :         else if (voltage == bw_def_0_8) {</span></a>
<a name="1793"><span class="lineNum">    1793 </span><span class="lineNoCov">          0 :                 data-&gt;max_phyclk = vbios-&gt;mid_voltage_max_phyclk;</span></a>
<a name="1794"><span class="lineNum">    1794 </span>            :         }</a>
<a name="1795"><span class="lineNum">    1795 </span>            :         else {</a>
<a name="1796"><span class="lineNum">    1796 </span><span class="lineNoCov">          0 :                 data-&gt;max_phyclk = vbios-&gt;high_voltage_max_phyclk;</span></a>
<a name="1797"><span class="lineNum">    1797 </span>            :         }</a>
<a name="1798"><span class="lineNum">    1798 </span>            :         /*required blackout recovery time*/</a>
<a name="1799"><span class="lineNum">    1799 </span><span class="lineNoCov">          0 :         data-&gt;blackout_recovery_time = bw_int_to_fixed(0);</span></a>
<a name="1800"><span class="lineNum">    1800 </span><span class="lineNoCov">          0 :         for (k = 0; k &lt;= maximum_number_of_surfaces - 1; k++) {</span></a>
<a name="1801"><span class="lineNum">    1801 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[k] &amp;&amp; bw_mtn(vbios-&gt;blackout_duration, bw_int_to_fixed(0)) &amp;&amp; data-&gt;cpup_state_change_enable == bw_def_yes) {</span></a>
<a name="1802"><span class="lineNum">    1802 </span><span class="lineNoCov">          0 :                         if (surface_type[k] != bw_def_display_write_back420_luma &amp;&amp; surface_type[k] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1803"><span class="lineNum">    1803 </span><span class="lineNoCov">          0 :                                 data-&gt;blackout_recovery_time = bw_max2(data-&gt;blackout_recovery_time, bw_add(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]));</span></a>
<a name="1804"><span class="lineNum">    1804 </span><span class="lineNoCov">          0 :                                 if (bw_ltn(data-&gt;adjusted_data_buffer_size[k], bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), (bw_add(vbios-&gt;blackout_duration, bw_add(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level])))))) {</span></a>
<a name="1805"><span class="lineNum">    1805 </span><span class="lineNoCov">          0 :                                         data-&gt;blackout_recovery_time = bw_max2(data-&gt;blackout_recovery_time, bw_div((bw_add(bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), vbios-&gt;blackout_duration), bw_sub(bw_div(bw_mul(bw_mul(bw_mul((bw_add(bw_mul(bw_int_to_fixed(2), data-&gt;total_dmifmc_urgent_latency), data-&gt;dmif_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level])), data-&gt;dispclk), bw_int_to_fixed(data-&gt;bytes_per_pixel[k])), data-&gt;lines_interleaved_in_mem_access[k]), data-&gt;latency_hiding_lines[k]), data-&gt;adjusted_data_buffer_size[k]))), (bw_sub(bw_div(bw_mul(bw_mul(data-&gt;dispclk, bw_int_to_fixed(data-&gt;bytes_per_pixel[k])), data-&gt;lines_interleaved_in_mem_access[k]), data-&gt;latency_hiding_lines[k]), bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k])))));</span></a>
<a name="1806"><span class="lineNum">    1806 </span>            :                                 }</a>
<a name="1807"><span class="lineNum">    1807 </span>            :                         }</a>
<a name="1808"><span class="lineNum">    1808 </span>            :                         else {</a>
<a name="1809"><span class="lineNum">    1809 </span><span class="lineNoCov">          0 :                                 data-&gt;blackout_recovery_time = bw_max2(data-&gt;blackout_recovery_time, bw_add(bw_mul(bw_int_to_fixed(2), vbios-&gt;mcifwrmc_urgent_latency), data-&gt;mcifwr_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]));</span></a>
<a name="1810"><span class="lineNum">    1810 </span><span class="lineNoCov">          0 :                                 if (bw_ltn(data-&gt;adjusted_data_buffer_size[k], bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), (bw_add(vbios-&gt;blackout_duration, bw_add(bw_mul(bw_int_to_fixed(2), vbios-&gt;mcifwrmc_urgent_latency), data-&gt;mcifwr_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level])))))) {</span></a>
<a name="1811"><span class="lineNum">    1811 </span><span class="lineNoCov">          0 :                                         data-&gt;blackout_recovery_time = bw_max2(data-&gt;blackout_recovery_time, bw_div((bw_add(bw_mul(bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k]), vbios-&gt;blackout_duration), bw_sub(bw_div(bw_mul(bw_mul(bw_mul((bw_add(bw_add(bw_mul(bw_int_to_fixed(2), vbios-&gt;mcifwrmc_urgent_latency), data-&gt;dmif_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]), data-&gt;mcifwr_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level])), data-&gt;dispclk), bw_int_to_fixed(data-&gt;bytes_per_pixel[k])), data-&gt;lines_interleaved_in_mem_access[k]), data-&gt;latency_hiding_lines[k]), data-&gt;adjusted_data_buffer_size[k]))), (bw_sub(bw_div(bw_mul(bw_mul(data-&gt;dispclk, bw_int_to_fixed(data-&gt;bytes_per_pixel[k])), data-&gt;lines_interleaved_in_mem_access[k]), data-&gt;latency_hiding_lines[k]), bw_div(bw_mul(data-&gt;display_bandwidth[k], data-&gt;useful_bytes_per_request[k]), data-&gt;bytes_per_request[k])))));</span></a>
<a name="1812"><span class="lineNum">    1812 </span>            :                                 }</a>
<a name="1813"><span class="lineNum">    1813 </span>            :                         }</a>
<a name="1814"><span class="lineNum">    1814 </span>            :                 }</a>
<a name="1815"><span class="lineNum">    1815 </span><span class="lineNoCov">          0 :         }</span></a>
<a name="1816"><span class="lineNum">    1816 </span><span class="lineNoCov">          0 :         /*sclk deep sleep*/</span></a>
<a name="1817"><span class="lineNum">    1817 </span>            :         /*during self-refresh, sclk can be reduced to dispclk divided by the minimum pixels in the data fifo entry, with 15% margin, but shoudl not be set to less than the request bandwidth.*/</a>
<a name="1818"><span class="lineNum">    1818 </span>            :         /*the data fifo entry is 16 pixels for the writeback, 64 bytes/bytes_per_pixel for the graphics, 16 pixels for the parallel rotation underlay,*/</a>
<a name="1819"><span class="lineNum">    1819 </span>            :         /*and 16 bytes/bytes_per_pixel for the orthogonal rotation underlay.*/</a>
<a name="1820"><span class="lineNum">    1820 </span>            :         /*in parallel mode (underlay pipe), the data read from the dmifv buffer is variable and based on the pixel depth (8bbp - 16 bytes, 16 bpp - 32 bytes, 32 bpp - 64 bytes)*/</a>
<a name="1821"><span class="lineNum">    1821 </span>            :         /*in orthogonal mode (underlay pipe), the data read from the dmifv buffer is fixed at 16 bytes.*/</a>
<a name="1822"><span class="lineNum">    1822 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1823"><span class="lineNum">    1823 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1824"><span class="lineNum">    1824 </span><span class="lineNoCov">          0 :                         if (surface_type[i] == bw_def_display_write_back420_luma || surface_type[i] == bw_def_display_write_back420_chroma) {</span></a>
<a name="1825"><span class="lineNum">    1825 </span><span class="lineNoCov">          0 :                                 data-&gt;pixels_per_data_fifo_entry[i] = bw_int_to_fixed(16);</span></a>
<a name="1826"><span class="lineNum">    1826 </span>            :                         }</a>
<a name="1827"><span class="lineNum">    1827 </span><span class="lineNoCov">          0 :                         else if (surface_type[i] == bw_def_graphics) {</span></a>
<a name="1828"><span class="lineNum">    1828 </span><span class="lineNoCov">          0 :                                 data-&gt;pixels_per_data_fifo_entry[i] = bw_div(bw_int_to_fixed(64), bw_int_to_fixed(data-&gt;bytes_per_pixel[i]));</span></a>
<a name="1829"><span class="lineNum">    1829 </span>            :                         }</a>
<a name="1830"><span class="lineNum">    1830 </span><span class="lineNoCov">          0 :                         else if (data-&gt;orthogonal_rotation[i] == 0) {</span></a>
<a name="1831"><span class="lineNum">    1831 </span><span class="lineNoCov">          0 :                                 data-&gt;pixels_per_data_fifo_entry[i] = bw_int_to_fixed(16);</span></a>
<a name="1832"><span class="lineNum">    1832 </span>            :                         }</a>
<a name="1833"><span class="lineNum">    1833 </span>            :                         else {</a>
<a name="1834"><span class="lineNum">    1834 </span><span class="lineNoCov">          0 :                                 data-&gt;pixels_per_data_fifo_entry[i] = bw_div(bw_int_to_fixed(16), bw_int_to_fixed(data-&gt;bytes_per_pixel[i]));</span></a>
<a name="1835"><span class="lineNum">    1835 </span>            :                         }</a>
<a name="1836"><span class="lineNum">    1836 </span>            :                 }</a>
<a name="1837"><span class="lineNum">    1837 </span>            :         }</a>
<a name="1838"><span class="lineNum">    1838 </span><span class="lineNoCov">          0 :         data-&gt;min_pixels_per_data_fifo_entry = bw_int_to_fixed(9999);</span></a>
<a name="1839"><span class="lineNum">    1839 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1840"><span class="lineNum">    1840 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1841"><span class="lineNum">    1841 </span><span class="lineNoCov">          0 :                         if (bw_mtn(data-&gt;min_pixels_per_data_fifo_entry, data-&gt;pixels_per_data_fifo_entry[i])) {</span></a>
<a name="1842"><span class="lineNum">    1842 </span><span class="lineNoCov">          0 :                                 data-&gt;min_pixels_per_data_fifo_entry = data-&gt;pixels_per_data_fifo_entry[i];</span></a>
<a name="1843"><span class="lineNum">    1843 </span>            :                         }</a>
<a name="1844"><span class="lineNum">    1844 </span>            :                 }</a>
<a name="1845"><span class="lineNum">    1845 </span>            :         }</a>
<a name="1846"><span class="lineNum">    1846 </span><span class="lineNoCov">          0 :         data-&gt;sclk_deep_sleep = bw_max2(bw_div(bw_mul(data-&gt;dispclk, bw_frc_to_fixed(115, 100)), data-&gt;min_pixels_per_data_fifo_entry), data-&gt;total_read_request_bandwidth);</span></a>
<a name="1847"><span class="lineNum">    1847 </span>            :         /*urgent, stutter and nb-p_state watermark*/</a>
<a name="1848"><span class="lineNum">    1848 </span>            :         /*the urgent watermark is the maximum of the urgent trip time plus the pixel transfer time, the urgent trip times to get data for the first pixel, and the urgent trip times to get data for the last pixel.*/</a>
<a name="1849"><span class="lineNum">    1849 </span>            :         /*the stutter exit watermark is the self refresh exit time plus the maximum of the data burst time plus the pixel transfer time, the data burst times to get data for the first pixel, and the data burst times to get data for the last pixel.  it does not apply to the writeback.*/</a>
<a name="1850"><span class="lineNum">    1850 </span>            :         /*the nb p-state change watermark is the dram speed/p-state change time plus the maximum of the data burst time plus the pixel transfer time, the data burst times to get data for the first pixel, and the data burst times to get data for the last pixel.*/</a>
<a name="1851"><span class="lineNum">    1851 </span>            :         /*the pixel transfer time is the maximum of the time to transfer the source pixels required for the first output pixel, and the time to transfer the pixels for the last output pixel minus the active line time.*/</a>
<a name="1852"><span class="lineNum">    1852 </span>            :         /*blackout_duration is added to the urgent watermark*/</a>
<a name="1853"><span class="lineNum">    1853 </span><span class="lineNoCov">          0 :         data-&gt;chunk_request_time = bw_int_to_fixed(0);</span></a>
<a name="1854"><span class="lineNum">    1854 </span><span class="lineNoCov">          0 :         data-&gt;cursor_request_time = bw_int_to_fixed(0);</span></a>
<a name="1855"><span class="lineNum">    1855 </span>            :         /*compute total time to request one chunk from each active display pipe*/</a>
<a name="1856"><span class="lineNum">    1856 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1857"><span class="lineNum">    1857 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1858"><span class="lineNum">    1858 </span><span class="lineNoCov">          0 :                         data-&gt;chunk_request_time = bw_add(data-&gt;chunk_request_time, (bw_div((bw_div(bw_int_to_fixed(pixels_per_chunk * data-&gt;bytes_per_pixel[i]), data-&gt;useful_bytes_per_request[i])), bw_min2(sclk[data-&gt;sclk_level], bw_div(data-&gt;dispclk, bw_int_to_fixed(2))))));</span></a>
<a name="1859"><span class="lineNum">    1859 </span>            :                 }</a>
<a name="1860"><span class="lineNum">    1860 </span>            :         }</a>
<a name="1861"><span class="lineNum">    1861 </span>            :         /*compute total time to request cursor data*/</a>
<a name="1862"><span class="lineNum">    1862 </span><span class="lineNoCov">          0 :         data-&gt;cursor_request_time = (bw_div(data-&gt;cursor_total_data, (bw_mul(bw_int_to_fixed(32), sclk[data-&gt;sclk_level]))));</span></a>
<a name="1863"><span class="lineNum">    1863 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1864"><span class="lineNum">    1864 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1865"><span class="lineNum">    1865 </span><span class="lineNoCov">          0 :                         data-&gt;line_source_pixels_transfer_time = bw_max2(bw_div(bw_div(data-&gt;src_pixels_for_first_output_pixel[i], dceip-&gt;lb_write_pixels_per_dispclk), (bw_div(data-&gt;dispclk, dceip-&gt;display_pipe_throughput_factor))), bw_sub(bw_div(bw_div(data-&gt;src_pixels_for_last_output_pixel[i], dceip-&gt;lb_write_pixels_per_dispclk), (bw_div(data-&gt;dispclk, dceip-&gt;display_pipe_throughput_factor))), data-&gt;active_time[i]));</span></a>
<a name="1866"><span class="lineNum">    1866 </span><span class="lineNoCov">          0 :                         if (surface_type[i] != bw_def_display_write_back420_luma &amp;&amp; surface_type[i] != bw_def_display_write_back420_chroma) {</span></a>
<a name="1867"><span class="lineNum">    1867 </span><span class="lineNoCov">          0 :                                 data-&gt;urgent_watermark[i] = bw_add(bw_add(bw_add(bw_add(bw_add(data-&gt;total_dmifmc_urgent_latency, data-&gt;dmif_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]), bw_max2(data-&gt;line_source_pixels_transfer_time, data-&gt;line_source_transfer_time[i][data-&gt;y_clk_level][data-&gt;sclk_level])), vbios-&gt;blackout_duration), data-&gt;chunk_request_time), data-&gt;cursor_request_time);</span></a>
<a name="1868"><span class="lineNum">    1868 </span><span class="lineNoCov">          0 :                                 data-&gt;stutter_exit_watermark[i] = bw_add(bw_sub(vbios-&gt;stutter_self_refresh_exit_latency, data-&gt;total_dmifmc_urgent_latency), data-&gt;urgent_watermark[i]);</span></a>
<a name="1869"><span class="lineNum">    1869 </span><span class="lineNoCov">          0 :                                 data-&gt;stutter_entry_watermark[i] = bw_add(bw_sub(bw_add(vbios-&gt;stutter_self_refresh_exit_latency, vbios-&gt;stutter_self_refresh_entry_latency), data-&gt;total_dmifmc_urgent_latency), data-&gt;urgent_watermark[i]);</span></a>
<a name="1870"><span class="lineNum">    1870 </span>            :                                 /*unconditionally remove black out time from the nb p_state watermark*/</a>
<a name="1871"><span class="lineNum">    1871 </span><span class="lineNoCov">          0 :                                 if (data-&gt;display_pstate_change_enable[i] == 1) {</span></a>
<a name="1872"><span class="lineNum">    1872 </span><span class="lineNoCov">          0 :                                         data-&gt;nbp_state_change_watermark[i] = bw_add(bw_add(vbios-&gt;nbp_state_change_latency, data-&gt;dmif_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]), bw_max2(data-&gt;line_source_pixels_transfer_time, data-&gt;dram_speed_change_line_source_transfer_time[i][data-&gt;y_clk_level][data-&gt;sclk_level]));</span></a>
<a name="1873"><span class="lineNum">    1873 </span>            :                                 }</a>
<a name="1874"><span class="lineNum">    1874 </span>            :                                 else {</a>
<a name="1875"><span class="lineNum">    1875 </span>            :                                         /*maximize the watermark to force the switch in the vb_lank region of the frame*/</a>
<a name="1876"><span class="lineNum">    1876 </span><span class="lineNoCov">          0 :                                         data-&gt;nbp_state_change_watermark[i] = bw_int_to_fixed(131000);</span></a>
<a name="1877"><span class="lineNum">    1877 </span>            :                                 }</a>
<a name="1878"><span class="lineNum">    1878 </span>            :                         }</a>
<a name="1879"><span class="lineNum">    1879 </span>            :                         else {</a>
<a name="1880"><span class="lineNum">    1880 </span><span class="lineNoCov">          0 :                                 data-&gt;urgent_watermark[i] = bw_add(bw_add(bw_add(bw_add(bw_add(vbios-&gt;mcifwrmc_urgent_latency, data-&gt;mcifwr_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]), bw_max2(data-&gt;line_source_pixels_transfer_time, data-&gt;line_source_transfer_time[i][data-&gt;y_clk_level][data-&gt;sclk_level])), vbios-&gt;blackout_duration), data-&gt;chunk_request_time), data-&gt;cursor_request_time);</span></a>
<a name="1881"><span class="lineNum">    1881 </span><span class="lineNoCov">          0 :                                 data-&gt;stutter_exit_watermark[i] = bw_int_to_fixed(0);</span></a>
<a name="1882"><span class="lineNum">    1882 </span><span class="lineNoCov">          0 :                                 data-&gt;stutter_entry_watermark[i] = bw_int_to_fixed(0);</span></a>
<a name="1883"><span class="lineNum">    1883 </span><span class="lineNoCov">          0 :                                 if (data-&gt;display_pstate_change_enable[i] == 1) {</span></a>
<a name="1884"><span class="lineNum">    1884 </span><span class="lineNoCov">          0 :                                         data-&gt;nbp_state_change_watermark[i] = bw_add(bw_add(vbios-&gt;nbp_state_change_latency, data-&gt;mcifwr_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]), bw_max2(data-&gt;line_source_pixels_transfer_time, data-&gt;dram_speed_change_line_source_transfer_time[i][data-&gt;y_clk_level][data-&gt;sclk_level]));</span></a>
<a name="1885"><span class="lineNum">    1885 </span>            :                                 }</a>
<a name="1886"><span class="lineNum">    1886 </span>            :                                 else {</a>
<a name="1887"><span class="lineNum">    1887 </span>            :                                         /*maximize the watermark to force the switch in the vb_lank region of the frame*/</a>
<a name="1888"><span class="lineNum">    1888 </span><span class="lineNoCov">          0 :                                         data-&gt;nbp_state_change_watermark[i] = bw_int_to_fixed(131000);</span></a>
<a name="1889"><span class="lineNum">    1889 </span>            :                                 }</a>
<a name="1890"><span class="lineNum">    1890 </span>            :                         }</a>
<a name="1891"><span class="lineNum">    1891 </span>            :                 }</a>
<a name="1892"><span class="lineNum">    1892 </span>            :         }</a>
<a name="1893"><span class="lineNum">    1893 </span>            :         /*stutter mode enable*/</a>
<a name="1894"><span class="lineNum">    1894 </span>            :         /*in the multi-display case the stutter exit or entry watermark cannot exceed the minimum latency hiding capabilities of the*/</a>
<a name="1895"><span class="lineNum">    1895 </span>            :         /*display pipe.*/</a>
<a name="1896"><span class="lineNum">    1896 </span><span class="lineNoCov">          0 :         data-&gt;stutter_mode_enable = data-&gt;cpuc_state_change_enable;</span></a>
<a name="1897"><span class="lineNum">    1897 </span><span class="lineNoCov">          0 :         if (data-&gt;number_of_displays &gt; 1) {</span></a>
<a name="1898"><span class="lineNum">    1898 </span><span class="lineNoCov">          0 :                 for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1899"><span class="lineNum">    1899 </span><span class="lineNoCov">          0 :                         if (data-&gt;enable[i]) {</span></a>
<a name="1900"><span class="lineNum">    1900 </span><span class="lineNoCov">          0 :                                 if ((bw_mtn(data-&gt;stutter_exit_watermark[i], data-&gt;minimum_latency_hiding[i]) || bw_mtn(data-&gt;stutter_entry_watermark[i], data-&gt;minimum_latency_hiding[i]))) {</span></a>
<a name="1901"><span class="lineNum">    1901 </span><span class="lineNoCov">          0 :                                         data-&gt;stutter_mode_enable = bw_def_no;</span></a>
<a name="1902"><span class="lineNum">    1902 </span>            :                                 }</a>
<a name="1903"><span class="lineNum">    1903 </span>            :                         }</a>
<a name="1904"><span class="lineNum">    1904 </span>            :                 }</a>
<a name="1905"><span class="lineNum">    1905 </span>            :         }</a>
<a name="1906"><span class="lineNum">    1906 </span>            :         /*performance metrics*/</a>
<a name="1907"><span class="lineNum">    1907 </span>            :         /* display read access efficiency (%)*/</a>
<a name="1908"><span class="lineNum">    1908 </span>            :         /* display write back access efficiency (%)*/</a>
<a name="1909"><span class="lineNum">    1909 </span>            :         /* stutter efficiency (%)*/</a>
<a name="1910"><span class="lineNum">    1910 </span>            :         /* extra underlay pitch recommended for efficiency (pixels)*/</a>
<a name="1911"><span class="lineNum">    1911 </span>            :         /* immediate flip time (us)*/</a>
<a name="1912"><span class="lineNum">    1912 </span>            :         /* latency for other clients due to urgent display read (us)*/</a>
<a name="1913"><span class="lineNum">    1913 </span>            :         /* latency for other clients due to urgent display write (us)*/</a>
<a name="1914"><span class="lineNum">    1914 </span>            :         /* average bandwidth consumed by display (no compression) (gb/s)*/</a>
<a name="1915"><span class="lineNum">    1915 </span>            :         /* required dram  bandwidth (gb/s)*/</a>
<a name="1916"><span class="lineNum">    1916 </span>            :         /* required sclk (m_hz)*/</a>
<a name="1917"><span class="lineNum">    1917 </span>            :         /* required rd urgent latency (us)*/</a>
<a name="1918"><span class="lineNum">    1918 </span>            :         /* nb p-state change margin (us)*/</a>
<a name="1919"><span class="lineNum">    1919 </span>            :         /*dmif and mcifwr dram access efficiency*/</a>
<a name="1920"><span class="lineNum">    1920 </span>            :         /*is the ratio between the ideal dram access time (which is the data buffer size in memory divided by the dram bandwidth), and the actual time which is the total page close-open time.  but it cannot exceed the dram efficiency provided by the memory subsystem*/</a>
<a name="1921"><span class="lineNum">    1921 </span><span class="lineNoCov">          0 :         data-&gt;dmifdram_access_efficiency = bw_min2(bw_div(bw_div(data-&gt;total_display_reads_required_dram_access_data, data-&gt;dram_bandwidth), data-&gt;dmif_total_page_close_open_time), bw_int_to_fixed(1));</span></a>
<a name="1922"><span class="lineNum">    1922 </span><span class="lineNoCov">          0 :         if (bw_mtn(data-&gt;total_display_writes_required_dram_access_data, bw_int_to_fixed(0))) {</span></a>
<a name="1923"><span class="lineNum">    1923 </span><span class="lineNoCov">          0 :                 data-&gt;mcifwrdram_access_efficiency = bw_min2(bw_div(bw_div(data-&gt;total_display_writes_required_dram_access_data, data-&gt;dram_bandwidth), data-&gt;mcifwr_total_page_close_open_time), bw_int_to_fixed(1));</span></a>
<a name="1924"><span class="lineNum">    1924 </span>            :         }</a>
<a name="1925"><span class="lineNum">    1925 </span>            :         else {</a>
<a name="1926"><span class="lineNum">    1926 </span><span class="lineNoCov">          0 :                 data-&gt;mcifwrdram_access_efficiency = bw_int_to_fixed(0);</span></a>
<a name="1927"><span class="lineNum">    1927 </span>            :         }</a>
<a name="1928"><span class="lineNum">    1928 </span>            :         /*stutter efficiency*/</a>
<a name="1929"><span class="lineNum">    1929 </span>            :         /*the stutter efficiency is the frame-average time in self-refresh divided by the frame-average stutter cycle duration.  only applies if the display write-back is not enabled.*/</a>
<a name="1930"><span class="lineNum">    1930 </span>            :         /*the frame-average stutter cycle used is the minimum for all pipes of the frame-average data buffer size in time, times the compression rate*/</a>
<a name="1931"><span class="lineNum">    1931 </span>            :         /*the frame-average time in self-refresh is the stutter cycle minus the self refresh exit latency and the burst time*/</a>
<a name="1932"><span class="lineNum">    1932 </span>            :         /*the stutter cycle is the dmif buffer size reduced by the excess of the stutter exit watermark over the lb size in time.*/</a>
<a name="1933"><span class="lineNum">    1933 </span>            :         /*the burst time is the data needed during the stutter cycle divided by the available bandwidth*/</a>
<a name="1934"><span class="lineNum">    1934 </span>            :         /*compute the time read all the data from the dmif buffer to the lb (dram refresh period)*/</a>
<a name="1935"><span class="lineNum">    1935 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1936"><span class="lineNum">    1936 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1937"><span class="lineNum">    1937 </span><span class="lineNoCov">          0 :                         data-&gt;stutter_refresh_duration[i] = bw_sub(bw_mul(bw_div(bw_div(bw_mul(bw_div(bw_div(data-&gt;adjusted_data_buffer_size[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;source_width_rounded_up_to_chunks[i]), data-&gt;h_total[i]), data-&gt;vsr[i]), data-&gt;pixel_rate[i]), data-&gt;compression_rate[i]), bw_max2(bw_int_to_fixed(0), bw_sub(data-&gt;stutter_exit_watermark[i], bw_div(bw_mul((bw_sub(data-&gt;lb_partitions[i], bw_int_to_fixed(1))), data-&gt;h_total[i]), data-&gt;pixel_rate[i]))));</span></a>
<a name="1938"><span class="lineNum">    1938 </span><span class="lineNoCov">          0 :                         data-&gt;stutter_dmif_buffer_size[i] = bw_div(bw_mul(bw_mul(bw_div(bw_mul(bw_mul(data-&gt;stutter_refresh_duration[i], bw_int_to_fixed(data-&gt;bytes_per_pixel[i])), data-&gt;source_width_rounded_up_to_chunks[i]), data-&gt;h_total[i]), data-&gt;vsr[i]), data-&gt;pixel_rate[i]), data-&gt;compression_rate[i]);</span></a>
<a name="1939"><span class="lineNum">    1939 </span>            :                 }</a>
<a name="1940"><span class="lineNum">    1940 </span>            :         }</a>
<a name="1941"><span class="lineNum">    1941 </span><span class="lineNoCov">          0 :         data-&gt;min_stutter_refresh_duration = bw_int_to_fixed(9999);</span></a>
<a name="1942"><span class="lineNum">    1942 </span><span class="lineNoCov">          0 :         data-&gt;total_stutter_dmif_buffer_size = 0;</span></a>
<a name="1943"><span class="lineNum">    1943 </span><span class="lineNoCov">          0 :         data-&gt;total_bytes_requested = 0;</span></a>
<a name="1944"><span class="lineNum">    1944 </span><span class="lineNoCov">          0 :         data-&gt;min_stutter_dmif_buffer_size = 9999;</span></a>
<a name="1945"><span class="lineNum">    1945 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1946"><span class="lineNum">    1946 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1947"><span class="lineNum">    1947 </span><span class="lineNoCov">          0 :                         if (bw_mtn(data-&gt;min_stutter_refresh_duration, data-&gt;stutter_refresh_duration[i])) {</span></a>
<a name="1948"><span class="lineNum">    1948 </span><span class="lineNoCov">          0 :                                 data-&gt;min_stutter_refresh_duration = data-&gt;stutter_refresh_duration[i];</span></a>
<a name="1949"><span class="lineNum">    1949 </span><span class="lineNoCov">          0 :                                 data-&gt;total_bytes_requested = bw_fixed_to_int(bw_add(bw_int_to_fixed(data-&gt;total_bytes_requested), (bw_mul(bw_mul(data-&gt;source_height_rounded_up_to_chunks[i], data-&gt;source_width_rounded_up_to_chunks[i]), bw_int_to_fixed(data-&gt;bytes_per_pixel[i])))));</span></a>
<a name="1950"><span class="lineNum">    1950 </span><span class="lineNoCov">          0 :                                 data-&gt;min_stutter_dmif_buffer_size = bw_fixed_to_int(data-&gt;stutter_dmif_buffer_size[i]);</span></a>
<a name="1951"><span class="lineNum">    1951 </span>            :                         }</a>
<a name="1952"><span class="lineNum">    1952 </span><span class="lineNoCov">          0 :                         data-&gt;total_stutter_dmif_buffer_size = bw_fixed_to_int(bw_add(data-&gt;stutter_dmif_buffer_size[i], bw_int_to_fixed(data-&gt;total_stutter_dmif_buffer_size)));</span></a>
<a name="1953"><span class="lineNum">    1953 </span>            :                 }</a>
<a name="1954"><span class="lineNum">    1954 </span>            :         }</a>
<a name="1955"><span class="lineNum">    1955 </span><span class="lineNoCov">          0 :         data-&gt;stutter_burst_time = bw_div(bw_int_to_fixed(data-&gt;total_stutter_dmif_buffer_size), bw_mul(sclk[data-&gt;sclk_level], vbios-&gt;data_return_bus_width));</span></a>
<a name="1956"><span class="lineNum">    1956 </span><span class="lineNoCov">          0 :         data-&gt;num_stutter_bursts = data-&gt;total_bytes_requested / data-&gt;min_stutter_dmif_buffer_size;</span></a>
<a name="1957"><span class="lineNum">    1957 </span><span class="lineNoCov">          0 :         data-&gt;total_stutter_cycle_duration = bw_add(bw_add(data-&gt;min_stutter_refresh_duration, vbios-&gt;stutter_self_refresh_exit_latency), data-&gt;stutter_burst_time);</span></a>
<a name="1958"><span class="lineNum">    1958 </span><span class="lineNoCov">          0 :         data-&gt;time_in_self_refresh = data-&gt;min_stutter_refresh_duration;</span></a>
<a name="1959"><span class="lineNum">    1959 </span><span class="lineNoCov">          0 :         if (data-&gt;d1_display_write_back_dwb_enable == 1) {</span></a>
<a name="1960"><span class="lineNum">    1960 </span><span class="lineNoCov">          0 :                 data-&gt;stutter_efficiency = bw_int_to_fixed(0);</span></a>
<a name="1961"><span class="lineNum">    1961 </span>            :         }</a>
<a name="1962"><span class="lineNum">    1962 </span><span class="lineNoCov">          0 :         else if (bw_ltn(data-&gt;time_in_self_refresh, bw_int_to_fixed(0))) {</span></a>
<a name="1963"><span class="lineNum">    1963 </span><span class="lineNoCov">          0 :                 data-&gt;stutter_efficiency = bw_int_to_fixed(0);</span></a>
<a name="1964"><span class="lineNum">    1964 </span>            :         }</a>
<a name="1965"><span class="lineNum">    1965 </span>            :         else {</a>
<a name="1966"><span class="lineNum">    1966 </span>            :                 /*compute stutter efficiency assuming 60 hz refresh rate*/</a>
<a name="1967"><span class="lineNum">    1967 </span><span class="lineNoCov">          0 :                 data-&gt;stutter_efficiency = bw_max2(bw_int_to_fixed(0), bw_mul((bw_sub(bw_int_to_fixed(1), (bw_div(bw_mul((bw_add(vbios-&gt;stutter_self_refresh_exit_latency, data-&gt;stutter_burst_time)), bw_int_to_fixed(data-&gt;num_stutter_bursts)), bw_frc_to_fixed(166666667, 10000))))), bw_int_to_fixed(100)));</span></a>
<a name="1968"><span class="lineNum">    1968 </span>            :         }</a>
<a name="1969"><span class="lineNum">    1969 </span>            :         /*immediate flip time*/</a>
<a name="1970"><span class="lineNum">    1970 </span>            :         /*if scatter gather is enabled, the immediate flip takes a number of urgent memory trips equivalent to the pte requests in a row divided by the pte request limit.*/</a>
<a name="1971"><span class="lineNum">    1971 </span>            :         /*otherwise, it may take just one urgenr memory trip*/</a>
<a name="1972"><span class="lineNum">    1972 </span><span class="lineNoCov">          0 :         data-&gt;worst_number_of_trips_to_memory = bw_int_to_fixed(1);</span></a>
<a name="1973"><span class="lineNum">    1973 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1974"><span class="lineNum">    1974 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i] &amp;&amp; data-&gt;scatter_gather_enable_for_pipe[i] == 1) {</span></a>
<a name="1975"><span class="lineNum">    1975 </span><span class="lineNoCov">          0 :                         data-&gt;number_of_trips_to_memory_for_getting_apte_row[i] = bw_ceil2(bw_div(data-&gt;scatter_gather_pte_requests_in_row[i], data-&gt;scatter_gather_pte_request_limit[i]), bw_int_to_fixed(1));</span></a>
<a name="1976"><span class="lineNum">    1976 </span><span class="lineNoCov">          0 :                         if (bw_ltn(data-&gt;worst_number_of_trips_to_memory, data-&gt;number_of_trips_to_memory_for_getting_apte_row[i])) {</span></a>
<a name="1977"><span class="lineNum">    1977 </span><span class="lineNoCov">          0 :                                 data-&gt;worst_number_of_trips_to_memory = data-&gt;number_of_trips_to_memory_for_getting_apte_row[i];</span></a>
<a name="1978"><span class="lineNum">    1978 </span>            :                         }</a>
<a name="1979"><span class="lineNum">    1979 </span>            :                 }</a>
<a name="1980"><span class="lineNum">    1980 </span>            :         }</a>
<a name="1981"><span class="lineNum">    1981 </span><span class="lineNoCov">          0 :         data-&gt;immediate_flip_time = bw_mul(data-&gt;worst_number_of_trips_to_memory, data-&gt;total_dmifmc_urgent_latency);</span></a>
<a name="1982"><span class="lineNum">    1982 </span>            :         /*worst latency for other clients*/</a>
<a name="1983"><span class="lineNum">    1983 </span>            :         /*it is the urgent latency plus the urgent burst time*/</a>
<a name="1984"><span class="lineNum">    1984 </span><span class="lineNoCov">          0 :         data-&gt;latency_for_non_dmif_clients = bw_add(data-&gt;total_dmifmc_urgent_latency, data-&gt;dmif_burst_time[data-&gt;y_clk_level][data-&gt;sclk_level]);</span></a>
<a name="1985"><span class="lineNum">    1985 </span><span class="lineNoCov">          0 :         if (data-&gt;d1_display_write_back_dwb_enable == 1) {</span></a>
<a name="1986"><span class="lineNum">    1986 </span><span class="lineNoCov">          0 :                 data-&gt;latency_for_non_mcifwr_clients = bw_add(vbios-&gt;mcifwrmc_urgent_latency, dceip-&gt;mcifwr_all_surfaces_burst_time);</span></a>
<a name="1987"><span class="lineNum">    1987 </span>            :         }</a>
<a name="1988"><span class="lineNum">    1988 </span>            :         else {</a>
<a name="1989"><span class="lineNum">    1989 </span><span class="lineNoCov">          0 :                 data-&gt;latency_for_non_mcifwr_clients = bw_int_to_fixed(0);</span></a>
<a name="1990"><span class="lineNum">    1990 </span>            :         }</a>
<a name="1991"><span class="lineNum">    1991 </span>            :         /*dmif mc urgent latency supported in high sclk and yclk*/</a>
<a name="1992"><span class="lineNum">    1992 </span><span class="lineNoCov">          0 :         data-&gt;dmifmc_urgent_latency_supported_in_high_sclk_and_yclk = bw_div((bw_sub(data-&gt;min_read_buffer_size_in_time, data-&gt;dmif_burst_time[high][s_high])), data-&gt;total_dmifmc_urgent_trips);</span></a>
<a name="1993"><span class="lineNum">    1993 </span>            :         /*dram speed/p-state change margin*/</a>
<a name="1994"><span class="lineNum">    1994 </span>            :         /*in the multi-display case the nb p-state change watermark cannot exceed the average lb size plus the dmif size or the cursor dcp buffer size*/</a>
<a name="1995"><span class="lineNum">    1995 </span><span class="lineNoCov">          0 :         data-&gt;v_blank_nbp_state_dram_speed_change_latency_supported = bw_int_to_fixed(99999);</span></a>
<a name="1996"><span class="lineNum">    1996 </span><span class="lineNoCov">          0 :         data-&gt;nbp_state_dram_speed_change_latency_supported = bw_int_to_fixed(99999);</span></a>
<a name="1997"><span class="lineNum">    1997 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt;= maximum_number_of_surfaces - 1; i++) {</span></a>
<a name="1998"><span class="lineNum">    1998 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[i]) {</span></a>
<a name="1999"><span class="lineNum">    1999 </span><span class="lineNoCov">          0 :                         data-&gt;nbp_state_dram_speed_change_latency_supported = bw_min2(data-&gt;nbp_state_dram_speed_change_latency_supported, bw_add(bw_sub(data-&gt;maximum_latency_hiding_with_cursor[i], data-&gt;nbp_state_change_watermark[i]), vbios-&gt;nbp_state_change_latency));</span></a>
<a name="2000"><span class="lineNum">    2000 </span><span class="lineNoCov">          0 :                         data-&gt;v_blank_nbp_state_dram_speed_change_latency_supported = bw_min2(data-&gt;v_blank_nbp_state_dram_speed_change_latency_supported, bw_add(bw_sub(bw_div(bw_mul((bw_sub(data-&gt;v_total[i], bw_sub(bw_div(data-&gt;src_height[i], data-&gt;v_scale_ratio[i]), bw_int_to_fixed(4)))), data-&gt;h_total[i]), data-&gt;pixel_rate[i]), data-&gt;nbp_state_change_watermark[i]), vbios-&gt;nbp_state_change_latency));</span></a>
<a name="2001"><span class="lineNum">    2001 </span>            :                 }</a>
<a name="2002"><span class="lineNum">    2002 </span>            :         }</a>
<a name="2003"><span class="lineNum">    2003 </span>            :         /*sclk required vs urgent latency*/</a>
<a name="2004"><span class="lineNum">    2004 </span><span class="lineNoCov">          0 :         for (i = 1; i &lt;= 5; i++) {</span></a>
<a name="2005"><span class="lineNum">    2005 </span><span class="lineNoCov">          0 :                 data-&gt;display_reads_time_for_data_transfer_and_urgent_latency = bw_sub(data-&gt;min_read_buffer_size_in_time, bw_mul(data-&gt;total_dmifmc_urgent_trips, bw_int_to_fixed(i)));</span></a>
<a name="2006"><span class="lineNum">    2006 </span><span class="lineNoCov">          0 :                 if (pipe_check == bw_def_ok &amp;&amp; (bw_mtn(data-&gt;display_reads_time_for_data_transfer_and_urgent_latency, data-&gt;dmif_total_page_close_open_time))) {</span></a>
<a name="2007"><span class="lineNum">    2007 </span><span class="lineNoCov">          0 :                         data-&gt;dmif_required_sclk_for_urgent_latency[i] = bw_div(bw_div(data-&gt;total_display_reads_required_data, data-&gt;display_reads_time_for_data_transfer_and_urgent_latency), (bw_mul(vbios-&gt;data_return_bus_width, bw_frc_to_fixed(dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency, 100))));</span></a>
<a name="2008"><span class="lineNum">    2008 </span>            :                 }</a>
<a name="2009"><span class="lineNum">    2009 </span>            :                 else {</a>
<a name="2010"><span class="lineNum">    2010 </span><span class="lineNoCov">          0 :                         data-&gt;dmif_required_sclk_for_urgent_latency[i] = bw_int_to_fixed(bw_def_na);</span></a>
<a name="2011"><span class="lineNum">    2011 </span>            :                 }</a>
<a name="2012"><span class="lineNum">    2012 </span>            :         }</a>
<a name="2013"><span class="lineNum">    2013 </span>            :         /*output link bit per pixel supported*/</a>
<a name="2014"><span class="lineNum">    2014 </span><span class="lineNoCov">          0 :         for (k = 0; k &lt;= maximum_number_of_surfaces - 1; k++) {</span></a>
<a name="2015"><span class="lineNum">    2015 </span><span class="lineNoCov">          0 :                 data-&gt;output_bpphdmi[k] = bw_def_na;</span></a>
<a name="2016"><span class="lineNum">    2016 </span><span class="lineNoCov">          0 :                 data-&gt;output_bppdp4_lane_hbr[k] = bw_def_na;</span></a>
<a name="2017"><span class="lineNum">    2017 </span><span class="lineNoCov">          0 :                 data-&gt;output_bppdp4_lane_hbr2[k] = bw_def_na;</span></a>
<a name="2018"><span class="lineNum">    2018 </span><span class="lineNoCov">          0 :                 data-&gt;output_bppdp4_lane_hbr3[k] = bw_def_na;</span></a>
<a name="2019"><span class="lineNum">    2019 </span><span class="lineNoCov">          0 :                 if (data-&gt;enable[k]) {</span></a>
<a name="2020"><span class="lineNum">    2020 </span><span class="lineNoCov">          0 :                         data-&gt;output_bpphdmi[k] = bw_fixed_to_int(bw_mul(bw_div(bw_min2(bw_int_to_fixed(600), data-&gt;max_phyclk), data-&gt;pixel_rate[k]), bw_int_to_fixed(24)));</span></a>
<a name="2021"><span class="lineNum">    2021 </span><span class="lineNoCov">          0 :                         if (bw_meq(data-&gt;max_phyclk, bw_int_to_fixed(270))) {</span></a>
<a name="2022"><span class="lineNum">    2022 </span><span class="lineNoCov">          0 :                                 data-&gt;output_bppdp4_lane_hbr[k] = bw_fixed_to_int(bw_mul(bw_div(bw_mul(bw_int_to_fixed(270), bw_int_to_fixed(4)), data-&gt;pixel_rate[k]), bw_int_to_fixed(8)));</span></a>
<a name="2023"><span class="lineNum">    2023 </span>            :                         }</a>
<a name="2024"><span class="lineNum">    2024 </span><span class="lineNoCov">          0 :                         if (bw_meq(data-&gt;max_phyclk, bw_int_to_fixed(540))) {</span></a>
<a name="2025"><span class="lineNum">    2025 </span><span class="lineNoCov">          0 :                                 data-&gt;output_bppdp4_lane_hbr2[k] = bw_fixed_to_int(bw_mul(bw_div(bw_mul(bw_int_to_fixed(540), bw_int_to_fixed(4)), data-&gt;pixel_rate[k]), bw_int_to_fixed(8)));</span></a>
<a name="2026"><span class="lineNum">    2026 </span>            :                         }</a>
<a name="2027"><span class="lineNum">    2027 </span><span class="lineNoCov">          0 :                         if (bw_meq(data-&gt;max_phyclk, bw_int_to_fixed(810))) {</span></a>
<a name="2028"><span class="lineNum">    2028 </span><span class="lineNoCov">          0 :                                 data-&gt;output_bppdp4_lane_hbr3[k] = bw_fixed_to_int(bw_mul(bw_div(bw_mul(bw_int_to_fixed(810), bw_int_to_fixed(4)), data-&gt;pixel_rate[k]), bw_int_to_fixed(8)));</span></a>
<a name="2029"><span class="lineNum">    2029 </span>            :                         }</a>
<a name="2030"><span class="lineNum">    2030 </span>            :                 }</a>
<a name="2031"><span class="lineNum">    2031 </span>            :         }</a>
<a name="2032"><span class="lineNum">    2032 </span>            : </a>
<a name="2033"><span class="lineNum">    2033 </span><span class="lineNoCov">          0 :         kfree(surface_type);</span></a>
<a name="2034"><span class="lineNum">    2034 </span>            : free_tiling_mode:</a>
<a name="2035"><span class="lineNum">    2035 </span><span class="lineNoCov">          0 :         kfree(tiling_mode);</span></a>
<a name="2036"><span class="lineNum">    2036 </span>            : free_sclk:</a>
<a name="2037"><span class="lineNum">    2037 </span><span class="lineNoCov">          0 :         kfree(sclk);</span></a>
<a name="2038"><span class="lineNum">    2038 </span>            : free_yclk:</a>
<a name="2039"><span class="lineNum">    2039 </span><span class="lineNoCov">          0 :         kfree(yclk);</span></a>
<a name="2040"><span class="lineNum">    2040 </span>            : }</a>
<a name="2041"><span class="lineNum">    2041 </span>            : </a>
<a name="2042"><span class="lineNum">    2042 </span>            : /*******************************************************************************</a>
<a name="2043"><span class="lineNum">    2043 </span>            :  * Public functions</a>
<a name="2044"><span class="lineNum">    2044 </span>            :  ******************************************************************************/</a>
<a name="2045"><span class="lineNum">    2045 </span><span class="lineNoCov">          0 : void bw_calcs_init(struct bw_calcs_dceip *bw_dceip,</span></a>
<a name="2046"><span class="lineNum">    2046 </span>            :         struct bw_calcs_vbios *bw_vbios,</a>
<a name="2047"><span class="lineNum">    2047 </span>            :         struct hw_asic_id asic_id)</a>
<a name="2048"><span class="lineNum">    2048 </span>            : {</a>
<a name="2049"><span class="lineNum">    2049 </span>            :         struct bw_calcs_dceip *dceip;</a>
<a name="2050"><span class="lineNum">    2050 </span>            :         struct bw_calcs_vbios *vbios;</a>
<a name="2051"><span class="lineNum">    2051 </span>            : </a>
<a name="2052"><span class="lineNum">    2052 </span><span class="lineNoCov">          0 :         enum bw_calcs_version version = bw_calcs_version_from_asic_id(asic_id);</span></a>
<a name="2053"><span class="lineNum">    2053 </span>            : </a>
<a name="2054"><span class="lineNum">    2054 </span><span class="lineNoCov">          0 :         dceip = kzalloc(sizeof(*dceip), GFP_KERNEL);</span></a>
<a name="2055"><span class="lineNum">    2055 </span><span class="lineNoCov">          0 :         if (!dceip)</span></a>
<a name="2056"><span class="lineNum">    2056 </span>            :                 return;</a>
<a name="2057"><span class="lineNum">    2057 </span>            : </a>
<a name="2058"><span class="lineNum">    2058 </span><span class="lineNoCov">          0 :         vbios = kzalloc(sizeof(*vbios), GFP_KERNEL);</span></a>
<a name="2059"><span class="lineNum">    2059 </span><span class="lineNoCov">          0 :         if (!vbios) {</span></a>
<a name="2060"><span class="lineNum">    2060 </span><span class="lineNoCov">          0 :                 kfree(dceip);</span></a>
<a name="2061"><span class="lineNum">    2061 </span><span class="lineNoCov">          0 :                 return;</span></a>
<a name="2062"><span class="lineNum">    2062 </span>            :         }</a>
<a name="2063"><span class="lineNum">    2063 </span>            : </a>
<a name="2064"><span class="lineNum">    2064 </span><span class="lineNoCov">          0 :         dceip-&gt;version = version;</span></a>
<a name="2065"><span class="lineNum">    2065 </span>            : </a>
<a name="2066"><span class="lineNum">    2066 </span><span class="lineNoCov">          0 :         switch (version) {</span></a>
<a name="2067"><span class="lineNum">    2067 </span>            :         case BW_CALCS_VERSION_CARRIZO:</a>
<a name="2068"><span class="lineNum">    2068 </span><span class="lineNoCov">          0 :                 vbios-&gt;memory_type = bw_def_gddr5;</span></a>
<a name="2069"><span class="lineNum">    2069 </span><span class="lineNoCov">          0 :                 vbios-&gt;dram_channel_width_in_bits = 64;</span></a>
<a name="2070"><span class="lineNum">    2070 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_channels = asic_id.vram_width / vbios-&gt;dram_channel_width_in_bits;</span></a>
<a name="2071"><span class="lineNum">    2071 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_banks = 8;</span></a>
<a name="2072"><span class="lineNum">    2072 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_yclk = bw_int_to_fixed(1600);</span></a>
<a name="2073"><span class="lineNum">    2073 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_yclk = bw_int_to_fixed(1600);</span></a>
<a name="2074"><span class="lineNum">    2074 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_yclk = bw_frc_to_fixed(66666, 100);</span></a>
<a name="2075"><span class="lineNum">    2075 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_sclk = bw_int_to_fixed(200);</span></a>
<a name="2076"><span class="lineNum">    2076 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid1_sclk = bw_int_to_fixed(300);</span></a>
<a name="2077"><span class="lineNum">    2077 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid2_sclk = bw_int_to_fixed(300);</span></a>
<a name="2078"><span class="lineNum">    2078 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid3_sclk = bw_int_to_fixed(300);</span></a>
<a name="2079"><span class="lineNum">    2079 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid4_sclk = bw_int_to_fixed(300);</span></a>
<a name="2080"><span class="lineNum">    2080 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid5_sclk = bw_int_to_fixed(300);</span></a>
<a name="2081"><span class="lineNum">    2081 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid6_sclk = bw_int_to_fixed(300);</span></a>
<a name="2082"><span class="lineNum">    2082 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_sclk = bw_frc_to_fixed(62609, 100);</span></a>
<a name="2083"><span class="lineNum">    2083 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_dispclk = bw_int_to_fixed(352);</span></a>
<a name="2084"><span class="lineNum">    2084 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_dispclk = bw_int_to_fixed(467);</span></a>
<a name="2085"><span class="lineNum">    2085 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_dispclk = bw_int_to_fixed(643);</span></a>
<a name="2086"><span class="lineNum">    2086 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_phyclk = bw_int_to_fixed(540);</span></a>
<a name="2087"><span class="lineNum">    2087 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2088"><span class="lineNum">    2088 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2089"><span class="lineNum">    2089 </span><span class="lineNoCov">          0 :                 vbios-&gt;data_return_bus_width = bw_int_to_fixed(32);</span></a>
<a name="2090"><span class="lineNum">    2090 </span><span class="lineNoCov">          0 :                 vbios-&gt;trc = bw_int_to_fixed(50);</span></a>
<a name="2091"><span class="lineNum">    2091 </span><span class="lineNoCov">          0 :                 vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(4);</span></a>
<a name="2092"><span class="lineNum">    2092 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_exit_latency = bw_frc_to_fixed(153, 10);</span></a>
<a name="2093"><span class="lineNum">    2093 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_entry_latency = bw_int_to_fixed(0);</span></a>
<a name="2094"><span class="lineNum">    2094 </span><span class="lineNoCov">          0 :                 vbios-&gt;nbp_state_change_latency = bw_frc_to_fixed(19649, 1000);</span></a>
<a name="2095"><span class="lineNum">    2095 </span><span class="lineNoCov">          0 :                 vbios-&gt;mcifwrmc_urgent_latency = bw_int_to_fixed(10);</span></a>
<a name="2096"><span class="lineNum">    2096 </span><span class="lineNoCov">          0 :                 vbios-&gt;scatter_gather_enable = true;</span></a>
<a name="2097"><span class="lineNum">    2097 </span><span class="lineNoCov">          0 :                 vbios-&gt;down_spread_percentage = bw_frc_to_fixed(5, 10);</span></a>
<a name="2098"><span class="lineNum">    2098 </span><span class="lineNoCov">          0 :                 vbios-&gt;cursor_width = 32;</span></a>
<a name="2099"><span class="lineNum">    2099 </span><span class="lineNoCov">          0 :                 vbios-&gt;average_compression_rate = 4;</span></a>
<a name="2100"><span class="lineNum">    2100 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_request_slots_gmc_reserves_for_dmif_per_channel = 256;</span></a>
<a name="2101"><span class="lineNum">    2101 </span><span class="lineNoCov">          0 :                 vbios-&gt;blackout_duration = bw_int_to_fixed(0); /* us */</span></a>
<a name="2102"><span class="lineNum">    2102 </span><span class="lineNoCov">          0 :                 vbios-&gt;maximum_blackout_recovery_time = bw_int_to_fixed(0);</span></a>
<a name="2103"><span class="lineNum">    2103 </span>            : </a>
<a name="2104"><span class="lineNum">    2104 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2105"><span class="lineNum">    2105 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2106"><span class="lineNum">    2106 </span><span class="lineNoCov">          0 :                 dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency = 100;</span></a>
<a name="2107"><span class="lineNum">    2107 </span><span class="lineNoCov">          0 :                 dceip-&gt;large_cursor = false;</span></a>
<a name="2108"><span class="lineNum">    2108 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_request_buffer_size = bw_int_to_fixed(768);</span></a>
<a name="2109"><span class="lineNum">    2109 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_pipe_en_fbc_chunk_tracker = false;</span></a>
<a name="2110"><span class="lineNum">    2110 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_max_outstanding_group_num = 1;</span></a>
<a name="2111"><span class="lineNum">    2111 </span><span class="lineNoCov">          0 :                 dceip-&gt;lines_interleaved_into_lb = 2;</span></a>
<a name="2112"><span class="lineNum">    2112 </span><span class="lineNoCov">          0 :                 dceip-&gt;chunk_width = 256;</span></a>
<a name="2113"><span class="lineNum">    2113 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_graphics_pipes = 3;</span></a>
<a name="2114"><span class="lineNum">    2114 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_underlay_pipes = 1;</span></a>
<a name="2115"><span class="lineNum">    2115 </span><span class="lineNoCov">          0 :                 dceip-&gt;low_power_tiling_mode = 0;</span></a>
<a name="2116"><span class="lineNum">    2116 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back_supported = false;</span></a>
<a name="2117"><span class="lineNum">    2117 </span><span class="lineNoCov">          0 :                 dceip-&gt;argb_compression_support = false;</span></a>
<a name="2118"><span class="lineNum">    2118 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2119"><span class="lineNum">    2119 </span>            :                         bw_frc_to_fixed(35556, 10000);</a>
<a name="2120"><span class="lineNum">    2120 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2121"><span class="lineNum">    2121 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2122"><span class="lineNum">    2122 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2123"><span class="lineNum">    2123 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2124"><span class="lineNum">    2124 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2125"><span class="lineNum">    2125 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2126"><span class="lineNum">    2126 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2127"><span class="lineNum">    2127 </span>            :                         bw_frc_to_fixed(35, 10);</a>
<a name="2128"><span class="lineNum">    2128 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2129"><span class="lineNum">    2129 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2130"><span class="lineNum">    2130 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2131"><span class="lineNum">    2131 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2132"><span class="lineNum">    2132 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2133"><span class="lineNum">    2133 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2134"><span class="lineNum">    2134 </span><span class="lineNoCov">          0 :                 dceip-&gt;alpha_vscaler_efficiency = bw_int_to_fixed(3);</span></a>
<a name="2135"><span class="lineNum">    2135 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_dmif_buffer_allocated = 2;</span></a>
<a name="2136"><span class="lineNum">    2136 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_dmif_size = 12288;</span></a>
<a name="2137"><span class="lineNum">    2137 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_luma_dmif_size = 19456;</span></a>
<a name="2138"><span class="lineNum">    2138 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_chroma_dmif_size = 23552;</span></a>
<a name="2139"><span class="lineNum">    2139 </span><span class="lineNoCov">          0 :                 dceip-&gt;pre_downscaler_enabled = true;</span></a>
<a name="2140"><span class="lineNum">    2140 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_downscale_prefetch_enabled = true;</span></a>
<a name="2141"><span class="lineNum">    2141 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_write_pixels_per_dispclk = bw_int_to_fixed(1);</span></a>
<a name="2142"><span class="lineNum">    2142 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_size_per_component444 = bw_int_to_fixed(82176);</span></a>
<a name="2143"><span class="lineNum">    2143 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching = false;</span></a>
<a name="2144"><span class="lineNum">    2144 </span><span class="lineNoCov">          0 :                 dceip-&gt;stutter_and_dram_clock_state_change_gated_before_cursor =</span></a>
<a name="2145"><span class="lineNum">    2145 </span>            :                         bw_int_to_fixed(0);</a>
<a name="2146"><span class="lineNum">    2146 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_luma_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2147"><span class="lineNum">    2147 </span>            :                         82176);</a>
<a name="2148"><span class="lineNum">    2148 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_chroma_lb_size_per_component =</span></a>
<a name="2149"><span class="lineNum">    2149 </span>            :                         bw_int_to_fixed(164352);</a>
<a name="2150"><span class="lineNum">    2150 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay422_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2151"><span class="lineNum">    2151 </span>            :                         82176);</a>
<a name="2152"><span class="lineNum">    2152 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_chunk_width = bw_int_to_fixed(64);</span></a>
<a name="2153"><span class="lineNum">    2153 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_dcp_buffer_lines = bw_int_to_fixed(4);</span></a>
<a name="2154"><span class="lineNum">    2154 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_width_efficient_for_tiling =</span></a>
<a name="2155"><span class="lineNum">    2155 </span>            :                         bw_int_to_fixed(1920);</a>
<a name="2156"><span class="lineNum">    2156 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_height_efficient_for_tiling =</span></a>
<a name="2157"><span class="lineNum">    2157 </span>            :                         bw_int_to_fixed(1080);</a>
<a name="2158"><span class="lineNum">    2158 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_multiple_displays_or_single_rotated_display =</span></a>
<a name="2159"><span class="lineNum">    2159 </span>            :                         bw_frc_to_fixed(3, 10);</a>
<a name="2160"><span class="lineNum">    2160 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_single_display_no_rotation =</span></a>
<a name="2161"><span class="lineNum">    2161 </span>            :                         bw_int_to_fixed(25);</a>
<a name="2162"><span class="lineNum">    2162 </span><span class="lineNoCov">          0 :                 dceip-&gt;minimum_outstanding_pte_request_limit = bw_int_to_fixed(</span></a>
<a name="2163"><span class="lineNum">    2163 </span>            :                         2);</a>
<a name="2164"><span class="lineNum">    2164 </span><span class="lineNoCov">          0 :                 dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw =</span></a>
<a name="2165"><span class="lineNum">    2165 </span>            :                         bw_int_to_fixed(128);</a>
<a name="2166"><span class="lineNum">    2166 </span><span class="lineNoCov">          0 :                 dceip-&gt;limit_excessive_outstanding_dmif_requests = true;</span></a>
<a name="2167"><span class="lineNum">    2167 </span><span class="lineNoCov">          0 :                 dceip-&gt;linear_mode_line_request_alternation_slice =</span></a>
<a name="2168"><span class="lineNum">    2168 </span>            :                         bw_int_to_fixed(64);</a>
<a name="2169"><span class="lineNum">    2169 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_lines_of_pte_prefetching_in_linear_mode =</span></a>
<a name="2170"><span class="lineNum">    2170 </span>            :                         32;</a>
<a name="2171"><span class="lineNum">    2171 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_luma_mcifwr_buffer_size = 12288;</span></a>
<a name="2172"><span class="lineNum">    2172 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_chroma_mcifwr_buffer_size = 8192;</span></a>
<a name="2173"><span class="lineNum">    2173 </span><span class="lineNoCov">          0 :                 dceip-&gt;request_efficiency = bw_frc_to_fixed(8, 10);</span></a>
<a name="2174"><span class="lineNum">    2174 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_per_request = bw_int_to_fixed(2);</span></a>
<a name="2175"><span class="lineNum">    2175 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_ramping_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2176"><span class="lineNum">    2176 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_pipe_throughput_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2177"><span class="lineNum">    2177 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode = 2;</span></a>
<a name="2178"><span class="lineNum">    2178 </span><span class="lineNoCov">          0 :                 dceip-&gt;mcifwr_all_surfaces_burst_time = bw_int_to_fixed(0); /* todo: this is a bug*/</span></a>
<a name="2179"><span class="lineNum">    2179 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="2180"><span class="lineNum">    2180 </span>            :         case BW_CALCS_VERSION_POLARIS10:</a>
<a name="2181"><span class="lineNum">    2181 </span>            :                 /* TODO: Treat VEGAM the same as P10 for now</a>
<a name="2182"><span class="lineNum">    2182 </span>            :                  * Need to tune the para for VEGAM if needed */</a>
<a name="2183"><span class="lineNum">    2183 </span>            :         case BW_CALCS_VERSION_VEGAM:</a>
<a name="2184"><span class="lineNum">    2184 </span><span class="lineNoCov">          0 :                 vbios-&gt;memory_type = bw_def_gddr5;</span></a>
<a name="2185"><span class="lineNum">    2185 </span><span class="lineNoCov">          0 :                 vbios-&gt;dram_channel_width_in_bits = 32;</span></a>
<a name="2186"><span class="lineNum">    2186 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_channels = asic_id.vram_width / vbios-&gt;dram_channel_width_in_bits;</span></a>
<a name="2187"><span class="lineNum">    2187 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_banks = 8;</span></a>
<a name="2188"><span class="lineNum">    2188 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_yclk = bw_int_to_fixed(6000);</span></a>
<a name="2189"><span class="lineNum">    2189 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_yclk = bw_int_to_fixed(3200);</span></a>
<a name="2190"><span class="lineNum">    2190 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_yclk = bw_int_to_fixed(1000);</span></a>
<a name="2191"><span class="lineNum">    2191 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_sclk = bw_int_to_fixed(300);</span></a>
<a name="2192"><span class="lineNum">    2192 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid1_sclk = bw_int_to_fixed(400);</span></a>
<a name="2193"><span class="lineNum">    2193 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid2_sclk = bw_int_to_fixed(500);</span></a>
<a name="2194"><span class="lineNum">    2194 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid3_sclk = bw_int_to_fixed(600);</span></a>
<a name="2195"><span class="lineNum">    2195 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid4_sclk = bw_int_to_fixed(700);</span></a>
<a name="2196"><span class="lineNum">    2196 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid5_sclk = bw_int_to_fixed(800);</span></a>
<a name="2197"><span class="lineNum">    2197 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid6_sclk = bw_int_to_fixed(974);</span></a>
<a name="2198"><span class="lineNum">    2198 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_sclk = bw_int_to_fixed(1154);</span></a>
<a name="2199"><span class="lineNum">    2199 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_dispclk = bw_int_to_fixed(459);</span></a>
<a name="2200"><span class="lineNum">    2200 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_dispclk = bw_int_to_fixed(654);</span></a>
<a name="2201"><span class="lineNum">    2201 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_dispclk = bw_int_to_fixed(1108);</span></a>
<a name="2202"><span class="lineNum">    2202 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_phyclk = bw_int_to_fixed(540);</span></a>
<a name="2203"><span class="lineNum">    2203 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2204"><span class="lineNum">    2204 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2205"><span class="lineNum">    2205 </span><span class="lineNoCov">          0 :                 vbios-&gt;data_return_bus_width = bw_int_to_fixed(32);</span></a>
<a name="2206"><span class="lineNum">    2206 </span><span class="lineNoCov">          0 :                 vbios-&gt;trc = bw_int_to_fixed(48);</span></a>
<a name="2207"><span class="lineNum">    2207 </span><span class="lineNoCov">          0 :                 vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(3);</span></a>
<a name="2208"><span class="lineNum">    2208 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_exit_latency = bw_int_to_fixed(5);</span></a>
<a name="2209"><span class="lineNum">    2209 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_entry_latency = bw_int_to_fixed(0);</span></a>
<a name="2210"><span class="lineNum">    2210 </span><span class="lineNoCov">          0 :                 vbios-&gt;nbp_state_change_latency = bw_int_to_fixed(45);</span></a>
<a name="2211"><span class="lineNum">    2211 </span><span class="lineNoCov">          0 :                 vbios-&gt;mcifwrmc_urgent_latency = bw_int_to_fixed(10);</span></a>
<a name="2212"><span class="lineNum">    2212 </span><span class="lineNoCov">          0 :                 vbios-&gt;scatter_gather_enable = true;</span></a>
<a name="2213"><span class="lineNum">    2213 </span><span class="lineNoCov">          0 :                 vbios-&gt;down_spread_percentage = bw_frc_to_fixed(5, 10);</span></a>
<a name="2214"><span class="lineNum">    2214 </span><span class="lineNoCov">          0 :                 vbios-&gt;cursor_width = 32;</span></a>
<a name="2215"><span class="lineNum">    2215 </span><span class="lineNoCov">          0 :                 vbios-&gt;average_compression_rate = 4;</span></a>
<a name="2216"><span class="lineNum">    2216 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_request_slots_gmc_reserves_for_dmif_per_channel = 256;</span></a>
<a name="2217"><span class="lineNum">    2217 </span><span class="lineNoCov">          0 :                 vbios-&gt;blackout_duration = bw_int_to_fixed(0); /* us */</span></a>
<a name="2218"><span class="lineNum">    2218 </span><span class="lineNoCov">          0 :                 vbios-&gt;maximum_blackout_recovery_time = bw_int_to_fixed(0);</span></a>
<a name="2219"><span class="lineNum">    2219 </span>            : </a>
<a name="2220"><span class="lineNum">    2220 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2221"><span class="lineNum">    2221 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2222"><span class="lineNum">    2222 </span><span class="lineNoCov">          0 :                 dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency = 100;</span></a>
<a name="2223"><span class="lineNum">    2223 </span><span class="lineNoCov">          0 :                 dceip-&gt;large_cursor = false;</span></a>
<a name="2224"><span class="lineNum">    2224 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_request_buffer_size = bw_int_to_fixed(768);</span></a>
<a name="2225"><span class="lineNum">    2225 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_pipe_en_fbc_chunk_tracker = false;</span></a>
<a name="2226"><span class="lineNum">    2226 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_max_outstanding_group_num = 1;</span></a>
<a name="2227"><span class="lineNum">    2227 </span><span class="lineNoCov">          0 :                 dceip-&gt;lines_interleaved_into_lb = 2;</span></a>
<a name="2228"><span class="lineNum">    2228 </span><span class="lineNoCov">          0 :                 dceip-&gt;chunk_width = 256;</span></a>
<a name="2229"><span class="lineNum">    2229 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_graphics_pipes = 6;</span></a>
<a name="2230"><span class="lineNum">    2230 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_underlay_pipes = 0;</span></a>
<a name="2231"><span class="lineNum">    2231 </span><span class="lineNoCov">          0 :                 dceip-&gt;low_power_tiling_mode = 0;</span></a>
<a name="2232"><span class="lineNum">    2232 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back_supported = false;</span></a>
<a name="2233"><span class="lineNum">    2233 </span><span class="lineNoCov">          0 :                 dceip-&gt;argb_compression_support = true;</span></a>
<a name="2234"><span class="lineNum">    2234 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2235"><span class="lineNum">    2235 </span>            :                         bw_frc_to_fixed(35556, 10000);</a>
<a name="2236"><span class="lineNum">    2236 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2237"><span class="lineNum">    2237 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2238"><span class="lineNum">    2238 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2239"><span class="lineNum">    2239 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2240"><span class="lineNum">    2240 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2241"><span class="lineNum">    2241 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2242"><span class="lineNum">    2242 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2243"><span class="lineNum">    2243 </span>            :                         bw_frc_to_fixed(35, 10);</a>
<a name="2244"><span class="lineNum">    2244 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2245"><span class="lineNum">    2245 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2246"><span class="lineNum">    2246 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2247"><span class="lineNum">    2247 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2248"><span class="lineNum">    2248 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2249"><span class="lineNum">    2249 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2250"><span class="lineNum">    2250 </span><span class="lineNoCov">          0 :                 dceip-&gt;alpha_vscaler_efficiency = bw_int_to_fixed(3);</span></a>
<a name="2251"><span class="lineNum">    2251 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_dmif_buffer_allocated = 4;</span></a>
<a name="2252"><span class="lineNum">    2252 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_dmif_size = 12288;</span></a>
<a name="2253"><span class="lineNum">    2253 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_luma_dmif_size = 19456;</span></a>
<a name="2254"><span class="lineNum">    2254 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_chroma_dmif_size = 23552;</span></a>
<a name="2255"><span class="lineNum">    2255 </span><span class="lineNoCov">          0 :                 dceip-&gt;pre_downscaler_enabled = true;</span></a>
<a name="2256"><span class="lineNum">    2256 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_downscale_prefetch_enabled = true;</span></a>
<a name="2257"><span class="lineNum">    2257 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_write_pixels_per_dispclk = bw_int_to_fixed(1);</span></a>
<a name="2258"><span class="lineNum">    2258 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_size_per_component444 = bw_int_to_fixed(245952);</span></a>
<a name="2259"><span class="lineNum">    2259 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching = true;</span></a>
<a name="2260"><span class="lineNum">    2260 </span><span class="lineNoCov">          0 :                 dceip-&gt;stutter_and_dram_clock_state_change_gated_before_cursor =</span></a>
<a name="2261"><span class="lineNum">    2261 </span>            :                         bw_int_to_fixed(1);</a>
<a name="2262"><span class="lineNum">    2262 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_luma_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2263"><span class="lineNum">    2263 </span>            :                         82176);</a>
<a name="2264"><span class="lineNum">    2264 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_chroma_lb_size_per_component =</span></a>
<a name="2265"><span class="lineNum">    2265 </span>            :                         bw_int_to_fixed(164352);</a>
<a name="2266"><span class="lineNum">    2266 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay422_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2267"><span class="lineNum">    2267 </span>            :                         82176);</a>
<a name="2268"><span class="lineNum">    2268 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_chunk_width = bw_int_to_fixed(64);</span></a>
<a name="2269"><span class="lineNum">    2269 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_dcp_buffer_lines = bw_int_to_fixed(4);</span></a>
<a name="2270"><span class="lineNum">    2270 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_width_efficient_for_tiling =</span></a>
<a name="2271"><span class="lineNum">    2271 </span>            :                         bw_int_to_fixed(1920);</a>
<a name="2272"><span class="lineNum">    2272 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_height_efficient_for_tiling =</span></a>
<a name="2273"><span class="lineNum">    2273 </span>            :                         bw_int_to_fixed(1080);</a>
<a name="2274"><span class="lineNum">    2274 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_multiple_displays_or_single_rotated_display =</span></a>
<a name="2275"><span class="lineNum">    2275 </span>            :                         bw_frc_to_fixed(3, 10);</a>
<a name="2276"><span class="lineNum">    2276 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_single_display_no_rotation =</span></a>
<a name="2277"><span class="lineNum">    2277 </span>            :                         bw_int_to_fixed(25);</a>
<a name="2278"><span class="lineNum">    2278 </span><span class="lineNoCov">          0 :                 dceip-&gt;minimum_outstanding_pte_request_limit = bw_int_to_fixed(</span></a>
<a name="2279"><span class="lineNum">    2279 </span>            :                         2);</a>
<a name="2280"><span class="lineNum">    2280 </span><span class="lineNoCov">          0 :                 dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw =</span></a>
<a name="2281"><span class="lineNum">    2281 </span>            :                         bw_int_to_fixed(128);</a>
<a name="2282"><span class="lineNum">    2282 </span><span class="lineNoCov">          0 :                 dceip-&gt;limit_excessive_outstanding_dmif_requests = true;</span></a>
<a name="2283"><span class="lineNum">    2283 </span><span class="lineNoCov">          0 :                 dceip-&gt;linear_mode_line_request_alternation_slice =</span></a>
<a name="2284"><span class="lineNum">    2284 </span>            :                         bw_int_to_fixed(64);</a>
<a name="2285"><span class="lineNum">    2285 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_lines_of_pte_prefetching_in_linear_mode =</span></a>
<a name="2286"><span class="lineNum">    2286 </span>            :                         32;</a>
<a name="2287"><span class="lineNum">    2287 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_luma_mcifwr_buffer_size = 12288;</span></a>
<a name="2288"><span class="lineNum">    2288 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_chroma_mcifwr_buffer_size = 8192;</span></a>
<a name="2289"><span class="lineNum">    2289 </span><span class="lineNoCov">          0 :                 dceip-&gt;request_efficiency = bw_frc_to_fixed(8, 10);</span></a>
<a name="2290"><span class="lineNum">    2290 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_per_request = bw_int_to_fixed(2);</span></a>
<a name="2291"><span class="lineNum">    2291 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_ramping_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2292"><span class="lineNum">    2292 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_pipe_throughput_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2293"><span class="lineNum">    2293 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode = 2;</span></a>
<a name="2294"><span class="lineNum">    2294 </span><span class="lineNoCov">          0 :                 dceip-&gt;mcifwr_all_surfaces_burst_time = bw_int_to_fixed(0);</span></a>
<a name="2295"><span class="lineNum">    2295 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="2296"><span class="lineNum">    2296 </span>            :         case BW_CALCS_VERSION_POLARIS11:</a>
<a name="2297"><span class="lineNum">    2297 </span><span class="lineNoCov">          0 :                 vbios-&gt;memory_type = bw_def_gddr5;</span></a>
<a name="2298"><span class="lineNum">    2298 </span><span class="lineNoCov">          0 :                 vbios-&gt;dram_channel_width_in_bits = 32;</span></a>
<a name="2299"><span class="lineNum">    2299 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_channels = asic_id.vram_width / vbios-&gt;dram_channel_width_in_bits;</span></a>
<a name="2300"><span class="lineNum">    2300 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_banks = 8;</span></a>
<a name="2301"><span class="lineNum">    2301 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_yclk = bw_int_to_fixed(6000);</span></a>
<a name="2302"><span class="lineNum">    2302 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_yclk = bw_int_to_fixed(3200);</span></a>
<a name="2303"><span class="lineNum">    2303 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_yclk = bw_int_to_fixed(1000);</span></a>
<a name="2304"><span class="lineNum">    2304 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_sclk = bw_int_to_fixed(300);</span></a>
<a name="2305"><span class="lineNum">    2305 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid1_sclk = bw_int_to_fixed(400);</span></a>
<a name="2306"><span class="lineNum">    2306 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid2_sclk = bw_int_to_fixed(500);</span></a>
<a name="2307"><span class="lineNum">    2307 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid3_sclk = bw_int_to_fixed(600);</span></a>
<a name="2308"><span class="lineNum">    2308 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid4_sclk = bw_int_to_fixed(700);</span></a>
<a name="2309"><span class="lineNum">    2309 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid5_sclk = bw_int_to_fixed(800);</span></a>
<a name="2310"><span class="lineNum">    2310 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid6_sclk = bw_int_to_fixed(974);</span></a>
<a name="2311"><span class="lineNum">    2311 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_sclk = bw_int_to_fixed(1154);</span></a>
<a name="2312"><span class="lineNum">    2312 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_dispclk = bw_int_to_fixed(459);</span></a>
<a name="2313"><span class="lineNum">    2313 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_dispclk = bw_int_to_fixed(654);</span></a>
<a name="2314"><span class="lineNum">    2314 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_dispclk = bw_int_to_fixed(1108);</span></a>
<a name="2315"><span class="lineNum">    2315 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_phyclk = bw_int_to_fixed(540);</span></a>
<a name="2316"><span class="lineNum">    2316 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2317"><span class="lineNum">    2317 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2318"><span class="lineNum">    2318 </span><span class="lineNoCov">          0 :                 vbios-&gt;data_return_bus_width = bw_int_to_fixed(32);</span></a>
<a name="2319"><span class="lineNum">    2319 </span><span class="lineNoCov">          0 :                 vbios-&gt;trc = bw_int_to_fixed(48);</span></a>
<a name="2320"><span class="lineNum">    2320 </span><span class="lineNoCov">          0 :                 if (vbios-&gt;number_of_dram_channels == 2) // 64-bit</span></a>
<a name="2321"><span class="lineNum">    2321 </span><span class="lineNoCov">          0 :                         vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(4);</span></a>
<a name="2322"><span class="lineNum">    2322 </span>            :                 else</a>
<a name="2323"><span class="lineNum">    2323 </span><span class="lineNoCov">          0 :                         vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(3);</span></a>
<a name="2324"><span class="lineNum">    2324 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_exit_latency = bw_int_to_fixed(5);</span></a>
<a name="2325"><span class="lineNum">    2325 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_entry_latency = bw_int_to_fixed(0);</span></a>
<a name="2326"><span class="lineNum">    2326 </span><span class="lineNoCov">          0 :                 vbios-&gt;nbp_state_change_latency = bw_int_to_fixed(45);</span></a>
<a name="2327"><span class="lineNum">    2327 </span><span class="lineNoCov">          0 :                 vbios-&gt;mcifwrmc_urgent_latency = bw_int_to_fixed(10);</span></a>
<a name="2328"><span class="lineNum">    2328 </span><span class="lineNoCov">          0 :                 vbios-&gt;scatter_gather_enable = true;</span></a>
<a name="2329"><span class="lineNum">    2329 </span><span class="lineNoCov">          0 :                 vbios-&gt;down_spread_percentage = bw_frc_to_fixed(5, 10);</span></a>
<a name="2330"><span class="lineNum">    2330 </span><span class="lineNoCov">          0 :                 vbios-&gt;cursor_width = 32;</span></a>
<a name="2331"><span class="lineNum">    2331 </span><span class="lineNoCov">          0 :                 vbios-&gt;average_compression_rate = 4;</span></a>
<a name="2332"><span class="lineNum">    2332 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_request_slots_gmc_reserves_for_dmif_per_channel = 256;</span></a>
<a name="2333"><span class="lineNum">    2333 </span><span class="lineNoCov">          0 :                 vbios-&gt;blackout_duration = bw_int_to_fixed(0); /* us */</span></a>
<a name="2334"><span class="lineNum">    2334 </span><span class="lineNoCov">          0 :                 vbios-&gt;maximum_blackout_recovery_time = bw_int_to_fixed(0);</span></a>
<a name="2335"><span class="lineNum">    2335 </span>            : </a>
<a name="2336"><span class="lineNum">    2336 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2337"><span class="lineNum">    2337 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2338"><span class="lineNum">    2338 </span><span class="lineNoCov">          0 :                 dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency = 100;</span></a>
<a name="2339"><span class="lineNum">    2339 </span><span class="lineNoCov">          0 :                 dceip-&gt;large_cursor = false;</span></a>
<a name="2340"><span class="lineNum">    2340 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_request_buffer_size = bw_int_to_fixed(768);</span></a>
<a name="2341"><span class="lineNum">    2341 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_pipe_en_fbc_chunk_tracker = false;</span></a>
<a name="2342"><span class="lineNum">    2342 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_max_outstanding_group_num = 1;</span></a>
<a name="2343"><span class="lineNum">    2343 </span><span class="lineNoCov">          0 :                 dceip-&gt;lines_interleaved_into_lb = 2;</span></a>
<a name="2344"><span class="lineNum">    2344 </span><span class="lineNoCov">          0 :                 dceip-&gt;chunk_width = 256;</span></a>
<a name="2345"><span class="lineNum">    2345 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_graphics_pipes = 5;</span></a>
<a name="2346"><span class="lineNum">    2346 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_underlay_pipes = 0;</span></a>
<a name="2347"><span class="lineNum">    2347 </span><span class="lineNoCov">          0 :                 dceip-&gt;low_power_tiling_mode = 0;</span></a>
<a name="2348"><span class="lineNum">    2348 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back_supported = false;</span></a>
<a name="2349"><span class="lineNum">    2349 </span><span class="lineNoCov">          0 :                 dceip-&gt;argb_compression_support = true;</span></a>
<a name="2350"><span class="lineNum">    2350 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2351"><span class="lineNum">    2351 </span>            :                         bw_frc_to_fixed(35556, 10000);</a>
<a name="2352"><span class="lineNum">    2352 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2353"><span class="lineNum">    2353 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2354"><span class="lineNum">    2354 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2355"><span class="lineNum">    2355 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2356"><span class="lineNum">    2356 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2357"><span class="lineNum">    2357 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2358"><span class="lineNum">    2358 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2359"><span class="lineNum">    2359 </span>            :                         bw_frc_to_fixed(35, 10);</a>
<a name="2360"><span class="lineNum">    2360 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2361"><span class="lineNum">    2361 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2362"><span class="lineNum">    2362 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2363"><span class="lineNum">    2363 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2364"><span class="lineNum">    2364 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2365"><span class="lineNum">    2365 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2366"><span class="lineNum">    2366 </span><span class="lineNoCov">          0 :                 dceip-&gt;alpha_vscaler_efficiency = bw_int_to_fixed(3);</span></a>
<a name="2367"><span class="lineNum">    2367 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_dmif_buffer_allocated = 4;</span></a>
<a name="2368"><span class="lineNum">    2368 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_dmif_size = 12288;</span></a>
<a name="2369"><span class="lineNum">    2369 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_luma_dmif_size = 19456;</span></a>
<a name="2370"><span class="lineNum">    2370 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_chroma_dmif_size = 23552;</span></a>
<a name="2371"><span class="lineNum">    2371 </span><span class="lineNoCov">          0 :                 dceip-&gt;pre_downscaler_enabled = true;</span></a>
<a name="2372"><span class="lineNum">    2372 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_downscale_prefetch_enabled = true;</span></a>
<a name="2373"><span class="lineNum">    2373 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_write_pixels_per_dispclk = bw_int_to_fixed(1);</span></a>
<a name="2374"><span class="lineNum">    2374 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_size_per_component444 = bw_int_to_fixed(245952);</span></a>
<a name="2375"><span class="lineNum">    2375 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching = true;</span></a>
<a name="2376"><span class="lineNum">    2376 </span><span class="lineNoCov">          0 :                 dceip-&gt;stutter_and_dram_clock_state_change_gated_before_cursor =</span></a>
<a name="2377"><span class="lineNum">    2377 </span>            :                         bw_int_to_fixed(1);</a>
<a name="2378"><span class="lineNum">    2378 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_luma_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2379"><span class="lineNum">    2379 </span>            :                         82176);</a>
<a name="2380"><span class="lineNum">    2380 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_chroma_lb_size_per_component =</span></a>
<a name="2381"><span class="lineNum">    2381 </span>            :                         bw_int_to_fixed(164352);</a>
<a name="2382"><span class="lineNum">    2382 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay422_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2383"><span class="lineNum">    2383 </span>            :                         82176);</a>
<a name="2384"><span class="lineNum">    2384 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_chunk_width = bw_int_to_fixed(64);</span></a>
<a name="2385"><span class="lineNum">    2385 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_dcp_buffer_lines = bw_int_to_fixed(4);</span></a>
<a name="2386"><span class="lineNum">    2386 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_width_efficient_for_tiling =</span></a>
<a name="2387"><span class="lineNum">    2387 </span>            :                         bw_int_to_fixed(1920);</a>
<a name="2388"><span class="lineNum">    2388 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_height_efficient_for_tiling =</span></a>
<a name="2389"><span class="lineNum">    2389 </span>            :                         bw_int_to_fixed(1080);</a>
<a name="2390"><span class="lineNum">    2390 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_multiple_displays_or_single_rotated_display =</span></a>
<a name="2391"><span class="lineNum">    2391 </span>            :                         bw_frc_to_fixed(3, 10);</a>
<a name="2392"><span class="lineNum">    2392 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_single_display_no_rotation =</span></a>
<a name="2393"><span class="lineNum">    2393 </span>            :                         bw_int_to_fixed(25);</a>
<a name="2394"><span class="lineNum">    2394 </span><span class="lineNoCov">          0 :                 dceip-&gt;minimum_outstanding_pte_request_limit = bw_int_to_fixed(</span></a>
<a name="2395"><span class="lineNum">    2395 </span>            :                         2);</a>
<a name="2396"><span class="lineNum">    2396 </span><span class="lineNoCov">          0 :                 dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw =</span></a>
<a name="2397"><span class="lineNum">    2397 </span>            :                         bw_int_to_fixed(128);</a>
<a name="2398"><span class="lineNum">    2398 </span><span class="lineNoCov">          0 :                 dceip-&gt;limit_excessive_outstanding_dmif_requests = true;</span></a>
<a name="2399"><span class="lineNum">    2399 </span><span class="lineNoCov">          0 :                 dceip-&gt;linear_mode_line_request_alternation_slice =</span></a>
<a name="2400"><span class="lineNum">    2400 </span>            :                         bw_int_to_fixed(64);</a>
<a name="2401"><span class="lineNum">    2401 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_lines_of_pte_prefetching_in_linear_mode =</span></a>
<a name="2402"><span class="lineNum">    2402 </span>            :                         32;</a>
<a name="2403"><span class="lineNum">    2403 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_luma_mcifwr_buffer_size = 12288;</span></a>
<a name="2404"><span class="lineNum">    2404 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_chroma_mcifwr_buffer_size = 8192;</span></a>
<a name="2405"><span class="lineNum">    2405 </span><span class="lineNoCov">          0 :                 dceip-&gt;request_efficiency = bw_frc_to_fixed(8, 10);</span></a>
<a name="2406"><span class="lineNum">    2406 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_per_request = bw_int_to_fixed(2);</span></a>
<a name="2407"><span class="lineNum">    2407 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_ramping_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2408"><span class="lineNum">    2408 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_pipe_throughput_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2409"><span class="lineNum">    2409 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode = 2;</span></a>
<a name="2410"><span class="lineNum">    2410 </span><span class="lineNoCov">          0 :                 dceip-&gt;mcifwr_all_surfaces_burst_time = bw_int_to_fixed(0);</span></a>
<a name="2411"><span class="lineNum">    2411 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="2412"><span class="lineNum">    2412 </span>            :         case BW_CALCS_VERSION_POLARIS12:</a>
<a name="2413"><span class="lineNum">    2413 </span><span class="lineNoCov">          0 :                 vbios-&gt;memory_type = bw_def_gddr5;</span></a>
<a name="2414"><span class="lineNum">    2414 </span><span class="lineNoCov">          0 :                 vbios-&gt;dram_channel_width_in_bits = 32;</span></a>
<a name="2415"><span class="lineNum">    2415 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_channels = asic_id.vram_width / vbios-&gt;dram_channel_width_in_bits;</span></a>
<a name="2416"><span class="lineNum">    2416 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_banks = 8;</span></a>
<a name="2417"><span class="lineNum">    2417 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_yclk = bw_int_to_fixed(6000);</span></a>
<a name="2418"><span class="lineNum">    2418 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_yclk = bw_int_to_fixed(3200);</span></a>
<a name="2419"><span class="lineNum">    2419 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_yclk = bw_int_to_fixed(1000);</span></a>
<a name="2420"><span class="lineNum">    2420 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_sclk = bw_int_to_fixed(678);</span></a>
<a name="2421"><span class="lineNum">    2421 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid1_sclk = bw_int_to_fixed(864);</span></a>
<a name="2422"><span class="lineNum">    2422 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid2_sclk = bw_int_to_fixed(900);</span></a>
<a name="2423"><span class="lineNum">    2423 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid3_sclk = bw_int_to_fixed(920);</span></a>
<a name="2424"><span class="lineNum">    2424 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid4_sclk = bw_int_to_fixed(940);</span></a>
<a name="2425"><span class="lineNum">    2425 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid5_sclk = bw_int_to_fixed(960);</span></a>
<a name="2426"><span class="lineNum">    2426 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid6_sclk = bw_int_to_fixed(980);</span></a>
<a name="2427"><span class="lineNum">    2427 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_sclk = bw_int_to_fixed(1049);</span></a>
<a name="2428"><span class="lineNum">    2428 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_dispclk = bw_int_to_fixed(459);</span></a>
<a name="2429"><span class="lineNum">    2429 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_dispclk = bw_int_to_fixed(654);</span></a>
<a name="2430"><span class="lineNum">    2430 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_dispclk = bw_int_to_fixed(1108);</span></a>
<a name="2431"><span class="lineNum">    2431 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_phyclk = bw_int_to_fixed(540);</span></a>
<a name="2432"><span class="lineNum">    2432 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2433"><span class="lineNum">    2433 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2434"><span class="lineNum">    2434 </span><span class="lineNoCov">          0 :                 vbios-&gt;data_return_bus_width = bw_int_to_fixed(32);</span></a>
<a name="2435"><span class="lineNum">    2435 </span><span class="lineNoCov">          0 :                 vbios-&gt;trc = bw_int_to_fixed(48);</span></a>
<a name="2436"><span class="lineNum">    2436 </span><span class="lineNoCov">          0 :                 if (vbios-&gt;number_of_dram_channels == 2) // 64-bit</span></a>
<a name="2437"><span class="lineNum">    2437 </span><span class="lineNoCov">          0 :                         vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(4);</span></a>
<a name="2438"><span class="lineNum">    2438 </span>            :                 else</a>
<a name="2439"><span class="lineNum">    2439 </span><span class="lineNoCov">          0 :                         vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(3);</span></a>
<a name="2440"><span class="lineNum">    2440 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_exit_latency = bw_int_to_fixed(5);</span></a>
<a name="2441"><span class="lineNum">    2441 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_entry_latency = bw_int_to_fixed(0);</span></a>
<a name="2442"><span class="lineNum">    2442 </span><span class="lineNoCov">          0 :                 vbios-&gt;nbp_state_change_latency = bw_int_to_fixed(250);</span></a>
<a name="2443"><span class="lineNum">    2443 </span><span class="lineNoCov">          0 :                 vbios-&gt;mcifwrmc_urgent_latency = bw_int_to_fixed(10);</span></a>
<a name="2444"><span class="lineNum">    2444 </span><span class="lineNoCov">          0 :                 vbios-&gt;scatter_gather_enable = false;</span></a>
<a name="2445"><span class="lineNum">    2445 </span><span class="lineNoCov">          0 :                 vbios-&gt;down_spread_percentage = bw_frc_to_fixed(5, 10);</span></a>
<a name="2446"><span class="lineNum">    2446 </span><span class="lineNoCov">          0 :                 vbios-&gt;cursor_width = 32;</span></a>
<a name="2447"><span class="lineNum">    2447 </span><span class="lineNoCov">          0 :                 vbios-&gt;average_compression_rate = 4;</span></a>
<a name="2448"><span class="lineNum">    2448 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_request_slots_gmc_reserves_for_dmif_per_channel = 256;</span></a>
<a name="2449"><span class="lineNum">    2449 </span><span class="lineNoCov">          0 :                 vbios-&gt;blackout_duration = bw_int_to_fixed(0); /* us */</span></a>
<a name="2450"><span class="lineNum">    2450 </span><span class="lineNoCov">          0 :                 vbios-&gt;maximum_blackout_recovery_time = bw_int_to_fixed(0);</span></a>
<a name="2451"><span class="lineNum">    2451 </span>            : </a>
<a name="2452"><span class="lineNum">    2452 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2453"><span class="lineNum">    2453 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2454"><span class="lineNum">    2454 </span><span class="lineNoCov">          0 :                 dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency = 100;</span></a>
<a name="2455"><span class="lineNum">    2455 </span><span class="lineNoCov">          0 :                 dceip-&gt;large_cursor = false;</span></a>
<a name="2456"><span class="lineNum">    2456 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_request_buffer_size = bw_int_to_fixed(768);</span></a>
<a name="2457"><span class="lineNum">    2457 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_pipe_en_fbc_chunk_tracker = false;</span></a>
<a name="2458"><span class="lineNum">    2458 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_max_outstanding_group_num = 1;</span></a>
<a name="2459"><span class="lineNum">    2459 </span><span class="lineNoCov">          0 :                 dceip-&gt;lines_interleaved_into_lb = 2;</span></a>
<a name="2460"><span class="lineNum">    2460 </span><span class="lineNoCov">          0 :                 dceip-&gt;chunk_width = 256;</span></a>
<a name="2461"><span class="lineNum">    2461 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_graphics_pipes = 5;</span></a>
<a name="2462"><span class="lineNum">    2462 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_underlay_pipes = 0;</span></a>
<a name="2463"><span class="lineNum">    2463 </span><span class="lineNoCov">          0 :                 dceip-&gt;low_power_tiling_mode = 0;</span></a>
<a name="2464"><span class="lineNum">    2464 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back_supported = true;</span></a>
<a name="2465"><span class="lineNum">    2465 </span><span class="lineNoCov">          0 :                 dceip-&gt;argb_compression_support = true;</span></a>
<a name="2466"><span class="lineNum">    2466 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2467"><span class="lineNum">    2467 </span>            :                         bw_frc_to_fixed(35556, 10000);</a>
<a name="2468"><span class="lineNum">    2468 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2469"><span class="lineNum">    2469 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2470"><span class="lineNum">    2470 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2471"><span class="lineNum">    2471 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2472"><span class="lineNum">    2472 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2473"><span class="lineNum">    2473 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2474"><span class="lineNum">    2474 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2475"><span class="lineNum">    2475 </span>            :                         bw_frc_to_fixed(35, 10);</a>
<a name="2476"><span class="lineNum">    2476 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2477"><span class="lineNum">    2477 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2478"><span class="lineNum">    2478 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2479"><span class="lineNum">    2479 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2480"><span class="lineNum">    2480 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2481"><span class="lineNum">    2481 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2482"><span class="lineNum">    2482 </span><span class="lineNoCov">          0 :                 dceip-&gt;alpha_vscaler_efficiency = bw_int_to_fixed(3);</span></a>
<a name="2483"><span class="lineNum">    2483 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_dmif_buffer_allocated = 4;</span></a>
<a name="2484"><span class="lineNum">    2484 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_dmif_size = 12288;</span></a>
<a name="2485"><span class="lineNum">    2485 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_luma_dmif_size = 19456;</span></a>
<a name="2486"><span class="lineNum">    2486 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_chroma_dmif_size = 23552;</span></a>
<a name="2487"><span class="lineNum">    2487 </span><span class="lineNoCov">          0 :                 dceip-&gt;pre_downscaler_enabled = true;</span></a>
<a name="2488"><span class="lineNum">    2488 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_downscale_prefetch_enabled = true;</span></a>
<a name="2489"><span class="lineNum">    2489 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_write_pixels_per_dispclk = bw_int_to_fixed(1);</span></a>
<a name="2490"><span class="lineNum">    2490 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_size_per_component444 = bw_int_to_fixed(245952);</span></a>
<a name="2491"><span class="lineNum">    2491 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching = true;</span></a>
<a name="2492"><span class="lineNum">    2492 </span><span class="lineNoCov">          0 :                 dceip-&gt;stutter_and_dram_clock_state_change_gated_before_cursor =</span></a>
<a name="2493"><span class="lineNum">    2493 </span>            :                         bw_int_to_fixed(1);</a>
<a name="2494"><span class="lineNum">    2494 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_luma_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2495"><span class="lineNum">    2495 </span>            :                         82176);</a>
<a name="2496"><span class="lineNum">    2496 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_chroma_lb_size_per_component =</span></a>
<a name="2497"><span class="lineNum">    2497 </span>            :                         bw_int_to_fixed(164352);</a>
<a name="2498"><span class="lineNum">    2498 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay422_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2499"><span class="lineNum">    2499 </span>            :                         82176);</a>
<a name="2500"><span class="lineNum">    2500 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_chunk_width = bw_int_to_fixed(64);</span></a>
<a name="2501"><span class="lineNum">    2501 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_dcp_buffer_lines = bw_int_to_fixed(4);</span></a>
<a name="2502"><span class="lineNum">    2502 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_width_efficient_for_tiling =</span></a>
<a name="2503"><span class="lineNum">    2503 </span>            :                         bw_int_to_fixed(1920);</a>
<a name="2504"><span class="lineNum">    2504 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_height_efficient_for_tiling =</span></a>
<a name="2505"><span class="lineNum">    2505 </span>            :                         bw_int_to_fixed(1080);</a>
<a name="2506"><span class="lineNum">    2506 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_multiple_displays_or_single_rotated_display =</span></a>
<a name="2507"><span class="lineNum">    2507 </span>            :                         bw_frc_to_fixed(3, 10);</a>
<a name="2508"><span class="lineNum">    2508 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_single_display_no_rotation =</span></a>
<a name="2509"><span class="lineNum">    2509 </span>            :                         bw_int_to_fixed(25);</a>
<a name="2510"><span class="lineNum">    2510 </span><span class="lineNoCov">          0 :                 dceip-&gt;minimum_outstanding_pte_request_limit = bw_int_to_fixed(</span></a>
<a name="2511"><span class="lineNum">    2511 </span>            :                         2);</a>
<a name="2512"><span class="lineNum">    2512 </span><span class="lineNoCov">          0 :                 dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw =</span></a>
<a name="2513"><span class="lineNum">    2513 </span>            :                         bw_int_to_fixed(128);</a>
<a name="2514"><span class="lineNum">    2514 </span><span class="lineNoCov">          0 :                 dceip-&gt;limit_excessive_outstanding_dmif_requests = true;</span></a>
<a name="2515"><span class="lineNum">    2515 </span><span class="lineNoCov">          0 :                 dceip-&gt;linear_mode_line_request_alternation_slice =</span></a>
<a name="2516"><span class="lineNum">    2516 </span>            :                         bw_int_to_fixed(64);</a>
<a name="2517"><span class="lineNum">    2517 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_lines_of_pte_prefetching_in_linear_mode =</span></a>
<a name="2518"><span class="lineNum">    2518 </span>            :                         32;</a>
<a name="2519"><span class="lineNum">    2519 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_luma_mcifwr_buffer_size = 12288;</span></a>
<a name="2520"><span class="lineNum">    2520 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_chroma_mcifwr_buffer_size = 8192;</span></a>
<a name="2521"><span class="lineNum">    2521 </span><span class="lineNoCov">          0 :                 dceip-&gt;request_efficiency = bw_frc_to_fixed(8, 10);</span></a>
<a name="2522"><span class="lineNum">    2522 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_per_request = bw_int_to_fixed(2);</span></a>
<a name="2523"><span class="lineNum">    2523 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_ramping_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2524"><span class="lineNum">    2524 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_pipe_throughput_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2525"><span class="lineNum">    2525 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode = 2;</span></a>
<a name="2526"><span class="lineNum">    2526 </span><span class="lineNoCov">          0 :                 dceip-&gt;mcifwr_all_surfaces_burst_time = bw_int_to_fixed(0);</span></a>
<a name="2527"><span class="lineNum">    2527 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="2528"><span class="lineNum">    2528 </span>            :         case BW_CALCS_VERSION_STONEY:</a>
<a name="2529"><span class="lineNum">    2529 </span><span class="lineNoCov">          0 :                 vbios-&gt;memory_type = bw_def_gddr5;</span></a>
<a name="2530"><span class="lineNum">    2530 </span><span class="lineNoCov">          0 :                 vbios-&gt;dram_channel_width_in_bits = 64;</span></a>
<a name="2531"><span class="lineNum">    2531 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_channels = asic_id.vram_width / vbios-&gt;dram_channel_width_in_bits;</span></a>
<a name="2532"><span class="lineNum">    2532 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_banks = 8;</span></a>
<a name="2533"><span class="lineNum">    2533 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_yclk = bw_int_to_fixed(1866);</span></a>
<a name="2534"><span class="lineNum">    2534 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_yclk = bw_int_to_fixed(1866);</span></a>
<a name="2535"><span class="lineNum">    2535 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_yclk = bw_int_to_fixed(1333);</span></a>
<a name="2536"><span class="lineNum">    2536 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_sclk = bw_int_to_fixed(200);</span></a>
<a name="2537"><span class="lineNum">    2537 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid1_sclk = bw_int_to_fixed(600);</span></a>
<a name="2538"><span class="lineNum">    2538 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid2_sclk = bw_int_to_fixed(600);</span></a>
<a name="2539"><span class="lineNum">    2539 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid3_sclk = bw_int_to_fixed(600);</span></a>
<a name="2540"><span class="lineNum">    2540 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid4_sclk = bw_int_to_fixed(600);</span></a>
<a name="2541"><span class="lineNum">    2541 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid5_sclk = bw_int_to_fixed(600);</span></a>
<a name="2542"><span class="lineNum">    2542 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid6_sclk = bw_int_to_fixed(600);</span></a>
<a name="2543"><span class="lineNum">    2543 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_sclk = bw_int_to_fixed(800);</span></a>
<a name="2544"><span class="lineNum">    2544 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_dispclk = bw_int_to_fixed(352);</span></a>
<a name="2545"><span class="lineNum">    2545 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_dispclk = bw_int_to_fixed(467);</span></a>
<a name="2546"><span class="lineNum">    2546 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_dispclk = bw_int_to_fixed(643);</span></a>
<a name="2547"><span class="lineNum">    2547 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_phyclk = bw_int_to_fixed(540);</span></a>
<a name="2548"><span class="lineNum">    2548 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2549"><span class="lineNum">    2549 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2550"><span class="lineNum">    2550 </span><span class="lineNoCov">          0 :                 vbios-&gt;data_return_bus_width = bw_int_to_fixed(32);</span></a>
<a name="2551"><span class="lineNum">    2551 </span><span class="lineNoCov">          0 :                 vbios-&gt;trc = bw_int_to_fixed(50);</span></a>
<a name="2552"><span class="lineNum">    2552 </span><span class="lineNoCov">          0 :                 vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(4);</span></a>
<a name="2553"><span class="lineNum">    2553 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_exit_latency = bw_frc_to_fixed(158, 10);</span></a>
<a name="2554"><span class="lineNum">    2554 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_entry_latency = bw_int_to_fixed(0);</span></a>
<a name="2555"><span class="lineNum">    2555 </span><span class="lineNoCov">          0 :                 vbios-&gt;nbp_state_change_latency = bw_frc_to_fixed(2008, 100);</span></a>
<a name="2556"><span class="lineNum">    2556 </span><span class="lineNoCov">          0 :                 vbios-&gt;mcifwrmc_urgent_latency = bw_int_to_fixed(10);</span></a>
<a name="2557"><span class="lineNum">    2557 </span><span class="lineNoCov">          0 :                 vbios-&gt;scatter_gather_enable = true;</span></a>
<a name="2558"><span class="lineNum">    2558 </span><span class="lineNoCov">          0 :                 vbios-&gt;down_spread_percentage = bw_frc_to_fixed(5, 10);</span></a>
<a name="2559"><span class="lineNum">    2559 </span><span class="lineNoCov">          0 :                 vbios-&gt;cursor_width = 32;</span></a>
<a name="2560"><span class="lineNum">    2560 </span><span class="lineNoCov">          0 :                 vbios-&gt;average_compression_rate = 4;</span></a>
<a name="2561"><span class="lineNum">    2561 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_request_slots_gmc_reserves_for_dmif_per_channel = 256;</span></a>
<a name="2562"><span class="lineNum">    2562 </span><span class="lineNoCov">          0 :                 vbios-&gt;blackout_duration = bw_int_to_fixed(0); /* us */</span></a>
<a name="2563"><span class="lineNum">    2563 </span><span class="lineNoCov">          0 :                 vbios-&gt;maximum_blackout_recovery_time = bw_int_to_fixed(0);</span></a>
<a name="2564"><span class="lineNum">    2564 </span>            : </a>
<a name="2565"><span class="lineNum">    2565 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2566"><span class="lineNum">    2566 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2567"><span class="lineNum">    2567 </span><span class="lineNoCov">          0 :                 dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency = 100;</span></a>
<a name="2568"><span class="lineNum">    2568 </span><span class="lineNoCov">          0 :                 dceip-&gt;large_cursor = false;</span></a>
<a name="2569"><span class="lineNum">    2569 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_request_buffer_size = bw_int_to_fixed(768);</span></a>
<a name="2570"><span class="lineNum">    2570 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_pipe_en_fbc_chunk_tracker = false;</span></a>
<a name="2571"><span class="lineNum">    2571 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_max_outstanding_group_num = 1;</span></a>
<a name="2572"><span class="lineNum">    2572 </span><span class="lineNoCov">          0 :                 dceip-&gt;lines_interleaved_into_lb = 2;</span></a>
<a name="2573"><span class="lineNum">    2573 </span><span class="lineNoCov">          0 :                 dceip-&gt;chunk_width = 256;</span></a>
<a name="2574"><span class="lineNum">    2574 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_graphics_pipes = 2;</span></a>
<a name="2575"><span class="lineNum">    2575 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_underlay_pipes = 1;</span></a>
<a name="2576"><span class="lineNum">    2576 </span><span class="lineNoCov">          0 :                 dceip-&gt;low_power_tiling_mode = 0;</span></a>
<a name="2577"><span class="lineNum">    2577 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back_supported = false;</span></a>
<a name="2578"><span class="lineNum">    2578 </span><span class="lineNoCov">          0 :                 dceip-&gt;argb_compression_support = true;</span></a>
<a name="2579"><span class="lineNum">    2579 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2580"><span class="lineNum">    2580 </span>            :                         bw_frc_to_fixed(35556, 10000);</a>
<a name="2581"><span class="lineNum">    2581 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2582"><span class="lineNum">    2582 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2583"><span class="lineNum">    2583 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2584"><span class="lineNum">    2584 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2585"><span class="lineNum">    2585 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2586"><span class="lineNum">    2586 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2587"><span class="lineNum">    2587 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2588"><span class="lineNum">    2588 </span>            :                         bw_frc_to_fixed(35, 10);</a>
<a name="2589"><span class="lineNum">    2589 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2590"><span class="lineNum">    2590 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2591"><span class="lineNum">    2591 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2592"><span class="lineNum">    2592 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2593"><span class="lineNum">    2593 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2594"><span class="lineNum">    2594 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2595"><span class="lineNum">    2595 </span><span class="lineNoCov">          0 :                 dceip-&gt;alpha_vscaler_efficiency = bw_int_to_fixed(3);</span></a>
<a name="2596"><span class="lineNum">    2596 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_dmif_buffer_allocated = 2;</span></a>
<a name="2597"><span class="lineNum">    2597 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_dmif_size = 12288;</span></a>
<a name="2598"><span class="lineNum">    2598 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_luma_dmif_size = 19456;</span></a>
<a name="2599"><span class="lineNum">    2599 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_chroma_dmif_size = 23552;</span></a>
<a name="2600"><span class="lineNum">    2600 </span><span class="lineNoCov">          0 :                 dceip-&gt;pre_downscaler_enabled = true;</span></a>
<a name="2601"><span class="lineNum">    2601 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_downscale_prefetch_enabled = true;</span></a>
<a name="2602"><span class="lineNum">    2602 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_write_pixels_per_dispclk = bw_int_to_fixed(1);</span></a>
<a name="2603"><span class="lineNum">    2603 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_size_per_component444 = bw_int_to_fixed(82176);</span></a>
<a name="2604"><span class="lineNum">    2604 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching = false;</span></a>
<a name="2605"><span class="lineNum">    2605 </span><span class="lineNoCov">          0 :                 dceip-&gt;stutter_and_dram_clock_state_change_gated_before_cursor =</span></a>
<a name="2606"><span class="lineNum">    2606 </span>            :                         bw_int_to_fixed(0);</a>
<a name="2607"><span class="lineNum">    2607 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_luma_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2608"><span class="lineNum">    2608 </span>            :                         82176);</a>
<a name="2609"><span class="lineNum">    2609 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_chroma_lb_size_per_component =</span></a>
<a name="2610"><span class="lineNum">    2610 </span>            :                         bw_int_to_fixed(164352);</a>
<a name="2611"><span class="lineNum">    2611 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay422_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2612"><span class="lineNum">    2612 </span>            :                         82176);</a>
<a name="2613"><span class="lineNum">    2613 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_chunk_width = bw_int_to_fixed(64);</span></a>
<a name="2614"><span class="lineNum">    2614 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_dcp_buffer_lines = bw_int_to_fixed(4);</span></a>
<a name="2615"><span class="lineNum">    2615 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_width_efficient_for_tiling =</span></a>
<a name="2616"><span class="lineNum">    2616 </span>            :                         bw_int_to_fixed(1920);</a>
<a name="2617"><span class="lineNum">    2617 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_height_efficient_for_tiling =</span></a>
<a name="2618"><span class="lineNum">    2618 </span>            :                         bw_int_to_fixed(1080);</a>
<a name="2619"><span class="lineNum">    2619 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_multiple_displays_or_single_rotated_display =</span></a>
<a name="2620"><span class="lineNum">    2620 </span>            :                         bw_frc_to_fixed(3, 10);</a>
<a name="2621"><span class="lineNum">    2621 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_single_display_no_rotation =</span></a>
<a name="2622"><span class="lineNum">    2622 </span>            :                         bw_int_to_fixed(25);</a>
<a name="2623"><span class="lineNum">    2623 </span><span class="lineNoCov">          0 :                 dceip-&gt;minimum_outstanding_pte_request_limit = bw_int_to_fixed(</span></a>
<a name="2624"><span class="lineNum">    2624 </span>            :                         2);</a>
<a name="2625"><span class="lineNum">    2625 </span><span class="lineNoCov">          0 :                 dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw =</span></a>
<a name="2626"><span class="lineNum">    2626 </span>            :                         bw_int_to_fixed(128);</a>
<a name="2627"><span class="lineNum">    2627 </span><span class="lineNoCov">          0 :                 dceip-&gt;limit_excessive_outstanding_dmif_requests = true;</span></a>
<a name="2628"><span class="lineNum">    2628 </span><span class="lineNoCov">          0 :                 dceip-&gt;linear_mode_line_request_alternation_slice =</span></a>
<a name="2629"><span class="lineNum">    2629 </span>            :                         bw_int_to_fixed(64);</a>
<a name="2630"><span class="lineNum">    2630 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_lines_of_pte_prefetching_in_linear_mode =</span></a>
<a name="2631"><span class="lineNum">    2631 </span>            :                         32;</a>
<a name="2632"><span class="lineNum">    2632 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_luma_mcifwr_buffer_size = 12288;</span></a>
<a name="2633"><span class="lineNum">    2633 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_chroma_mcifwr_buffer_size = 8192;</span></a>
<a name="2634"><span class="lineNum">    2634 </span><span class="lineNoCov">          0 :                 dceip-&gt;request_efficiency = bw_frc_to_fixed(8, 10);</span></a>
<a name="2635"><span class="lineNum">    2635 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_per_request = bw_int_to_fixed(2);</span></a>
<a name="2636"><span class="lineNum">    2636 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_ramping_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2637"><span class="lineNum">    2637 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_pipe_throughput_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2638"><span class="lineNum">    2638 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode = 2;</span></a>
<a name="2639"><span class="lineNum">    2639 </span><span class="lineNoCov">          0 :                 dceip-&gt;mcifwr_all_surfaces_burst_time = bw_int_to_fixed(0);</span></a>
<a name="2640"><span class="lineNum">    2640 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="2641"><span class="lineNum">    2641 </span>            :         case BW_CALCS_VERSION_VEGA10:</a>
<a name="2642"><span class="lineNum">    2642 </span><span class="lineNoCov">          0 :                 vbios-&gt;memory_type = bw_def_hbm;</span></a>
<a name="2643"><span class="lineNum">    2643 </span><span class="lineNoCov">          0 :                 vbios-&gt;dram_channel_width_in_bits = 128;</span></a>
<a name="2644"><span class="lineNum">    2644 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_channels = asic_id.vram_width / vbios-&gt;dram_channel_width_in_bits;</span></a>
<a name="2645"><span class="lineNum">    2645 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_dram_banks = 16;</span></a>
<a name="2646"><span class="lineNum">    2646 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_yclk = bw_int_to_fixed(2400);</span></a>
<a name="2647"><span class="lineNum">    2647 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_yclk = bw_int_to_fixed(1700);</span></a>
<a name="2648"><span class="lineNum">    2648 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_yclk = bw_int_to_fixed(1000);</span></a>
<a name="2649"><span class="lineNum">    2649 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_sclk = bw_int_to_fixed(300);</span></a>
<a name="2650"><span class="lineNum">    2650 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid1_sclk = bw_int_to_fixed(350);</span></a>
<a name="2651"><span class="lineNum">    2651 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid2_sclk = bw_int_to_fixed(400);</span></a>
<a name="2652"><span class="lineNum">    2652 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid3_sclk = bw_int_to_fixed(500);</span></a>
<a name="2653"><span class="lineNum">    2653 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid4_sclk = bw_int_to_fixed(600);</span></a>
<a name="2654"><span class="lineNum">    2654 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid5_sclk = bw_int_to_fixed(700);</span></a>
<a name="2655"><span class="lineNum">    2655 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid6_sclk = bw_int_to_fixed(760);</span></a>
<a name="2656"><span class="lineNum">    2656 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_sclk = bw_int_to_fixed(776);</span></a>
<a name="2657"><span class="lineNum">    2657 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_dispclk = bw_int_to_fixed(460);</span></a>
<a name="2658"><span class="lineNum">    2658 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_dispclk = bw_int_to_fixed(670);</span></a>
<a name="2659"><span class="lineNum">    2659 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_dispclk = bw_int_to_fixed(1133);</span></a>
<a name="2660"><span class="lineNum">    2660 </span><span class="lineNoCov">          0 :                 vbios-&gt;low_voltage_max_phyclk = bw_int_to_fixed(540);</span></a>
<a name="2661"><span class="lineNum">    2661 </span><span class="lineNoCov">          0 :                 vbios-&gt;mid_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2662"><span class="lineNum">    2662 </span><span class="lineNoCov">          0 :                 vbios-&gt;high_voltage_max_phyclk = bw_int_to_fixed(810);</span></a>
<a name="2663"><span class="lineNum">    2663 </span><span class="lineNoCov">          0 :                 vbios-&gt;data_return_bus_width = bw_int_to_fixed(32);</span></a>
<a name="2664"><span class="lineNum">    2664 </span><span class="lineNoCov">          0 :                 vbios-&gt;trc = bw_int_to_fixed(48);</span></a>
<a name="2665"><span class="lineNum">    2665 </span><span class="lineNoCov">          0 :                 vbios-&gt;dmifmc_urgent_latency = bw_int_to_fixed(3);</span></a>
<a name="2666"><span class="lineNum">    2666 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_exit_latency = bw_frc_to_fixed(75, 10);</span></a>
<a name="2667"><span class="lineNum">    2667 </span><span class="lineNoCov">          0 :                 vbios-&gt;stutter_self_refresh_entry_latency = bw_frc_to_fixed(19, 10);</span></a>
<a name="2668"><span class="lineNum">    2668 </span><span class="lineNoCov">          0 :                 vbios-&gt;nbp_state_change_latency = bw_int_to_fixed(39);</span></a>
<a name="2669"><span class="lineNum">    2669 </span><span class="lineNoCov">          0 :                 vbios-&gt;mcifwrmc_urgent_latency = bw_int_to_fixed(10);</span></a>
<a name="2670"><span class="lineNum">    2670 </span><span class="lineNoCov">          0 :                 vbios-&gt;scatter_gather_enable = false;</span></a>
<a name="2671"><span class="lineNum">    2671 </span><span class="lineNoCov">          0 :                 vbios-&gt;down_spread_percentage = bw_frc_to_fixed(5, 10);</span></a>
<a name="2672"><span class="lineNum">    2672 </span><span class="lineNoCov">          0 :                 vbios-&gt;cursor_width = 32;</span></a>
<a name="2673"><span class="lineNum">    2673 </span><span class="lineNoCov">          0 :                 vbios-&gt;average_compression_rate = 4;</span></a>
<a name="2674"><span class="lineNum">    2674 </span><span class="lineNoCov">          0 :                 vbios-&gt;number_of_request_slots_gmc_reserves_for_dmif_per_channel = 8;</span></a>
<a name="2675"><span class="lineNum">    2675 </span><span class="lineNoCov">          0 :                 vbios-&gt;blackout_duration = bw_int_to_fixed(0); /* us */</span></a>
<a name="2676"><span class="lineNum">    2676 </span><span class="lineNoCov">          0 :                 vbios-&gt;maximum_blackout_recovery_time = bw_int_to_fixed(0);</span></a>
<a name="2677"><span class="lineNum">    2677 </span>            : </a>
<a name="2678"><span class="lineNum">    2678 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_port_bw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2679"><span class="lineNum">    2679 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_average_percent_of_ideal_drambw_display_can_use_in_normal_system_operation = 100;</span></a>
<a name="2680"><span class="lineNum">    2680 </span><span class="lineNoCov">          0 :                 dceip-&gt;percent_of_ideal_port_bw_received_after_urgent_latency = 100;</span></a>
<a name="2681"><span class="lineNum">    2681 </span><span class="lineNoCov">          0 :                 dceip-&gt;large_cursor = false;</span></a>
<a name="2682"><span class="lineNum">    2682 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_request_buffer_size = bw_int_to_fixed(2304);</span></a>
<a name="2683"><span class="lineNum">    2683 </span><span class="lineNoCov">          0 :                 dceip-&gt;dmif_pipe_en_fbc_chunk_tracker = true;</span></a>
<a name="2684"><span class="lineNum">    2684 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_max_outstanding_group_num = 1;</span></a>
<a name="2685"><span class="lineNum">    2685 </span><span class="lineNoCov">          0 :                 dceip-&gt;lines_interleaved_into_lb = 2;</span></a>
<a name="2686"><span class="lineNum">    2686 </span><span class="lineNoCov">          0 :                 dceip-&gt;chunk_width = 256;</span></a>
<a name="2687"><span class="lineNum">    2687 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_graphics_pipes = 6;</span></a>
<a name="2688"><span class="lineNum">    2688 </span><span class="lineNoCov">          0 :                 dceip-&gt;number_of_underlay_pipes = 0;</span></a>
<a name="2689"><span class="lineNum">    2689 </span><span class="lineNoCov">          0 :                 dceip-&gt;low_power_tiling_mode = 0;</span></a>
<a name="2690"><span class="lineNum">    2690 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back_supported = true;</span></a>
<a name="2691"><span class="lineNum">    2691 </span><span class="lineNoCov">          0 :                 dceip-&gt;argb_compression_support = true;</span></a>
<a name="2692"><span class="lineNum">    2692 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2693"><span class="lineNum">    2693 </span>            :                         bw_frc_to_fixed(35556, 10000);</a>
<a name="2694"><span class="lineNum">    2694 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2695"><span class="lineNum">    2695 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2696"><span class="lineNum">    2696 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2697"><span class="lineNum">    2697 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2698"><span class="lineNum">    2698 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2699"><span class="lineNum">    2699 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2700"><span class="lineNum">    2700 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency6_bit_per_component =</span></a>
<a name="2701"><span class="lineNum">    2701 </span>            :                         bw_frc_to_fixed(35, 10);</a>
<a name="2702"><span class="lineNum">    2702 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency8_bit_per_component =</span></a>
<a name="2703"><span class="lineNum">    2703 </span>            :                         bw_frc_to_fixed(34286, 10000);</a>
<a name="2704"><span class="lineNum">    2704 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency10_bit_per_component =</span></a>
<a name="2705"><span class="lineNum">    2705 </span>            :                         bw_frc_to_fixed(32, 10);</a>
<a name="2706"><span class="lineNum">    2706 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_vscaler_efficiency12_bit_per_component =</span></a>
<a name="2707"><span class="lineNum">    2707 </span>            :                         bw_int_to_fixed(3);</a>
<a name="2708"><span class="lineNum">    2708 </span><span class="lineNoCov">          0 :                 dceip-&gt;alpha_vscaler_efficiency = bw_int_to_fixed(3);</span></a>
<a name="2709"><span class="lineNum">    2709 </span><span class="lineNoCov">          0 :                 dceip-&gt;max_dmif_buffer_allocated = 4;</span></a>
<a name="2710"><span class="lineNum">    2710 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_dmif_size = 24576;</span></a>
<a name="2711"><span class="lineNum">    2711 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_luma_dmif_size = 19456;</span></a>
<a name="2712"><span class="lineNum">    2712 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_chroma_dmif_size = 23552;</span></a>
<a name="2713"><span class="lineNum">    2713 </span><span class="lineNoCov">          0 :                 dceip-&gt;pre_downscaler_enabled = true;</span></a>
<a name="2714"><span class="lineNum">    2714 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_downscale_prefetch_enabled = false;</span></a>
<a name="2715"><span class="lineNum">    2715 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_write_pixels_per_dispclk = bw_int_to_fixed(1);</span></a>
<a name="2716"><span class="lineNum">    2716 </span><span class="lineNoCov">          0 :                 dceip-&gt;lb_size_per_component444 = bw_int_to_fixed(245952);</span></a>
<a name="2717"><span class="lineNum">    2717 </span><span class="lineNoCov">          0 :                 dceip-&gt;graphics_lb_nodownscaling_multi_line_prefetching = true;</span></a>
<a name="2718"><span class="lineNum">    2718 </span><span class="lineNoCov">          0 :                 dceip-&gt;stutter_and_dram_clock_state_change_gated_before_cursor =</span></a>
<a name="2719"><span class="lineNum">    2719 </span>            :                         bw_int_to_fixed(1);</a>
<a name="2720"><span class="lineNum">    2720 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_luma_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2721"><span class="lineNum">    2721 </span>            :                         82176);</a>
<a name="2722"><span class="lineNum">    2722 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay420_chroma_lb_size_per_component =</span></a>
<a name="2723"><span class="lineNum">    2723 </span>            :                         bw_int_to_fixed(164352);</a>
<a name="2724"><span class="lineNum">    2724 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay422_lb_size_per_component = bw_int_to_fixed(</span></a>
<a name="2725"><span class="lineNum">    2725 </span>            :                         82176);</a>
<a name="2726"><span class="lineNum">    2726 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_chunk_width = bw_int_to_fixed(64);</span></a>
<a name="2727"><span class="lineNum">    2727 </span><span class="lineNoCov">          0 :                 dceip-&gt;cursor_dcp_buffer_lines = bw_int_to_fixed(4);</span></a>
<a name="2728"><span class="lineNum">    2728 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_width_efficient_for_tiling =</span></a>
<a name="2729"><span class="lineNum">    2729 </span>            :                         bw_int_to_fixed(1920);</a>
<a name="2730"><span class="lineNum">    2730 </span><span class="lineNoCov">          0 :                 dceip-&gt;underlay_maximum_height_efficient_for_tiling =</span></a>
<a name="2731"><span class="lineNum">    2731 </span>            :                         bw_int_to_fixed(1080);</a>
<a name="2732"><span class="lineNum">    2732 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_multiple_displays_or_single_rotated_display =</span></a>
<a name="2733"><span class="lineNum">    2733 </span>            :                         bw_frc_to_fixed(3, 10);</a>
<a name="2734"><span class="lineNum">    2734 </span><span class="lineNoCov">          0 :                 dceip-&gt;peak_pte_request_to_eviction_ratio_limiting_single_display_no_rotation =</span></a>
<a name="2735"><span class="lineNum">    2735 </span>            :                         bw_int_to_fixed(25);</a>
<a name="2736"><span class="lineNum">    2736 </span><span class="lineNoCov">          0 :                 dceip-&gt;minimum_outstanding_pte_request_limit = bw_int_to_fixed(</span></a>
<a name="2737"><span class="lineNum">    2737 </span>            :                         2);</a>
<a name="2738"><span class="lineNum">    2738 </span><span class="lineNoCov">          0 :                 dceip-&gt;maximum_total_outstanding_pte_requests_allowed_by_saw =</span></a>
<a name="2739"><span class="lineNum">    2739 </span>            :                         bw_int_to_fixed(128);</a>
<a name="2740"><span class="lineNum">    2740 </span><span class="lineNoCov">          0 :                 dceip-&gt;limit_excessive_outstanding_dmif_requests = true;</span></a>
<a name="2741"><span class="lineNum">    2741 </span><span class="lineNoCov">          0 :                 dceip-&gt;linear_mode_line_request_alternation_slice =</span></a>
<a name="2742"><span class="lineNum">    2742 </span>            :                         bw_int_to_fixed(64);</a>
<a name="2743"><span class="lineNum">    2743 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_lines_of_pte_prefetching_in_linear_mode =</span></a>
<a name="2744"><span class="lineNum">    2744 </span>            :                         32;</a>
<a name="2745"><span class="lineNum">    2745 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_luma_mcifwr_buffer_size = 12288;</span></a>
<a name="2746"><span class="lineNum">    2746 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_write_back420_chroma_mcifwr_buffer_size = 8192;</span></a>
<a name="2747"><span class="lineNum">    2747 </span><span class="lineNoCov">          0 :                 dceip-&gt;request_efficiency = bw_frc_to_fixed(8, 10);</span></a>
<a name="2748"><span class="lineNum">    2748 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_per_request = bw_int_to_fixed(2);</span></a>
<a name="2749"><span class="lineNum">    2749 </span><span class="lineNoCov">          0 :                 dceip-&gt;dispclk_ramping_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2750"><span class="lineNum">    2750 </span><span class="lineNoCov">          0 :                 dceip-&gt;display_pipe_throughput_factor = bw_frc_to_fixed(105, 100);</span></a>
<a name="2751"><span class="lineNum">    2751 </span><span class="lineNoCov">          0 :                 dceip-&gt;scatter_gather_pte_request_rows_in_tiling_mode = 2;</span></a>
<a name="2752"><span class="lineNum">    2752 </span><span class="lineNoCov">          0 :                 dceip-&gt;mcifwr_all_surfaces_burst_time = bw_int_to_fixed(0);</span></a>
<a name="2753"><span class="lineNum">    2753 </span><span class="lineNoCov">          0 :                 break;</span></a>
<a name="2754"><span class="lineNum">    2754 </span>            :         default:</a>
<a name="2755"><span class="lineNum">    2755 </span>            :                 break;</a>
<a name="2756"><span class="lineNum">    2756 </span>            :         }</a>
<a name="2757"><span class="lineNum">    2757 </span><span class="lineNoCov">          0 :         *bw_dceip = *dceip;</span></a>
<a name="2758"><span class="lineNum">    2758 </span><span class="lineNoCov">          0 :         *bw_vbios = *vbios;</span></a>
<a name="2759"><span class="lineNum">    2759 </span>            : </a>
<a name="2760"><span class="lineNum">    2760 </span><span class="lineNoCov">          0 :         kfree(dceip);</span></a>
<a name="2761"><span class="lineNum">    2761 </span><span class="lineNoCov">          0 :         kfree(vbios);</span></a>
<a name="2762"><span class="lineNum">    2762 </span>            : }</a>
<a name="2763"><span class="lineNum">    2763 </span>            : </a>
<a name="2764"><span class="lineNum">    2764 </span>            : /*</a>
<a name="2765"><span class="lineNum">    2765 </span>            :  * Compare calculated (required) clocks against the clocks available at</a>
<a name="2766"><span class="lineNum">    2766 </span>            :  * maximum voltage (max Performance Level).</a>
<a name="2767"><span class="lineNum">    2767 </span>            :  */</a>
<a name="2768"><span class="lineNum">    2768 </span>            : static bool is_display_configuration_supported(</a>
<a name="2769"><span class="lineNum">    2769 </span>            :         const struct bw_calcs_vbios *vbios,</a>
<a name="2770"><span class="lineNum">    2770 </span>            :         const struct dce_bw_output *calcs_output)</a>
<a name="2771"><span class="lineNum">    2771 </span>            : {</a>
<a name="2772"><span class="lineNum">    2772 </span>            :         uint32_t int_max_clk;</a>
<a name="2773"><span class="lineNum">    2773 </span>            : </a>
<a name="2774"><span class="lineNum">    2774 </span><span class="lineNoCov">          0 :         int_max_clk = bw_fixed_to_int(vbios-&gt;high_voltage_max_dispclk);</span></a>
<a name="2775"><span class="lineNum">    2775 </span><span class="lineNoCov">          0 :         int_max_clk *= 1000; /* MHz to kHz */</span></a>
<a name="2776"><span class="lineNum">    2776 </span><span class="lineNoCov">          0 :         if (calcs_output-&gt;dispclk_khz &gt; int_max_clk)</span></a>
<a name="2777"><span class="lineNum">    2777 </span>            :                 return false;</a>
<a name="2778"><span class="lineNum">    2778 </span>            : </a>
<a name="2779"><span class="lineNum">    2779 </span><span class="lineNoCov">          0 :         int_max_clk = bw_fixed_to_int(vbios-&gt;high_sclk);</span></a>
<a name="2780"><span class="lineNum">    2780 </span><span class="lineNoCov">          0 :         int_max_clk *= 1000; /* MHz to kHz */</span></a>
<a name="2781"><span class="lineNum">    2781 </span><span class="lineNoCov">          0 :         if (calcs_output-&gt;sclk_khz &gt; int_max_clk)</span></a>
<a name="2782"><span class="lineNum">    2782 </span>            :                 return false;</a>
<a name="2783"><span class="lineNum">    2783 </span>            : </a>
<a name="2784"><span class="lineNum">    2784 </span>            :         return true;</a>
<a name="2785"><span class="lineNum">    2785 </span>            : }</a>
<a name="2786"><span class="lineNum">    2786 </span>            : </a>
<a name="2787"><span class="lineNum">    2787 </span><span class="lineNoCov">          0 : static void populate_initial_data(</span></a>
<a name="2788"><span class="lineNum">    2788 </span>            :         const struct pipe_ctx pipe[], int pipe_count, struct bw_calcs_data *data)</a>
<a name="2789"><span class="lineNum">    2789 </span>            : {</a>
<a name="2790"><span class="lineNum">    2790 </span>            :         int i, j;</a>
<a name="2791"><span class="lineNum">    2791 </span><span class="lineNoCov">          0 :         int num_displays = 0;</span></a>
<a name="2792"><span class="lineNum">    2792 </span>            : </a>
<a name="2793"><span class="lineNum">    2793 </span><span class="lineNoCov">          0 :         data-&gt;underlay_surface_type = bw_def_420;</span></a>
<a name="2794"><span class="lineNum">    2794 </span><span class="lineNoCov">          0 :         data-&gt;panning_and_bezel_adjustment = bw_def_none;</span></a>
<a name="2795"><span class="lineNum">    2795 </span><span class="lineNoCov">          0 :         data-&gt;graphics_lb_bpc = 10;</span></a>
<a name="2796"><span class="lineNum">    2796 </span><span class="lineNoCov">          0 :         data-&gt;underlay_lb_bpc = 8;</span></a>
<a name="2797"><span class="lineNum">    2797 </span><span class="lineNoCov">          0 :         data-&gt;underlay_tiling_mode = bw_def_tiled;</span></a>
<a name="2798"><span class="lineNum">    2798 </span><span class="lineNoCov">          0 :         data-&gt;graphics_tiling_mode = bw_def_tiled;</span></a>
<a name="2799"><span class="lineNum">    2799 </span><span class="lineNoCov">          0 :         data-&gt;underlay_micro_tile_mode = bw_def_display_micro_tiling;</span></a>
<a name="2800"><span class="lineNum">    2800 </span><span class="lineNoCov">          0 :         data-&gt;graphics_micro_tile_mode = bw_def_display_micro_tiling;</span></a>
<a name="2801"><span class="lineNum">    2801 </span><span class="lineNoCov">          0 :         data-&gt;increase_voltage_to_support_mclk_switch = true;</span></a>
<a name="2802"><span class="lineNum">    2802 </span>            : </a>
<a name="2803"><span class="lineNum">    2803 </span>            :         /* Pipes with underlay first */</a>
<a name="2804"><span class="lineNum">    2804 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; pipe_count; i++) {</span></a>
<a name="2805"><span class="lineNum">    2805 </span><span class="lineNoCov">          0 :                 if (!pipe[i].stream || !pipe[i].bottom_pipe)</span></a>
<a name="2806"><span class="lineNum">    2806 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="2807"><span class="lineNum">    2807 </span>            : </a>
<a name="2808"><span class="lineNum">    2808 </span><span class="lineNoCov">          0 :                 ASSERT(pipe[i].plane_state);</span></a>
<a name="2809"><span class="lineNum">    2809 </span>            : </a>
<a name="2810"><span class="lineNum">    2810 </span><span class="lineNoCov">          0 :                 if (num_displays == 0) {</span></a>
<a name="2811"><span class="lineNum">    2811 </span><span class="lineNoCov">          0 :                         if (!pipe[i].plane_state-&gt;visible)</span></a>
<a name="2812"><span class="lineNum">    2812 </span><span class="lineNoCov">          0 :                                 data-&gt;d0_underlay_mode = bw_def_underlay_only;</span></a>
<a name="2813"><span class="lineNum">    2813 </span>            :                         else</a>
<a name="2814"><span class="lineNum">    2814 </span><span class="lineNoCov">          0 :                                 data-&gt;d0_underlay_mode = bw_def_blend;</span></a>
<a name="2815"><span class="lineNum">    2815 </span>            :                 } else {</a>
<a name="2816"><span class="lineNum">    2816 </span><span class="lineNoCov">          0 :                         if (!pipe[i].plane_state-&gt;visible)</span></a>
<a name="2817"><span class="lineNum">    2817 </span><span class="lineNoCov">          0 :                                 data-&gt;d1_underlay_mode = bw_def_underlay_only;</span></a>
<a name="2818"><span class="lineNum">    2818 </span>            :                         else</a>
<a name="2819"><span class="lineNum">    2819 </span><span class="lineNoCov">          0 :                                 data-&gt;d1_underlay_mode = bw_def_blend;</span></a>
<a name="2820"><span class="lineNum">    2820 </span>            :                 }</a>
<a name="2821"><span class="lineNum">    2821 </span>            : </a>
<a name="2822"><span class="lineNum">    2822 </span><span class="lineNoCov">          0 :                 data-&gt;fbc_en[num_displays + 4] = false;</span></a>
<a name="2823"><span class="lineNum">    2823 </span><span class="lineNoCov">          0 :                 data-&gt;lpt_en[num_displays + 4] = false;</span></a>
<a name="2824"><span class="lineNum">    2824 </span><span class="lineNoCov">          0 :                 data-&gt;h_total[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;timing.h_total);</span></a>
<a name="2825"><span class="lineNum">    2825 </span><span class="lineNoCov">          0 :                 data-&gt;v_total[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;timing.v_total);</span></a>
<a name="2826"><span class="lineNum">    2826 </span><span class="lineNoCov">          0 :                 data-&gt;pixel_rate[num_displays + 4] = bw_frc_to_fixed(pipe[i].stream-&gt;timing.pix_clk_100hz, 10000);</span></a>
<a name="2827"><span class="lineNum">    2827 </span><span class="lineNoCov">          0 :                 data-&gt;src_width[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.viewport.width);</span></a>
<a name="2828"><span class="lineNum">    2828 </span><span class="lineNoCov">          0 :                 data-&gt;pitch_in_pixels[num_displays + 4] = data-&gt;src_width[num_displays + 4];</span></a>
<a name="2829"><span class="lineNum">    2829 </span><span class="lineNoCov">          0 :                 data-&gt;src_height[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.viewport.height);</span></a>
<a name="2830"><span class="lineNum">    2830 </span><span class="lineNoCov">          0 :                 data-&gt;h_taps[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.taps.h_taps);</span></a>
<a name="2831"><span class="lineNum">    2831 </span><span class="lineNoCov">          0 :                 data-&gt;v_taps[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.taps.v_taps);</span></a>
<a name="2832"><span class="lineNum">    2832 </span><span class="lineNoCov">          0 :                 data-&gt;h_scale_ratio[num_displays + 4] = fixed31_32_to_bw_fixed(pipe[i].plane_res.scl_data.ratios.horz.value);</span></a>
<a name="2833"><span class="lineNum">    2833 </span><span class="lineNoCov">          0 :                 data-&gt;v_scale_ratio[num_displays + 4] = fixed31_32_to_bw_fixed(pipe[i].plane_res.scl_data.ratios.vert.value);</span></a>
<a name="2834"><span class="lineNum">    2834 </span><span class="lineNoCov">          0 :                 switch (pipe[i].plane_state-&gt;rotation) {</span></a>
<a name="2835"><span class="lineNum">    2835 </span>            :                 case ROTATION_ANGLE_0:</a>
<a name="2836"><span class="lineNum">    2836 </span><span class="lineNoCov">          0 :                         data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(0);</span></a>
<a name="2837"><span class="lineNum">    2837 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2838"><span class="lineNum">    2838 </span>            :                 case ROTATION_ANGLE_90:</a>
<a name="2839"><span class="lineNum">    2839 </span><span class="lineNoCov">          0 :                         data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(90);</span></a>
<a name="2840"><span class="lineNum">    2840 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2841"><span class="lineNum">    2841 </span>            :                 case ROTATION_ANGLE_180:</a>
<a name="2842"><span class="lineNum">    2842 </span><span class="lineNoCov">          0 :                         data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(180);</span></a>
<a name="2843"><span class="lineNum">    2843 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2844"><span class="lineNum">    2844 </span>            :                 case ROTATION_ANGLE_270:</a>
<a name="2845"><span class="lineNum">    2845 </span><span class="lineNoCov">          0 :                         data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(270);</span></a>
<a name="2846"><span class="lineNum">    2846 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2847"><span class="lineNum">    2847 </span>            :                 default:</a>
<a name="2848"><span class="lineNum">    2848 </span>            :                         break;</a>
<a name="2849"><span class="lineNum">    2849 </span>            :                 }</a>
<a name="2850"><span class="lineNum">    2850 </span><span class="lineNoCov">          0 :                 switch (pipe[i].plane_state-&gt;format) {</span></a>
<a name="2851"><span class="lineNum">    2851 </span>            :                 case SURFACE_PIXEL_FORMAT_VIDEO_420_YCbCr:</a>
<a name="2852"><span class="lineNum">    2852 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ARGB1555:</a>
<a name="2853"><span class="lineNum">    2853 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_RGB565:</a>
<a name="2854"><span class="lineNum">    2854 </span><span class="lineNoCov">          0 :                         data-&gt;bytes_per_pixel[num_displays + 4] = 2;</span></a>
<a name="2855"><span class="lineNum">    2855 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2856"><span class="lineNum">    2856 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ARGB8888:</a>
<a name="2857"><span class="lineNum">    2857 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ABGR8888:</a>
<a name="2858"><span class="lineNum">    2858 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ARGB2101010:</a>
<a name="2859"><span class="lineNum">    2859 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010:</a>
<a name="2860"><span class="lineNum">    2860 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010_XR_BIAS:</a>
<a name="2861"><span class="lineNum">    2861 </span>            :                 case SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCbCr:</a>
<a name="2862"><span class="lineNum">    2862 </span>            :                 case SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCrCb:</a>
<a name="2863"><span class="lineNum">    2863 </span><span class="lineNoCov">          0 :                         data-&gt;bytes_per_pixel[num_displays + 4] = 4;</span></a>
<a name="2864"><span class="lineNum">    2864 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2865"><span class="lineNum">    2865 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:</a>
<a name="2866"><span class="lineNum">    2866 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616:</a>
<a name="2867"><span class="lineNum">    2867 </span>            :                 case SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F:</a>
<a name="2868"><span class="lineNum">    2868 </span><span class="lineNoCov">          0 :                         data-&gt;bytes_per_pixel[num_displays + 4] = 8;</span></a>
<a name="2869"><span class="lineNum">    2869 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2870"><span class="lineNum">    2870 </span>            :                 default:</a>
<a name="2871"><span class="lineNum">    2871 </span><span class="lineNoCov">          0 :                         data-&gt;bytes_per_pixel[num_displays + 4] = 4;</span></a>
<a name="2872"><span class="lineNum">    2872 </span><span class="lineNoCov">          0 :                         break;</span></a>
<a name="2873"><span class="lineNum">    2873 </span>            :                 }</a>
<a name="2874"><span class="lineNum">    2874 </span><span class="lineNoCov">          0 :                 data-&gt;interlace_mode[num_displays + 4] = false;</span></a>
<a name="2875"><span class="lineNum">    2875 </span><span class="lineNoCov">          0 :                 data-&gt;stereo_mode[num_displays + 4] = bw_def_mono;</span></a>
<a name="2876"><span class="lineNum">    2876 </span>            : </a>
<a name="2877"><span class="lineNum">    2877 </span>            : </a>
<a name="2878"><span class="lineNum">    2878 </span><span class="lineNoCov">          0 :                 for (j = 0; j &lt; 2; j++) {</span></a>
<a name="2879"><span class="lineNum">    2879 </span><span class="lineNoCov">          0 :                         data-&gt;fbc_en[num_displays * 2 + j] = false;</span></a>
<a name="2880"><span class="lineNum">    2880 </span><span class="lineNoCov">          0 :                         data-&gt;lpt_en[num_displays * 2 + j] = false;</span></a>
<a name="2881"><span class="lineNum">    2881 </span>            : </a>
<a name="2882"><span class="lineNum">    2882 </span><span class="lineNoCov">          0 :                         data-&gt;src_height[num_displays * 2 + j] = bw_int_to_fixed(pipe[i].bottom_pipe-&gt;plane_res.scl_data.viewport.height);</span></a>
<a name="2883"><span class="lineNum">    2883 </span><span class="lineNoCov">          0 :                         data-&gt;src_width[num_displays * 2 + j] = bw_int_to_fixed(pipe[i].bottom_pipe-&gt;plane_res.scl_data.viewport.width);</span></a>
<a name="2884"><span class="lineNum">    2884 </span><span class="lineNoCov">          0 :                         data-&gt;pitch_in_pixels[num_displays * 2 + j] = bw_int_to_fixed(</span></a>
<a name="2885"><span class="lineNum">    2885 </span><span class="lineNoCov">          0 :                                         pipe[i].bottom_pipe-&gt;plane_state-&gt;plane_size.surface_pitch);</span></a>
<a name="2886"><span class="lineNum">    2886 </span><span class="lineNoCov">          0 :                         data-&gt;h_taps[num_displays * 2 + j] = bw_int_to_fixed(pipe[i].bottom_pipe-&gt;plane_res.scl_data.taps.h_taps);</span></a>
<a name="2887"><span class="lineNum">    2887 </span><span class="lineNoCov">          0 :                         data-&gt;v_taps[num_displays * 2 + j] = bw_int_to_fixed(pipe[i].bottom_pipe-&gt;plane_res.scl_data.taps.v_taps);</span></a>
<a name="2888"><span class="lineNum">    2888 </span><span class="lineNoCov">          0 :                         data-&gt;h_scale_ratio[num_displays * 2 + j] = fixed31_32_to_bw_fixed(</span></a>
<a name="2889"><span class="lineNum">    2889 </span><span class="lineNoCov">          0 :                                         pipe[i].bottom_pipe-&gt;plane_res.scl_data.ratios.horz.value);</span></a>
<a name="2890"><span class="lineNum">    2890 </span><span class="lineNoCov">          0 :                         data-&gt;v_scale_ratio[num_displays * 2 + j] = fixed31_32_to_bw_fixed(</span></a>
<a name="2891"><span class="lineNum">    2891 </span><span class="lineNoCov">          0 :                                         pipe[i].bottom_pipe-&gt;plane_res.scl_data.ratios.vert.value);</span></a>
<a name="2892"><span class="lineNum">    2892 </span><span class="lineNoCov">          0 :                         switch (pipe[i].bottom_pipe-&gt;plane_state-&gt;rotation) {</span></a>
<a name="2893"><span class="lineNum">    2893 </span>            :                         case ROTATION_ANGLE_0:</a>
<a name="2894"><span class="lineNum">    2894 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays * 2 + j] = bw_int_to_fixed(0);</span></a>
<a name="2895"><span class="lineNum">    2895 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2896"><span class="lineNum">    2896 </span>            :                         case ROTATION_ANGLE_90:</a>
<a name="2897"><span class="lineNum">    2897 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays * 2 + j] = bw_int_to_fixed(90);</span></a>
<a name="2898"><span class="lineNum">    2898 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2899"><span class="lineNum">    2899 </span>            :                         case ROTATION_ANGLE_180:</a>
<a name="2900"><span class="lineNum">    2900 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays * 2 + j] = bw_int_to_fixed(180);</span></a>
<a name="2901"><span class="lineNum">    2901 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2902"><span class="lineNum">    2902 </span>            :                         case ROTATION_ANGLE_270:</a>
<a name="2903"><span class="lineNum">    2903 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays * 2 + j] = bw_int_to_fixed(270);</span></a>
<a name="2904"><span class="lineNum">    2904 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2905"><span class="lineNum">    2905 </span>            :                         default:</a>
<a name="2906"><span class="lineNum">    2906 </span>            :                                 break;</a>
<a name="2907"><span class="lineNum">    2907 </span>            :                         }</a>
<a name="2908"><span class="lineNum">    2908 </span><span class="lineNoCov">          0 :                         data-&gt;stereo_mode[num_displays * 2 + j] = bw_def_mono;</span></a>
<a name="2909"><span class="lineNum">    2909 </span>            :                 }</a>
<a name="2910"><span class="lineNum">    2910 </span>            : </a>
<a name="2911"><span class="lineNum">    2911 </span><span class="lineNoCov">          0 :                 num_displays++;</span></a>
<a name="2912"><span class="lineNum">    2912 </span>            :         }</a>
<a name="2913"><span class="lineNum">    2913 </span>            : </a>
<a name="2914"><span class="lineNum">    2914 </span>            :         /* Pipes without underlay after */</a>
<a name="2915"><span class="lineNum">    2915 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; pipe_count; i++) {</span></a>
<a name="2916"><span class="lineNum">    2916 </span>            :                 unsigned int pixel_clock_100hz;</a>
<a name="2917"><span class="lineNum">    2917 </span><span class="lineNoCov">          0 :                 if (!pipe[i].stream || pipe[i].bottom_pipe)</span></a>
<a name="2918"><span class="lineNum">    2918 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="2919"><span class="lineNum">    2919 </span>            : </a>
<a name="2920"><span class="lineNum">    2920 </span>            : </a>
<a name="2921"><span class="lineNum">    2921 </span><span class="lineNoCov">          0 :                 data-&gt;fbc_en[num_displays + 4] = false;</span></a>
<a name="2922"><span class="lineNum">    2922 </span><span class="lineNoCov">          0 :                 data-&gt;lpt_en[num_displays + 4] = false;</span></a>
<a name="2923"><span class="lineNum">    2923 </span><span class="lineNoCov">          0 :                 data-&gt;h_total[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;timing.h_total);</span></a>
<a name="2924"><span class="lineNum">    2924 </span><span class="lineNoCov">          0 :                 data-&gt;v_total[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;timing.v_total);</span></a>
<a name="2925"><span class="lineNum">    2925 </span><span class="lineNoCov">          0 :                 pixel_clock_100hz = pipe[i].stream-&gt;timing.pix_clk_100hz;</span></a>
<a name="2926"><span class="lineNum">    2926 </span><span class="lineNoCov">          0 :                 if (pipe[i].stream-&gt;timing.timing_3d_format == TIMING_3D_FORMAT_HW_FRAME_PACKING)</span></a>
<a name="2927"><span class="lineNum">    2927 </span><span class="lineNoCov">          0 :                         pixel_clock_100hz *= 2;</span></a>
<a name="2928"><span class="lineNum">    2928 </span><span class="lineNoCov">          0 :                 data-&gt;pixel_rate[num_displays + 4] = bw_frc_to_fixed(pixel_clock_100hz, 10000);</span></a>
<a name="2929"><span class="lineNum">    2929 </span><span class="lineNoCov">          0 :                 if (pipe[i].plane_state) {</span></a>
<a name="2930"><span class="lineNum">    2930 </span><span class="lineNoCov">          0 :                         data-&gt;src_width[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.viewport.width);</span></a>
<a name="2931"><span class="lineNum">    2931 </span><span class="lineNoCov">          0 :                         data-&gt;pitch_in_pixels[num_displays + 4] = data-&gt;src_width[num_displays + 4];</span></a>
<a name="2932"><span class="lineNum">    2932 </span><span class="lineNoCov">          0 :                         data-&gt;src_height[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.viewport.height);</span></a>
<a name="2933"><span class="lineNum">    2933 </span><span class="lineNoCov">          0 :                         data-&gt;h_taps[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.taps.h_taps);</span></a>
<a name="2934"><span class="lineNum">    2934 </span><span class="lineNoCov">          0 :                         data-&gt;v_taps[num_displays + 4] = bw_int_to_fixed(pipe[i].plane_res.scl_data.taps.v_taps);</span></a>
<a name="2935"><span class="lineNum">    2935 </span><span class="lineNoCov">          0 :                         data-&gt;h_scale_ratio[num_displays + 4] = fixed31_32_to_bw_fixed(pipe[i].plane_res.scl_data.ratios.horz.value);</span></a>
<a name="2936"><span class="lineNum">    2936 </span><span class="lineNoCov">          0 :                         data-&gt;v_scale_ratio[num_displays + 4] = fixed31_32_to_bw_fixed(pipe[i].plane_res.scl_data.ratios.vert.value);</span></a>
<a name="2937"><span class="lineNum">    2937 </span><span class="lineNoCov">          0 :                         switch (pipe[i].plane_state-&gt;rotation) {</span></a>
<a name="2938"><span class="lineNum">    2938 </span>            :                         case ROTATION_ANGLE_0:</a>
<a name="2939"><span class="lineNum">    2939 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(0);</span></a>
<a name="2940"><span class="lineNum">    2940 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2941"><span class="lineNum">    2941 </span>            :                         case ROTATION_ANGLE_90:</a>
<a name="2942"><span class="lineNum">    2942 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(90);</span></a>
<a name="2943"><span class="lineNum">    2943 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2944"><span class="lineNum">    2944 </span>            :                         case ROTATION_ANGLE_180:</a>
<a name="2945"><span class="lineNum">    2945 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(180);</span></a>
<a name="2946"><span class="lineNum">    2946 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2947"><span class="lineNum">    2947 </span>            :                         case ROTATION_ANGLE_270:</a>
<a name="2948"><span class="lineNum">    2948 </span><span class="lineNoCov">          0 :                                 data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(270);</span></a>
<a name="2949"><span class="lineNum">    2949 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2950"><span class="lineNum">    2950 </span>            :                         default:</a>
<a name="2951"><span class="lineNum">    2951 </span>            :                                 break;</a>
<a name="2952"><span class="lineNum">    2952 </span>            :                         }</a>
<a name="2953"><span class="lineNum">    2953 </span><span class="lineNoCov">          0 :                         switch (pipe[i].plane_state-&gt;format) {</span></a>
<a name="2954"><span class="lineNum">    2954 </span>            :                         case SURFACE_PIXEL_FORMAT_VIDEO_420_YCbCr:</a>
<a name="2955"><span class="lineNum">    2955 </span>            :                         case SURFACE_PIXEL_FORMAT_VIDEO_420_YCrCb:</a>
<a name="2956"><span class="lineNum">    2956 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ARGB1555:</a>
<a name="2957"><span class="lineNum">    2957 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_RGB565:</a>
<a name="2958"><span class="lineNum">    2958 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_pixel[num_displays + 4] = 2;</span></a>
<a name="2959"><span class="lineNum">    2959 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2960"><span class="lineNum">    2960 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ARGB8888:</a>
<a name="2961"><span class="lineNum">    2961 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ABGR8888:</a>
<a name="2962"><span class="lineNum">    2962 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ARGB2101010:</a>
<a name="2963"><span class="lineNum">    2963 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010:</a>
<a name="2964"><span class="lineNum">    2964 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010_XR_BIAS:</a>
<a name="2965"><span class="lineNum">    2965 </span>            :                         case SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCbCr:</a>
<a name="2966"><span class="lineNum">    2966 </span>            :                         case SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCrCb:</a>
<a name="2967"><span class="lineNum">    2967 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_pixel[num_displays + 4] = 4;</span></a>
<a name="2968"><span class="lineNum">    2968 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2969"><span class="lineNum">    2969 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:</a>
<a name="2970"><span class="lineNum">    2970 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616:</a>
<a name="2971"><span class="lineNum">    2971 </span>            :                         case SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F:</a>
<a name="2972"><span class="lineNum">    2972 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_pixel[num_displays + 4] = 8;</span></a>
<a name="2973"><span class="lineNum">    2973 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2974"><span class="lineNum">    2974 </span>            :                         default:</a>
<a name="2975"><span class="lineNum">    2975 </span><span class="lineNoCov">          0 :                                 data-&gt;bytes_per_pixel[num_displays + 4] = 4;</span></a>
<a name="2976"><span class="lineNum">    2976 </span><span class="lineNoCov">          0 :                                 break;</span></a>
<a name="2977"><span class="lineNum">    2977 </span>            :                         }</a>
<a name="2978"><span class="lineNum">    2978 </span><span class="lineNoCov">          0 :                 } else if (pipe[i].stream-&gt;dst.width != 0 &amp;&amp;</span></a>
<a name="2979"><span class="lineNum">    2979 </span><span class="lineNoCov">          0 :                                         pipe[i].stream-&gt;dst.height != 0 &amp;&amp;</span></a>
<a name="2980"><span class="lineNum">    2980 </span><span class="lineNoCov">          0 :                                         pipe[i].stream-&gt;src.width != 0 &amp;&amp;</span></a>
<a name="2981"><span class="lineNum">    2981 </span><span class="lineNoCov">          0 :                                         pipe[i].stream-&gt;src.height != 0) {</span></a>
<a name="2982"><span class="lineNum">    2982 </span><span class="lineNoCov">          0 :                         data-&gt;src_width[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;src.width);</span></a>
<a name="2983"><span class="lineNum">    2983 </span><span class="lineNoCov">          0 :                         data-&gt;pitch_in_pixels[num_displays + 4] = data-&gt;src_width[num_displays + 4];</span></a>
<a name="2984"><span class="lineNum">    2984 </span><span class="lineNoCov">          0 :                         data-&gt;src_height[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;src.height);</span></a>
<a name="2985"><span class="lineNum">    2985 </span><span class="lineNoCov">          0 :                         data-&gt;h_taps[num_displays + 4] = pipe[i].stream-&gt;src.width == pipe[i].stream-&gt;dst.width ? bw_int_to_fixed(1) : bw_int_to_fixed(2);</span></a>
<a name="2986"><span class="lineNum">    2986 </span><span class="lineNoCov">          0 :                         data-&gt;v_taps[num_displays + 4] = pipe[i].stream-&gt;src.height == pipe[i].stream-&gt;dst.height ? bw_int_to_fixed(1) : bw_int_to_fixed(2);</span></a>
<a name="2987"><span class="lineNum">    2987 </span><span class="lineNoCov">          0 :                         data-&gt;h_scale_ratio[num_displays + 4] = bw_frc_to_fixed(pipe[i].stream-&gt;src.width, pipe[i].stream-&gt;dst.width);</span></a>
<a name="2988"><span class="lineNum">    2988 </span><span class="lineNoCov">          0 :                         data-&gt;v_scale_ratio[num_displays + 4] = bw_frc_to_fixed(pipe[i].stream-&gt;src.height, pipe[i].stream-&gt;dst.height);</span></a>
<a name="2989"><span class="lineNum">    2989 </span><span class="lineNoCov">          0 :                         data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(0);</span></a>
<a name="2990"><span class="lineNum">    2990 </span><span class="lineNoCov">          0 :                         data-&gt;bytes_per_pixel[num_displays + 4] = 4;</span></a>
<a name="2991"><span class="lineNum">    2991 </span>            :                 } else {</a>
<a name="2992"><span class="lineNum">    2992 </span><span class="lineNoCov">          0 :                         data-&gt;src_width[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;timing.h_addressable);</span></a>
<a name="2993"><span class="lineNum">    2993 </span><span class="lineNoCov">          0 :                         data-&gt;pitch_in_pixels[num_displays + 4] = data-&gt;src_width[num_displays + 4];</span></a>
<a name="2994"><span class="lineNum">    2994 </span><span class="lineNoCov">          0 :                         data-&gt;src_height[num_displays + 4] = bw_int_to_fixed(pipe[i].stream-&gt;timing.v_addressable);</span></a>
<a name="2995"><span class="lineNum">    2995 </span><span class="lineNoCov">          0 :                         data-&gt;h_taps[num_displays + 4] = bw_int_to_fixed(1);</span></a>
<a name="2996"><span class="lineNum">    2996 </span><span class="lineNoCov">          0 :                         data-&gt;v_taps[num_displays + 4] = bw_int_to_fixed(1);</span></a>
<a name="2997"><span class="lineNum">    2997 </span><span class="lineNoCov">          0 :                         data-&gt;h_scale_ratio[num_displays + 4] = bw_int_to_fixed(1);</span></a>
<a name="2998"><span class="lineNum">    2998 </span><span class="lineNoCov">          0 :                         data-&gt;v_scale_ratio[num_displays + 4] = bw_int_to_fixed(1);</span></a>
<a name="2999"><span class="lineNum">    2999 </span><span class="lineNoCov">          0 :                         data-&gt;rotation_angle[num_displays + 4] = bw_int_to_fixed(0);</span></a>
<a name="3000"><span class="lineNum">    3000 </span><span class="lineNoCov">          0 :                         data-&gt;bytes_per_pixel[num_displays + 4] = 4;</span></a>
<a name="3001"><span class="lineNum">    3001 </span>            :                 }</a>
<a name="3002"><span class="lineNum">    3002 </span>            : </a>
<a name="3003"><span class="lineNum">    3003 </span><span class="lineNoCov">          0 :                 data-&gt;interlace_mode[num_displays + 4] = false;</span></a>
<a name="3004"><span class="lineNum">    3004 </span><span class="lineNoCov">          0 :                 data-&gt;stereo_mode[num_displays + 4] = bw_def_mono;</span></a>
<a name="3005"><span class="lineNum">    3005 </span><span class="lineNoCov">          0 :                 num_displays++;</span></a>
<a name="3006"><span class="lineNum">    3006 </span>            :         }</a>
<a name="3007"><span class="lineNum">    3007 </span>            : </a>
<a name="3008"><span class="lineNum">    3008 </span><span class="lineNoCov">          0 :         data-&gt;number_of_displays = num_displays;</span></a>
<a name="3009"><span class="lineNum">    3009 </span><span class="lineNoCov">          0 : }</span></a>
<a name="3010"><span class="lineNum">    3010 </span>            : </a>
<a name="3011"><span class="lineNum">    3011 </span><span class="lineNoCov">          0 : static bool all_displays_in_sync(const struct pipe_ctx pipe[],</span></a>
<a name="3012"><span class="lineNum">    3012 </span>            :                                  int pipe_count)</a>
<a name="3013"><span class="lineNum">    3013 </span>            : {</a>
<a name="3014"><span class="lineNum">    3014 </span>            :         const struct pipe_ctx *active_pipes[MAX_PIPES];</a>
<a name="3015"><span class="lineNum">    3015 </span><span class="lineNoCov">          0 :         int i, num_active_pipes = 0;</span></a>
<a name="3016"><span class="lineNum">    3016 </span>            : </a>
<a name="3017"><span class="lineNum">    3017 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; pipe_count; i++) {</span></a>
<a name="3018"><span class="lineNum">    3018 </span><span class="lineNoCov">          0 :                 if (!pipe[i].stream || pipe[i].top_pipe)</span></a>
<a name="3019"><span class="lineNum">    3019 </span><span class="lineNoCov">          0 :                         continue;</span></a>
<a name="3020"><span class="lineNum">    3020 </span>            : </a>
<a name="3021"><span class="lineNum">    3021 </span><span class="lineNoCov">          0 :                 active_pipes[num_active_pipes++] = &amp;pipe[i];</span></a>
<a name="3022"><span class="lineNum">    3022 </span>            :         }</a>
<a name="3023"><span class="lineNum">    3023 </span>            : </a>
<a name="3024"><span class="lineNum">    3024 </span><span class="lineNoCov">          0 :         if (!num_active_pipes)</span></a>
<a name="3025"><span class="lineNum">    3025 </span>            :                 return false;</a>
<a name="3026"><span class="lineNum">    3026 </span>            : </a>
<a name="3027"><span class="lineNum">    3027 </span><span class="lineNoCov">          0 :         for (i = 1; i &lt; num_active_pipes; ++i) {</span></a>
<a name="3028"><span class="lineNum">    3028 </span><span class="lineNoCov">          0 :                 if (!resource_are_streams_timing_synchronizable(</span></a>
<a name="3029"><span class="lineNum">    3029 </span><span class="lineNoCov">          0 :                             active_pipes[0]-&gt;stream, active_pipes[i]-&gt;stream)) {</span></a>
<a name="3030"><span class="lineNum">    3030 </span>            :                         return false;</a>
<a name="3031"><span class="lineNum">    3031 </span>            :                 }</a>
<a name="3032"><span class="lineNum">    3032 </span>            :         }</a>
<a name="3033"><span class="lineNum">    3033 </span>            : </a>
<a name="3034"><span class="lineNum">    3034 </span>            :         return true;</a>
<a name="3035"><span class="lineNum">    3035 </span>            : }</a>
<a name="3036"><span class="lineNum">    3036 </span>            : </a>
<a name="3037"><span class="lineNum">    3037 </span>            : /*</a>
<a name="3038"><span class="lineNum">    3038 </span>            :  * Return:</a>
<a name="3039"><span class="lineNum">    3039 </span>            :  *      true -  Display(s) configuration supported.</a>
<a name="3040"><span class="lineNum">    3040 </span>            :  *              In this case 'calcs_output' contains data for HW programming</a>
<a name="3041"><span class="lineNum">    3041 </span>            :  *      false - Display(s) configuration not supported (not enough bandwidth).</a>
<a name="3042"><span class="lineNum">    3042 </span>            :  */</a>
<a name="3043"><span class="lineNum">    3043 </span><span class="lineNoCov">          0 : bool bw_calcs(struct dc_context *ctx,</span></a>
<a name="3044"><span class="lineNum">    3044 </span>            :         const struct bw_calcs_dceip *dceip,</a>
<a name="3045"><span class="lineNum">    3045 </span>            :         const struct bw_calcs_vbios *vbios,</a>
<a name="3046"><span class="lineNum">    3046 </span>            :         const struct pipe_ctx pipe[],</a>
<a name="3047"><span class="lineNum">    3047 </span>            :         int pipe_count,</a>
<a name="3048"><span class="lineNum">    3048 </span>            :         struct dce_bw_output *calcs_output)</a>
<a name="3049"><span class="lineNum">    3049 </span>            : {</a>
<a name="3050"><span class="lineNum">    3050 </span><span class="lineNoCov">          0 :         struct bw_calcs_data *data = kzalloc(sizeof(struct bw_calcs_data),</span></a>
<a name="3051"><span class="lineNum">    3051 </span>            :                                              GFP_KERNEL);</a>
<a name="3052"><span class="lineNum">    3052 </span><span class="lineNoCov">          0 :         if (!data)</span></a>
<a name="3053"><span class="lineNum">    3053 </span>            :                 return false;</a>
<a name="3054"><span class="lineNum">    3054 </span>            : </a>
<a name="3055"><span class="lineNum">    3055 </span><span class="lineNoCov">          0 :         populate_initial_data(pipe, pipe_count, data);</span></a>
<a name="3056"><span class="lineNum">    3056 </span>            : </a>
<a name="3057"><span class="lineNum">    3057 </span><span class="lineNoCov">          0 :         if (ctx-&gt;dc-&gt;config.multi_mon_pp_mclk_switch)</span></a>
<a name="3058"><span class="lineNum">    3058 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;all_displays_in_sync = all_displays_in_sync(pipe, pipe_count);</span></a>
<a name="3059"><span class="lineNum">    3059 </span>            :         else</a>
<a name="3060"><span class="lineNum">    3060 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;all_displays_in_sync = false;</span></a>
<a name="3061"><span class="lineNum">    3061 </span>            : </a>
<a name="3062"><span class="lineNum">    3062 </span><span class="lineNoCov">          0 :         if (data-&gt;number_of_displays != 0) {</span></a>
<a name="3063"><span class="lineNum">    3063 </span>            :                 uint8_t yclk_lvl;</a>
<a name="3064"><span class="lineNum">    3064 </span><span class="lineNoCov">          0 :                 struct bw_fixed high_sclk = vbios-&gt;high_sclk;</span></a>
<a name="3065"><span class="lineNum">    3065 </span><span class="lineNoCov">          0 :                 struct bw_fixed mid1_sclk = vbios-&gt;mid1_sclk;</span></a>
<a name="3066"><span class="lineNum">    3066 </span><span class="lineNoCov">          0 :                 struct bw_fixed mid2_sclk = vbios-&gt;mid2_sclk;</span></a>
<a name="3067"><span class="lineNum">    3067 </span><span class="lineNoCov">          0 :                 struct bw_fixed mid3_sclk = vbios-&gt;mid3_sclk;</span></a>
<a name="3068"><span class="lineNum">    3068 </span><span class="lineNoCov">          0 :                 struct bw_fixed mid4_sclk = vbios-&gt;mid4_sclk;</span></a>
<a name="3069"><span class="lineNum">    3069 </span><span class="lineNoCov">          0 :                 struct bw_fixed mid5_sclk = vbios-&gt;mid5_sclk;</span></a>
<a name="3070"><span class="lineNum">    3070 </span><span class="lineNoCov">          0 :                 struct bw_fixed mid6_sclk = vbios-&gt;mid6_sclk;</span></a>
<a name="3071"><span class="lineNum">    3071 </span><span class="lineNoCov">          0 :                 struct bw_fixed low_sclk = vbios-&gt;low_sclk;</span></a>
<a name="3072"><span class="lineNum">    3072 </span><span class="lineNoCov">          0 :                 struct bw_fixed high_yclk = vbios-&gt;high_yclk;</span></a>
<a name="3073"><span class="lineNum">    3073 </span><span class="lineNoCov">          0 :                 struct bw_fixed mid_yclk = vbios-&gt;mid_yclk;</span></a>
<a name="3074"><span class="lineNum">    3074 </span><span class="lineNoCov">          0 :                 struct bw_fixed low_yclk = vbios-&gt;low_yclk;</span></a>
<a name="3075"><span class="lineNum">    3075 </span>            : </a>
<a name="3076"><span class="lineNum">    3076 </span>            :                 if (ctx-&gt;dc-&gt;debug.bandwidth_calcs_trace) {</a>
<a name="3077"><span class="lineNum">    3077 </span>            :                         print_bw_calcs_dceip(ctx, dceip);</a>
<a name="3078"><span class="lineNum">    3078 </span>            :                         print_bw_calcs_vbios(ctx, vbios);</a>
<a name="3079"><span class="lineNum">    3079 </span>            :                         print_bw_calcs_data(ctx, data);</a>
<a name="3080"><span class="lineNum">    3080 </span>            :                 }</a>
<a name="3081"><span class="lineNum">    3081 </span><span class="lineNoCov">          0 :                 calculate_bandwidth(dceip, vbios, data);</span></a>
<a name="3082"><span class="lineNum">    3082 </span>            : </a>
<a name="3083"><span class="lineNum">    3083 </span><span class="lineNoCov">          0 :                 yclk_lvl = data-&gt;y_clk_level;</span></a>
<a name="3084"><span class="lineNum">    3084 </span>            : </a>
<a name="3085"><span class="lineNum">    3085 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_enable =</span></a>
<a name="3086"><span class="lineNum">    3086 </span><span class="lineNoCov">          0 :                         data-&gt;nbp_state_change_enable;</span></a>
<a name="3087"><span class="lineNum">    3087 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;cpuc_state_change_enable =</span></a>
<a name="3088"><span class="lineNum">    3088 </span><span class="lineNoCov">          0 :                                 data-&gt;cpuc_state_change_enable;</span></a>
<a name="3089"><span class="lineNum">    3089 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;cpup_state_change_enable =</span></a>
<a name="3090"><span class="lineNum">    3090 </span><span class="lineNoCov">          0 :                                 data-&gt;cpup_state_change_enable;</span></a>
<a name="3091"><span class="lineNum">    3091 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_mode_enable =</span></a>
<a name="3092"><span class="lineNum">    3092 </span><span class="lineNoCov">          0 :                                 data-&gt;stutter_mode_enable;</span></a>
<a name="3093"><span class="lineNum">    3093 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;dispclk_khz =</span></a>
<a name="3094"><span class="lineNum">    3094 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;dispclk,</span></a>
<a name="3095"><span class="lineNum">    3095 </span>            :                                         bw_int_to_fixed(1000)));</a>
<a name="3096"><span class="lineNum">    3096 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;blackout_recovery_time_us =</span></a>
<a name="3097"><span class="lineNum">    3097 </span>            :                         bw_fixed_to_int(data-&gt;blackout_recovery_time);</a>
<a name="3098"><span class="lineNum">    3098 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;sclk_khz =</span></a>
<a name="3099"><span class="lineNum">    3099 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;required_sclk,</span></a>
<a name="3100"><span class="lineNum">    3100 </span>            :                                         bw_int_to_fixed(1000)));</a>
<a name="3101"><span class="lineNum">    3101 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;sclk_deep_sleep_khz =</span></a>
<a name="3102"><span class="lineNum">    3102 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;sclk_deep_sleep,</span></a>
<a name="3103"><span class="lineNum">    3103 </span>            :                                         bw_int_to_fixed(1000)));</a>
<a name="3104"><span class="lineNum">    3104 </span><span class="lineNoCov">          0 :                 if (yclk_lvl == 0)</span></a>
<a name="3105"><span class="lineNum">    3105 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;yclk_khz = bw_fixed_to_int(</span></a>
<a name="3106"><span class="lineNum">    3106 </span>            :                                 bw_mul(low_yclk, bw_int_to_fixed(1000)));</a>
<a name="3107"><span class="lineNum">    3107 </span><span class="lineNoCov">          0 :                 else if (yclk_lvl == 1)</span></a>
<a name="3108"><span class="lineNum">    3108 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;yclk_khz = bw_fixed_to_int(</span></a>
<a name="3109"><span class="lineNum">    3109 </span>            :                                 bw_mul(mid_yclk, bw_int_to_fixed(1000)));</a>
<a name="3110"><span class="lineNum">    3110 </span>            :                 else</a>
<a name="3111"><span class="lineNum">    3111 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;yclk_khz = bw_fixed_to_int(</span></a>
<a name="3112"><span class="lineNum">    3112 </span>            :                                 bw_mul(high_yclk, bw_int_to_fixed(1000)));</a>
<a name="3113"><span class="lineNum">    3113 </span>            : </a>
<a name="3114"><span class="lineNum">    3114 </span>            :                 /* units: nanosecond, 16bit storage. */</a>
<a name="3115"><span class="lineNum">    3115 </span>            : </a>
<a name="3116"><span class="lineNum">    3116 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[0].a_mark =</span></a>
<a name="3117"><span class="lineNum">    3117 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3118"><span class="lineNum">    3118 </span>            :                                 nbp_state_change_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3119"><span class="lineNum">    3119 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[1].a_mark =</span></a>
<a name="3120"><span class="lineNum">    3120 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3121"><span class="lineNum">    3121 </span>            :                                 nbp_state_change_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3122"><span class="lineNum">    3122 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[2].a_mark =</span></a>
<a name="3123"><span class="lineNum">    3123 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3124"><span class="lineNum">    3124 </span>            :                                 nbp_state_change_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3125"><span class="lineNum">    3125 </span>            : </a>
<a name="3126"><span class="lineNum">    3126 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3127"><span class="lineNum">    3127 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[3].a_mark =</span></a>
<a name="3128"><span class="lineNum">    3128 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3129"><span class="lineNum">    3129 </span>            :                                         nbp_state_change_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3130"><span class="lineNum">    3130 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[4].a_mark =</span></a>
<a name="3131"><span class="lineNum">    3131 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3132"><span class="lineNum">    3132 </span>            :                                                         nbp_state_change_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3133"><span class="lineNum">    3133 </span>            :                 } else {</a>
<a name="3134"><span class="lineNum">    3134 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[3].a_mark =</span></a>
<a name="3135"><span class="lineNum">    3135 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3136"><span class="lineNum">    3136 </span>            :                                         nbp_state_change_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3137"><span class="lineNum">    3137 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[4].a_mark =</span></a>
<a name="3138"><span class="lineNum">    3138 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3139"><span class="lineNum">    3139 </span>            :                                         nbp_state_change_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3140"><span class="lineNum">    3140 </span>            :                 }</a>
<a name="3141"><span class="lineNum">    3141 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[5].a_mark =</span></a>
<a name="3142"><span class="lineNum">    3142 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3143"><span class="lineNum">    3143 </span>            :                                 nbp_state_change_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3144"><span class="lineNum">    3144 </span>            : </a>
<a name="3145"><span class="lineNum">    3145 </span>            : </a>
<a name="3146"><span class="lineNum">    3146 </span>            : </a>
<a name="3147"><span class="lineNum">    3147 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[0].a_mark =</span></a>
<a name="3148"><span class="lineNum">    3148 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3149"><span class="lineNum">    3149 </span>            :                                 stutter_exit_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3150"><span class="lineNum">    3150 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[1].a_mark =</span></a>
<a name="3151"><span class="lineNum">    3151 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3152"><span class="lineNum">    3152 </span>            :                                 stutter_exit_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3153"><span class="lineNum">    3153 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[2].a_mark =</span></a>
<a name="3154"><span class="lineNum">    3154 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3155"><span class="lineNum">    3155 </span>            :                                 stutter_exit_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3156"><span class="lineNum">    3156 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3157"><span class="lineNum">    3157 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[3].a_mark =</span></a>
<a name="3158"><span class="lineNum">    3158 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3159"><span class="lineNum">    3159 </span>            :                                         stutter_exit_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3160"><span class="lineNum">    3160 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[4].a_mark =</span></a>
<a name="3161"><span class="lineNum">    3161 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3162"><span class="lineNum">    3162 </span>            :                                         stutter_exit_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3163"><span class="lineNum">    3163 </span>            :                 } else {</a>
<a name="3164"><span class="lineNum">    3164 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[3].a_mark =</span></a>
<a name="3165"><span class="lineNum">    3165 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3166"><span class="lineNum">    3166 </span>            :                                         stutter_exit_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3167"><span class="lineNum">    3167 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[4].a_mark =</span></a>
<a name="3168"><span class="lineNum">    3168 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3169"><span class="lineNum">    3169 </span>            :                                         stutter_exit_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3170"><span class="lineNum">    3170 </span>            :                 }</a>
<a name="3171"><span class="lineNum">    3171 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[5].a_mark =</span></a>
<a name="3172"><span class="lineNum">    3172 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3173"><span class="lineNum">    3173 </span>            :                                 stutter_exit_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3174"><span class="lineNum">    3174 </span>            : </a>
<a name="3175"><span class="lineNum">    3175 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[0].a_mark =</span></a>
<a name="3176"><span class="lineNum">    3176 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3177"><span class="lineNum">    3177 </span>            :                                 stutter_entry_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3178"><span class="lineNum">    3178 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[1].a_mark =</span></a>
<a name="3179"><span class="lineNum">    3179 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3180"><span class="lineNum">    3180 </span>            :                                 stutter_entry_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3181"><span class="lineNum">    3181 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[2].a_mark =</span></a>
<a name="3182"><span class="lineNum">    3182 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3183"><span class="lineNum">    3183 </span>            :                                 stutter_entry_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3184"><span class="lineNum">    3184 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3185"><span class="lineNum">    3185 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[3].a_mark =</span></a>
<a name="3186"><span class="lineNum">    3186 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3187"><span class="lineNum">    3187 </span>            :                                         stutter_entry_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3188"><span class="lineNum">    3188 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[4].a_mark =</span></a>
<a name="3189"><span class="lineNum">    3189 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3190"><span class="lineNum">    3190 </span>            :                                         stutter_entry_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3191"><span class="lineNum">    3191 </span>            :                 } else {</a>
<a name="3192"><span class="lineNum">    3192 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[3].a_mark =</span></a>
<a name="3193"><span class="lineNum">    3193 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3194"><span class="lineNum">    3194 </span>            :                                         stutter_entry_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3195"><span class="lineNum">    3195 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[4].a_mark =</span></a>
<a name="3196"><span class="lineNum">    3196 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3197"><span class="lineNum">    3197 </span>            :                                         stutter_entry_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3198"><span class="lineNum">    3198 </span>            :                 }</a>
<a name="3199"><span class="lineNum">    3199 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[5].a_mark =</span></a>
<a name="3200"><span class="lineNum">    3200 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3201"><span class="lineNum">    3201 </span>            :                                 stutter_entry_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3202"><span class="lineNum">    3202 </span>            : </a>
<a name="3203"><span class="lineNum">    3203 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[0].a_mark =</span></a>
<a name="3204"><span class="lineNum">    3204 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3205"><span class="lineNum">    3205 </span>            :                                 urgent_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3206"><span class="lineNum">    3206 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[1].a_mark =</span></a>
<a name="3207"><span class="lineNum">    3207 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3208"><span class="lineNum">    3208 </span>            :                                 urgent_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3209"><span class="lineNum">    3209 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[2].a_mark =</span></a>
<a name="3210"><span class="lineNum">    3210 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3211"><span class="lineNum">    3211 </span>            :                                 urgent_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3212"><span class="lineNum">    3212 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3213"><span class="lineNum">    3213 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[3].a_mark =</span></a>
<a name="3214"><span class="lineNum">    3214 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3215"><span class="lineNum">    3215 </span>            :                                         urgent_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3216"><span class="lineNum">    3216 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[4].a_mark =</span></a>
<a name="3217"><span class="lineNum">    3217 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3218"><span class="lineNum">    3218 </span>            :                                         urgent_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3219"><span class="lineNum">    3219 </span>            :                 } else {</a>
<a name="3220"><span class="lineNum">    3220 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[3].a_mark =</span></a>
<a name="3221"><span class="lineNum">    3221 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3222"><span class="lineNum">    3222 </span>            :                                         urgent_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3223"><span class="lineNum">    3223 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[4].a_mark =</span></a>
<a name="3224"><span class="lineNum">    3224 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3225"><span class="lineNum">    3225 </span>            :                                         urgent_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3226"><span class="lineNum">    3226 </span>            :                 }</a>
<a name="3227"><span class="lineNum">    3227 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[5].a_mark =</span></a>
<a name="3228"><span class="lineNum">    3228 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3229"><span class="lineNum">    3229 </span>            :                                 urgent_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3230"><span class="lineNum">    3230 </span>            : </a>
<a name="3231"><span class="lineNum">    3231 </span><span class="lineNoCov">          0 :                 if (dceip-&gt;version != BW_CALCS_VERSION_CARRIZO) {</span></a>
<a name="3232"><span class="lineNum">    3232 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;low_sclk = mid3_sclk;</span></a>
<a name="3233"><span class="lineNum">    3233 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid1_sclk = mid3_sclk;</span></a>
<a name="3234"><span class="lineNum">    3234 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid2_sclk = mid3_sclk;</span></a>
<a name="3235"><span class="lineNum">    3235 </span><span class="lineNoCov">          0 :                         calculate_bandwidth(dceip, vbios, data);</span></a>
<a name="3236"><span class="lineNum">    3236 </span>            : </a>
<a name="3237"><span class="lineNum">    3237 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[0].b_mark =</span></a>
<a name="3238"><span class="lineNum">    3238 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3239"><span class="lineNum">    3239 </span>            :                                         nbp_state_change_watermark[4],bw_int_to_fixed(1000)));</a>
<a name="3240"><span class="lineNum">    3240 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[1].b_mark =</span></a>
<a name="3241"><span class="lineNum">    3241 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3242"><span class="lineNum">    3242 </span>            :                                         nbp_state_change_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3243"><span class="lineNum">    3243 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[2].b_mark =</span></a>
<a name="3244"><span class="lineNum">    3244 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3245"><span class="lineNum">    3245 </span>            :                                         nbp_state_change_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3246"><span class="lineNum">    3246 </span>            : </a>
<a name="3247"><span class="lineNum">    3247 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3248"><span class="lineNum">    3248 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[3].b_mark =</span></a>
<a name="3249"><span class="lineNum">    3249 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3250"><span class="lineNum">    3250 </span>            :                                                 nbp_state_change_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3251"><span class="lineNum">    3251 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[4].b_mark =</span></a>
<a name="3252"><span class="lineNum">    3252 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3253"><span class="lineNum">    3253 </span>            :                                                 nbp_state_change_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3254"><span class="lineNum">    3254 </span>            :                         } else {</a>
<a name="3255"><span class="lineNum">    3255 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[3].b_mark =</span></a>
<a name="3256"><span class="lineNum">    3256 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3257"><span class="lineNum">    3257 </span>            :                                                 nbp_state_change_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3258"><span class="lineNum">    3258 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[4].b_mark =</span></a>
<a name="3259"><span class="lineNum">    3259 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3260"><span class="lineNum">    3260 </span>            :                                                 nbp_state_change_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3261"><span class="lineNum">    3261 </span>            :                         }</a>
<a name="3262"><span class="lineNum">    3262 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[5].b_mark =</span></a>
<a name="3263"><span class="lineNum">    3263 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3264"><span class="lineNum">    3264 </span>            :                                         nbp_state_change_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3265"><span class="lineNum">    3265 </span>            : </a>
<a name="3266"><span class="lineNum">    3266 </span>            : </a>
<a name="3267"><span class="lineNum">    3267 </span>            : </a>
<a name="3268"><span class="lineNum">    3268 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[0].b_mark =</span></a>
<a name="3269"><span class="lineNum">    3269 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3270"><span class="lineNum">    3270 </span>            :                                         stutter_exit_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3271"><span class="lineNum">    3271 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[1].b_mark =</span></a>
<a name="3272"><span class="lineNum">    3272 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3273"><span class="lineNum">    3273 </span>            :                                         stutter_exit_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3274"><span class="lineNum">    3274 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[2].b_mark =</span></a>
<a name="3275"><span class="lineNum">    3275 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3276"><span class="lineNum">    3276 </span>            :                                         stutter_exit_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3277"><span class="lineNum">    3277 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3278"><span class="lineNum">    3278 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[3].b_mark =</span></a>
<a name="3279"><span class="lineNum">    3279 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3280"><span class="lineNum">    3280 </span>            :                                                 stutter_exit_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3281"><span class="lineNum">    3281 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[4].b_mark =</span></a>
<a name="3282"><span class="lineNum">    3282 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3283"><span class="lineNum">    3283 </span>            :                                                 stutter_exit_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3284"><span class="lineNum">    3284 </span>            :                         } else {</a>
<a name="3285"><span class="lineNum">    3285 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[3].b_mark =</span></a>
<a name="3286"><span class="lineNum">    3286 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3287"><span class="lineNum">    3287 </span>            :                                                 stutter_exit_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3288"><span class="lineNum">    3288 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[4].b_mark =</span></a>
<a name="3289"><span class="lineNum">    3289 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3290"><span class="lineNum">    3290 </span>            :                                                 stutter_exit_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3291"><span class="lineNum">    3291 </span>            :                         }</a>
<a name="3292"><span class="lineNum">    3292 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[5].b_mark =</span></a>
<a name="3293"><span class="lineNum">    3293 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3294"><span class="lineNum">    3294 </span>            :                                         stutter_exit_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3295"><span class="lineNum">    3295 </span>            : </a>
<a name="3296"><span class="lineNum">    3296 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[0].b_mark =</span></a>
<a name="3297"><span class="lineNum">    3297 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3298"><span class="lineNum">    3298 </span>            :                                         stutter_entry_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3299"><span class="lineNum">    3299 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[1].b_mark =</span></a>
<a name="3300"><span class="lineNum">    3300 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3301"><span class="lineNum">    3301 </span>            :                                         stutter_entry_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3302"><span class="lineNum">    3302 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[2].b_mark =</span></a>
<a name="3303"><span class="lineNum">    3303 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3304"><span class="lineNum">    3304 </span>            :                                         stutter_entry_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3305"><span class="lineNum">    3305 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3306"><span class="lineNum">    3306 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[3].b_mark =</span></a>
<a name="3307"><span class="lineNum">    3307 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3308"><span class="lineNum">    3308 </span>            :                                                 stutter_entry_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3309"><span class="lineNum">    3309 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[4].b_mark =</span></a>
<a name="3310"><span class="lineNum">    3310 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3311"><span class="lineNum">    3311 </span>            :                                                 stutter_entry_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3312"><span class="lineNum">    3312 </span>            :                         } else {</a>
<a name="3313"><span class="lineNum">    3313 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[3].b_mark =</span></a>
<a name="3314"><span class="lineNum">    3314 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3315"><span class="lineNum">    3315 </span>            :                                                 stutter_entry_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3316"><span class="lineNum">    3316 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[4].b_mark =</span></a>
<a name="3317"><span class="lineNum">    3317 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3318"><span class="lineNum">    3318 </span>            :                                                 stutter_entry_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3319"><span class="lineNum">    3319 </span>            :                         }</a>
<a name="3320"><span class="lineNum">    3320 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[5].b_mark =</span></a>
<a name="3321"><span class="lineNum">    3321 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3322"><span class="lineNum">    3322 </span>            :                                         stutter_entry_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3323"><span class="lineNum">    3323 </span>            : </a>
<a name="3324"><span class="lineNum">    3324 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[0].b_mark =</span></a>
<a name="3325"><span class="lineNum">    3325 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3326"><span class="lineNum">    3326 </span>            :                                         urgent_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3327"><span class="lineNum">    3327 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[1].b_mark =</span></a>
<a name="3328"><span class="lineNum">    3328 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3329"><span class="lineNum">    3329 </span>            :                                         urgent_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3330"><span class="lineNum">    3330 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[2].b_mark =</span></a>
<a name="3331"><span class="lineNum">    3331 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3332"><span class="lineNum">    3332 </span>            :                                         urgent_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3333"><span class="lineNum">    3333 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3334"><span class="lineNum">    3334 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[3].b_mark =</span></a>
<a name="3335"><span class="lineNum">    3335 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3336"><span class="lineNum">    3336 </span>            :                                                 urgent_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3337"><span class="lineNum">    3337 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[4].b_mark =</span></a>
<a name="3338"><span class="lineNum">    3338 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3339"><span class="lineNum">    3339 </span>            :                                                 urgent_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3340"><span class="lineNum">    3340 </span>            :                         } else {</a>
<a name="3341"><span class="lineNum">    3341 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[3].b_mark =</span></a>
<a name="3342"><span class="lineNum">    3342 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3343"><span class="lineNum">    3343 </span>            :                                                 urgent_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3344"><span class="lineNum">    3344 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[4].b_mark =</span></a>
<a name="3345"><span class="lineNum">    3345 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3346"><span class="lineNum">    3346 </span>            :                                                 urgent_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3347"><span class="lineNum">    3347 </span>            :                         }</a>
<a name="3348"><span class="lineNum">    3348 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[5].b_mark =</span></a>
<a name="3349"><span class="lineNum">    3349 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3350"><span class="lineNum">    3350 </span>            :                                         urgent_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3351"><span class="lineNum">    3351 </span>            : </a>
<a name="3352"><span class="lineNum">    3352 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;low_sclk = low_sclk;</span></a>
<a name="3353"><span class="lineNum">    3353 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid1_sclk = mid1_sclk;</span></a>
<a name="3354"><span class="lineNum">    3354 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid2_sclk = mid2_sclk;</span></a>
<a name="3355"><span class="lineNum">    3355 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;low_yclk = mid_yclk;</span></a>
<a name="3356"><span class="lineNum">    3356 </span><span class="lineNoCov">          0 :                         calculate_bandwidth(dceip, vbios, data);</span></a>
<a name="3357"><span class="lineNum">    3357 </span>            : </a>
<a name="3358"><span class="lineNum">    3358 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[0].c_mark =</span></a>
<a name="3359"><span class="lineNum">    3359 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3360"><span class="lineNum">    3360 </span>            :                                         nbp_state_change_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3361"><span class="lineNum">    3361 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[1].c_mark =</span></a>
<a name="3362"><span class="lineNum">    3362 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3363"><span class="lineNum">    3363 </span>            :                                         nbp_state_change_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3364"><span class="lineNum">    3364 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[2].c_mark =</span></a>
<a name="3365"><span class="lineNum">    3365 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3366"><span class="lineNum">    3366 </span>            :                                         nbp_state_change_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3367"><span class="lineNum">    3367 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3368"><span class="lineNum">    3368 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[3].c_mark =</span></a>
<a name="3369"><span class="lineNum">    3369 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3370"><span class="lineNum">    3370 </span>            :                                                 nbp_state_change_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3371"><span class="lineNum">    3371 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[4].c_mark =</span></a>
<a name="3372"><span class="lineNum">    3372 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3373"><span class="lineNum">    3373 </span>            :                                                 nbp_state_change_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3374"><span class="lineNum">    3374 </span>            :                         } else {</a>
<a name="3375"><span class="lineNum">    3375 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[3].c_mark =</span></a>
<a name="3376"><span class="lineNum">    3376 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3377"><span class="lineNum">    3377 </span>            :                                                 nbp_state_change_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3378"><span class="lineNum">    3378 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;nbp_state_change_wm_ns[4].c_mark =</span></a>
<a name="3379"><span class="lineNum">    3379 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3380"><span class="lineNum">    3380 </span>            :                                                 nbp_state_change_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3381"><span class="lineNum">    3381 </span>            :                         }</a>
<a name="3382"><span class="lineNum">    3382 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[5].c_mark =</span></a>
<a name="3383"><span class="lineNum">    3383 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3384"><span class="lineNum">    3384 </span>            :                                         nbp_state_change_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3385"><span class="lineNum">    3385 </span>            : </a>
<a name="3386"><span class="lineNum">    3386 </span>            : </a>
<a name="3387"><span class="lineNum">    3387 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[0].c_mark =</span></a>
<a name="3388"><span class="lineNum">    3388 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3389"><span class="lineNum">    3389 </span>            :                                         stutter_exit_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3390"><span class="lineNum">    3390 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[1].c_mark =</span></a>
<a name="3391"><span class="lineNum">    3391 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3392"><span class="lineNum">    3392 </span>            :                                         stutter_exit_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3393"><span class="lineNum">    3393 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[2].c_mark =</span></a>
<a name="3394"><span class="lineNum">    3394 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3395"><span class="lineNum">    3395 </span>            :                                         stutter_exit_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3396"><span class="lineNum">    3396 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3397"><span class="lineNum">    3397 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[3].c_mark =</span></a>
<a name="3398"><span class="lineNum">    3398 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3399"><span class="lineNum">    3399 </span>            :                                                 stutter_exit_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3400"><span class="lineNum">    3400 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[4].c_mark =</span></a>
<a name="3401"><span class="lineNum">    3401 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3402"><span class="lineNum">    3402 </span>            :                                                 stutter_exit_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3403"><span class="lineNum">    3403 </span>            :                         } else {</a>
<a name="3404"><span class="lineNum">    3404 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[3].c_mark =</span></a>
<a name="3405"><span class="lineNum">    3405 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3406"><span class="lineNum">    3406 </span>            :                                                 stutter_exit_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3407"><span class="lineNum">    3407 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_exit_wm_ns[4].c_mark =</span></a>
<a name="3408"><span class="lineNum">    3408 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3409"><span class="lineNum">    3409 </span>            :                                                 stutter_exit_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3410"><span class="lineNum">    3410 </span>            :                         }</a>
<a name="3411"><span class="lineNum">    3411 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[5].c_mark =</span></a>
<a name="3412"><span class="lineNum">    3412 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3413"><span class="lineNum">    3413 </span>            :                                         stutter_exit_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3414"><span class="lineNum">    3414 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[0].c_mark =</span></a>
<a name="3415"><span class="lineNum">    3415 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3416"><span class="lineNum">    3416 </span>            :                                         stutter_entry_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3417"><span class="lineNum">    3417 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[1].c_mark =</span></a>
<a name="3418"><span class="lineNum">    3418 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3419"><span class="lineNum">    3419 </span>            :                                         stutter_entry_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3420"><span class="lineNum">    3420 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[2].c_mark =</span></a>
<a name="3421"><span class="lineNum">    3421 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3422"><span class="lineNum">    3422 </span>            :                                         stutter_entry_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3423"><span class="lineNum">    3423 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3424"><span class="lineNum">    3424 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[3].c_mark =</span></a>
<a name="3425"><span class="lineNum">    3425 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;stutter_entry_watermark[0],</span></a>
<a name="3426"><span class="lineNum">    3426 </span>            :                                                 bw_int_to_fixed(1000)));</a>
<a name="3427"><span class="lineNum">    3427 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[4].c_mark =</span></a>
<a name="3428"><span class="lineNum">    3428 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;stutter_entry_watermark[1],</span></a>
<a name="3429"><span class="lineNum">    3429 </span>            :                                                 bw_int_to_fixed(1000)));</a>
<a name="3430"><span class="lineNum">    3430 </span>            :                         } else {</a>
<a name="3431"><span class="lineNum">    3431 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[3].c_mark =</span></a>
<a name="3432"><span class="lineNum">    3432 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;stutter_entry_watermark[7],</span></a>
<a name="3433"><span class="lineNum">    3433 </span>            :                                                 bw_int_to_fixed(1000)));</a>
<a name="3434"><span class="lineNum">    3434 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;stutter_entry_wm_ns[4].c_mark =</span></a>
<a name="3435"><span class="lineNum">    3435 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;stutter_entry_watermark[8],</span></a>
<a name="3436"><span class="lineNum">    3436 </span>            :                                                 bw_int_to_fixed(1000)));</a>
<a name="3437"><span class="lineNum">    3437 </span>            :                         }</a>
<a name="3438"><span class="lineNum">    3438 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[5].c_mark =</span></a>
<a name="3439"><span class="lineNum">    3439 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3440"><span class="lineNum">    3440 </span>            :                                         stutter_entry_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3441"><span class="lineNum">    3441 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[0].c_mark =</span></a>
<a name="3442"><span class="lineNum">    3442 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3443"><span class="lineNum">    3443 </span>            :                                         urgent_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3444"><span class="lineNum">    3444 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[1].c_mark =</span></a>
<a name="3445"><span class="lineNum">    3445 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3446"><span class="lineNum">    3446 </span>            :                                         urgent_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3447"><span class="lineNum">    3447 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[2].c_mark =</span></a>
<a name="3448"><span class="lineNum">    3448 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3449"><span class="lineNum">    3449 </span>            :                                         urgent_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3450"><span class="lineNum">    3450 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3451"><span class="lineNum">    3451 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[3].c_mark =</span></a>
<a name="3452"><span class="lineNum">    3452 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3453"><span class="lineNum">    3453 </span>            :                                                 urgent_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3454"><span class="lineNum">    3454 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[4].c_mark =</span></a>
<a name="3455"><span class="lineNum">    3455 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3456"><span class="lineNum">    3456 </span>            :                                                 urgent_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3457"><span class="lineNum">    3457 </span>            :                         } else {</a>
<a name="3458"><span class="lineNum">    3458 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[3].c_mark =</span></a>
<a name="3459"><span class="lineNum">    3459 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3460"><span class="lineNum">    3460 </span>            :                                                 urgent_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3461"><span class="lineNum">    3461 </span><span class="lineNoCov">          0 :                                 calcs_output-&gt;urgent_wm_ns[4].c_mark =</span></a>
<a name="3462"><span class="lineNum">    3462 </span><span class="lineNoCov">          0 :                                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3463"><span class="lineNum">    3463 </span>            :                                                 urgent_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3464"><span class="lineNum">    3464 </span>            :                         }</a>
<a name="3465"><span class="lineNum">    3465 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[5].c_mark =</span></a>
<a name="3466"><span class="lineNum">    3466 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3467"><span class="lineNum">    3467 </span>            :                                         urgent_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3468"><span class="lineNum">    3468 </span>            :                 }</a>
<a name="3469"><span class="lineNum">    3469 </span>            : </a>
<a name="3470"><span class="lineNum">    3470 </span><span class="lineNoCov">          0 :                 if (dceip-&gt;version == BW_CALCS_VERSION_CARRIZO) {</span></a>
<a name="3471"><span class="lineNum">    3471 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;low_yclk = high_yclk;</span></a>
<a name="3472"><span class="lineNum">    3472 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid_yclk = high_yclk;</span></a>
<a name="3473"><span class="lineNum">    3473 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;low_sclk = high_sclk;</span></a>
<a name="3474"><span class="lineNum">    3474 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid1_sclk = high_sclk;</span></a>
<a name="3475"><span class="lineNum">    3475 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid2_sclk = high_sclk;</span></a>
<a name="3476"><span class="lineNum">    3476 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid3_sclk = high_sclk;</span></a>
<a name="3477"><span class="lineNum">    3477 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid4_sclk = high_sclk;</span></a>
<a name="3478"><span class="lineNum">    3478 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid5_sclk = high_sclk;</span></a>
<a name="3479"><span class="lineNum">    3479 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid6_sclk = high_sclk;</span></a>
<a name="3480"><span class="lineNum">    3480 </span>            :                 } else {</a>
<a name="3481"><span class="lineNum">    3481 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;low_yclk = mid_yclk;</span></a>
<a name="3482"><span class="lineNum">    3482 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;low_sclk = mid3_sclk;</span></a>
<a name="3483"><span class="lineNum">    3483 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid1_sclk = mid3_sclk;</span></a>
<a name="3484"><span class="lineNum">    3484 </span><span class="lineNoCov">          0 :                         ((struct bw_calcs_vbios *)vbios)-&gt;mid2_sclk = mid3_sclk;</span></a>
<a name="3485"><span class="lineNum">    3485 </span>            :                 }</a>
<a name="3486"><span class="lineNum">    3486 </span>            : </a>
<a name="3487"><span class="lineNum">    3487 </span><span class="lineNoCov">          0 :                 calculate_bandwidth(dceip, vbios, data);</span></a>
<a name="3488"><span class="lineNum">    3488 </span>            : </a>
<a name="3489"><span class="lineNum">    3489 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[0].d_mark =</span></a>
<a name="3490"><span class="lineNum">    3490 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3491"><span class="lineNum">    3491 </span>            :                                 nbp_state_change_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3492"><span class="lineNum">    3492 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[1].d_mark =</span></a>
<a name="3493"><span class="lineNum">    3493 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3494"><span class="lineNum">    3494 </span>            :                                 nbp_state_change_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3495"><span class="lineNum">    3495 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[2].d_mark =</span></a>
<a name="3496"><span class="lineNum">    3496 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3497"><span class="lineNum">    3497 </span>            :                                 nbp_state_change_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3498"><span class="lineNum">    3498 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3499"><span class="lineNum">    3499 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[3].d_mark =</span></a>
<a name="3500"><span class="lineNum">    3500 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3501"><span class="lineNum">    3501 </span>            :                                         nbp_state_change_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3502"><span class="lineNum">    3502 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[4].d_mark =</span></a>
<a name="3503"><span class="lineNum">    3503 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3504"><span class="lineNum">    3504 </span>            :                                         nbp_state_change_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3505"><span class="lineNum">    3505 </span>            :                 } else {</a>
<a name="3506"><span class="lineNum">    3506 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[3].d_mark =</span></a>
<a name="3507"><span class="lineNum">    3507 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3508"><span class="lineNum">    3508 </span>            :                                         nbp_state_change_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3509"><span class="lineNum">    3509 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;nbp_state_change_wm_ns[4].d_mark =</span></a>
<a name="3510"><span class="lineNum">    3510 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3511"><span class="lineNum">    3511 </span>            :                                         nbp_state_change_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3512"><span class="lineNum">    3512 </span>            :                 }</a>
<a name="3513"><span class="lineNum">    3513 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_wm_ns[5].d_mark =</span></a>
<a name="3514"><span class="lineNum">    3514 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3515"><span class="lineNum">    3515 </span>            :                                 nbp_state_change_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3516"><span class="lineNum">    3516 </span>            : </a>
<a name="3517"><span class="lineNum">    3517 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[0].d_mark =</span></a>
<a name="3518"><span class="lineNum">    3518 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3519"><span class="lineNum">    3519 </span>            :                                 stutter_exit_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3520"><span class="lineNum">    3520 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[1].d_mark =</span></a>
<a name="3521"><span class="lineNum">    3521 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3522"><span class="lineNum">    3522 </span>            :                                 stutter_exit_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3523"><span class="lineNum">    3523 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[2].d_mark =</span></a>
<a name="3524"><span class="lineNum">    3524 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3525"><span class="lineNum">    3525 </span>            :                                 stutter_exit_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3526"><span class="lineNum">    3526 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3527"><span class="lineNum">    3527 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[3].d_mark =</span></a>
<a name="3528"><span class="lineNum">    3528 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3529"><span class="lineNum">    3529 </span>            :                                         stutter_exit_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3530"><span class="lineNum">    3530 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[4].d_mark =</span></a>
<a name="3531"><span class="lineNum">    3531 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3532"><span class="lineNum">    3532 </span>            :                                         stutter_exit_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3533"><span class="lineNum">    3533 </span>            :                 } else {</a>
<a name="3534"><span class="lineNum">    3534 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[3].d_mark =</span></a>
<a name="3535"><span class="lineNum">    3535 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3536"><span class="lineNum">    3536 </span>            :                                         stutter_exit_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3537"><span class="lineNum">    3537 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_exit_wm_ns[4].d_mark =</span></a>
<a name="3538"><span class="lineNum">    3538 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3539"><span class="lineNum">    3539 </span>            :                                         stutter_exit_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3540"><span class="lineNum">    3540 </span>            :                 }</a>
<a name="3541"><span class="lineNum">    3541 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_exit_wm_ns[5].d_mark =</span></a>
<a name="3542"><span class="lineNum">    3542 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3543"><span class="lineNum">    3543 </span>            :                                 stutter_exit_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3544"><span class="lineNum">    3544 </span>            : </a>
<a name="3545"><span class="lineNum">    3545 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[0].d_mark =</span></a>
<a name="3546"><span class="lineNum">    3546 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3547"><span class="lineNum">    3547 </span>            :                                 stutter_entry_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3548"><span class="lineNum">    3548 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[1].d_mark =</span></a>
<a name="3549"><span class="lineNum">    3549 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3550"><span class="lineNum">    3550 </span>            :                                 stutter_entry_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3551"><span class="lineNum">    3551 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[2].d_mark =</span></a>
<a name="3552"><span class="lineNum">    3552 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3553"><span class="lineNum">    3553 </span>            :                                 stutter_entry_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3554"><span class="lineNum">    3554 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3555"><span class="lineNum">    3555 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[3].d_mark =</span></a>
<a name="3556"><span class="lineNum">    3556 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3557"><span class="lineNum">    3557 </span>            :                                         stutter_entry_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3558"><span class="lineNum">    3558 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[4].d_mark =</span></a>
<a name="3559"><span class="lineNum">    3559 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3560"><span class="lineNum">    3560 </span>            :                                         stutter_entry_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3561"><span class="lineNum">    3561 </span>            :                 } else {</a>
<a name="3562"><span class="lineNum">    3562 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[3].d_mark =</span></a>
<a name="3563"><span class="lineNum">    3563 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3564"><span class="lineNum">    3564 </span>            :                                         stutter_entry_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3565"><span class="lineNum">    3565 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;stutter_entry_wm_ns[4].d_mark =</span></a>
<a name="3566"><span class="lineNum">    3566 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3567"><span class="lineNum">    3567 </span>            :                                         stutter_entry_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3568"><span class="lineNum">    3568 </span>            :                 }</a>
<a name="3569"><span class="lineNum">    3569 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_entry_wm_ns[5].d_mark =</span></a>
<a name="3570"><span class="lineNum">    3570 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3571"><span class="lineNum">    3571 </span>            :                                 stutter_entry_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3572"><span class="lineNum">    3572 </span>            : </a>
<a name="3573"><span class="lineNum">    3573 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[0].d_mark =</span></a>
<a name="3574"><span class="lineNum">    3574 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3575"><span class="lineNum">    3575 </span>            :                                 urgent_watermark[4], bw_int_to_fixed(1000)));</a>
<a name="3576"><span class="lineNum">    3576 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[1].d_mark =</span></a>
<a name="3577"><span class="lineNum">    3577 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3578"><span class="lineNum">    3578 </span>            :                                 urgent_watermark[5], bw_int_to_fixed(1000)));</a>
<a name="3579"><span class="lineNum">    3579 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[2].d_mark =</span></a>
<a name="3580"><span class="lineNum">    3580 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3581"><span class="lineNum">    3581 </span>            :                                 urgent_watermark[6], bw_int_to_fixed(1000)));</a>
<a name="3582"><span class="lineNum">    3582 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;dc-&gt;caps.max_slave_planes) {</span></a>
<a name="3583"><span class="lineNum">    3583 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[3].d_mark =</span></a>
<a name="3584"><span class="lineNum">    3584 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3585"><span class="lineNum">    3585 </span>            :                                         urgent_watermark[0], bw_int_to_fixed(1000)));</a>
<a name="3586"><span class="lineNum">    3586 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[4].d_mark =</span></a>
<a name="3587"><span class="lineNum">    3587 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3588"><span class="lineNum">    3588 </span>            :                                         urgent_watermark[1], bw_int_to_fixed(1000)));</a>
<a name="3589"><span class="lineNum">    3589 </span>            :                 } else {</a>
<a name="3590"><span class="lineNum">    3590 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[3].d_mark =</span></a>
<a name="3591"><span class="lineNum">    3591 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3592"><span class="lineNum">    3592 </span>            :                                         urgent_watermark[7], bw_int_to_fixed(1000)));</a>
<a name="3593"><span class="lineNum">    3593 </span><span class="lineNoCov">          0 :                         calcs_output-&gt;urgent_wm_ns[4].d_mark =</span></a>
<a name="3594"><span class="lineNum">    3594 </span><span class="lineNoCov">          0 :                                 bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3595"><span class="lineNum">    3595 </span>            :                                         urgent_watermark[8], bw_int_to_fixed(1000)));</a>
<a name="3596"><span class="lineNum">    3596 </span>            :                 }</a>
<a name="3597"><span class="lineNum">    3597 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;urgent_wm_ns[5].d_mark =</span></a>
<a name="3598"><span class="lineNum">    3598 </span><span class="lineNoCov">          0 :                         bw_fixed_to_int(bw_mul(data-&gt;</span></a>
<a name="3599"><span class="lineNum">    3599 </span>            :                                 urgent_watermark[9], bw_int_to_fixed(1000)));</a>
<a name="3600"><span class="lineNum">    3600 </span>            : </a>
<a name="3601"><span class="lineNum">    3601 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;low_yclk = low_yclk;</span></a>
<a name="3602"><span class="lineNum">    3602 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;mid_yclk = mid_yclk;</span></a>
<a name="3603"><span class="lineNum">    3603 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;low_sclk = low_sclk;</span></a>
<a name="3604"><span class="lineNum">    3604 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;mid1_sclk = mid1_sclk;</span></a>
<a name="3605"><span class="lineNum">    3605 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;mid2_sclk = mid2_sclk;</span></a>
<a name="3606"><span class="lineNum">    3606 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;mid3_sclk = mid3_sclk;</span></a>
<a name="3607"><span class="lineNum">    3607 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;mid4_sclk = mid4_sclk;</span></a>
<a name="3608"><span class="lineNum">    3608 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;mid5_sclk = mid5_sclk;</span></a>
<a name="3609"><span class="lineNum">    3609 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;mid6_sclk = mid6_sclk;</span></a>
<a name="3610"><span class="lineNum">    3610 </span><span class="lineNoCov">          0 :                 ((struct bw_calcs_vbios *)vbios)-&gt;high_sclk = high_sclk;</span></a>
<a name="3611"><span class="lineNum">    3611 </span>            :         } else {</a>
<a name="3612"><span class="lineNum">    3612 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;nbp_state_change_enable = true;</span></a>
<a name="3613"><span class="lineNum">    3613 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;cpuc_state_change_enable = true;</span></a>
<a name="3614"><span class="lineNum">    3614 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;cpup_state_change_enable = true;</span></a>
<a name="3615"><span class="lineNum">    3615 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;stutter_mode_enable = true;</span></a>
<a name="3616"><span class="lineNum">    3616 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;dispclk_khz = 0;</span></a>
<a name="3617"><span class="lineNum">    3617 </span><span class="lineNoCov">          0 :                 calcs_output-&gt;sclk_khz = 0;</span></a>
<a name="3618"><span class="lineNum">    3618 </span>            :         }</a>
<a name="3619"><span class="lineNum">    3619 </span>            : </a>
<a name="3620"><span class="lineNum">    3620 </span><span class="lineNoCov">          0 :         kfree(data);</span></a>
<a name="3621"><span class="lineNum">    3621 </span>            : </a>
<a name="3622"><span class="lineNum">    3622 </span><span class="lineNoCov">          0 :         return is_display_configuration_supported(vbios, calcs_output);</span></a>
<a name="3623"><span class="lineNum">    3623 </span>            : }</a>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.14</a></td></tr>
  </table>
  <br>

</body>
</html>
